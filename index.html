
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Driverworks Reference</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-9c19b03a.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-966d6edc.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-b12a2749.js"></script>

  </head>

  <body class="index" data-languages="[&quot;lua&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-3056e635.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="lua">lua</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#license-copyright-and-trademark" class="toc-h1 toc-link" data-title="License, Copyright, and Trademark">License, Copyright, and Trademark</a>
          </li>
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#what-s-new-in-the-fundamentals-guide" class="toc-h1 toc-link" data-title="What’s New in the Fundamentals Guide">What’s New in the Fundamentals Guide</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-4-2" class="toc-h2 toc-link" data-title="What’s New in 3.4.2">What’s New in 3.4.2</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-4-1" class="toc-h2 toc-link" data-title="What’s New in 3.4.1">What’s New in 3.4.1</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-4-0" class="toc-h2 toc-link" data-title="What’s New in 3.4.0">What’s New in 3.4.0</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-3-2" class="toc-h2 toc-link" data-title="What’s New in 3.3.2">What’s New in 3.3.2</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-3-1" class="toc-h2 toc-link" data-title="What’s New in 3.3.1">What’s New in 3.3.1</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-3-0" class="toc-h2 toc-link" data-title="What’s New in 3.3.0">What’s New in 3.3.0</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-3" class="toc-h2 toc-link" data-title="What’s New in 3.2.3">What’s New in 3.2.3</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-2" class="toc-h2 toc-link" data-title="What’s New in 3.2.2">What’s New in 3.2.2</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-1" class="toc-h2 toc-link" data-title="What’s New in 3.2.1">What’s New in 3.2.1</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-0" class="toc-h2 toc-link" data-title="What’s New in 3.2.0">What’s New in 3.2.0</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-3" class="toc-h2 toc-link" data-title="What was New in 3.1.3">What was New in 3.1.3</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-2" class="toc-h2 toc-link" data-title="What was New in 3.1.2">What was New in 3.1.2</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-0" class="toc-h2 toc-link" data-title="What was New in 3.1.0">What was New in 3.1.0</a>
                  </li>
                  <li>
                    <a href="#what-s-new-in-the-fundamentals-guide-what-was-new-in-o-s-3" class="toc-h2 toc-link" data-title="What was New in O.S.3">What was New in O.S.3</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#important-concepts-and-terminology" class="toc-h1 toc-link" data-title="Important Concepts and Terminology">Important Concepts and Terminology</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#important-concepts-and-terminology-proxy-driver" class="toc-h2 toc-link" data-title="Proxy Driver">Proxy Driver</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-protocol-driver" class="toc-h2 toc-link" data-title="Protocol Driver">Protocol Driver</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-combo-driver" class="toc-h2 toc-link" data-title="Combo Driver">Combo Driver</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-proxy-binding" class="toc-h2 toc-link" data-title="Proxy Binding">Proxy Binding</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-c4z-file" class="toc-h2 toc-link" data-title=".c4z File">.c4z File</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-communication-protocol" class="toc-h2 toc-link" data-title="Communication Protocol">Communication Protocol</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-lua" class="toc-h2 toc-link" data-title="Lua">Lua</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-lua-ide" class="toc-h2 toc-link" data-title="Lua IDE">Lua IDE</a>
                  </li>
                  <li>
                    <a href="#important-concepts-and-terminology-driver-development-terminology" class="toc-h2 toc-link" data-title="Driver Development Terminology">Driver Development Terminology</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#understanding-c4z-drivers" class="toc-h1 toc-link" data-title="Understanding .c4z Drivers">Understanding .c4z Drivers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#understanding-c4z-drivers-overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#understanding-c4z-drivers-identifying-a-c4z-driver" class="toc-h2 toc-link" data-title="Identifying a .c4z Driver">Identifying a .c4z Driver</a>
                  </li>
                  <li>
                    <a href="#understanding-c4z-drivers-c4-allowexecute-api" class="toc-h2 toc-link" data-title="C4:AllowExecute API">C4:AllowExecute API</a>
                  </li>
                  <li>
                    <a href="#understanding-c4z-drivers-squishlua-and-driver-encryption" class="toc-h2 toc-link" data-title="SquishLua and Driver Encryption">SquishLua and Driver Encryption</a>
                  </li>
                  <li>
                    <a href="#understanding-c4z-drivers-replacing-a-c4i-file-with-c4z" class="toc-h2 toc-link" data-title="Replacing a .c4i file with .c4z">Replacing a .c4i file with .c4z</a>
                  </li>
                  <li>
                    <a href="#understanding-c4z-drivers-what-is-a-c4zproj-file" class="toc-h2 toc-link" data-title="What is a .c4zproj File">What is a .c4zproj File</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#driverworks-and-luajit" class="toc-h1 toc-link" data-title="DriverWorks and luajit">DriverWorks and luajit</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#driverworks-and-luajit-control4-os-3-and-luajit" class="toc-h2 toc-link" data-title="Control4 OS 3 and LuaJIT">Control4 OS 3 and LuaJIT</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#proxies-and-proxy-types" class="toc-h1 toc-link" data-title="Proxies and Proxy Types">Proxies and Proxy Types</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#proxies-and-proxy-types-single-and-multi-proxies" class="toc-h2 toc-link" data-title="Single and Multi-Proxies">Single and Multi-Proxies</a>
                  </li>
                  <li>
                    <a href="#proxies-and-proxy-types-modifying-the-default-naming-of-proxies" class="toc-h2 toc-link" data-title="Modifying the Default Naming of Proxies">Modifying the Default Naming of Proxies</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#commands" class="toc-h1 toc-link" data-title="Commands">Commands</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#commands-supported-command-parameter-types" class="toc-h2 toc-link" data-title="Supported Command Parameter Types">Supported Command Parameter Types</a>
                  </li>
                  <li>
                    <a href="#commands-getcommandparamlist" class="toc-h2 toc-link" data-title="GetCommandParamList">GetCommandParamList</a>
                  </li>
                  <li>
                    <a href="#commands-dynamic-list-type-for-commands" class="toc-h2 toc-link" data-title="Dynamic List type for Commands">Dynamic List type for Commands</a>
                  </li>
                  <li>
                    <a href="#commands-sorting-commands-in-composerpro" class="toc-h2 toc-link" data-title="Sorting Commands in ComposerPro">Sorting Commands in ComposerPro</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#conditionals" class="toc-h1 toc-link" data-title="Conditionals">Conditionals</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#conditionals-overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#conditionals-simple-conditional" class="toc-h2 toc-link" data-title="Simple Conditional">Simple Conditional</a>
                  </li>
                  <li>
                    <a href="#conditionals-conditional-xml-example-code" class="toc-h2 toc-link" data-title="Conditional XML Example Code">Conditional XML Example Code</a>
                  </li>
                  <li>
                    <a href="#conditionals-using-the-test-condition-function" class="toc-h2 toc-link" data-title="Using the Test Condition Function">Using the Test Condition Function</a>
                  </li>
                  <li>
                    <a href="#conditionals-understanding-xml-in-a-list-type-conditional" class="toc-h2 toc-link" data-title="Understanding XML in a LIST Type Conditional">Understanding XML in a LIST Type Conditional</a>
                  </li>
                  <li>
                    <a href="#conditionals-understanding-xml-in-a-string-type-conditional" class="toc-h2 toc-link" data-title="Understanding XML in a STRING Type Conditional">Understanding XML in a STRING Type Conditional</a>
                  </li>
                  <li>
                    <a href="#conditionals-understanding-xml-in-a-number-type-conditional" class="toc-h2 toc-link" data-title="Understanding XML in a NUMBER Type Conditional">Understanding XML in a NUMBER Type Conditional</a>
                  </li>
                  <li>
                    <a href="#conditionals-understanding-xml-in-a-boolean-type-conditional" class="toc-h2 toc-link" data-title="Understanding XML in a BOOLEAN Type Conditional">Understanding XML in a BOOLEAN Type Conditional</a>
                  </li>
                  <li>
                    <a href="#conditionals-understanding-xml-in-a-device-type-conditional" class="toc-h2 toc-link" data-title="Understanding XML in a DEVICE Type Conditional">Understanding XML in a DEVICE Type Conditional</a>
                  </li>
                  <li>
                    <a href="#conditionals-understanding-xml-in-a-room-type-conditional" class="toc-h2 toc-link" data-title="Understanding XML in a ROOM Type Conditional">Understanding XML in a ROOM Type Conditional</a>
                  </li>
                  <li>
                    <a href="#conditionals-creating-dynamic-driver-conditionals" class="toc-h2 toc-link" data-title="Creating Dynamic Driver Conditionals">Creating Dynamic Driver Conditionals</a>
                  </li>
                  <li>
                    <a href="#conditionals-getconditionals" class="toc-h2 toc-link" data-title="GetConditionals()">GetConditionals()</a>
                  </li>
                  <li>
                    <a href="#conditionals-sorting-conditionals-in-composerpro" class="toc-h2 toc-link" data-title="Sorting Conditionals in ComposerPro">Sorting Conditionals in ComposerPro</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#connections" class="toc-h1 toc-link" data-title="Connections">Connections</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#connections-overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#connections-contact-and-relay-bindings" class="toc-h2 toc-link" data-title="Contact and Relay Bindings">Contact and Relay Bindings</a>
                  </li>
                  <li>
                    <a href="#connections-control-bindings" class="toc-h2 toc-link" data-title="Control Bindings">Control Bindings</a>
                  </li>
                  <li>
                    <a href="#connections-non-binding-connection" class="toc-h2 toc-link" data-title="Non-Binding Connection">Non-Binding Connection</a>
                  </li>
                  <li>
                    <a href="#connections-proxy-binding-multiple-proxies" class="toc-h2 toc-link" data-title="Proxy Binding Multiple Proxies">Proxy Binding Multiple Proxies</a>
                  </li>
                  <li>
                    <a href="#connections-proxy-binding-single-proxy-examples" class="toc-h2 toc-link" data-title="Proxy Binding Single Proxy Examples">Proxy Binding Single Proxy Examples</a>
                  </li>
                  <li>
                    <a href="#connections-user-datagram-protocol" class="toc-h2 toc-link" data-title="User Datagram Protocol">User Datagram Protocol</a>
                  </li>
                  <li>
                    <a href="#connections-favored-and-blocked-av-connection-classes" class="toc-h2 toc-link" data-title="Favored and Blocked AV Connection Classes">Favored and Blocked AV Connection Classes</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#custom-select-implementation" class="toc-h1 toc-link" data-title="CUSTOM SELECT Implementation">CUSTOM SELECT Implementation</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#custom-select-implementation-favored-and-blocked-av-connection-classes-how-actions-work-in-your-driver" class="toc-h2 toc-link" data-title="How Actions work in Your Driver">How Actions work in Your Driver</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options" class="toc-h2 toc-link" data-title="Action Configuration Options">Action Configuration Options</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-favored-and-blocked-av-connection-classes-implementation-steps" class="toc-h2 toc-link" data-title="Implementation Steps">Implementation Steps</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-favored-and-blocked-av-connection-classes-custom-select-function" class="toc-h2 toc-link" data-title="Custom Select Function">Custom Select Function</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-favored-and-blocked-av-connection-classes-understanding-action-workflow" class="toc-h2 toc-link" data-title="Understanding Action Workflow">Understanding Action Workflow</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-custom_select-list" class="toc-h2 toc-link" data-title="CUSTOM_SELECT List">CUSTOM_SELECT List</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-custom_select-search" class="toc-h2 toc-link" data-title="CUSTOM_SELECT Search">CUSTOM_SELECT Search</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-custom_select-filter" class="toc-h2 toc-link" data-title="CUSTOM_SELECT Filter">CUSTOM_SELECT Filter</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-custom_select-folder" class="toc-h2 toc-link" data-title="CUSTOM_SELECT Folder">CUSTOM_SELECT Folder</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-custom_select-async-all" class="toc-h2 toc-link" data-title="CUSTOM_SELECT Async All">CUSTOM_SELECT Async All</a>
                  </li>
                  <li>
                    <a href="#custom-select-implementation-custom_select-all" class="toc-h2 toc-link" data-title="CUSTOM_SELECT All">CUSTOM_SELECT All</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#events" class="toc-h1 toc-link" data-title="Events">Events</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#events-history-event-notifications" class="toc-h2 toc-link" data-title="History Event Notifications">History Event Notifications</a>
                  </li>
                  <li>
                    <a href="#events-sorting-events-in-composerpro" class="toc-h2 toc-link" data-title="Sorting Events in ComposerPro">Sorting Events in ComposerPro</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#capabilities" class="toc-h1 toc-link" data-title="Capabilities">Capabilities</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#capabilities-capabilities" class="toc-h2 toc-link" data-title="Capabilities">Capabilities</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#creating-or-modifying-driverworks-drivers" class="toc-h1 toc-link" data-title="Creating or Modifying DriverWorks Drivers">Creating or Modifying DriverWorks Drivers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#creating-or-modifying-driverworks-drivers-introduction" class="toc-h2 toc-link" data-title="Introduction">Introduction</a>
                  </li>
                  <li>
                    <a href="#creating-or-modifying-driverworks-drivers-development-process-flow" class="toc-h2 toc-link" data-title="Development Process Flow">Development Process Flow</a>
                  </li>
                  <li>
                    <a href="#creating-or-modifying-driverworks-drivers-template-development-process-flow" class="toc-h2 toc-link" data-title="Template Development Process Flow">Template Development Process Flow</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#updating-released-drivers" class="toc-h1 toc-link" data-title="Updating Released Drivers">Updating Released Drivers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#updating-released-drivers-automatically-updating-released-drivers" class="toc-h2 toc-link" data-title="Automatically Updating Released Drivers">Automatically Updating Released Drivers</a>
                  </li>
                  <li>
                    <a href="#updating-released-drivers-driver-update-limitations-and-considerations" class="toc-h2 toc-link" data-title="Driver Update Limitations and Considerations">Driver Update Limitations and Considerations</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#composerpro-the-interface-into-the-sdk" class="toc-h1 toc-link" data-title="ComposerPro: The Interface into the SDK">ComposerPro: The Interface into the SDK</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-properties" class="toc-h2 toc-link" data-title="Properties">Properties</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-dynamic-list-properties" class="toc-h2 toc-link" data-title="Dynamic List Properties">Dynamic List Properties</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-advanced-properties" class="toc-h2 toc-link" data-title="Advanced Properties">Advanced Properties</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-using-the-device-selector-property" class="toc-h2 toc-link" data-title="Using the DEVICE SELECTOR Property">Using the DEVICE SELECTOR Property</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-using-the-custom-select-property" class="toc-h2 toc-link" data-title="Using the CUSTOM SELECT Property">Using the CUSTOM SELECT Property</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-using-the-color-selector-property" class="toc-h2 toc-link" data-title="Using the COLOR SELECTOR Property">Using the COLOR SELECTOR Property</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-actions" class="toc-h2 toc-link" data-title="ACTIONS">ACTIONS</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-lua" class="toc-h2 toc-link" data-title="LUA">LUA</a>
                  </li>
                  <li>
                    <a href="#composerpro-the-interface-into-the-sdk-programming" class="toc-h2 toc-link" data-title="PROGRAMMING">PROGRAMMING</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#director" class="toc-h1 toc-link" data-title="Director">Director</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#director-director-and-geo-location-services" class="toc-h2 toc-link" data-title="Director and Geo Location Services">Director and Geo Location Services</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#system-manager-logging" class="toc-h1 toc-link" data-title="System Manager Logging">System Manager Logging</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#system-manager-logging-introduction" class="toc-h2 toc-link" data-title="Introduction">Introduction</a>
                  </li>
                  <li>
                    <a href="#system-manager-logging-system-manager-logging-ui" class="toc-h2 toc-link" data-title="System Manager Logging UI">System Manager Logging UI</a>
                  </li>
                  <li>
                    <a href="#system-manager-logging-sorting-and-filtering-the-log-view" class="toc-h2 toc-link" data-title="Sorting and Filtering the Log View">Sorting and Filtering the Log View</a>
                  </li>
                  <li>
                    <a href="#system-manager-logging-supported-log-types" class="toc-h2 toc-link" data-title="Supported Log Types">Supported Log Types</a>
                  </li>
                  <li>
                    <a href="#system-manager-logging-changing-log-levels" class="toc-h2 toc-link" data-title="Changing Log Levels">Changing Log Levels</a>
                  </li>
                  <li>
                    <a href="#system-manager-logging-viewing-log-file-data" class="toc-h2 toc-link" data-title="Viewing Log File Data">Viewing Log File Data</a>
                  </li>
                  <li>
                    <a href="#system-manager-logging-adding-a-log-appender-column" class="toc-h2 toc-link" data-title="Adding a Log Appender Column">Adding a Log Appender Column</a>
                  </li>
                  <li>
                    <a href="#system-manager-logging-advanced-logging-capabilities" class="toc-h2 toc-link" data-title="Advanced Logging Capabilities">Advanced Logging Capabilities</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#handling-binary-data" class="toc-h1 toc-link" data-title="Handling Binary Data">Handling Binary Data</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#handling-binary-data-operating-system-3-and-binary-data" class="toc-h2 toc-link" data-title="Operating System 3 and Binary Data">Operating System 3 and Binary Data</a>
                  </li>
                  <li>
                    <a href="#handling-binary-data-using-the-bit-library" class="toc-h2 toc-link" data-title="Using the Bit Library">Using the Bit Library</a>
                  </li>
                  <li>
                    <a href="#handling-binary-data-using-string-pack" class="toc-h2 toc-link" data-title="Using string.pack">Using string.pack</a>
                  </li>
                  <li>
                    <a href="#handling-binary-data-using-string-unpack" class="toc-h2 toc-link" data-title="Using string.unpack">Using string.unpack</a>
                  </li>
                  <li>
                    <a href="#handling-binary-data-using-pack-and-unpack-format-operators" class="toc-h2 toc-link" data-title="Using Pack and Unpack Format Operators">Using Pack and Unpack Format Operators</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#handling-xml-code" class="toc-h1 toc-link" data-title="Handling XML Code">Handling XML Code</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#handling-xml-code-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers" class="toc-h2 toc-link" data-title="Using XML Dependencies to Automatically Load and Bind Dependent Drivers">Using XML Dependencies to Automatically Load and Bind Dependent Drivers</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#driver-icon-management" class="toc-h1 toc-link" data-title="Driver Icon Management">Driver Icon Management</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-managing-driver-icons" class="toc-h2 toc-link" data-title="Managing Driver Icons">Managing Driver Icons</a>
                  </li>
                  <li>
                    <a href="#driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-combo-drivers" class="toc-h2 toc-link" data-title="Combo Drivers">Combo Drivers</a>
                  </li>
                  <li>
                    <a href="#driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-single-proxy-drivers" class="toc-h2 toc-link" data-title="Single Proxy Drivers">Single Proxy Drivers</a>
                  </li>
                  <li>
                    <a href="#driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-multi-proxy-drivers" class="toc-h2 toc-link" data-title="Multi Proxy Drivers">Multi Proxy Drivers</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#qr-codes-and-drivers" class="toc-h1 toc-link" data-title="QR Codes and Drivers">QR Codes and Drivers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#qr-codes-and-drivers-using-qr-codes-to-identify-and-download-drivers" class="toc-h2 toc-link" data-title="Using QR Codes to Identify and Download Drivers">Using QR Codes to Identify and Download Drivers</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#universal-minidrivers" class="toc-h1 toc-link" data-title="Universal Minidrivers">Universal Minidrivers</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#universal-minidrivers-overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#driverworks-agents" class="toc-h1 toc-link" data-title="DriverWorks Agents">DriverWorks Agents</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#driverworks-agents-overview-agents-vs-drivers" class="toc-h2 toc-link" data-title="Agents vs. Drivers">Agents vs. Drivers</a>
                  </li>
                  <li>
                    <a href="#driverworks-agents-overview-creating-an-agent-from-an-existing-driver" class="toc-h2 toc-link" data-title="Creating an Agent from an Existing Driver">Creating an Agent from an Existing Driver</a>
                  </li>
                  <li>
                    <a href="#driverworks-agents-overview-managing-driverworks-agents" class="toc-h2 toc-link" data-title="Managing DriverWorks Agents">Managing DriverWorks Agents</a>
                  </li>
                  <li>
                    <a href="#driverworks-agents-overview-loading-a-driverworks-agent" class="toc-h2 toc-link" data-title="Loading a DriverWorks Agent">Loading a DriverWorks Agent</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#command-handling-and-dropped-connections" class="toc-h1 toc-link" data-title="Command Handling and Dropped Connections">Command Handling and Dropped Connections</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#command-handling-and-dropped-connections-command-handling-and-dropped-network-connections" class="toc-h2 toc-link" data-title="Command Handling and Dropped Network Connections">Command Handling and Dropped Network Connections</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#persisting-driver-data" class="toc-h1 toc-link" data-title="Persisting Driver Data">Persisting Driver Data</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#persisting-driver-data-persisting-driver-data-and-the-persistdata-table" class="toc-h2 toc-link" data-title="Persisting Driver Data and the PersistData Table">Persisting Driver Data and the PersistData Table</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#tls-and-ssl-driver-configuration" class="toc-h1 toc-link" data-title="TLS and SSL Driver Configuration">TLS and SSL Driver Configuration</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tls-and-ssl-driver-configuration-tls-ssl-driver-configuration" class="toc-h2 toc-link" data-title="TLS/SSL Driver Configuration">TLS/SSL Driver Configuration</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#markdown-driver-documentation" class="toc-h1 toc-link" data-title="Markdown Driver Documentation">Markdown Driver Documentation</a>
          </li>
          <li>
            <a href="#proxy-specific-information" class="toc-h1 toc-link" data-title="Proxy Specific Information">Proxy Specific Information</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#proxy-specific-information-amplifier-proxy-and-navigator-eq-controls" class="toc-h2 toc-link" data-title="Amplifier Proxy and Navigator EQ Controls">Amplifier Proxy and Navigator EQ Controls</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-av-switch-proxy-and-navigator-eq-controls" class="toc-h2 toc-link" data-title="AV Switch Proxy and Navigator EQ Controls">AV Switch Proxy and Navigator EQ Controls</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-av-switch-proxy-and-display-adjustable-bindings" class="toc-h2 toc-link" data-title="AV Switch Proxy and Display Adjustable Bindings">AV Switch Proxy and Display Adjustable Bindings</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-camera-proxy-audio-distribution" class="toc-h2 toc-link" data-title="Camera Proxy Audio Distribution">Camera Proxy Audio Distribution</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-camera-proxy-and-dynamic-streams" class="toc-h2 toc-link" data-title="Camera Proxy and Dynamic Streams">Camera Proxy and Dynamic Streams</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-intercom-proxy-best-practices" class="toc-h2 toc-link" data-title="Intercom Proxy Best Practices">Intercom Proxy Best Practices</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-intercom-proxy-terminology" class="toc-h2 toc-link" data-title="Intercom Proxy Terminology">Intercom Proxy Terminology</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-light-proxy-driver-development-best-practices" class="toc-h2 toc-link" data-title="Light Proxy Driver Development Best Practices">Light Proxy Driver Development Best Practices</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-light-proxy-extras-interface-library" class="toc-h2 toc-link" data-title="Light Proxy Extras Interface Library">Light Proxy Extras Interface Library</a>
                  </li>
                  <li>
                    <a href="#proxy-specific-information-security-sensor-types" class="toc-h2 toc-link" data-title="Security Sensor Types">Security Sensor Types</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://snap-one.github.io/docs-driverworks-introduction/'>An Introduction to DriverWorks</a></li>
            <li><a href='https://snap-one.github.io/docs-driverworks-fundamentals/'>DriverWorks Fundamentals Guide</a></li>
            <li><a href='https://snap-one.github.io/docs-driverworks-api/'>DriverWorks API Reference Guide</a></li>
            <li><a href='https://github.com/snap-one/docs-driverworks'>DriverWorks GitHub Home</a></li>
            <li><a href='https://github.com/lord/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='license-copyright-and-trademark'>License, Copyright, and Trademark</h1>

<p>The content contained in this repository is the intellectual property of Snap One, LLC, (formerly known as Wirepath Home Systems, LLC), and use without a valid license from Snap One is strictly prohibited. The user of this repository shall keep all content contained herein confidential and shall protect this content in whole or in part from disclosure to any and all third parties except as specifically authorized in writing by Snap One.</p>

<p><strong>License and Intellectual Property Disclaimer</strong></p>

<p>The content in this repository is provided in connection with Snap One products. No license, express or implied, by estoppal or otherwise, to any intellectual property rights is granted by this document or in this repository. Except as provided in Snap Oneʼs terms and conditions for the license of such products, Snap One and its affiliates assume no liability whatsoever and disclaim any express or implied warranty, relating to the sale and/or use of Snap One products including liability or warranties relating to fitness for a particular purpose, merchantability, or infringement of any patent, copyright or other intellectual property right. Snap One products are not intended for use in medical, lifesaving, or life sustaining applications.</p>

<p>Information regarding third-party products is provided solely for educational purposes. Snap One is not responsible for the performance or support of third-party products and does not make any representations or warranties whatsoever regarding the quality, reliability, functionality or compatibility of these products. The reader is advised that third parties can have intellectual property rights that can be relevant to this repository and the technologies discussed herein, and is advised to seek the advice of competent legal counsel regarding the intellectual property rights of third parties, without obligation of Snap One.</p>

<p>Snap One retains the right to make changes to this repository or related product specifications and descriptions in this repository, at any time, without notice. Snap One makes no warranty for the use of this repository and assumes no responsibility for any errors that can appear in the repository nor does it make a commitment to update the content contained herein.</p>

<p><strong>Copyright</strong></p>

<p>Copyright 2023 Snap One, LLC. All rights reserved.</p>

<p>The above copyright notice applies to all content in this repository unless otherwise stated explicitly herein that a third-party’s copyright applies.</p>

<p>No part of this publication may be reproduced, photocopied, stored on a retrieval system, or transmitted without the express written consent of the publisher.</p>

<p><strong>Trademarks</strong></p>

<p>Snap One and Snap One Logo, Control4 and the Control4 logo, and DriverWorks are trademarks or registered trademarks of  Snap One, LLC. Other product and company names mentioned in this repository may be the trademarks or registered trademarks of their respective owners.</p>

<p><strong> Derivative Works</strong></p>

<p>To the extent that you create any “Derivative Work” (meaning any work that is based upon one or more preexisting versions of the work provided to you in this repository, such as an enhancement or modification, revision, translation, abridgement, condensation, expansion, collection, compilation or any other form in which such preexisting works may be recast, modified, transformed or adapted, explicitly including without limitation, any updates or changes to Snap One, LLC’s software code or intellectual property) such Derivative Work shall be owned by Snap One, LLC and all right, title and interest in and to each such Derivative Work shall automatically vest in Snap One, LLC. To the extent any Derivative Work does not automatically vest in Snap One, LLC by operation of law, you hereby assign such Derivative Work to Snap One, LLC with full title guarantee. Snap One, LLC shall have no obligation to grant you any right in any such Derivative Work.</p>

<p><strong>Contact Us</strong></p>

<p>Snap One, LLC
11734 S. Election Road
Salt Lake City, UT 84020 USA</p>

<p><a href="www.control4.com">http://www.control4.com</a></p>
<h1 id='introduction'>Introduction</h1>

<p>The DriverWorks Fundamentals Guide is intended to provide an overview of the fundamental components that make up a device driver as well as the architectural layers that a device driver must interact with.  As a driver developer, you are tasked with implementing this “interaction”. Successful driver developers build drivers that not only handle numerous dependencies placed on their driver code – but also seek out ways to enhance a device’s capabilities in an automated environment. This level of interaction manifests itself as seamless device integration, a high level of device controllability and ultimately - a quality end user experience. This is something we refer to as the Control4 Interoperability Model.</p>

<p>Beginning with O.S. 3.4.0, Control4 has delivered a set of new Driver Development Templates and a utility called JumpStart to accelerate your driver development efforts.   The use of these templates assumes knowledge of the content included in this guide. Please see the driver template repository for more information on how to leverage these templates:</p>

<p><a href="https://github.com/snap-one/drivers-template-code-public">https://github.com/snap-one/drivers-template-code-public</a></p>
<h1 id='what-s-new-in-the-fundamentals-guide'>What’s New in the Fundamentals Guide</h1>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-4-2'>What’s New in 3.4.2</h2>

<p>There were no modifications to the Fundamentals Guide in conjunction with O.S. Release 3.4.2. </p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-4-1'>What’s New in 3.4.1</h2>

<p>There were no modifications to the Fundamentals Guide in conjunction with O.S. Release 3.4.1. </p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-4-0'>What’s New in 3.4.0</h2><h3 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-4-0-history-event-notifications'>History Event Notifications</h3>
<p>Beginning with O.S. 3.4.0, drivers can provide a better experience for users receiving <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#events-history-event-notifications">Event Push Notifications</a> on smartphones or tablets. Users can now view these notifications and, if desired, select the notification and be taken directly to the relevant content within the Control4 app. This removes the previous need to navigate through the app to find the relevant information. </p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-3-2'>What’s New in 3.3.2</h2>

<p>There we no changes to The DriverWorks Fundamentals Guide in conjunction with O.S. 3.3.2.</p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-3-1'>What’s New in 3.3.1</h2>

<p>There we no changes to The DriverWorks Fundamentals Guide in conjunction with O.S. 3.3.1.</p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-3-0'>What’s New in 3.3.0</h2>

<p><strong>Sorting Driver Elements</strong></p>

<p>A new sort order driver element has been delivered that provides the ability to display <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#conditionals-sorting-conditionals-in-composerpro">Conditionals</a>, <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#events-sorting-events-in-composerpro">Events</a> and <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#commands-sorting-commands-in-composerpro">Commands</a> in any desired order within the Programming area of ComposerPro.</p>

<p><strong>Supported Command Parameter Types</strong></p>

<p>A new section defining <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#commands-supported-command-parameter-types">Command Parameter Types</a> has been added to the guide.</p>

<p><strong> Dynamic_List type for Commands</strong></p>

<p>Support for <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#commands-dynamic-list-type-for-commands">DYNAMIC_LIST</a> type parameters within a command has been included.</p>

<p><strong>Driver Documentation</strong></p>

<p>A new section has been added to the Fundamentals Guide detailing driver documentation. Specifically, this section includes the steps required to produce <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#markdown-driver-documentation">HTML driver documentation from markdown</a>.</p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-3'>What’s New in 3.2.3</h2>

<p>There were no changes to this content for Operating System 3.2.3</p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-2'>What’s New in 3.2.2</h2>

<p><em>There were no changes to this content for Operating System 3.2.2.</em></p>

<h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-1'>What’s New in 3.2.1</h2>

<p><em>There were no changes to this content for Operating System 3.2.1.</em></p>

<p><h2 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-0'>What’s New in 3.2.0</h2><h3 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-0-sorting-conditionals-in-programming'>Sorting Conditionals in Programming</h3>
<p>Driver writers now have the ability to order the way driver conditionals are displayed in the Programming area of ComposerPro. A new sort order XML driver element has been delivered that provides the ability to display conditionals in any desired order.</p>
<h3 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-0-new-property-link'>New Property: <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#composerpro-the-interface-into-the-sdk-properties">LINK</a></h3>
<p>The new LINK property type allows you to provide a link to a resource which can be used to support your driver. Typically, this Property is used to link to a configuration page on a device. _ </p>
<h3 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-0-driver-conditionals'>Driver Conditionals</h3>
<p>In addition to updated content examples and explanations, the Conditionals section includes information on two new Conditional Types: <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#conditionals-understanding-xml-in-a-room-type-conditional">Room and Device</a>. The ability to generate <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#conditionals-creating-dynamic-driver-conditionals">Dynamic Conditionals</a> is also included in O.S. 3.2.0.</p>
<h3 id='what-s-new-in-the-fundamentals-guide-what-s-new-in-3-2-0-zigbee'>Zigbee</h3>
<p>Change to Zigbee Server-Side Cluster Management
Starting with the release of Operating System 3.2.0, Control4 will change the way Zigbee Clusters are handled. Drivers that have previously relied on the ability of clusters to circumvent zserver and its processes will be impacted by this change and will not function as intended in OS 3.2.0 and going forward.</p></p>

<p>For example, consider the following sample Profile:</p>

<p><code>(HA Profile (0x0104)</code>
   <code> Cluster A: Time (0x000A)</code>
   <code> Cluster B: Basic (0x0000)</code>
<code>Cluster C: OTA Upgrade (0x0019)</code></p>

<p>Pre-OS 3.2.0, these clusters and others may have been partially handled by Control4&#39;s zserver. With the release of OS 3.2.0, Time, Basic and OTA clusters will be advertised as supported by Control4, via a MatchDescriptorRequest, on the HA Profile (0x0104) and will be entirely handled within zserver.</p>

<p>Note that there are two scenarios where zserver will pass a cluster un-handled directly to a driver. These are:</p>

<ul>
<li><p>If the cluster that has the manufacturer-specific flag set, the cluster will be passed through to the driver, un-handled by zserver.</p></li>
<li><p>All clusters which are not supported by Control4, on the HA profile, will be passed through to the driver, un-handled by zserver.</p></li>
</ul>

<p>To avoid unintended functionality, a review of your Zigbee driver(s) is recommended prior to the release of OS 3.2.0. The ability to send Zigbee Clusters directly to your driver will need to be handled at the device firmware level.</p>

<p><h2 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-3'>What was New in 3.1.3</h2><h3 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-3-driver-agents'>Driver Agents</h3>
<p>Beginning with O.S. Release 3.1.3, the SDK provides a stable enough platform for developing <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#driverworks-agents">DriverWorks Agents</a> in addition to device drivers. DriverWorks Agents provide third-party Driver Developers the ability to create agents which can be loaded into projects and used in customer homes.</p>
<h3 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-3-future-change-to-zigbee-server-side-cluster-management-in-os-3-2-0'>Future Change to Zigbee Server-Side Cluster Management in OS 3.2.0</h3>
<p>Starting with the upcoming release of Operating System 3.2.0, Control4 will change the way Zigbee Clusters are handled. Drivers that have previously relied on the ability of clusters to circumvent zserver and its processes will be impacted by this change and will not function as intended in OS 3.2.0 and going forward.</p></p>

<p>For example, consider the following sample Profile:</p>

<p>(HA Profile (0x0104)
Cluster A: Time (0x000A)
Cluster B: Basic (0x0000)
Cluster C: OTA Upgrade (0x0019)</p>

<p>Pre-OS 3.2.0, these clusters and others may have been partially handled by Control4&#39;s zserver. With the release of OS 3.2.0, Time, Basic and OTA clusters will be advertised as supported by Control4, via a MatchDescriptorRequest, on the HA Profile (0x0104) and will be entirely handled within zserver.</p>

<p>Note that there are two scenarios where zserver will pass a cluster un-handled directly to a driver. These are:</p>

<ul>
<li><p>If the cluster that has the manufacturer-specific flag set, the cluster will be passed through to the driver, un-handled by zserver.</p></li>
<li><p>All clusters which are not supported by Control4, on the HA profile, will be passed through to the driver, un-handled by zserver.</p></li>
</ul>

<p>To avoid unintended functionality, a review of your Zigbee driver(s) is recommended prior to the release of OS 3.2.0. The ability to send Zigbee Clusters directly to your driver will need to be handled at the device firmware level.</p>

<p>Operating System 3.2.0 will include an OTA Upgrade API which will provide a driver based approach to device updates.</p>

<h3 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-3-sqlite3-database-information'>SQLite3 Database Information</h3>

<p>Control4 has been delivering a SQLite3 library with its Lua distribution beginning with O.S Release 2.10.0. This library is delivered without the intention of being a third party developer resource. For this reason, Control4 does not provide an interface into the library and has no intention of providing an interface or supporting third party developers in efforts to utilize SQLite3. If the decision is made to use this database Control4 strongly encourages developers to familiarize themselves with the content available through sqlite.org and the LuaSQLite 3 wiki.</p>

<p>Several issues must be considered when using SQLite3. Please ensure that in your development efforts you avoid doing things that fall into the categories below and/or account for the limitations they can present:</p>

<ul>
<li><p>SQLite3 utilizes a blocking API. This means that Director will be blocked while read/writing database files. Reads aren&#39;t generally a concern, but writes can be expensive. Especially when the transaction API is not used.</p></li>
<li><p>Access to the filesystem: driver developers should only open database(s) in their sandbox directory. Database files opened and/or placed elsewhere on the filesystem may have unintended consequences causing problems with the Control4 Operating System.</p></li>
<li><p>Database files will not be backed up with a project since the backup mechanism knows nothing about these files. This means data stored in the driver’s DB file will get lost if the controller is ever restored to default or migrated to a new controller.</p></li>
<li><p>The controller has limited disk space. It is important to be aware of the amount of data that driver developers collect/store and ensure that the DB doesn’t grow to a point where it will impact the controller’s disk space. This may mean that driver developers may need to have a mechanism for archiving data to off-controller storage and prune the local DB if they want to maintain historical data to the extent that the DB file size becomes too large.</p></li>
</ul>

<p><h2 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-2'>What was New in 3.1.2</h2><h3 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-2-a-note-to-drivereditor-users'>A Note to DriverEditor Users</h3>
<p>Beginning with OS 3, Director no longer accepts connections on its unsecured port. Previously, DriverEditor 3.0.1 used that port. Control4 has not yet updated DriverEditor to use Director’s secure port for the debug connection. In the interim, the Lua Input window within Composer Pro is available to make code changes and test driver functionality. This method is useful in making point changes to the running code on the controller and also includes pasting and executing complete functions or even your entire driver, while you are developing. </p></p>

<p>An important caveat regarding this debug approach must be considered: The driver must be re-built the and updated with code changes before finishing the Lua debug window development. Any code changes made in the runtime environment  will only last for the duration of the uptime of Director. As soon as Director is restarted, the driver will be reloaded from the copy on disk and changes will be lost.</p>

<p><h2 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-0'>What was New in 3.1.0</h2><h3 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-3-1-0-driver-development-templates'>Driver Development Templates</h3>
<p>The SDK now contains all of Control4&#39;s Driver Development Templates. These .c4z files and supporting documentation can be found at the root level of the SDK in Driver Templates folder. The Proxies supported with Driver Development Templates currently include:</p></p>

<ul>
<li>AV Switch</li>
<li>Blind</li>
<li>Camera</li>
<li>Door Station</li>
<li>DVD</li>
<li>Lock</li>
<li>Pool</li>
<li>Projector</li>
<li>Receiver</li>
<li>Security</li>
<li>Thermostat</li>
<li>TV</li>
</ul>

<p><h2 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-o-s-3'>What was New in O.S.3</h2><h3 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-o-s-3-sample-drivers'>Sample Drivers</h3>
<p>Several new sample.c4z files have been included in this release of the SDK. These drivers can be located in the SDK under the root level or: DriverWorks SDK/Samples: They include:</p></p>

<ul>
<li><p>Variable Parser driver which provides the ability to convert any variable on any device from one type to another. See the driver documentation for more information.</p></li>
<li><p>The dlna example driver demonstrates how to do DLNA discovery and control._ </p></li>
<li><p>The generic-http driver demonstrates how to perform basic C4:url calls.</p></li>
<li><p>The dynamic list widget driver demonstrates the ability to generate Dynamic Lists based on driver code to support a proxy-less device.</p></li>
<li><p>The notification driver demonstrates how to implement push notifications of images in a driver.</p></li>
</ul>

<h3 id='what-s-new-in-the-fundamentals-guide-what-was-new-in-o-s-3-other'>Other:</h3>

<p>New information regarding the use of the CUSTOM SELECT Property has been added.</p>

<p>Lua Conditional functionality has been enhanced for the number type. Two new options include the &lt;minimum&gt; and &lt;maximum&gt; tags to specify the range for the NUMBER type</p>

<p>An overview, usage section and examples on creating Universal Minidrivers has been added.</p>

<p>New information regarding persisting driver data has been added.</p>

<p>New information regarding limitations with signed bit integers in excess of 32 bits has been added to the Handling Binary Data section.</p>

<p>A new connection type has been added: Non-Binding Connection.</p>

<p>Beginning with OS 3, driver developers can leverage Lua&#39;s Just In Time compiler (LuaJIT).</p>

<p>New information regarding driver debug messaging and LuaJIT updates has been added to the Driver Update Considerations area.</p>

<p>The Device and Service Icon presentation content has been is updated in conjunction with OS 3. This includes new icon guidelines, design templates and instructions to assist with delivering the best experience across a variety of wallpapers and to ensure consistency across all icons within the interface. The new content can be found in the DriverWorks SDK at: DriverWorks SDK/Icon Templates directory.</p>
<h1 id='important-concepts-and-terminology'>Important Concepts and Terminology</h1>

<h2 id='important-concepts-and-terminology-proxy-driver'>Proxy Driver</h2>

<p>A Proxy Driver is an interface to the Control4 system for a set of devices that have common functionality. For instance, most DVD disc changers have common controls such as PLAY, STOP, PAUSE, FAST FORWARD, etc.  The disc changer proxy allows for a common user interface to control all disc changers.  The Control4 system (Director) sends information to and receives information from the proxy drivers.  The Proxy Drivers send information to and receive information from the Protocol Drivers.</p>

<h2 id='important-concepts-and-terminology-protocol-driver'>Protocol Driver</h2>

<p>Two similar devices may have the same functionality but utilize a very different command set.  A protocol driver provides the device-specific information needed to communicate with the Control4 system.  In the case of DriverWorks, the DriverWorks driver is the protocol driver.  When combined with the device-specific.c4a file it provides the custom code necessary to implement the 2-way device driver.</p>

<h2 id='important-concepts-and-terminology-combo-driver'>Combo Driver</h2>

<p>A Combo Driver refers to a driver that does not rely on a Control4 Proxy to provide a user interface displayed on Navigators. Rather, the driver’s UI is displayed within ComposerPro along with its defined variables, events and commands which are used for programming purposes. </p>

<p>A Combo Driver is designated as such within the driver’s XML using the <code>&lt;combo&gt;&lt;/combo&gt;</code> element. See the example to the right. </p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;combo&gt;</span>true<span class="nt">&lt;/combo&gt;</span>
<span class="nt">&lt;proxies&gt;</span>
  <span class="nt">&lt;proxy</span> <span class="na">name=</span><span class="s">“combo_driver_name”</span><span class="nt">&gt;</span>combo_driver_name<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div>

<p>The &lt;combo&gt; element tells Director that this driver does not use a proxy but provides its own UI within Composer.</p>

<h2 id='important-concepts-and-terminology-proxy-binding'>Proxy Binding</h2>

<p>The proxy driver and the protocol driver are connected together with what are called proxy bindings.  The Control4 system sends general command such as PLAY, STOP, PAUSE, etc. to the proxy driver which is bound to the protocol driver.  The protocol driver sends specific commands that the device understands to the device over its connected communication mechanism, IP, serial, etc.</p>

<h2 id='important-concepts-and-terminology-c4z-file'>.c4z File</h2>

<p>Beginning with operating system 2.6.0, Control4 changed the file structure previously used to support device drivers. Up until 2.6.0, device driver were contained within a single-level file using the extension of .c4i or: <code>drivername.c4i</code></p>

<p>The release of 2.6.0 marked a significant change to this model with the introduction of the .c4z file structure or: <code>drivername.c4z</code>. A .c4z file provides all of the content that the .c4i file previously did. However, it offers some significant features and advantages that its predecessor did not.</p>

<p>At its most basic level, a .c4z file is a zip file. It contains numerous folders and files which, when encapsulated in a .c4z file, represent a device driver. The modularity within the .c4z file makes for a far more organized and structured approach to device driver architecture. It also provides the ability to include many related objects within the confines of the driver in an organized manner.</p>

<p>See Understanding .c4z Driver Files for information regarding Control4&#39;s latest driver file architecture.</p>

<h2 id='important-concepts-and-terminology-communication-protocol'>Communication Protocol</h2>

<p>The Control4 system can communicate with various devices over several different communication protocols.  A device may be controlled using an Internet Protocol (IP), a serial connection, ZigBee, or an IR emitter. DriverWorks supports connectivity to devices using only serial and/or IP protocols.</p>

<h2 id='important-concepts-and-terminology-lua'>Lua</h2>

<p>Lua is a powerful, fast, light-weight and embeddable scripting language that combines simple procedural syntax with powerful data description constructs based on associative arrays and extensible semantics. DriverWorks contains an embedded Lua interpreter. Lua is dynamically typed, runs by interpreting bytecode for a register-based virtual machine, and has automatic memory management with incremental garbage collection. All of these features combine to make it ideal for configuration, scripting, and rapid prototyping. You can find out more about Lua at: http://www.lua.org</p>

<h2 id='important-concepts-and-terminology-lua-ide'>Lua IDE</h2>

<p>When creating a Lua driver, you may find it helpful to have a working version of Lua with an integrated development environment (IDE) installed on your PC in order to test your Lua functions and ensure they work as expected before you embed them in a .c4z file and attempt to load them into your project using Composer. There are numerous Lua IDEs available that will accomplish this. A simple Internet search for &quot;Lua IDE&quot; will return numerous options.</p>

<h2 id='important-concepts-and-terminology-driver-development-terminology'>Driver Development Terminology</h2>

<p><strong>Actions</strong> - Actions are similar to device specific commands. However, they are primarily intended to be used during driver installation and configuration. They can only be activated on the Actionstab in Composer and are not available for programming within the system. </p>

<p><strong>Android Navigator</strong> – A graphical interface displayed on devices running the Android OS platform.</p>

<p><strong>Capabilities</strong> - Capabilities are defined in a proxy and referenced in protocol drivers. They represent typical functionality and physical characteristics found in devices of a given device class. Values for each Capability are entered in a protocol driver and then in-turn are exposed to the Proxy.  This enables the proxy driver to determine what capabilities are supported by the device defined by the protocol.</p>

<p><strong>Combo Driver</strong> – A standalone driver that does not bind itself to a Control4 proxy. User interaction is accomplished through programming, events and bindings. A Navigator UI is not provided for combo drivers.</p>

<p><strong>Command</strong> – A command comes from the Control4 system and its destination is a device or a driver.</p>

<p><strong>Config</strong> - The config area of a protocol driver contains all of the device specific configuration properties.  The Lua code is also incorporated into the Config section.</p>

<p><strong>Connections</strong> - Connections are the bindings defined in a driver and used within the Control4 system. Generally speaking, they are visible through Composer. In the case of AV, Control and Room bindings – they are reported to the proxy driver when they are bound together in a project.</p>

<p><strong>Connection Class</strong> - Connection class information is defined inside each connection instance – within the connections code block of a driver. A connection class lists the physical data or signal type that a specific connection can to transmit.</p>

<p><strong>Director</strong> - Director is the software platform that runs on all Control4 controllers. It communicates with device drivers in a manner that enforces a standardized API which hides the complexity of a huge array of different systems and protocols. It also uses that communication to serve up various user interfaces that are displayed on a wide variety of navigation devices.</p>

<p><strong>Driver</strong> – A term used to describe files used in the Control Operating System. They are text-based files that have an extension of .c4i or .c4z. Several types of drivers exist including proxy drivers, protocol drivers, combo drivers and multi-proxy drivers.</p>

<p><strong>iOS Navigator</strong> - A graphical interface displayed on devices running the iOS platform.</p>

<p><strong>List Navigator</strong> – A text based Navigator instance that is used on Control4 Remote controls.</p>

<p><strong>Multi-Proxy Driver</strong> – A Protocol driver that has dependencies upon several proxies. A receiver driver is good example of this. While the protocol driver for a Sony receiver is certainly device specific – it relies upon several proxies such Tuner and DVD in addition to the Receiver proxy.</p>

<p><strong>Navigator</strong> – Refers to an instance of the Control4 UI running on a device.</p>

<p><strong>Navigator Device</strong> – Refers to any device that is running a version of the Control4 Navigator. This includes TVs (onscreen navigator), touchscreens, remote controls, etc.</p>

<p><strong>Navigator UI</strong> – A user interface that is graphically displayed on devices or may also refer to a text-based user interface as in List Navigator on remote controls.</p>

<p><strong>Notification</strong> – Notifications are updates sent to the Control4 system that communicate status or update changes. These notifications may come from a device or the driver.</p>

<p><strong>Programming UI</strong> – A user interface that does not utilize a graphical or text based user interface. This is usually implemented through programming, button presses, timers or events.</p>

<p><strong>Properties</strong> - DriverWorks Properties, as defined in the .c4i file, are exposed in the Composer System Design interface on the Properties tab. Properties are data values which are used within your driver. These are initialized in the driver code and also may be configured through the Composer Properties page for your driver. Property data types include:</p>

<p><strong>Protocol </strong>– Protocols contain the definition for a specific device. They are composed of functionality that is unique to a specific device.</p>

<p><strong>Protocol Driver</strong> – An implementation of the protocol in the form of a driver (.c4i) file. When this driver is added to a Control4 Automation system, device control is dictated by the functions defined in the protocol by the device manufacturer. User Interaction with the device is accomplished through system programming such as button presses and events. The UI is provided by one or possibly several of the proxies. In most instances of driver development, the driver developer will be creating a protocol driver.</p>

<p><strong>Proxy</strong> – A Proxy contains the definition for a specific class of device. Proxies are composed of the most common examples of functionality for each device class. The use of a proxy provides a common interface between the Control4 Navigator UI and a device driver. Proxies are pre-defined and supplied by Control4.</p>

<p><strong>Proxy Binding Id</strong> - A proxy binding id is a numerical value that is assigned to each proxy used within a protocol driver. It is a unique reference that can be utilized in the protocol driver code. . This id value is used often when sending data and ensures that the correct proxy-data relationship is always enforced.</p>

<p><strong>Proxy Driver </strong>– An implementation of a proxy in the form of a driver (.c4i) file. When this file is included in a Control4 Automation system, device control includes that of the pre-defined functionality provided in the proxy. User interaction is provided through a Control4 Navigator interface.</p>

<p><strong>UI</strong> – User Interface. General term referring to the manner in which a user interfaces with the Control4 system.</p>
<h1 id='understanding-c4z-drivers'>Understanding .c4z Drivers</h1>

<h2 id='understanding-c4z-drivers-overview'>Overview</h2>

<p>Beginning with operating system 2.6.0, Control4 has changed the file structure previously used to support device drivers. Up until 2.6.0, device driver were contained within a single-level file using the extension of .c4i or: drivername.c4i</p>

<p>The release of 2.6.0 marked a significant change to this model with the introduction of the .c4z file structure or: drivername.c4z. A .c4z file provides all of the content that the .c4i file previously did. However, it offers some significant features and advantages that its predecessor did not.</p>

<p>At its most basic level, a .c4z file is a zip file. It contains numerous folders and files which, when encapsulated in a .c4z file, represent a device driver. The modularity within the .c4z file makes for a far more organized and structured approach to device driver architecture. It also provides the ability to include many related objects within the confines of the driver in an organized manner.</p>

<p>These objects include items such as graphics and icon directories to support custom user interfaces which can run on Navigator. A .c4z file also contains a .lua file which contains all of the driver’s lua code. It has its own .xml directory as well to separate the XML portion of a driver from the .lua code. Also, rich text documentation can be included in the .c4z to support a far superior user assistance model.</p>

<p>The image below is a look into a .c4z file at its root level:</p>

<p><img src="images/6_understanding_c4z_drivers-Overview-01-521fe5d7.png"/></p>

<p>You’ll notice several files at the root level of the .c4z which were described in the section above. The www folder must contain the documentation file to support the driver.</p>

<p><img src="images/6_understanding_c4z_drivers-Overview-02-d47a9bf0.png"/></p>

<p>This is an architectural change implemented with the release of OS 2.8.1.</p>

<p>This is the driver’s overview and configuration documentation that integrators will see displayed in ComposerPro and ComposerExpress. Note that the inclusion of the .RTF file in the .c4z  ensures that the information is displayed in ComposerPro only. In order for your documentation to be displayed in ComposerExpress, you will need to also enclose the text within the  &lt;documentation&gt; XML tags in the .c4z file.</p>

<p>For example:
&lt;documentation file=&quot;doc.rtf&quot;&gt; This is text that will appear in Composer Express. &lt;/documentation&gt; </p>

<p>Using this structure, ComposerPro will load the RTF documentation file and ignore the text between the XML tags. Composer Express, which can&#39;t display RTF documentation, will display the text documentation within the XML tags.</p>

<p>Below that is the .lua file that contains all of the .lua code for the driver. It is possible to have multiple .lua files included in the .c4z file. For example, here is an opened .c4z file for a pool controller:</p>

<p><img src="images/6_understanding_c4z_drivers-Overview-03-576a57dd.png"/></p>

<p>As you can see, this .c4z contains numerous .lua files. In order for all of the .lua files to be recognized not just by DriverEditor but Director as well - the use of the Lua require function is needed. The required Function loads and runs libraries. All of the .lua files that need to be included in .c4z file are identified in the .c4z file&#39;s driver. lua file. If we open the pool controller&#39;s driver.lua file we see this:</p>

<p><img src="images/6_understanding_c4z_drivers-Overview-04-6a157d60.png"/></p>

<p>In the example above, the file names are surrounded by quotation marks. The required Function uses the global variable LUA_PATH to find the file. This variable is defined as LUA_PATH = C4System; Driver. Based on this, Director will look for the .lua file on the controller first, The LUA_PATH environment on the controller is:
/control4/drivers/lua/?.lua;</p>

<p>As each driver contains its own environment the LUA_PATH for each driver would be:</p>

<p><code>LUA\_PATH=/control4/drivers/lua/?.lua;/etc/c4i/test\_driver\_name/?.lua</code></p>

<p>The required Function can also navigate a path to the .lua file if it is defined. For example:</p>

<p><code>require &quot;/usr/local/lua/pool\_init.lua&quot;</code></p>

<p>When Director loads this .c4z file it will load all of the required .lua files into memory as one large .lua file and execute based on the contents of the assembled file.</p>

<p>Lua files can be included in a .c4z, defined using the require Function and still be excluded when DriverPackager assembles the final .c4z. This is useful in the event that a .lua file was included for testing purposes but is not needed when the final .c4z is delivered. This is handled in the .c4zproj file. Specifically, with the exclude parameter. For example, say a test.lua file was included in our .c4z, but is not needed when the driver is delivered. The .c4zproj file would look like the example to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;Items&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"www"</span> <span class="na">recurse=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"common"</span> <span class="na">c4zDir=</span><span class="s">"Common"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"tests"</span> <span class="na">exclude=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"driver.xml"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"squish.lua"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"foo1.lua"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"foo2.lua"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"library.lua"</span> <span class="na">c4zDir=</span><span class="s">"Common"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"test.lua"</span> <span class="na">exclude=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Items&gt;</span>
</code></pre></div>

<p>Note the test.lua line with exclude set to True. This is will prevent this file from being packaged by DriverPackager.</p>

<p>Next we can see another driver file. This contains all of the XML that was previously found between the <code>\&lt;devicedata\&gt;</code> tags of a .c4i file. These are elements such as <code>\&lt;creator\&gt;, \&lt;name\&gt;, \&lt;model\&gt;, \&lt;manufacturer\&gt;, \&lt;identify\_image\&gt;, \&lt;identify\_text\&gt;</code> and so on.</p>

<p>If we open the www directory we see the following:</p>

<p><img src="images/6_understanding_c4z_drivers-Overview-05-16e8266e.png"/></p>

<p>As mentioned above, a c4z file can contain graphical elements to support the driver’s use in Navigator. When opened, the icons folder for this driver looks like this:</p>

<p><img src="images/6_understanding_c4z_drivers-Overview-06-f0c4cd98.png"/></p>

<p>The icons directory contains all of the images, organized by their resolutions, which are displayed during the use of the driver. The images in this particular driver are found under the root level of “www” placing them within the .c4z in this manner makes them accessible from via the controller’s web server. For example, accessing an image can be accomplished by appending the .c4z icon path to a URL such as:</p>

<p><code>http://urlstring/driver/drivername/icons/20x20/driverimage.png</code></p>

<p>or</p>

<p><code>http://127.0.0.1/driver/myc4zdriver/icons/20X20/driverimage.png</code></p>

<p>The other directory file found under this driver’s www directory is the languages folder. This folder contains all of the .po files used for localizing this driver.</p>

<p>Going forward, any .lua-based driver will be expected to be delivered in the .c4z format. To facilitate the conversion of previously built .c4i files to the new .c4z format, control4 has delivered a utility called DriverPackager. DriverPackager accomplishes two significant tasks for the developer. These include:</p>

<ul>
<li>XML Validation</li>
<li>Assembles the .c4z</li>
</ul>

<h2 id='understanding-c4z-drivers-identifying-a-c4z-driver'>Identifying a .c4z Driver</h2>

<p>The ability to specify a unique driver identification image and instructional text can be defined in the <code>&lt;config&gt;</code> XML section of your .c4z driver. </p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;devicedata&gt;</span>
    ...
    <span class="nt">&lt;config&gt;</span>
        <span class="nt">&lt;identify_text&gt;</span>Insert how to identify here<span class="nt">&lt;/identify_text&gt;</span>
        <span class="nt">&lt;identify_image&gt;</span>my_identify.gif<span class="nt">&lt;/identify_image&gt;</span>
    <span class="nt">&lt;/config&gt;</span>
    ...
<span class="nt">&lt;/devicedata&gt;</span>
</code></pre></div>

<p> </p>

<p>Both the text string and the .gif are pulled from the .c4z file at the relative path specified in the driver. In the example above they would just be in the root of the c4z.</p>

<p>For identify images, .gifs are recommended as they can be animated. However, other image formats are supported.
  </p>

<h2 id='understanding-c4z-drivers-c4-allowexecute-api'>C4:AllowExecute API</h2>

<p>The C4:AllowExecute API is a function which dictates whether or not the lua window in ComposerPro can be used to view debugging content or exercising functions within a driver. </p>

<p>C4:AllowExecute defaults to false which locks the driver’s Lua execute and output window.  If a driver is encrypted, C4:AllowExecute defaults to locked (False).
Entering the following in the driver’s Lua execute window will lock the lua window: <code>C4:AllowExecute(false)</code>.</p>

<p>However, if this API is set to true the lua command window is unlocked and supports execution of data and results being displayed in the lua output window.</p>

<p>A more preferable approach to using the API is to create an Action that can change the command dynamically.</p>

<p>The C4:AllowExecute API is evoked in OnDriverInit or OnDriverEarlyInit.</p>

<h2 id='understanding-c4z-drivers-squishlua-and-driver-encryption'>SquishLua and Driver Encryption</h2>

<p>All .lua files included in a .c4z file must be squished prior to encryption. This is accomplished using Squish Lua. Squish is a tool that can pack many individual Lua scripts and their modules into a single Lua script. Whether or not Squish is run on the .lua files inside of a .c4z file is defined in the .c4z project file. In the example project file to the right you can see that the squishLua parameter has a value of &quot;true.&quot; With this setting, Driver Packager will squish all of the .lua files before encryption. This is a requirement for successful driver encryption.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;Driver</span> <span class="na">type=</span><span class="s">"c4z"</span> <span class="na">name=</span><span class="s">"sample"</span> <span class="na">squishLua=</span><span class="s">"true"</span> <span class="nt">&gt;</span>
<span class="nt">&lt;Items&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"www"</span> <span class="na">recurse=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"common"</span> <span class="na">c4zDir=</span><span class="s">"Common"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"tests"</span> <span class="na">exclude=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"driver.xml"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"squish.lua"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"foo1.lua"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"foo2.lua"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"library.lua"</span> <span class="na">c4zDir=</span><span class="s">"Common"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"readme.txt"</span> <span class="na">exclude=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Items&gt;</span>
</code></pre></div>

<p>The first line of the .proj file contains the following:</p>

<p><strong>Driver type</strong> – This must be “c4z” for the manifest to be valid.</p>

<p><strong>name</strong> – This is the name of the driver in quotes  without its extension.</p>

<p><strong>squishLua</strong> – Must be set to “true” or “false”. It defaults to a value of &quot;false.&quot; There are two options when encrypting a driver: encrypt a single Lua file or Squish all Lua files into one file and encrypt it. Squish is a tool that packs many individual Lua scripts and their modules into a single Lua script. A file called “squishy” must be created for the squish tool. This file contains all of the Lua files to be included in the squished file. Here is an example of a basic squishy file:</p>

<p>Main &quot;driver.lua&quot;</p>

<ul>
<li>Module &quot;module1&quot;</li>
<li>Module &quot;module2&quot;</li>
<li>Module &quot;common.command&quot; &quot;common/command.lua&quot;</li>
<li>Module &quot;common.common&quot;  &quot;common/common.lua&quot;</li>
<li>Module &quot;common.diagnostics&quot; &quot;common/diagnostics.lua&quot;</li>
</ul>

<p>Output &quot;squished.lua&quot;</p>

<p>Next you’ll notice the <code>&lt;Items&gt;&lt;/Items&gt;</code> section:</p>

<p><strong>Item type</strong> - Must be “dir” or “file”. This specifies if the item is a file or a directory. “dir” creates a folder &#39;name&#39; and adds all immediate files beneath &#39;name&#39; to the c4z. “file” adds file &#39;name&#39; to the c4z.</p>

<p><strong>Item name</strong> - Name of folder or file to be added to c4z.</p>

<p><strong>recurse </strong>- Optional. Only applicable to type &#39;dir&#39; items. Must be &quot;true&quot; or &quot;false&quot;, default is &quot;false&quot; if not specified. If &quot;true&quot;, recursively adds all files beneath &#39;name&#39; to c4z.</p>

<p><strong>c4zDir</strong> - Optional. The name of the c4z folder where the &#39;dir&#39; or &#39;file&#39; item is added.</p>

<p><strong>exclude</strong> - Optional.  Must be &quot;true&quot; of &quot;false&quot;, default is &quot;false&quot; if not specified. This specifies if an item is excluded from the c4z.</p>

<h3 id='understanding-c4z-drivers-squishlua-and-driver-encryption-usage-notes'>Usage Notes</h3>

<p><strong>Driver Encryption</strong></p>

<p>To encrypt a driver, the driver.xml script tag must include the encryption attribute set to “2”. Additionally, the file attribute needs to point to the main file that should be encrypted; in the example below it is the output of the squishy file:</p>

<p><code>&lt;script jit=&quot;1&quot; encryption=&quot;2&quot; file=&quot;lua/squished.lua&quot;/&gt;</code></p>

<p><strong>Driver Packager</strong></p>

<p>Driver Packager is a Python utility used to create individual .c4z files from source code. When Driver Packager assembles a .c4z file and the the encryption attribute for the script tag in the driver.xml file is set to “2”, the file is encrypted using a new and improved encryption protocol based on an asymmetrical public key infrastructure. This level of encryption is applicable to .c4z files only.</p>

<p>For more information please see: <a href="https://github.com/control4/drivers-driverpackager">https://github.com/control4/drivers-driverpackager</a></p>

<p>For more information regarding luajit, please see: <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#driverworks-and-luajit-control4-os-3-and-luajit">https://snap-one.github.io/docs-driverworks-fundamentals/#control4-os-3-and-luajit</a></p>

<h2 id='understanding-c4z-drivers-replacing-a-c4i-file-with-c4z'>Replacing a .c4i file with .c4z</h2>

<p>An XML element has been included to support the replacement of an existing driver.c4i file with a new driver.c4z. An example of the &lt;replaces&gt; element is to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;replaces&gt;</span>
   <span class="nt">&lt;replace&gt;</span>driver.c4i<span class="nt">&lt;/replace&gt;</span>
<span class="nt">&lt;/replaces&gt;</span>
</code></pre></div>

<p>This element is included in the .c4z driver.xml file. It is optional and if used, requires at least one instance of replace containing the .c4i file name. Once the .c4z is loaded, Director will remove the .c4i file from the project. Note that the .c4i file is also removed from the local driver database of Composer Pro. This occurs without warning. The .c4i file is then marked as &quot;Obsolete&quot; upon driver searches. Obsolete drivers cannot be loaded into a project.</p>

<h2 id='understanding-c4z-drivers-what-is-a-c4zproj-file'>What is a .c4zproj File</h2>

<p>As described in the Understanding .c4z Files, a .c4z file is a zipped filed consisting of several directories and numerous files that (when zipped together) represent a device driver. DriverEditor views these assembled files as a &quot;Project.&quot; When a .c4z file is imported or opened through the DriverEditor environment, a corresponding .c4zproj file is created. For example, let&#39;s assume the driver you wish to import into DriverEditor resides at:</p>

<p><code>C:\Users\username.CONTROL4\Documents\Control4\Drivers</code></p>

<p>This the Control4 system default location for DriverWorks drivers. The example directory looks like this:</p>

<p><img src="images/6_6-07-f1c8c0c3.png"/></p>

<p>If we import the HelloWorld.c4z file into the Driver Editor environment, we can go back and see that a new directory has been created:</p>

<p><img src="images/6_6-08-e4fc362f.png"/></p>

<p>The HelloWorld File Folder was created by DriverEditor. All of the changes made to the .c4z file through DriverEditor will be made to this directory. If we open the new Hello World folder we&#39;ll find this:</p>

<p><img src="images/6_6-09-160d0e9c.png"/></p>

<p>Note the addition of the HelloWorld.c4zproj file. This file allows DriverEditor to assemble, encrypt, name the .c4z file along with defining several other file level functions. If we open the .c4zproj file we&#39;d find the example to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;Driver</span> <span class="na">type=</span><span class="s">"c4z"</span> <span class="na">name=</span><span class="s">"sample"</span> <span class="na">squishLua=</span><span class="s">"true"</span> <span class="na">Encryption=</span><span class="s">"True/False"</span><span class="nt">&gt;</span>
<span class="nt">&lt;Items&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"www"</span> <span class="na">recurse=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"common"</span> <span class="na">c4zDir=</span><span class="s">"Common"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"dir"</span> <span class="na">name=</span><span class="s">"tests"</span> <span class="na">exclude=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"driver.xml"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"squish.lua"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"foo1.lua"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"foo2.lua"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"library.lua"</span> <span class="na">c4zDir=</span><span class="s">"Common"</span><span class="nt">/&gt;</span>
 <span class="nt">&lt;Item</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">name=</span><span class="s">"readme.txt"</span> <span class="na">exclude=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
 <span class="err">&lt;</span>/Items
<span class="nt">&lt;/Driver&gt;</span>
</code></pre></div>

<p>The first line of the proj file contains the following:
<strong>Driver type</strong> – This must be “c4z” for the manifest to be valid.</p>

<p><strong>name</strong> – This is the name of the driver in quotes  without its extension.</p>

<p><strong>squishLua</strong> – Must be set to “true” or “false”. It defaults to a value of &quot;false.&quot; There are two options when encrypting a driver: encrypt a single Lua file or Squish all Lua files into one file and encrypt it. Squish is a tool that packs many individual Lua scripts and their respective modules into a single Lua script. A file called “squishy” must be created for the squish tool. This file contains all of the Lua files to be included in the squished file. Here is an example of a basic squishy file:</p>

<p>Main &quot;driver.lua&quot;</p>

<ul>
<li> Module &quot;module1&quot;</li>
<li> Module &quot;module2&quot;</li>
<li> Module &quot;common.command&quot; &quot;common/command.lua&quot;</li>
<li> Module &quot;common.common&quot; &quot;common/common.lua&quot;</li>
<li> Module &quot;common.diagnostics&quot; &quot;common/diagnostics.lua&quot;</li>
</ul>

<p>Output &quot;squished.lua&quot;</p>

<p><strong>Encryption</strong> – Designates whether or not the driver will be encrypted or not.</p>

<p>Next you&#39;ll notice the &lt;Items&gt;&lt;/Items&gt; section:
<strong>Item type</strong> - Must be “dir” or “file”. This specifies if the item is a file or a directory. “dir” creates a folder &#39;name&#39; and adds all immediate files beneath &#39;name&#39; to the c4z. “file” adds file &#39;name&#39; to the c4z.</p>

<p><strong>Item name</strong> - Name of folder or file to be added to c4z.</p>

<p><strong>recurse</strong> - Optional. Only applicable to type &#39;dir&#39; items. Must be &quot;true&quot; or &quot;false&quot;, default is &quot;false&quot; if not specified. If &quot;true&quot;, recursively adds all files beneath &#39;name&#39; to c4z. </p>

<p><strong>c4zDir</strong> - Optional. The name of the c4z folder where the &#39;dir&#39; or &#39;file&#39; item is added. </p>

<p><strong>exclude</strong> - Optional. Must be &quot;true&quot; of &quot;false&quot;, default is &quot;false&quot; if not specified. This specifies if an item is excluded from the c4z. </p>
<h1 id='driverworks-and-luajit'>DriverWorks and luajit</h1>

<h2 id='driverworks-and-luajit-control4-os-3-and-luajit'>Control4 OS 3 and LuaJIT</h2>

<p>Prior to OS 3, Control4 loaded drivers into the controller environment using the Lua run time compiler known as &quot;standard Lua&quot; or &quot;PUC Lua&quot;. With the release of OS 3, support for Lua&#39;s Just In Time compiler (LuaJIT) has been added. Note that LuaJIT compatibility is an addition and not a replacement for PUC Lua. This means that driver modification is not a requirement for OS 3 compatibility. PUC Lua will continue to load previously released drivers as it has in the past.</p>

<p>Modifying a driver to use the LuaJIT compiler is worth consideration. LuaJIT is considerably faster that PUC Lua. The speed enhancement it provides offers a direct benefit to end users through increased responsiveness and scalability. This is particularly beneficial when considering your drivers deployment into larger systems. </p>

<p>A considerable amount of information is available regarding LuaJIT on the Lua homepage and the LuaJIT wiki:</p>

<p><a href="https://www.lua.org/">https://www.lua.org/</a></p>

<p><a href="https://luajit.org/">http://wiki.luajit.org/Home</a></p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-modifying-your-driver-to-use-luajit'>Modifying your Driver to use LuaJIT</h3>

<p>Beginning with OS 3, Director looks for a LuaJIT XML attribute within the driver. If Director does not detect the presence of the attribute it loads it using the PUC Lua compiler. If a LuaJIT XML attribute is specified in driver.xml, it loads the driver using the LuaJIT compiler.</p>

<p>In order for your driver to be loaded using the LuaJIT compiler it will be necessary to modify your driver.xml to include the LuaJIT XML attribute in the driver&#39;s XML code. This attribute is added to the driver&#39;s script XML element. A value of &quot;1&quot; specifies that the driver should be loaded with LuaJIT. A value of &quot;0&quot; (or lack of the attribute altogether) will result in PUC Lua loading the driver. For example:</p>

<p>Driver loads using LuaJIT: <code>&lt;script encryption=&quot;2&quot; file=&quot;driver.lua&quot; jit=&quot;1&quot;/&gt;</code></p>

<p>Driver loads using PUC Lua: <code>&lt;script encryption=&quot;2&quot; file=&quot;driver.lua&quot; jit=&quot;0&quot;/&gt;</code></p>

<p>After your driver has been modified to include the LuaJIT XML attribute and it contains a value of &quot;1&quot; a restart of Director is required. Director will then attempt to load the driver using LuaJIT. If LuaJIT indicates that syntax errors occurred during the load process Director will destroy the driver instance and then reload the driver using the PUC Lua compiler. </p>

<p>Note: There is no fall back to using the PUC Lua compiler for drivers that were initially loaded using LuaJIT. This means that if a driver has errors it will fail to load - even if it may load successfully using PUC Lua.</p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-driver-debug-messaging-considerations-and-luajit'>Driver Debug Messaging Considerations and LuaJIT</h3>

<p>Beginning with OS 3, the ability to send debug Lua messages upon a driver failing to update has changed. Sending Lua debug messages are determined on how the driver&#39;s properties are set. When a driver is updated from using the previous PUC Lua compiler to LuaJIT, the driver&#39;s state and properties are temporarily lost. This is also true if a driver is updated involves going from LuaJIT to PUC Lua. The state and properties are not restored until the driver has loaded successfully. During this time frame, driver debug messages are not sent. The following are use cases to consider regarding this:</p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-driver-updating-from-puc-to-puc'>Driver updating from PUC to PUC.</h3>

<p>This is a driver that was initially loaded with PUC and the updated driver likewise loads with PUC. There is no &quot;jit&quot; attribute applied to the driver script. In this case, the same driver instance is reused and the driver will function as it did prior to 3.x. </p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-driver-updating-from-puc-to-luajit'>Driver updating from PUC to LuaJIT:</h3>

<p>This is a driver that was initially loaded with PUC and the updated driver expects to load with LuaJIT. The specified &quot;jit&quot; attribute has been applied to the driver script. In this case, the old driver instance is destroyed and then re-loaded with LuaJIT. In doing so, all of the driver properties that set for this driver are temporarily lost. This results in the following two scenarios:
If the driver loads successfully all of the properties &amp; state data is restored.
If the driver fails to load successfully, the LuaJIT instance is abandoned and then reloaded with PUC Lua. The properties &amp; state data is restored after the driver loads. Debug Lua messaging is  impacted.</p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-driver-updating-from-luajit-to-luajit'>Driver updating from LuaJIT to LuaJIT:</h3>

<p>This is a driver that was initially loaded with LuaJIT and the updated driver likewise loads with LuaJIT. The specified &quot;jit&quot; attribute has been applied to the driver script. In this case,an attempt is made to re-use the same driver instance. This results in the following two scenarios:
If the driver loads successfully, then this will function as it did prior to 3.x.
If the driver fails to load, the LuaJIT instance is abandoned and reloaded with PUC. When this happens, all of the properties that are set for the driver are temporarily lost. The properties &amp; state data is restored after the driver loads. Debug Lua messaging is impacted.</p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-areas-where-your-driver-may-fail'>Areas Where your Driver May Fail</h3>

<p>As mentioned above, Director will abandon attempts to load a driver with LuaJit and fallback to PUC Lua when syntax errors occur during the loading of the driver. However, the presence of other run-time errors will prevent a driver from working properly within LuaJIT. If this occurs, the driver’s Lua code will need to be updated to resolve the Lua syntax errors or the driver.xml should not specify that the driver is supported in LuaJIT. </p>

<p>Many of these errors result from LuaJit&#39;s compatibility requirement with the Lua 5.1 language standard. PUC Lua is compatible with version 5.0. Two common errors that are seen in Control4 device drivers include the use of invalid arguments and invalid escape strings:</p>

<p>Invalid Arguments:
In the Lua 5.1 language standard the pseudo-argument arg is no longer supported. Drivers loaded using LuaJit that contain the argument will fail with a run-time error and not be loaded. The following list shows some examples of 5.0 <code>arg</code> use and how they can be modified to be 5.1 compatible:</p>

<table><thead>
<tr>
<th>5.0 Syntax</th>
<th>5.1 Syntax</th>
</tr>
</thead><tbody>
<tr>
<td><code> #arg</code></td>
<td><code>select(&quot;#&quot;, ...)</code></td>
</tr>
<tr>
<td><code>arg.n</code></td>
<td><code>select(&quot;#&quot;, …)</code></td>
</tr>
<tr>
<td><code>unpack.(arg)</code></td>
<td><code>unpack({...})</code></td>
</tr>
</tbody></table>

<p>Replacements for individual arg syntax lines will resolve this issue. However, it may be more effective to convert the vararg into a local variable named &#39;arg&#39; at the beginning of the function where the arg parameter is used. See the example to the right:</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span><span class="err"> </span><span class="nf">test</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="err">  </span><span class="kd">local</span> <span class="n">arg</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="err">  </span><span class="c1">-- Now all the arg-based code will work properly again...</span>
<span class="err">  </span><span class="nb">print</span><span class="p">(</span><span class="o">#</span><span class="n">arg</span><span class="p">)</span>
<span class="err">  </span><span class="k">for</span><span class="err"> </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="err"> </span><span class="o">#</span><span class="n">arg</span> <span class="k">do</span>
<span class="err">    </span><span class="nb">print</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="err">  </span><span class="k">end</span>
<span class="err">  </span>  <span class="nb">print</span><span class="p">(</span><span class="n">unpack</span><span class="p">(</span><span class="n">arg</span><span class="p">))</span>
<span class="k">end</span>
</code></pre></div><h3 id='driverworks-and-luajit-control4-os-3-and-luajit-invalid-escape-sequences'>Invalid Escape Sequences</h3>
<p>Also due to the Lua 5.1 language standard requirement, invalid escape sequences in Lua 5.0 are not supported by LuaJIT. This means that invalid escape sequences which were previously handled by PUC Lua are not handled by LuaJIT. The resulting error will prevent a driver from successfully loading or running. </p>

<p>The following table shows two examples of 5.0 escape sequences and how to fix them to meet the 5.1 language standard:</p>

<table><thead>
<tr>
<th>5.0 Syntax</th>
</tr>
</thead><tbody>
<tr>
<td><code>string.gsub(s, &#39;\&amp;quot\;&#39;, &#39;&quot;&#39;)</code></td>
</tr>
<tr>
<td><code>string.match(C4:GetVersionInfo().version, &#39;(%d+)\.(%d+)\.(%d+)\.(%d+)&#39;)</code></td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>5.1 Syntax</th>
</tr>
</thead><tbody>
<tr>
<td><code>string.gsub (s, &#39;%&amp;quot%;&#39; , &#39;&quot;&#39;) string.gsub (s, &#39;&amp;quot;&#39; , &#39;&quot;&#39;)</code></td>
</tr>
<tr>
<td><code>string.match(C4:GetVersionInfo().version, &#39;(%d+)%.(%d+)%.(%d+)%.(%d+)&#39;)</code></td>
</tr>
</tbody></table>

<p><em>The Lua 5.1 Language Manual details its incompatibilities with previous versions. For more information see Section #7 of the manual here: <a href="http://www.lua.org/manual/5.1/manual.html">http://www.lua.org/manual/5.1/manual.html</a></em></p>
<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-order-dependency-in-lua-tables'>Order Dependency in Lua Tables</h3>
<p>As best practice, Control4 recommends against the use of Lua Tables that depend on consistency with regard to the ordering of pairs. It is important to understand that LuaJIT does not iterate through a table of functions in the same way that PUC Lua does. For example, consider a table of functions that is iterated through using OnDriverInit() with the code to the right:</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="k">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">PROTOCOL_DECLARATIONS</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">PROTOCOL_DECLARATIONS</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">PROTOCOL_DECLARATIONS</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="s2">"function"</span><span class="p">)</span> <span class="k">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span><span class="err">             </span>
  <span class="n">PROTOCOL_DECLARATIONS</span><span class="p">[</span><span class="n">k</span><span class="p">]()</span>
 <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>There is no guarantee that that order of iteration through this table will be the same in LuaPUC and LuaJIT. A dependency on order in the table will likely result in a run-time Lua error. </p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-identifying-related-entries-in-the-driver-debug-logs'>Identifying Related Entries in the Driver Debug logs</h3>

<p>When Director attempts to load a driver it reports various errors and conditions to both the director.log and the <code>driver_debug.log</code> or: </p>

<p><code>/var/log/debug/director.log</code></p>

<p><code>/mtn/internal/log/driver_debug.log</code></p>

<p>Note that the director.log rotates out its content frequently so driver errors are quickly lost. However, <code>driver_debug.log</code> should have very little content and will likely be easier to inspect.   <code>driver_debug.log</code> resides in a different directory as it is not cleared on controller reboots. By default, <code>driver_debug_nl</code> is set at Error level logging and won’t capture debug log statements. This can be changed to capture debug level for development testing with the following command: sysman log <code>driver_debug_nl</code> debug</p>

<p><em>For further information regarding system logging, please see the System Manager Logging information.</em></p>

<p>For reference, a list of sample load conditions and their respective log entries follows:</p>

<p>Condition : A Lua driver loaded successfully with LuaJIT<br>
Sample Entry: 
<code>2018-10-10 12:34:56.789 -0600 ea5-000DEADBEEF [1234] DEBUG: Lua driver loaded successful with LuaJIT [id: 42][name: HeloWorld Driver][file: HeloWorld.c4z]</code></p>

<p>Condition : A Lua driver loaded successful with LuaJIT, but there are runtime errors: 
Sample Entry :
<code>2018-10-10 12:34:56.789 -0600 ea5-000DEADBEEF [1234] ERROR: Lua driver loaded with LuaJIT but there were one, or more, runtime errors. This driver may not function correctly [id: 42][name: HeloWorld Driver][file: HeloWorld.c4z]</code></p>

<p>Condition : A Lua driver failed to load with LuaJIT due to syntax errors. Director will proceed to reload the driver with PUC Lua:
Sample Entry :
 <code>2018-10-10 12:34:56.789 -0600 ea5-000DEADBEEF [1234] ERROR: Lua driver failed to load with LuaJIT; retrying with PUC Lua  [id: 42][name: HeloWorld Driver][file: HeloWorld.c4z]</code></p>

<p>Condition : A Lua driver loaded successfully with PUC Lua:
Sample Entry : 
<code>2018-10-10 12:34:56.789 -0600 ea5-000DEADBEEF [1234] DEBUG: Lua driver loaded successfully with PUC Lua [id: 42][name: HeloWorld Driver][file: HeloWorld.c4z]</code></p>

<p>Condition : A Lua driver loaded successfully with PUC Lua, but there are runtime errors:
Sample Entry : <code>2018-10-10 12:34:56.789 -0600 ea5-000DEADBEEF [1234] ERROR: Lua driver loaded with PUC Lua but there were one, or more, runtime errors. This driver may not function correctly [id: 42][name: HeloWorld Driver][file: HeloWorld.c4z]</code></p>

<h3 id='driverworks-and-luajit-control4-os-3-and-luajit-driver-validation-using-drivervalidator'>Driver Validation using DriverValidator</h3>

<p>Driver Validator is a DriverWorks SDK compiled Python utility used to validate .c4z files. This section will explain how to execute the utility from a command line to validate a driver&#39;s LuaJit compatibility. </p>

<p>An example of executing drivervalidator against a driver called HelloWorld.c4z would be:</p>

<p><code>-d &quot;C:\\Users\username\Documents\Control4\Drivers\Hello World\Hello World.c4z&quot; -v 1 -1 8</code></p>

<p>In the example above, the -d is required followed by the path to the .c4z file that will be validated. The verbosity level (-v 1) is set with a value of 1 or 2. A value of 1 is least and 2 is most. The example above shows a verbosity level of least. In the example above (-v 1 -1 8) the value of 8 is passed for a logging level of DEBUG. Logging level values are passed as follows:</p>

<p><code>WARN = 1</code>
<code>FATAL = 2</code>
<code>FAIL = 3</code>
<code>ERROR = 4</code>
<code>PASS = 5</code>
<code>INFO = 6</code>
<code>NOT_IMPLEMENTED -= 7</code>
<code>DEBUG = 8</code></p>

<p>Selecting a logging level will include all log entries for it and any entries for logging levels lower than it. For example, selecting a log level of ERROR will log all Error entries as well as FAIL, FATAL and WARN. The NOT IMPLEMENTED log level is has been included for driver certification testing purposes. This log level is useful in identifying instances where a test routines have been created for driver code, but the driver being validated has not implemented that code.</p>
<h1 id='proxies-and-proxy-types'>Proxies and Proxy Types</h1>

<h2 id='proxies-and-proxy-types-single-and-multi-proxies'>Single and Multi-Proxies</h2>

<p>Most devices will require the use of only a single proxy.  Be sure to choose the correct proxy type for your device.  When using a single proxy, your .c4z can specify the proxy using a simple declaration in the .c4i file. For example:</p>

<p><code>&lt;proxy&gt;discchanger&lt;/proxy&gt;</code></p>

<p>or</p>

<p><code>&lt;proxy&gt;TV&lt;/proxy&gt;</code></p>

<p>If you decide to not use an existing proxy and create one; you should specify the proxy with the same name as the .c4z filename.  Your driver will not show up for selection within Composer if your proxy name is not a valid proxy type for the Control4 system and doesn’t match your .c4i filename.</p>

<p>Alternatively, even for a single proxy driver, you may choose to use the more complete declaration as in the first two examples to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies&gt;</span>
  <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span><span class="nt">&gt;</span>discchanger<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies&gt;</span>
 <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span><span class="nt">&gt;</span>~tv~<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div>

<p>This is also the format used with multi-proxy devices as seen in the remaining examples:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies&gt;</span>
  <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span><span class="nt">&gt;</span>tuner<span class="nt">&lt;/proxy&gt;</span>
  <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5002"</span><span class="nt">&gt;</span>tuner<span class="nt">&lt;/proxy&gt;</span>
  <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5003"</span><span class="nt">&gt;</span>tunerXM<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies&gt;</span>
   <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span><span class="nt">&gt;</span>receiver<span class="nt">&lt;/proxy&gt;</span>
   <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5002"</span><span class="nt">&gt;</span>tuner<span class="nt">&lt;/proxy&gt;</span>
   <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5003"</span><span class="nt">&gt;</span>tunerXM<span class="nt">&lt;/proxy&gt;</span>
   <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5004"</span><span class="nt">&gt;</span>dvd<span class="nt">&lt;/proxy&gt;</span>
   <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5005"</span><span class="nt">&gt;</span>tunerXM<span class="nt">&lt;/proxy&gt;</span>
 <span class="nt">&lt;/proxies&gt;</span>
</code></pre></div>

<p>Each proxy within a driver is given a binding ID in the &lt;connections&gt; section of the .c4z.  If you have multiple proxies of the same type you’ll need to explicitly state the proxybinding id for each proxy.  The proxy binding ID is included in every command received from the system for your DriverWorks driver.</p>

<p>If you have any questions about how to define the proxy or proxies for a specific device type, you might find it helpful to refer to an existing driver.  Proxies are defined in the same way for DriverWorks and for non-DriverWorks drivers.</p>

<h2 id='proxies-and-proxy-types-modifying-the-default-naming-of-proxies'>Modifying the Default Naming of Proxies</h2>

<p>When a device is added to a project within Composer, the name of the device displayed in the project is inherited from the device proxy. It is possible modify the name for a proxy that will be displayed in composer. This is especially useful when a proxy includes several “devices” . The name can be changed in the proxies section of the driver. In the example to the right, a thermostat has been renamed. Instead of the device being identified in composer as “Thermostat” it will now be displayed as “Carrier Infinity Thermostat”.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies</span> <span class="na">qty=</span><span class="s">"1"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span> <span class="na">name=</span><span class="s">"Carrier Infinity Thermostat"</span><span class="nt">&gt;</span>~thermostat<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div>
<h1 id='commands'>Commands</h1>

<p>Commands come from the Device Proxy. For example, a AV Switch might have the following section in the XML of the .c4z file:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;commands&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>MAIN_ZONE_ON<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>MAIN_ZONE_ON<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>MAIN_ZONE_OFF<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>MAIN_ZONE_OFF<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>ZONE2_ON<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>ZONE2_ON<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>ZONE2_OFF<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>ZONE2_OFF<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>ZONE3_ON<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>ZONE3_ON<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>ZONE3_OFF<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>ZONE3_OFF<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>ZONE4_ON<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>ZONE4_ON<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
 <span class="nt">&lt;command&gt;</span>
   <span class="nt">&lt;name&gt;</span>ZONE4_OFF<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;description&gt;</span>ZONE4_OFF<span class="nt">&lt;/description&gt;</span>
 <span class="nt">&lt;/command&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div><h2 id='commands-supported-command-parameter-types'>Supported Command Parameter Types</h2><h3 id='commands-supported-command-parameter-types-custom-select'>Custom Select</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>Select Channel<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>Select Channel PARAM1<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>9<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>Channel<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:SelectChannelParamSelect<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>

<p>The ability of a Proxy driver to deliver a browse-able list of related elements can be supported through the use of the CUSTOM_SELECT property.</p>

<p>These lists could represent stations, channels or actual media. The elements delivered in the list can then be used as parameter in a command.</p>

<p>In order for this property to work, a command needs to be created in the &lt;devicedata&gt;&lt;config&gt; section of the c4z driver.xml file. This command must include the CUSTOM_SELECT parameter type. For example, here is a command called SelectChannelParamSelect.</p>

<p>In the SelectChannel example above, SelectChannel is the command name that is sent to the ExecuteCommand function in the driver. The param type CUSTOM_SELECT allows for the specification of a global .lua function that will be invoked whenever ComposerPro wants to get data. In the example to the right, it is the function SelectChannelParamSelect.</p>

<h3 id='commands-supported-command-parameter-types-device-selector'>Device Selector</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>DEVICE_SELECTOR Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME DEVICE_SELECTOR Value: PARAM1<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>6<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>DEVICE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>DEVICE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;items&gt;</span>
                    <span class="nt">&lt;item&gt;</span>pool.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>camera.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>blind.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>camera.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>controller.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>doorstation.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>light_v2.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>lock.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>media.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>tv.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>uidevice.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>thermostatV2.c4i<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>driver_properties.c4z<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;/items&gt;</span>
                <span class="nt">&lt;multiselect&gt;</span>true<span class="nt">&lt;/multiselect&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p>The Device Selector command parameter type supports the Device Selector property. This is  a property that can be added to a DriverWorks driver. Device Selector allows you (as the driver developer) to display a list of devices that may be associated with the driver you have developed. These devices can then be selected from within composer.</p>

<p>In order for this property to work, a command needs to be created in the &lt;devicedata&gt;&lt;config&gt; section of the c4z driver.xml file. This command must include the DEVICE_SELECTOR_ parameter type.</p>
<h3 id='commands-supported-command-parameter-types-dynamic-list'>Dynamic List</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>DYNAMIC_LIST Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>DYNAMIC_LIST Value: PARAM1<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>4<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p>The Dynamic List command parameter type supports the ability to use the Dynamic List Property. This property provides ability to include driver-based, dynamically updated lists in ComposerPro’s Advanced Properties screen.</p>

<p>In order for this property to work, a command needs to be created in the &lt;devicedata&gt;&lt;config&gt; section of the c4z driver.xml file. This command must include the DYNAMIC_LIST_ parameter type.</p>

<p>Note: The driver must implement a function called GetCommandParamList that returns a table with the list for the specified parameter.</p>
<h3 id='commands-supported-command-parameter-types-list'>List</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>LIST Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME LIST Value: PARAM1<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>3<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>LIST<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>LIST<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;items&gt;</span>
                    <span class="nt">&lt;item&gt;</span>Item 1<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>Item 2<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>Item 3<span class="nt">&lt;/item&gt;</span>
                    <span class="nt">&lt;item&gt;</span>Item 4<span class="nt">&lt;/item&gt;</span>
                <span class="nt">&lt;/items&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p>The List command parameter type supports the ability to provide a non-dynamic list of selectable objects within the Properties tab in ComposerPro.</p>

<p>In order for this property to work, a command needs to be created in the &lt;devicedata&gt;&lt;config&gt; section of the c4z driver.xml file. This command must include the LIST parameter type.</p>
<h3 id='commands-supported-command-parameter-types-ranged-float'>Ranged Float</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>RANGED_FLOAT Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME RANGED_FLOAT Value: PARAM1<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>1<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>RANGED_FLOAT<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>RANGED_FLOAT<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;minimum&gt;</span>50<span class="nt">&lt;/minimum&gt;</span>
                <span class="nt">&lt;maximum&gt;</span>60<span class="nt">&lt;/maximum&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p>The Ranged Float command parameter type supports the ability to provide a range of selectable floating-point or non-integer numbers within the Properties tab in ComposerPro.</p>

<p>In order for this property to work, a command needs to be created in the &lt;devicedata&gt;&lt;config&gt; section of the c4z driver.xml file. This command must include the RANGED_FLOAT_ parameter type.</p>
<h3 id='commands-supported-command-parameter-types-ranged-integer'>Ranged Integer</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>RANGED_INTEGER Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME RANGED_INTEGER Value: PARAM1<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>0<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>RANGED_INTEGER<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>RANGED_INTEGER<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;minimum&gt;</span>79<span class="nt">&lt;/minimum&gt;</span>
                <span class="nt">&lt;maximum&gt;</span>120<span class="nt">&lt;/maximum&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p>The Ranged Integer command parameter type supports the ability to provide a range of selectable integers within the Properties tab in ComposerPro.</p>

<p>In order for this property to work, a command needs to be created in the &lt;devicedata&gt;&lt;config&gt; section of the c4z driver.xml file. This command must include the RANGED_INTEGER_ parameter type</p>
<h3 id='commands-supported-command-parameter-types-string'>String</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>STRING Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME STRING Value: PARAM1<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>2<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>STRING<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p>The STRING command parameter type supports the ability to provide a read only string within the Properties tab in ComposerPro.</p>

<p>In order for this property to work, a command needs to be created in the &lt;devicedata&gt;&lt;config&gt; section of the c4z driver.xml file. This command must include the STRING_ parameter type</p>
<h3 id='commands-supported-command-parameter-types-variable-selector'>Variable Selector</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>VARIABLE_SELECTOR  Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>Param Values NAME (boolean: PARAM1, P2: PARAM2, P3: PARAM3, P4: PARAM4, P5: PARAM5, P6: PARAM6, P7: PARAM7, P8: PARAM8)<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>7<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>boolean VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>boolean<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>string VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>string<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>number VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>number<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>float VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>float<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>device VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>device<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>media VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>media<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>user VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>user<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>all VARIABLE_SELECTOR<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>all<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p>The Variable Selector command parameter type supports the ability to choose a variable type within the Properties tab in ComposerPro. Supported Variable Types include:</p>

<ul>
<li>boolean</li>
<li>string</li>
<li>number</li>
<li>float</li>
<li>device</li>
<li>media</li>
<li>user</li>
<li>room</li>
</ul>
<h3 id='commands-supported-command-parameter-types-variable-selector-value'>Variable Selector Value</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
        <span class="nt">&lt;name&gt;</span>VARIABLE_SELECTOR_VALUE Parameter Example<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>Param Values NAME(P1: PARAM1, P2: PARAM2, P3: PARAM3, P4: PARAM4, P5: PARAM5, P6: PARAM6)<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>8<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>boolean VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>boolean<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>string VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>string<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>number VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>number<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>float VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>float<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>device VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>device<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>media VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>VARIABLE_SELECTOR_VALUE<span class="nt">&lt;/type&gt;</span>
                <span class="nt">&lt;variabletype&gt;</span>media<span class="nt">&lt;/variabletype&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
    <span class="nt">&lt;/command&gt;</span>
</code></pre></div><h2 id='commands-getcommandparamlist'>GetCommandParamList</h2>
<p>This function is required in order for a driver to use the DYNAMIC_LIST type parameters within a &lt;command&gt;.</p>
<h3 id='commands-getcommandparamlist-signature'>Signature</h3>

<p><code>GetCommandParamList ()</code></p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>str</td>
<td>commandName</td>
</tr>
<tr>
<td>str</td>
<td>paramName</td>
</tr>
</tbody></table>

<h3 id='commands-getcommandparamlist-returns'>Returns</h3>

<p>Returns a table with the list for the specified parameter.</p>

<h3 id='commands-getcommandparamlist-example'>Example</h3><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetCommandParamList</span><span class="p">(</span><span class="n">commandName</span><span class="p">,</span> <span class="n">paramName</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">tList</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">commandName</span> <span class="o">==</span> <span class="s2">"Turn On"</span><span class="p">)</span> <span class="k">then</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">paramName</span> <span class="o">==</span> <span class="s2">"Zone"</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">tList</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Main"</span><span class="p">,</span> <span class="s2">"Master"</span><span class="p">,</span> <span class="s2">"Upstairs"</span><span class="p">,</span> <span class="s2">"Downstairs"</span><span class="p">,</span> <span class="s2">"Patio"</span><span class="p">}</span>
        <span class="k">elseif</span> <span class="p">(</span><span class="n">paramName</span> <span class="o">==</span> <span class="s2">"Level"</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">tList</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Low"</span><span class="p">,</span> <span class="s2">"Medium"</span><span class="p">,</span> <span class="s2">"High"</span><span class="p">}</span>
        <span class="k">end</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">commandName</span> <span class="o">==</span> <span class="s2">"Toggle"</span> <span class="ow">and</span> <span class="n">paramName</span> <span class="o">==</span> <span class="s2">"Zone"</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">tList</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"Main"</span><span class="p">,</span> <span class="s2">"Patio"</span><span class="p">}</span>
    <span class="k">end</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">tList</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div><h2 id='commands-dynamic-list-type-for-commands'>Dynamic List type for Commands</h2>
<p>Support for DYNAMIC_LIST type parameters within a &lt;command&gt;. The driver must implement a function called GetCommandParamList that returns a table with the list for the specified parameter.</p>

<p><em>This feature was introduced in O.S. Release 3.3.0</em></p>
<h3 id='commands-dynamic-list-type-for-commands-example'>Example</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;command&gt;</span>
    <span class="nt">&lt;name&gt;</span>Turn On<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;description&gt;</span>Turn on PARAM1 to PARAM2<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Zone<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Level<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
<span class="nt">&lt;command&gt;</span>
    <span class="nt">&lt;name&gt;</span>Toggle<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;description&gt;</span>Toggle PARAM1<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Zone<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/command&gt;</span>
</code></pre></div><h2 id='commands-sorting-commands-in-composerpro'>Sorting Commands in ComposerPro</h2>
<p>The ability to order the way driver commands are displayed in the Programming area of ComposerPro is possible with the use of a sort order driver XML tag:</p>
<div class="highlight"><pre class="highlight xml tab-xml"><code>            <span class="nt">&lt;command&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Command<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>New Description<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>0<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/command&gt;</span>
            <span class="nt">&lt;command&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Command 1<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Command Description 1<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>1<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/command&gt;</span>
            <span class="nt">&lt;command&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Command 2<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Command Description 2<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>2<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/command&gt;</span>
            <span class="nt">&lt;command&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Command 3<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Command Description 3<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>3<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/command&gt;</span>
            <span class="nt">&lt;command&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Command 4<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Command Description 4<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>4<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/command&gt;</span>
            <span class="nt">&lt;command&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Command 5<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Command Description 10<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>5<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/command&gt;</span>
</code></pre></div>
<p><code>&lt;sort_order&gt;&lt;/sort_order&gt;</code></p>

<p>The tag accepts a zero based list and will display the commands in the order of the number included in each commands’ <code>&lt;sort_order&gt;&lt;/sort_order&gt;</code>tag.</p>

<p>For example, in the XML code to the right there are five device specific commands. They will display in ComposerPro Programming as:</p>

<ul>
<li>New Command</li>
<li>New Command 1</li>
<li>New Command 2</li>
<li>New Command 3</li>
<li>New Command 4</li>
<li>New Command 5</li>
</ul>
<h3 id='commands-sorting-commands-in-composerpro-considerations-when-sorting-commands'>Considerations when Sorting Commands</h3>

<ul>
<li>Sort Order numbering must be a positive number (including 0). The list is sorted in numerical order.</li>
<li> If a sort order number value is used twice, the second Command using the same value will not be displayed.</li>
<li>When defining Commands that will use the Sort Order element, all of the Commands must include a numeric value. Failing to provide a sort order number for one Command will result in none of the Commands being sorted. For example, if you have ten Commands defined in your driver and one of them is missing the sort order element - none of the Commands will be sorted.</li>
</ul>
<h1 id='conditionals'>Conditionals</h1>

<h2 id='conditionals-overview'>Overview</h2>

<p>Driver conditionals are useful to include in your driver as they provide the opportunity for custom programming through the interface found in ComposerPro. When considering conditionals, it’s helpful to think of them as “If” programming statements. For example, a light driver may have a simple conditional defined for when the light is in the On state. Using this conditional can then support programming in the project that will be executed if the light is On.</p>

<p>Conditionals are defined in the driver’s XML area within the conditionals tag. See the example to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>1.  <span class="nt">&lt;conditionals&gt;</span>
2.   <span class="nt">&lt;conditional&gt;</span>
3.     <span class="nt">&lt;id&gt;</span>0<span class="nt">&lt;/id&gt;</span>
4.     <span class="nt">&lt;name&gt;</span>SIMPLE_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
5.     <span class="nt">&lt;type&gt;</span>SIMPLE<span class="nt">&lt;/type&gt;</span>
6.     <span class="nt">&lt;condition_statement&gt;</span>The light is on<span class="nt">&lt;/condition_statement&gt;</span>
7.     <span class="nt">&lt;description&gt;</span>NAME is On<span class="nt">&lt;/description&gt;</span>
8.   <span class="nt">&lt;/conditional&gt;</span>
9.  <span class="nt">&lt;/conditionals&gt;</span>
</code></pre></div><h3 id='conditionals-overview-conditional-types'>Conditional Types</h3>
<p>Conditionals are not just limited to the simple example provided above. Currently there are seven types of conditionals that can be included in your driver. They vary in complexity and each are intended to provide a specific programming opportunity. They include:</p>

<p><strong>LIST</strong>: Asks if the current device value is equal to or not equal to the selected item in a list of values defined in the driver. These values can be numbers or strings.</p>

<p><strong>STRING</strong>: Asks if the current device value provided in string format is equal to or not equal to a string value entered in ComposerPro programming by the integrator.</p>

<p><strong>NUMBER</strong>: Uses the following operators: =, !=, &lt;, &lt;=, &gt;, &gt;= to compare the current device value with an integer entered in ComposerPro programming by the dealer.</p>

<p><strong>BOOLEAN</strong>: Asks a True/False question based on True/False text provided by the driver conditional configuration.</p>

<p><strong>SIMPLE</strong>: Asks a true or false question.</p>

<p><strong>ROOM</strong>: Provides the ability to initiate programming based on whether or not a room selection is equal to or not equal to a room in the project.</p>

<p><strong>DEVICE</strong>: Provides the ability to initiate programming based on whether or not a device selection is equal to or not equal to a device in the project.</p>

<p>A Note about Loops
Before detailing each of the conditionals listed above, it’s worth noting the role of Loops in ComposerPro programming. Loops offer another opportunity of custom programming for your driver. ComposerPro will use the XML for the conditionals you’ve defined in your driver and replicate them under their own Loops programming tab. All of your conditionals, and their respective functionality, are listed under the Loops tab exactly as they are under the conditionals tab. However, Loops differ from conditionals in that they can be considered as “While” programming statements. </p>

<p>Above we looked at a simple light on conditional example. When ComposerPro creates a Loop based on this conditional, it provides a programming opportunity that can be used while the light is in the On state. Using this Loop supports programming in the project that will be executed while the light is On.</p>

<p>As mentioned above, ComposerPro created these Loops from your driver’s conditional XML code. As a driver writer, you need to do nothing for Loops to be available for use in ComposerPro. However, it is worth considering that Loops can be resource expensive as they will continue to execute throughout the duration that a device is in a certain state. If your conditional code lends itself to the potential of this happening addressing this in your driver documentation is strongly recommended.</p>

<h2 id='conditionals-simple-conditional'>Simple Conditional</h2><h3 id='conditionals-simple-conditional-understanding-xml-in-a-simple-type-conditional'>Understanding XML in a SIMPLE Type Conditional</h3>
<p>Your conditional XML code must be defined in a manner that can be used by ComposerPro. In this section, we’ll define a SIMPLE type conditional called <code>SIMPLE_LIGHT_ON</code>. In doing so we’ll look at each line of XML required to define this type of conditional to the right:</p>
<div class="highlight"><pre class="highlight xml tab-xml"><code>1.  <span class="nt">&lt;conditionals&gt;</span>
2.   <span class="nt">&lt;conditional&gt;</span>
3.     <span class="nt">&lt;id&gt;</span>0<span class="nt">&lt;/id&gt;</span>
4.     <span class="nt">&lt;name&gt;</span>SIMPLE_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
5.     <span class="nt">&lt;type&gt;</span>SIMPLE<span class="nt">&lt;/type&gt;</span>
6.     <span class="nt">&lt;condition_statement&gt;</span>The light is on<span class="nt">&lt;/condition_statement&gt;</span>
7.     <span class="nt">&lt;description&gt;</span>NAME is On<span class="nt">&lt;/description&gt;</span>
8.   <span class="nt">&lt;/conditional&gt;</span>
9.  <span class="nt">&lt;/conditionals&gt;</span>
</code></pre></div>

<p>Line 1: <code>&lt;conditionals&gt;&lt;/conditionals&gt; </code>
This is the driver’s root XML tag that contains all the driver’s conditional code.</p>

<p>Line 2: <code>&lt;conditional&gt;&lt;/conditional&gt; </code>
XML tag for this unique conditional.</p>

<p>Line 3: <code>&lt;id&gt;&lt;/id&gt;</code>
The conditional’s numeric ID value. It is recommended that conditionals be numbered beginning with 0. All conditionals require a unique numeric ID.</p>

<p>Line 4: <code>&lt;name&gt;&lt;/name&gt;</code>
The name of the conditional. This is a unique name defined by the driver writer. It is used in the TestCondition function in the Lua code of the driver. This is given as the first parameter to the TestCondition function. This is how the driver knows what condition is being tested.</p>

<p>Line 5: <code>&lt;type&gt;&lt;/type&gt;</code>
The type of the conditional as defined above in the Conditional Types section.</p>

<p>Line 6: &lt;<code>condition_statement&gt;&lt;/condition_statement&gt;</code> 
The conditional statement states a question being asked regarding a state of the driver. This is the statement that is shown before the condition logic. For example, the Simple Light On conditional above, the question being asked is if ‘The Light is on’. It is basically a useful statement that supports the conditional. When an integrator is viewing this driver’s conditionals in ComposerPro, they can select “The Light is on” from the list of conditionals and can ultimately initiate programming when the light is in the On state.</p>

<p>Line 7: <code>&lt;description&gt;&lt;/description&gt;</code>
The description element needs to contain the NAME macro. NAME is a key value that is equivalent to your driver’s unique name. Every conditional needs to include NAME. ComposerPro treats the NAME macro in your conditional XML in a way that replaces it with your driver’s unique name. The unique name is formatted by the name of the room where the driver resides followed by “-&gt;”, followed by the name of the driver as it is named in the project. For example, consider that the name of our example driver is “Living Room Lamp” and it is in the Living Room. Based on this, “Living Room-&gt;Living Room Lamp” will replace NAME when your conditional programming description is displayed in the conditionals window and the script actions area of ComposerPro. Using the example above, ComposerPro will display the description XML element as: “If Living Room-&gt;Living Room Lamp is on”.</p>

<h2 id='conditionals-conditional-xml-example-code'>Conditional XML Example Code</h2>

<p>Previously, we discussed how to define a SIMPLE type conditional. The remainder of this document will explain each of the conditional types listed above in the same manner. An XML code set defining these conditionals is referenced throughout. The conditional code examples in the XML are based on an example Light driver. This &quot;driver code” is for explanation purposes only. Typically, the Light Proxy would be used in this case. However, this example explains how Conditionals are not only defined but can be useful for drivers that need to offer them when they are not provided in the scope of a Control4 Proxy. The sample XML from the “driver” is shown to the righ:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>1. <span class="nt">&lt;conditionals&gt;</span>
2.   <span class="nt">&lt;conditional&gt;</span>
3.     <span class="nt">&lt;id&gt;</span>0<span class="nt">&lt;/id&gt;</span>
4.     <span class="nt">&lt;name&gt;</span>SIMPLE_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
5.     <span class="nt">&lt;type&gt;</span>SIMPLE<span class="nt">&lt;/type&gt;</span>
6.     <span class="nt">&lt;condition_statement&gt;</span>The light is on<span class="nt">&lt;/condition_statement&gt;</span>
7.     <span class="nt">&lt;description&gt;</span>NAME is On<span class="nt">&lt;/description&gt;</span>
8.   <span class="nt">&lt;/conditional&gt;</span>
9.   <span class="nt">&lt;conditional&gt;</span>
10.     <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
11.     <span class="nt">&lt;name&gt;</span>SIMPLE_LIGHT_OFF<span class="nt">&lt;/name&gt;</span>
12.     <span class="nt">&lt;type&gt;</span>SIMPLE<span class="nt">&lt;/type&gt;</span>
13.     <span class="nt">&lt;condition_statement&gt;</span>The light is off<span class="nt">&lt;/condition_statement&gt;</span>
14.     <span class="nt">&lt;description&gt;</span>NAME is Off<span class="nt">&lt;/description&gt;</span>
15.   <span class="nt">&lt;/conditional&gt;</span>
16.   <span class="nt">&lt;conditional&gt;</span>
17.     <span class="nt">&lt;id&gt;</span>2<span class="nt">&lt;/id&gt;</span>
18.     <span class="nt">&lt;name&gt;</span>BOOL_LIGHT<span class="nt">&lt;/name&gt;</span>
19.     <span class="nt">&lt;type&gt;</span>BOOL<span class="nt">&lt;/type&gt;</span>
20.     <span class="nt">&lt;condition_statement&gt;</span>Light is<span class="nt">&lt;/condition_statement&gt;</span>
21.     <span class="nt">&lt;description&gt;</span>NAME Light is STRING<span class="nt">&lt;/description&gt;</span>
22.     <span class="nt">&lt;true_text&gt;</span>On<span class="nt">&lt;/true_text&gt;</span>
23.     <span class="nt">&lt;false_text&gt;</span>Off<span class="nt">&lt;/false_text&gt;</span>
24.   <span class="nt">&lt;/conditional&gt;</span>
25.   <span class="nt">&lt;conditional&gt;</span>
26.     <span class="nt">&lt;id&gt;</span>3<span class="nt">&lt;/id&gt;</span>
27.     <span class="nt">&lt;name&gt;</span>BOOL_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
28.     <span class="nt">&lt;type&gt;</span>BOOL<span class="nt">&lt;/type&gt;</span>
29.     <span class="nt">&lt;condition_statement&gt;</span>Light is On<span class="nt">&lt;/condition_statement&gt;</span>
30.     <span class="nt">&lt;description&gt;</span>NAME Light is On is STRING<span class="nt">&lt;/description&gt;</span>
31.     <span class="nt">&lt;true_text&gt;</span>True<span class="nt">&lt;/true_text&gt;</span>
32.     <span class="nt">&lt;false_text&gt;</span>False<span class="nt">&lt;/false_text&gt;</span>
33.  <span class="nt">&lt;/conditional&gt;</span>
34.  <span class="nt">&lt;conditional&gt;</span>
35.     <span class="nt">&lt;id&gt;</span>4<span class="nt">&lt;/id&gt;</span>
36.     <span class="nt">&lt;name&gt;</span>NUMBER_LIGHT_LEVEL<span class="nt">&lt;/name&gt;</span>
37.     <span class="nt">&lt;type&gt;</span>NUMBER<span class="nt">&lt;/type&gt;</span>
38.     <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
39.     <span class="nt">&lt;description&gt;</span>NAME is LOGIC INTEGER<span class="nt">&lt;/description&gt;</span>
40.     <span class="nt">&lt;minimum&gt;</span>10<span class="nt">&lt;/minimum&gt;</span>
41.     <span class="nt">&lt;maximum&gt;</span>150<span class="nt">&lt;/maximum&gt;</span>
42.   <span class="nt">&lt;/conditional&gt;</span>
43.   <span class="nt">&lt;conditional&gt;</span>
44.     <span class="nt">&lt;id&gt;</span>5<span class="nt">&lt;/id&gt;</span>
45.     <span class="nt">&lt;name&gt;</span>STRING_LIGHT<span class="nt">&lt;/name&gt;</span>
46.     <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
47.     <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
48.     <span class="nt">&lt;description&gt;</span>NAME Level is LOGIC STRING<span class="nt">&lt;/description&gt;</span>
49.   <span class="nt">&lt;/conditional&gt;</span>
50.   <span class="nt">&lt;conditional&gt;</span>
51.     <span class="nt">&lt;id&gt;</span>6<span class="nt">&lt;/id&gt;</span>
52.     <span class="nt">&lt;name&gt;</span>LIST_LIGHT_LEVEL<span class="nt">&lt;/name&gt;</span>
53.     <span class="nt">&lt;type&gt;</span>LIST<span class="nt">&lt;/type&gt;</span>
54.     <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
55.     <span class="nt">&lt;description&gt;</span>NAME is LOGIC STRING<span class="nt">&lt;/description&gt;</span>
56.     <span class="nt">&lt;items&gt;</span>
57.      <span class="nt">&lt;item&gt;</span>10%<span class="nt">&lt;/item&gt;</span>
58.      <span class="nt">&lt;item&gt;</span>20%<span class="nt">&lt;/item&gt;</span>
59.      <span class="nt">&lt;item&gt;</span>30%<span class="nt">&lt;/item&gt;</span>
60.      <span class="nt">&lt;item&gt;</span>40%<span class="nt">&lt;/item&gt;</span>
61.      <span class="nt">&lt;item&gt;</span>50%<span class="nt">&lt;/item&gt;</span>
62.      <span class="nt">&lt;item&gt;</span>60%<span class="nt">&lt;/item&gt;</span>
63.      <span class="nt">&lt;item&gt;</span>70%<span class="nt">&lt;/item&gt;</span>
64.      <span class="nt">&lt;item&gt;</span>80%<span class="nt">&lt;/item&gt;</span>
65.      <span class="nt">&lt;item&gt;</span>90%<span class="nt">&lt;/item&gt;</span>
66.      <span class="nt">&lt;item&gt;</span>100%<span class="nt">&lt;/item&gt;</span>
67.    <span class="nt">&lt;/items&gt;</span>
68.  <span class="nt">&lt;/conditional&gt;</span>
70.  <span class="nt">&lt;conditional&gt;</span>
71.    <span class="nt">&lt;id&gt;</span>7<span class="nt">&lt;/id&gt;</span>
72.    <span class="nt">&lt;name&gt;</span>ROOM_SELECTION<span class="nt">&lt;/name&gt;</span>
73.    <span class="nt">&lt;type&gt;</span>ROOM<span class="nt">&lt;/type&gt;</span>
74.    <span class="nt">&lt;condition_statement&gt;</span>[7-ROOM] Room Selection is<span class="nt">&lt;/condition_statement&gt;</span>
75.    <span class="nt">&lt;description&gt;</span>[7] NAME Room Selection LOGIC ROOM<span class="nt">&lt;/description&gt;</span>
76.  <span class="nt">&lt;/conditional&gt;</span>
77.  <span class="nt">&lt;conditional&gt;</span>
78.    <span class="nt">&lt;id&gt;</span>8<span class="nt">&lt;/id&gt;</span>
79.    <span class="nt">&lt;name&gt;</span>DEVICE_SELECTION<span class="nt">&lt;/name&gt;</span>
80.    <span class="nt">&lt;type&gt;</span>DEVICE<span class="nt">&lt;/type&gt;</span>
81.    <span class="nt">&lt;condition_statement&gt;</span>[8-DEVICE] Device Selection is<span class="nt">&lt;/condition_statement&gt;</span>
82.    <span class="nt">&lt;description&gt;</span>[8] NAME Device Selection LOGIC DEVICE<span class="nt">&lt;/description&gt;</span>
83.  <span class="nt">&lt;/conditional&gt;</span>
84.<span class="nt">&lt;/conditionals&gt;</span>
</code></pre></div>

<p>Note: The order in which the conditionals defined in the XML will be reversed in their order of display in ComposerPro. For example, above the<code>SIMPLE_LIGHT_ON</code> conditional is defined first. It will display at the bottom of the conditional list in the Programming area of ComposerPro.</p>

<h2 id='conditionals-using-the-test-condition-function'>Using the Test Condition Function</h2><h3 id='conditionals-using-the-test-condition-function-signature'>Signature</h3>
<p><code>TestCondition (name, tParams)</code></p>

<p>In order to evaluate the expression, the driver must implement the TestCondition function in their lua code.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>str</td>
<td>name: The name of the condition being tested. This is the name found in the &lt;name&gt; defined in the conditional xml.</td>
</tr>
<tr>
<td>table</td>
<td>tParam: Table of parameters. This varies depending on the Conditional Type  <code>&lt;type&gt;</code> tag as defined in the conditional xml.</td>
</tr>
</tbody></table>

<p>Conditional Types:</p>

<ul>
<li>SIMPLE: empty table</li>
<li>BOOL: empty table</li>
<li>NUMBER: table of two name/value pairs:</li>
<li>tParams “VALUE” contains the INTEGER macro value of the code item in programming.</li>
<li>tParams “LOGIC” contains the LOGIC macro value of the code item in programming. Possible LOGIC values are:
EQUAL, 
NOT_EQUAL, 
LESS_THAN, 
LESS_THAN_OR_EQUAL, 
GREATER_THAN, 
GREATER_THAN_OR_EQUAL.</li>
</ul>

<p>You may use <code>C4:EvaluateExpression</code> to simplify the evaluation of the LOGIC field.</p>

<p>STRING: table of two name/value pairs:
<code>tParams[“VALUE”]</code> contains the STRING macro value of the code item in programming.
<code>tParams[“LOGIC”]</code> contains the LOGIC macro value of the code item in programming. Possible LOGIC values are EQUAL and NOT_EQUAL.</p>

<p>You may use <code>C4:EvaluateExpression</code> to simplify the evaluation of the LOGIC field.</p>

<p>LIST: table of two name/value pairs:
<code>tParams[“VALUE”]</code> contains the STRING macro value of the code item in programming.
<code>tParams[“LOGIC”]</code> contains the LOGIC macro value of the code item in programming. Possible LOGIC values are EQUALand NOT_EQUAL._</p>

<p>You may use <code>C4:EvaluateExpression</code>n to simplify the evaluation of the LOGIC field.</p>

<p>ROOM: table of two name/value pairs
<code>tParams[“VALUE”]</code> contains the room id of the ROOM macro value of the code item in programming.
<code>tParams[“LOGIC”]</code> contains the LOGIC macro value of the code item in programming. Possible LOGIC values are EQUALand NOT_EQUAL.</p>

<p>You may use <code>C4:EvaluateExpression</code> to simplify the evaluation of the LOGIC field.</p>

<p>DEVICE: table of two name/value pairs
<code>tParams[“VALUE”]</code> contains the device id of the DEVICE macro value of the code item in programming.
<code>tParams[“LOGIC”]</code> contains the LOGIC macro value of the code item in programming. Possible LOGIC values are EQUALand NOT_EQUAL.</p>

<p>You may use <code>C4:EvaluateExpression</code> to simplify the evaluation of the LOGIC field.</p>
<h3 id='conditionals-using-the-test-condition-function-returns'>Returns</h3>
<p>The function must return a Boolean value. If the expression results to true then return true, otherwise return false.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">Sample</span> <span class="n">TestCondition</span> <span class="k">function</span>


<span class="nf">function</span> <span class="n">TestCondition</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">retVal</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"SIMPLE_LIGHT_ON"</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="p">(</span><span class="n">gLightLevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"SIMPLE_LIGHT_OFF"</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="p">(</span><span class="n">gLightLevel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"BOOL_LIGHT_ON"</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">logic</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"LOGIC"</span><span class="p">]</span>
        <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"VALUE"</span><span class="p">]</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s2">"On"</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"BOOL_LIGHT"</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"VALUE"</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s2">"On"</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="n">gLightLevel</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">elseif</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="s2">"Off"</span><span class="p">)</span> <span class="k">then</span>
            <span class="n">retVal</span> <span class="o">=</span> <span class="n">gLightLevel</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">end</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"NUMBER_LIGHT_LEVEL"</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">logic</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"LOGIC"</span><span class="p">]</span>
        <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">tParams</span><span class="p">[</span><span class="s2">"VALUE"</span><span class="p">])</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">EvaluateExpression</span><span class="p">(</span><span class="n">logic</span><span class="p">,</span> <span class="n">gLightLevel</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"STRING_LIGHT"</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">logic</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"LOGIC"</span><span class="p">]</span>
        <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="n">tParams</span><span class="p">[</span><span class="s2">"VALUE"</span><span class="p">])</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">EvaluateExpression</span><span class="p">(</span><span class="n">logic</span><span class="p">,</span> <span class="n">gLightLevel</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"LIST_LIGHT_LEVEL"</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">logic</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"LOGIC"</span><span class="p">]</span>
        <span class="kd">local</span> <span class="n">strValue</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"VALUE"</span><span class="p">]</span>
        <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">tonumber</span><span class="p">(</span><span class="nb">string.match</span><span class="p">(</span><span class="n">strValue</span><span class="p">,</span><span class="s2">"(%d.+).+"</span><span class="p">))</span>
        <span class="n">LogTrace</span><span class="p">(</span><span class="s2">"value = "</span> <span class="o">..</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">EvaluateExpression</span><span class="p">(</span><span class="n">logic</span><span class="p">,</span> <span class="n">gLightLevel</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"ROOM_SELECTION"</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">logic</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"LOGIC"</span><span class="p">]</span>
        <span class="kd">local</span> <span class="n">strValue</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"VALUE"</span><span class="p">]</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">EvaluateExpression</span><span class="p">(</span><span class="n">logic</span><span class="p">,</span> <span class="n">someRoomId</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s2">"DEVICE_SELECTION"</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">logic</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"LOGIC"</span><span class="p">]</span>
        <span class="kd">local</span> <span class="n">strValue</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"VALUE"</span><span class="p">]</span>
        <span class="n">retVal</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">EvaluateExpression</span><span class="p">(</span><span class="n">logic</span><span class="p">,</span> <span class="n">someDeviceId</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="n">LogTrace</span><span class="p">(</span><span class="s2">"c4test: Result = "</span> <span class="o">..</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">retVal</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">retVal</span>
<span class="k">end</span>
</code></pre></div>
<h2 id='conditionals-understanding-xml-in-a-list-type-conditional'>Understanding XML in a LIST Type Conditional</h2>

<p>In this section, we’ll define a LIST type conditional called <code>LIST_LIGHT_LEVEL</code>. LIST type conditionals provide a list of values which can be selected for use in programming. Here is the example XML code used to define this type of conditional:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>50.   <span class="nt">&lt;conditional&gt;</span>
51.     <span class="nt">&lt;id&gt;</span>6<span class="nt">&lt;/id&gt;</span>
52.     <span class="nt">&lt;name&gt;</span>LIST_LIGHT_LEVEL<span class="nt">&lt;/name&gt;</span>
53.     <span class="nt">&lt;type&gt;</span>LIST<span class="nt">&lt;/type&gt;</span>
54.     <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
55.     <span class="nt">&lt;description&gt;</span>NAME is LOGIC STRING<span class="nt">&lt;/description&gt;</span>
56.     <span class="nt">&lt;items&gt;</span>
57.      <span class="nt">&lt;item&gt;</span>10%<span class="nt">&lt;/item&gt;</span>
58.      <span class="nt">&lt;item&gt;</span>20%<span class="nt">&lt;/item&gt;</span>
59.      <span class="nt">&lt;item&gt;</span>30%<span class="nt">&lt;/item&gt;</span>
60.      <span class="nt">&lt;item&gt;</span>40%<span class="nt">&lt;/item&gt;</span>
61.      <span class="nt">&lt;item&gt;</span>50%<span class="nt">&lt;/item&gt;</span>
62.      <span class="nt">&lt;item&gt;</span>60%<span class="nt">&lt;/item&gt;</span>
63.      <span class="nt">&lt;item&gt;</span>70%<span class="nt">&lt;/item&gt;</span>
64.      <span class="nt">&lt;item&gt;</span>80%<span class="nt">&lt;/item&gt;</span>
65.      <span class="nt">&lt;item&gt;</span>90%<span class="nt">&lt;/item&gt;</span>
66.      <span class="nt">&lt;item&gt;</span>100%<span class="nt">&lt;/item&gt;</span>
67.     <span class="nt">&lt;/items&gt;</span>
68.  <span class="nt">&lt;/conditional&gt;</span>
</code></pre></div>

<p>Line 50: <code>&lt;conditional&gt;&lt;/conditional&gt;</code>
XML tag for this unique conditional.</p>

<p>Line 51: <code>&lt;id&gt;&lt;/id&gt;</code>
The conditional’s numeric ID value. It is recommended that conditionals be numbered beginning with 0. All conditionals require a unique numeric ID.</p>

<p>Line 52: <code>&lt;name&gt;&lt;/name&gt;</code>
The name of the conditional. This is a unique name defined by the driver writer. It is used in the TestCondition function in the Lua code of the driver. This is given as the first parameter to the TestCondition function. This is how the driver knows what condition is being tested.</p>

<p>Line 53: <code>&lt;type&gt;&lt;/type&gt;</code>
The type of the conditional as defined above in the Conditional Types section.</p>

<p>Line 54: <code>&lt;condition_statement&gt;&lt;/condition_statement&gt;</code> 
The conditional statement states a question being asked regarding a state of the driver. This is the statement that is shown before the condition logic. For example, the <code>LIST_LIGHT_LEVEL</code> conditional above, the question being asked is if the current device value is equal to or not equal to the selected item in a list of values defined in the driver. It is basically a useful statement that supports the conditional. When an integrator is viewing this driver’s conditionals in ComposerPro, they can select a value from the list of values defined in the driver and initiate programming when the light is in the at the level selected.</p>

<p>Line 55: <code>&lt;description&gt;&lt;/description&gt;</code>
The description element needs to contain the NAME macro. NAME is a key value that is equivalent to your driver’s unique name. Every conditional needs to include NAME. ComposerPro treats the NAME macro in your conditional XML in a way that replaces it with your driver’s unique name. The unique name is formatted by the name of the room where the driver resides followed by “-&gt;”, followed by the name of the driver as it is named in the project. For example, consider that the name of our example driver is “Living Room Lamp” and it is in the Living Room. Based on this, “Living Room-&gt;Living Room Lamp” will replace NAME when your conditional programming description is displayed in the conditionals window and the script actions area of ComposerPro. Using the example above, ComposerPro can display the description XML element as: “If Living Room-&gt;Living Room Lamp is 50%” Note the use of the LOGIC STRING statement in the description XML. This provides the ability for an integrator to select any of the logic operators and apply that operator to the selected value. Operators include: =, !=, &lt;, &lt;=, &gt;, &gt;=. </p>

<p>Line 56: <code>&lt;items&gt;&lt;/items&gt;</code>
The items element contains a list of values which can be numerical or strings that are displayed in the list in ComposerPro. Integrators can choose a value from the list along with any of the logic operators to complete the programming for the conditional. </p>

<h2 id='conditionals-understanding-xml-in-a-string-type-conditional'>Understanding XML in a STRING Type Conditional</h2>

<p>In this section, we’ll define a STRING type conditional called <code>STRING_LIGHT</code>. STRING type conditionals provide values (in string format) which can be selected for use in programming. Here is the example XML code used to define this type of conditional:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>43.   <span class="nt">&lt;conditional&gt;</span>
44.     <span class="nt">&lt;id&gt;</span>5<span class="nt">&lt;/id&gt;</span>
45.     <span class="nt">&lt;name&gt;</span>STRING_LIGHT<span class="nt">&lt;/name&gt;</span>
46.     <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
47.     <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
48.     <span class="nt">&lt;description&gt;</span>NAME Level is LOGIC STRING<span class="nt">&lt;/description&gt;</span>
49.   <span class="nt">&lt;/conditional&gt;</span>
50.   <span class="nt">&lt;conditional&gt;</span>
</code></pre></div>

<p>Line 43: <code>&lt;conditional&gt;&lt;/conditional&gt;</code>
XML tag for this unique conditional.</p>

<p>Line 44: <code>&lt;id&gt;&lt;/id&gt;</code>
The conditional’s numeric ID value. It is recommended that conditionals be numbered beginning with 0. All conditionals require a unique numeric ID.</p>

<p>Line 45: <code>&lt;name&gt;&lt;/name&gt;</code>
The name of the conditional. This is a unique name defined by the driver writer. It is used in the TestCondition function in the Lua code of the driver. This is given as the first parameter to the TestCondition function. This is how the driver knows what condition is being tested.</p>

<p>Line 46: <code>&lt;type&gt;&lt;/type&gt;</code>
The type of the conditional as defined above in the Conditional Types section.</p>

<p>Line 47: <code>&lt;condition_statement&gt;&lt;/condition_statement&gt; </code>
The conditional statement states a question being asked regarding a state of the driver. This is the statement that is shown before the condition logic. For example, in the <code>STRING_LIGHT</code> conditional above, the question being asked is: Is the device value equal to or not equal to a string value entered in ComposerPro programming by the integrator. It is basically a useful statement that supports the conditional. When an integrator is viewing this driver’s conditionals in ComposerPro, they can enter a string value for this conditional and ultimately initiate programming when the device state is equal to or not equal to the value entered. </p>

<p>Line 48: <code>&lt;description&gt;&lt;/description&gt;</code>
The description element needs to contain the NAME macro. NAME is a key value that is equivalent to your driver’s unique name. Every conditional needs to include NAME. ComposerPro treats the NAME macro in your conditional XML in a way that replaces it with your driver’s unique name. The unique name is formatted by the name of the room where the driver resides followed by “-&gt;”, followed by the name of the driver as it is named in the project. For example, consider that the name of our example driver is “Living Room Lamp” and it is in the Living Room. Based on this, “Living Room-&gt;Living Room Lamp” will replace NAME when your conditional programming description is displayed in the conditionals window and the script actions area of ComposerPro. Using the example above, ComposerPro can display the description XML element as: “If Living Room-&gt;Living Room Lamp is 100%” where the string value of 100 is entered by the integrator.  Note the use of the LOGIC STRING statement in the description XML. This provides the ability for an integrator to select two of the logic operators and apply that operator to the selected value. Operators for the STRING type conditional include: =, !=</p>

<h2 id='conditionals-understanding-xml-in-a-number-type-conditional'>Understanding XML in a NUMBER Type Conditional</h2>

<p>In this section, we’ll define a NUMBER type conditional called <code>NUMBER_LIGHT_LEVE</code>L. NUMBER type conditionals compare the current device value with an integer entered in ComposerPro programming by the integrator. This comparison can use the following operators: =, !=. Here is the example XML code used to define this type of conditional:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>34.  <span class="nt">&lt;conditional&gt;</span>
35.     <span class="nt">&lt;id&gt;</span>4<span class="nt">&lt;/id&gt;</span>
36.     <span class="nt">&lt;name&gt;</span>NUMBER_LIGHT_LEVEL<span class="nt">&lt;/name&gt;</span>
37.     <span class="nt">&lt;type&gt;</span>NUMBER<span class="nt">&lt;/type&gt;</span>
38.     <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
39.     <span class="nt">&lt;description&gt;</span>NAME is LOGIC INTEGER<span class="nt">&lt;/description&gt;</span>
40.     <span class="nt">&lt;minimum&gt;</span>10<span class="nt">&lt;/minimum&gt;</span>
41.     <span class="nt">&lt;maximum&gt;</span>150<span class="nt">&lt;/maximum&gt;</span>
42.   <span class="nt">&lt;/conditional&gt;</span>
</code></pre></div>

<p>Line 34: <code>&lt;conditional&gt;&lt;/conditional&gt;</code>
XML tag for this unique conditional.</p>

<p>Line 35: <code>&lt;id&gt;&lt;/id&gt;</code>
The conditional’s numeric ID value. It is recommended that conditionals be numbered beginning with 0. All conditionals require a unique numeric ID.</p>

<p>Line 36: <code>&lt;name&gt;&lt;/name&gt;</code>
The name of the conditional. This is a unique name defined by the driver writer. It is used in the TestCondition function in the Lua code of the driver. This is given as the first parameter to the TestCondition function. This is how the driver knows what condition is being tested.</p>

<p>Line 37: <code>&lt;type&gt;&lt;/type&gt;</code>
The type of the conditional as defined above in the Conditional Types section.</p>

<p>Line 38: <code>&lt;condition_statement&gt;&lt;/condition_statement&gt;</code> 
The conditional statement states a question being asked regarding a state of the driver. This is the statement that is shown before the condition logic. For example, in the <code>NUMBER_LIGHT_LEVEL</code> conditional above the question being asked is: Is the device value equal to or not equal to a numeric value entered in ComposerPro programming by the integrator. It is basically a useful statement that supports the conditional. When an integrator is viewing this driver’s conditionals in ComposerPro, they can enter a numeric value for this conditional and ultimately initiate programming when the device state is equal to or not equal to the number entered. </p>

<p>Line 39: <code>&lt;description&gt;&lt;/description&gt;</code>
The description element needs to contain the NAME macro. NAME is a key value that is equivalent to your driver’s unique name. Every conditional needs to include NAME. ComposerPro treats the NAME macro in your conditional XML in a way that replaces it with your driver’s unique name. The unique name is formatted by the name of the room where the driver resides followed by “-&gt;”, followed by the name of the driver as it is named in the project. For example, consider that the name of our example driver is “Living Room Lamp” and it is in the Living Room. Based on this, “Living Room-&gt;Living Room Lamp” will replace NAME when your conditional programming description is displayed in the conditionals window and the script actions area of ComposerPro. Using the example above, ComposerPro can display the description XML element as: “If Living Room-&gt;Living Room Lamp is = 75%” where the numeric value of 75 is entered by the integrator. Note the use of the LOGIC STRING statement in the description XML. This provides the ability for an integrator to select two of the logic operators and apply that operator to the selected value. Operators for the STRING type conditional include: =, !=</p>

<h2 id='conditionals-understanding-xml-in-a-boolean-type-conditional'>Understanding XML in a BOOLEAN Type Conditional</h2>

<p>In this section, we’ll define a Boolean type conditional called <code>BOOL_LIGHT</code>. BOOLEAN type conditionals ask a True/False question based on True/False text provided by the driver conditional configuration. Programming is completed by the integrator responding to the True/False question by making response selections in the programming window. Here is the example XML code used to define this type of conditional:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>16.   <span class="nt">&lt;conditional&gt;</span>
17.     <span class="nt">&lt;id&gt;</span>2<span class="nt">&lt;/id&gt;</span>
18.     <span class="nt">&lt;name&gt;</span>BOOL_LIGHT<span class="nt">&lt;/name&gt;</span>
19.     <span class="nt">&lt;type&gt;</span>BOOL<span class="nt">&lt;/type&gt;</span>
20.     <span class="nt">&lt;condition_statement&gt;</span>Light is<span class="nt">&lt;/condition_statement&gt;</span>
21.     <span class="nt">&lt;description&gt;</span>NAME Light is STRING<span class="nt">&lt;/description&gt;</span>
22.     <span class="nt">&lt;true_text&gt;</span>On<span class="nt">&lt;/true_text&gt;</span>
23.     <span class="nt">&lt;false_text&gt;</span>Off<span class="nt">&lt;/false_text&gt;</span>
24.   <span class="nt">&lt;/conditional&gt;</span>
</code></pre></div>

<p>Line 16: <code>&lt;conditional&gt;&lt;/conditional&gt;</code>
XML tag for this unique conditional.</p>

<p>Line 17: <code>&lt;id&gt;&lt;/id&gt;</code>
The conditional’s numeric ID value. It is recommended that conditionals be numbered beginning with 0. All conditionals require a unique numeric ID.</p>

<p>Line 18: <code>&lt;name&gt;&lt;/name&gt;</code>
The name of the conditional. This is a unique name defined by the driver writer. It is used in the TestCondition function in the Lua code of the driver. This is given as the first parameter to the TestCondition function. This is how the driver knows what condition is being tested.</p>

<p>Line 19: <code>&lt;type&gt;&lt;/type&gt;</code>
The type of the conditional as defined above in the Conditional Types section.</p>

<p>Line 20: <code>&lt;condition_statement&gt;&lt;/condition_statement&gt;</code> 
The conditional statement states a question being asked regarding a state of the driver. This is the statement that is shown before the condition logic. For example, in the <code>BOOL_LIGHT</code>conditional above, the question being asked involves whether or not the Light is On or Off. It is basically a useful statement that supports the conditional. When an integrator is viewing this driver’s conditionals in ComposerPro, they can select an On or Off value and ultimately initiate programming based on that selection. </p>

<p>Line 21: <code>&lt;description&gt;&lt;/description&gt;</code>
The description element needs to contain the NAME macro. NAME is a key value that is equivalent to your driver’s unique name. Every conditional needs to include NAME. ComposerPro treats the NAME macro in your conditional XML in a way that replaces it with your driver’s unique name. The unique name is formatted by the name of the room where the driver resides followed by “-&gt;”, followed by the name of the driver as it is named in the project. For example, consider that the name of our example driver is “Living Room Lamp” and it is in the Living Room. Based on this, “Living Room-&gt;Living Room Lamp” will replace NAME when your conditional programming description is displayed in the conditionals window and the script actions area of ComposerPro. Using the example above, ComposerPro can display the description XML element as: “If Living Room-&gt;Living Room Lamp is Off” where the Off value was selected by the integrator. </p>

<p>Line 22: &lt;<code>true_text&gt;&lt;/true_text&gt;</code></p>

<p>Line 23: &lt;<code>false_text&gt;&lt;/false_text&gt;</code></p>

<p>Note the use of the <code>&lt;*_text&gt;</code> XML elements in this example. The values entered here will be the responses to the True/False questions asked by the conditional. Note that these values can be any string value. For example, to the right is another BOOLEAN conditional taken from the code sample above. It is called <code>BOOL_LIGHT_ON</code> and asks the question “If Living Room-&gt;Living Room Lamp is On”. The integrator can then select either of the text XML elements of “True” and “False” to complete programming.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>25.   <span class="nt">&lt;conditional&gt;</span>
26.     <span class="nt">&lt;id&gt;</span>3<span class="nt">&lt;/id&gt;</span>
27.     <span class="nt">&lt;name&gt;</span>BOOL_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
28.     <span class="nt">&lt;type&gt;</span>BOOL<span class="nt">&lt;/type&gt;</span>
29.     <span class="nt">&lt;condition_statement&gt;</span>Light is On<span class="nt">&lt;/condition_statement&gt;</span>
30.     <span class="nt">&lt;description&gt;</span>NAME Light is On is STRING<span class="nt">&lt;/description&gt;</span>
31.     <span class="nt">&lt;true_text&gt;</span>True<span class="nt">&lt;/true_text&gt;</span>
32.     <span class="nt">&lt;false_text&gt;</span>False<span class="nt">&lt;/false_text&gt;</span>
33.   <span class="nt">&lt;/conditional&gt;</span>
</code></pre></div>

<h2 id='conditionals-understanding-xml-in-a-device-type-conditional'>Understanding XML in a DEVICE Type Conditional</h2>

<p>In this section, we’ll define a Device type conditional called <code>DEVICE_SELECTION</code>. The DEVICE type conditional provides the ability to initiate programming based on whether or not a device selection is equal to or not equal to a device in the project. Programming is completed by the integrator through selecting a device from the drop-down list in Conditionals tab. The list will contain all of the Rooms in the project and their respective devices. Next, the integrator selects whether or not programming will be executed if the device selection is equal to or not equal to that device. This conditional uses the following operators: =, !=.</p>

<p>Here is the example XML code used to define this type of conditional:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>77.  <span class="nt">&lt;conditional&gt;</span>
78.    <span class="nt">&lt;id&gt;</span>8<span class="nt">&lt;/id&gt;</span>
79.    <span class="nt">&lt;name&gt;</span>DEVICE_SELECTION<span class="nt">&lt;/name&gt;</span>
80.    <span class="nt">&lt;type&gt;</span>DEVICE<span class="nt">&lt;/type&gt;</span>
81.    <span class="nt">&lt;condition_statement&gt;</span>[8-DEVICE] Device Selection is<span class="nt">&lt;/condition_statement&gt;</span>
82.    <span class="nt">&lt;description&gt;</span>[8] NAME Device Selection LOGIC DEVICE<span class="nt">&lt;/description&gt;</span>
83.  <span class="nt">&lt;/conditional&gt;</span>
</code></pre></div>

<p>Line 77: <code>&lt;conditional&gt;&lt;/conditional&gt;</code>
XML tag for this unique conditional.</p>

<p>Line 78: <code>&lt;id&gt;&lt;/id&gt;</code>
The conditional’s numeric ID value. It is recommended that conditionals be numbered beginning with 0. All conditionals require a unique numeric ID.</p>

<p>Line 79: <code>&lt;name&gt;&lt;/name&gt;</code>
The name of the conditional. This is a unique name defined by the driver writer. It is used in the TestCondition function in the Lua code of the driver. This is given as the first parameter to the TestCondition function. This is how the driver knows what condition is being tested.</p>

<p>Line 80: <code>&lt;type&gt;&lt;/type&gt;</code>
The type of the conditional as defined above in the Conditional Types section.</p>

<p>Line 81: <code>&lt;condition_statement&gt;&lt;/condition_statement&gt;</code>
The conditional statement states a question being asked regarding a state of the driver. This is the statement that is shown before the condition logic. For example, in the <code>DEVICE_SELECTION</code> conditional above, the question being asked is: Is the device value equal to or not equal to the device value selected in ComposerPro programming by the integrator. It is basically a useful statement that supports the conditional. When an integrator is viewing this driver’s conditionals in ComposerPro, they can select a device from the project and ultimately initiate programming when the device is equal to or not equal to the device selected in the Conditionals programming tab.</p>

<p>Line 82: &lt;description&gt;&lt;/description&gt;
The description element needs to contain the NAME macro. NAME is a key value that is equivalent to your driver’s unique name. Every conditional needs to include NAME. ComposerPro treats the NAME macro in your conditional XML in a way that replaces it with your driver’s unique name. The unique name is formatted by the name of the room where the driver resides followed by “-&gt;”, followed by the name of the driver as it is named in the project. For example, consider that our driver name is Test Driver and the integrator selected a device named Light along with the not equals to operator. The Conditional statement formed in ComposerPro programming would be: If Theater -&gt; Device Selection != Light</p>

<p>Note the use of the LOGIC STRING statement in the description XML. This provides the ability for an integrator to select two of the logic operators and apply that operator to the selected value. Operators for the Room type conditional include: =, !=.</p>

<h2 id='conditionals-understanding-xml-in-a-room-type-conditional'>Understanding XML in a ROOM Type Conditional</h2>

<p>In this section, we’ll define a Room type conditional called <code>ROOM_SELECTION</code>. The ROOM type conditional provides the ability to initiate programming based on whether or not a room selection is equal to or not equal to a room in the project. Programming is completed by the integrator through selecting a room from the drop-down list in Conditionals tab. The list will contain all of the Rooms defined in the project. Next, the integrator selects whether or not programming will be executed if the room selection is equal to or not equal to that room. This conditional uses the following operators: =, !=.</p>

<p>Here is the example XML code used to define this type of conditional:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>70.  <span class="nt">&lt;conditional&gt;</span>
71.    <span class="nt">&lt;id&gt;</span>7<span class="nt">&lt;/id&gt;</span>
72.    <span class="nt">&lt;name&gt;</span>ROOM_SELECTION<span class="nt">&lt;/name&gt;</span>
73.    <span class="nt">&lt;type&gt;</span>ROOM<span class="nt">&lt;/type&gt;</span>
74.    <span class="nt">&lt;condition_statement&gt;</span>[7-ROOM] Room Selection is<span class="nt">&lt;/condition_statement&gt;</span>
75.    <span class="nt">&lt;description&gt;</span>[7] NAME Room Selection LOGIC ROOM<span class="nt">&lt;/description&gt;</span>
76.  <span class="nt">&lt;/conditional&gt;</span>
</code></pre></div>

<p>Line 70: <code>&lt;conditional&gt;&lt;/conditional&gt;</code>
XML tag for this unique conditional.</p>

<p>Line 71: <code>&lt;id&gt;&lt;/id&gt;</code>
The conditional’s numeric ID value. It is recommended that conditionals be numbered beginning with 0. All conditionals require a unique numeric ID.</p>

<p>Line 72: <code>&lt;name&gt;&lt;/name&gt;</code>
The name of the conditional. This is a unique name defined by the driver writer. It is used in the TestCondition function in the Lua code of the driver. This is given as the first parameter to the TestCondition function. This is how the driver knows what condition is being tested.</p>

<p>Line 73: <code>&lt;type&gt;&lt;/type&gt;</code>
The type of the conditional as defined above in the Conditional Types section.</p>

<p>Line 74: <code>&lt;condition_statement&gt;&lt;/condition_statement&gt;</code>
The conditional statement states a question being asked regarding a state of the driver. This is the statement that is shown before the condition logic. For example, in the <code>ROOM_SELECTION</code> conditional above, the question being asked is: Is the room value equal to or not equal to the room value selected in ComposerPro programming by the integrator. It is basically a useful statement that supports the conditional. When an integrator is viewing this driver’s conditionals in ComposerPro, they can select a room from the project and ultimately initiate programming when the room is equal to or not equal to the room selected in the Conditionals programming tab.</p>

<p>Line 75: <code>&lt;description&gt;&lt;/description&gt;</code>
The description element needs to contain the NAME macro. NAME is a key value that is equivalent to your driver’s unique name. Every conditional needs to include NAME. ComposerPro treats the NAME macro in your conditional XML in a way that replaces it with your driver’s unique name. The unique name is formatted by the name of the room where the driver resides followed by “-&gt;”, followed by the name of the driver as it is named in the project. For example, consider that our driver name is Test Driver and the integrator selected a room named Theater along with the equals operator. The Conditional statement formed in ComposerPro programming would be: If Theater -&gt; Room Selection = Theater</p>

<p>Note the use of the LOGIC STRING statement in the description XML. This provides the ability for an integrator to select two of the logic operators and apply that operator to the selected value. Operators for the Room type conditional include: =, !=.</p>

<h2 id='conditionals-creating-dynamic-driver-conditionals'>Creating Dynamic Driver Conditionals</h2>

<p>All of the preceding conditional content has referred to statically created conditionals defined within the driver’s XML code. While the types and functionality of Dynamic Conditionals are identical to the static variety, they differ in that they are created dynamically by the driver. This is useful in instances where a driver conditionals are based off of the drivers properties or based off of the configuration of the device the driver is connected to. </p>

<p>For example, consider a Pool Controller where one model of the controller supports spa control and another model does not. One driver could be written for both models containing a <code>has_spa</code> property. If that property is selected in ComposerPro or the driver can query spa support, a conditional could be dynamically created to support spa control</p>

<p>When Composer generates the list of conditionals for the driver in Composer Pro programming, it first will create the static conditionals (defined in the xml of the driver). Once that is done it then needs to know about any dynamic conditionals the driver may have. This is handled through the function, GetConditionals. If the driver has defined the GetConditionals function, then that function is called. If the driver does not have any need for dynamic conditionals then there is no need to create the function.</p>

<h2 id='conditionals-getconditionals'>GetConditionals()</h2>

<p>Function that returns a table of information containing elements of conditionals that will be created dynamically in ComposerPro.</p>

<h3 id='conditionals-getconditionals-parameters'>Parameters</h3>

<p><code>None</code></p>

<table><thead>
<tr>
<th>Returns</th>
<th>Value</th>
</tr>
</thead><tbody>
<tr>
<td>table</td>
<td>Table containing all the configuration information for the dynamic conditionals of the driver.</td>
</tr>
</tbody></table>

<p>Dynamic conditionals support all the same types that are supported with static conditionals. The example below details all the conditional types previously defined above. The table, tConditionals, includes an example of each of those conditionals and the table elements required for that conditional to be created dynamically in Composer Pro. For example, the XML required to create a static SIMPLE Conditional Type looks like this:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>1.  <span class="nt">&lt;conditionals&gt;</span>
2.   <span class="nt">&lt;conditional&gt;</span>
3.     <span class="nt">&lt;id&gt;</span>10<span class="nt">&lt;/id&gt;</span>
4.     <span class="nt">&lt;name&gt;</span>SIMPLE_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
5.     <span class="nt">&lt;type&gt;</span>SIMPLE<span class="nt">&lt;/type&gt;</span>
6.     <span class="nt">&lt;condition_statement&gt;</span>The light is on<span class="nt">&lt;/condition_statement&gt;</span>
7.     <span class="nt">&lt;description&gt;</span>NAME is On<span class="nt">&lt;/description&gt;</span>
8.   <span class="nt">&lt;/conditional&gt;</span>
9.  <span class="nt">&lt;/conditionals&gt;</span>
</code></pre></div>

<p>The same conditional’s required table information to enable it to be created dynamically is shown to the right:</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span><span class="err"> </span>
<span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE_LIGHT_ON"</span>
<span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE"</span>
<span class="n">ttConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME is On"</span>
</code></pre></div><div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetConditionals</span><span class="p">()</span>
    <span class="c1">-- starting conditionals with ID 10</span>
    <span class="kd">local</span> <span class="n">tConditionals</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span><span class="err">``</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE_LIGHT_ON"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE``"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Light is on"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME is On"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE_LIGHT_OFF"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Light is off"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[11] NAME is Off"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL_LIGHT"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Light is"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME Light is STRING"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"true_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"On"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"false_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Off"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL_LIGHT_ON"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Light is On"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[13] NAME Light is On is STRING"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"true_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"True"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"false_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"False"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NUMBER_LIGHT_LEVEL"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NUMBER"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Light Level"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME is LOGIC INTEGER"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"minimum"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"10"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"maximum"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"150"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"STRING_LIGHT"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"STRING"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Light Level"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME Level is LOGIC STRING"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"LIST_LIGHT_LEVEL"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"LIST"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Light Level"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME is LOGIC STRING"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"list_items"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"10%,20%,30%,40%,50%,60%,70%,80%,90%,100%"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"ROOM_SELECTION"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"ROOM"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Room Selection is"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME is LOGIC STRING"</span>

    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"DEVICE_SELECTION"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"DEVICE"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Device Selection is"</span>
    <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NAME Device Selection LOGIC DEVICE"</span>

    <span class="k">return</span> <span class="n">tConditionals</span>
<span class="k">end</span>
</code></pre></div>

<h2 id='conditionals-sorting-conditionals-in-composerpro'>Sorting Conditionals in ComposerPro</h2>

<p>Prior to the release of O.S. 3.2.0, driver writers did not have the ability to order the way driver conditionals were displayed in the Programming area of ComposerPro. A new sort order driver element has been delivered that provides the ability to display conditionals in any desired order. Sort order can be applied to static conditionals in the driver.xml with the inclusion of the following xml tag: <code>&lt;sort_order&gt;&lt;/sort_order&gt;</code>. See the lighting code Example 1 from a driver.xml file to the right.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>Example 1

driver.xml
    <span class="nt">&lt;conditionals&gt;</span>
      <span class="nt">&lt;conditional&gt;</span>
        <span class="nt">&lt;id&gt;</span>0<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;name&gt;</span>SIMPLE_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>SIMPLE<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;condition_statement&gt;</span>The light is on<span class="nt">&lt;/condition_statement&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME is On<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>0<span class="nt">&lt;/sort_order&gt;</span>      
      <span class="nt">&lt;/conditional&gt;</span>
      <span class="nt">&lt;conditional&gt;</span>
        <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;name&gt;</span>SIMPLE_LIGHT_OFF<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>SIMPLE<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;condition_statement&gt;</span>The light is off<span class="nt">&lt;/condition_statement&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME is Off<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>2<span class="nt">&lt;/sort_order&gt;</span>
      <span class="nt">&lt;/conditional&gt;</span>
      <span class="nt">&lt;conditional&gt;</span>
        <span class="nt">&lt;id&gt;</span>2<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;name&gt;</span>BOOL_LIGHT<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>BOOL<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;condition_statement&gt;</span>Light is<span class="nt">&lt;/condition_statement&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME Light is STRING<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;true_text&gt;</span>On<span class="nt">&lt;/true_text&gt;</span>
        <span class="nt">&lt;false_text&gt;</span>Off<span class="nt">&lt;/false_text&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>4<span class="nt">&lt;/sort_order&gt;</span>
      <span class="nt">&lt;/conditional&gt;</span>
     <span class="nt">&lt;conditional&gt;</span>
        <span class="nt">&lt;id&gt;</span>3<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;name&gt;</span>BOOL_LIGHT_ON<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>BOOL<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;condition_statement&gt;</span>Light is On<span class="nt">&lt;/condition_statement&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME Light is On is STRING<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;true_text&gt;</span>True<span class="nt">&lt;/true_text&gt;</span>
        <span class="nt">&lt;false_text&gt;</span>False<span class="nt">&lt;/false_text&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>6<span class="nt">&lt;/sort_order&gt;</span>
      <span class="nt">&lt;/conditional&gt;</span>
      <span class="nt">&lt;conditional&gt;</span>
        <span class="nt">&lt;id&gt;</span>4<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;name&gt;</span>NUMBER_LIGHT_LEVEL<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>NUMBER<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME is LOGIC INTEGER<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;minimum&gt;</span>10<span class="nt">&lt;/minimum&gt;</span>
        <span class="nt">&lt;maximum&gt;</span>150<span class="nt">&lt;/maximum&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>8<span class="nt">&lt;/sort_order&gt;</span>
      <span class="nt">&lt;/conditional&gt;</span>
      <span class="nt">&lt;conditional&gt;</span>
        <span class="nt">&lt;id&gt;</span>5<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;name&gt;</span>STRING_LIGHT<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME Level is LOGIC STRING<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>10<span class="nt">&lt;/sort_order&gt;</span>
      <span class="nt">&lt;/conditional&gt;</span>
      <span class="nt">&lt;conditional&gt;</span>
        <span class="nt">&lt;id&gt;</span>6<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;name&gt;</span>LIST_LIGHT_LEVEL<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>LIST<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;condition_statement&gt;</span>Light Level<span class="nt">&lt;/condition_statement&gt;</span>
        <span class="nt">&lt;description&gt;</span>NAME is LOGIC STRING<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;items&gt;</span>
          <span class="nt">&lt;item&gt;</span>10%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>20%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>30%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>40%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>50%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>60%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>70%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>80%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>90%<span class="nt">&lt;/item&gt;</span>
          <span class="nt">&lt;item&gt;</span>100%<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;/items&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>12<span class="nt">&lt;/sort_order&gt;</span>
      <span class="nt">&lt;/conditional&gt;</span>
    <span class="nt">&lt;/conditionals&gt;</span>
</code></pre></div>

<p>Dynamic Conditionals found in the driver.lua file can also be sorted with the inclusion of the sort order element in the Conditionals table found in the driver.lua file: <code>[&quot;sort_order&quot;] = &quot;1&quot;</code> See the lighting code Example 2 from a driver.lua file to the right.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">Example</span> <span class="mi">2</span>

<span class="k">function</span> <span class="nf">GetConditionals</span><span class="p">()</span>

                <span class="kd">local</span> <span class="n">tConditionals</span> <span class="o">=</span> <span class="p">{}</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE_LIGHT_ON"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[10-SIMPLE-DYNAMIC] Light is on"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[10] NAME is On"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"10"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"1"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE_LIGHT_OFF"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"SIMPLE"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[11-SIMPLE-DYNAMIC] Light is off"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[11] NAME is Off"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"11"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"3"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL_LIGHT"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[12-BOOL-DYNAMIC] Light is"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[12] NAME Light is STRING"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"true_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"On"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"false_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Off"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"12"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"5"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL_LIGHT_ON"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BOOL"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[13-BOOL-DYNAMIC] Light is On"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[13] NAME Light is On is STRING"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"true_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"True"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"false_text"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"False"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"13"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"7"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NUMBER_LIGHT_LEVEL"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"NUMBER"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[14-NUMBER-DYNAMIC] Light Level"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[14] NAME is LOGIC INTEGER"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"minimum"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"10"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"maximum"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"150"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"14"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"9"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"STRING_LIGHT"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"STRING"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[15-STRING-DYNAMIC] Light Level"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[15] NAME Level is LOGIC STRING"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"15"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"11"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"LIST_LIGHT_LEVEL"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"LIST"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[16-LIST-DYNAMIC] Light Level"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[16] NAME is LOGIC STRING"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"list_items"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"10%,20%,30%,40%,50%,60%,70%,80%,90%,100%"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"16"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"13"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"ROOM_SELECTION"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"ROOM"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[17-ROOM-DYNAMIC] Room Selection is"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[17] NAME is LOGIC STRING"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"17"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"15"</span>

                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"DEVICE_SELECTION"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"DEVICE"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"condition_statement"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[18-DEVICE-DYNAMIC] Device Selection is     (dynamic)"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"description"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"[18] NAME Device Selection LOGIC DEVICE"</span>
                <span class="n">tConditionals</span><span class="p">[</span><span class="s2">"18"</span><span class="p">][</span><span class="s2">"sort_order"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"17"</span>

                <span class="k">return</span> <span class="n">tConditionals</span>
<span class="k">end</span>
</code></pre></div>

<p>The result of ordering both the static and dynamic conditions found in the code examples is: </p>

<p><img src="images/5_1-01-bce65755.png"/></p>

<p>You can see that the first conditional displayed is “The Light is on”. This is a static conditional and has a sort order value of 0 ( <code>&lt;sort_order&gt;0&lt;/sort_order&gt;</code> ) as seen in the xml code Example 1. </p>

<p>The second conditional displayed is also “The Light is on” however this is the dynamic conditional defined in the lua code Example 2. This conditional has a sort order value of 1 (<code>tConditionals[&quot;10&quot;][&quot;sort_order&quot;] = “1”</code>)</p>

<p>The third conditional displayed is “The Light is off”, which is a static conditional and has a sort order value of 2 ( <code>&lt;sort_order&gt;2&lt;/sort_order&gt;</code> ) as seen in the xml code Example 1. </p>

<p>The remainder of the conditionals in the code examples follow the alternate numbering used between the static XML code and the dynamic .lua code.</p>

<h3 id='conditionals-sorting-conditionals-in-composerpro-considerations-when-sorting-conditionals'>Considerations when Sorting Conditionals</h3>

<ul>
<li>Sort Order numbering must be a positive number (including 0). The list is sorted in numerical order.</li>
<li> If a sort order number value is used twice, the second Conditional using the same value will not be displayed.</li>
<li>When defining Conditionals that will use the Sort Order element, all of the Conditionals must include a numeric value. Failing to provide a sort order number for one Conditional will result in none of the Conditionals being sorted. For example, if you have ten Conditionals defined in your driver and one of them is missing the sort order element - none of the Conditionals will be sorted.</li>
</ul>
<h1 id='connections'>Connections</h1>

<h2 id='connections-overview'>Overview</h2>

<p>As every trained Control4 installer knows, each driver within the Control4 system publishes the connections capabilities that are available for the device being controlled. These connections are utilized to create the bindings within the Control4 system. The connections to the device you are creating a driver for can be implemented using serial (RS-232) or Internet (TCP/IP) protocols.</p>

<p>Devices with serial ports are bound using the Control/AV tab to bind the Control Inputs to the appropriate serial port on any controller or serial extender in the Control4 system.</p>

<p>Devices communicating using Internet protocols are configured using the Network tab to identify the IP address of the device. </p>

<p>In addition to the network/communication bindings, your DriverWorks driver will have all of the other bindings necessary for your device (just like any other driver) as long as they are correctly defined in the &lt;connections&gt; section of the .c4z file.</p>

<p>As the driver creator, you will define those connections capabilities within the .c4z file.
Connections are critical and can be complicated. The following information outlines the various parameters that can be utilized in the .c4z file for configuring connections.</p>

<p><code>&lt;connections&gt;</code>
This section contains zero or more connections. Connections are the bindings defined by this driver and usually visible through Composer. The AV bindings are reported to the proxy driver when they are bound together.</p>

<p><code>&lt;connection proxybindingid=”3001”&gt;</code>
This establishes a connection block. The proxy binding id attribute: 3001 allows the driver to specify which proxy binding that this connection is associated with.</p>

<p><code>&lt;id&gt;5001&lt;/id&gt;</code>
This is the id for the connection. Note: This id number must be in the correct range for the particular type of connection. Below are the ranges:</p>

<table><thead>
<tr>
<th>Binding</th>
<th>Range</th>
</tr>
</thead><tbody>
<tr>
<td>Control Bindings</td>
<td>1 - 999</td>
</tr>
<tr>
<td>Video Inputs</td>
<td>1000 - 1099</td>
</tr>
<tr>
<td>Video Outputs</td>
<td>2000 - 2999</td>
</tr>
<tr>
<td>Audio Inputs</td>
<td>3000 - 3099</td>
</tr>
<tr>
<td>Audio Outputs</td>
<td>4000 - 4999</td>
</tr>
<tr>
<td>Proxy Bindings</td>
<td>5000 - 5999</td>
</tr>
<tr>
<td>Network Bindings</td>
<td>6000 - 6999</td>
</tr>
<tr>
<td>Room Bindings</td>
<td>7000 - 7999</td>
</tr>
<tr>
<td>Power Manager</td>
<td>8000 - 8999</td>
</tr>
</tbody></table>

<p><code>&lt;facing&gt;0&lt;/facing&gt;</code>
This value indicates which side of the device this connection is on if it is a physical connection. Values are:</p>

<ul>
<li>Front - 0</li>
<li>Back - 1</li>
<li>Top - 2</li>
<li>Bottom - 3</li>
<li>Left - 4</li>
<li>Right - 5</li>
<li>Unknown - 6</li>
</ul>

<p><code>&lt;connectionname&gt;TV&lt;/connectionname&gt;</code>
The value indicates the name of this connection. This name is used by Composer to display the binding if it isn’t a hidden binding.</p>

<p><code>&lt;type&gt;2&lt;/type&gt;</code>
The value indicates the type of this connection. Values are:</p>

<ul>
<li>Control - 1</li>
<li>Proxy - 2</li>
<li>Audio/Video - 3</li>
<li>Network - 4</li>
<li>Video - 5</li>
<li>Audio - 6</li>
<li>Room - 7</li>
</ul>

<p><code>&lt;consumer&gt;False&lt;/consumer&gt;</code>
This value (True or False) indicates if this driver is a consumer (or a provider) of this connection.</p>

<p><code>&lt;linelevel&gt;False&lt;/linelevel&gt;</code>
This value (True or False) indicates if this connection provides a line level source.</p>

<p><code>&lt;idautobind&gt;0&lt;/idautobind&gt;</code>
This is an optional tag that allows the connection to automatically connect to a specified binding ID Range is 0 - 999.</p>

<p><code>&lt;hidden&gt;True&lt;/hidden&gt;</code>
This is an optional tag to specify if this connection should be hidden or not. This defaults to false, except for proxy bindings.</p>

<p><code>&lt;classes&gt;</code>
Section of one or more classes for this connection:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;ports&gt;</span>
   <span class="nt">&lt;port&gt;</span>
    <span class="nt">&lt;number&gt;</span>8750<span class="nt">&lt;/number&gt;</span>
  <span class="nt">&lt;/port&gt;</span>
<span class="nt">&lt;/ports&gt;</span>
</code></pre></div>

<p>If the class is TCP or UDP then there may be a ports section as seen to the right. This includes the IP Port number for the network connection.</p>

<p><code>&lt;auto_connect&gt;True&lt;/auto_connect&gt;</code>
The above example creates an Auto Connect for this socket. This socket will be created and connected when the driver is started.</p>

<p><code>&lt;monitor_connection&gt;True&lt;/monitor_connection&gt;</code>
The above example provides monitoring of this socket. Director will periodically check the connection, if data is not returned on this socket it will be considered down.</p>

<p><code>&lt;keep_connection&gt;True&lt;/keep_connection&gt;</code>
The statement above keeps this connection connected. This means if the connection goes down, Director will attempt to re-connect it.</p>

<p><code>&lt;delimiter&gt;0d&lt;/delimiter&gt; </code>
Above is an example of an optional delimiter to specify how the network driver should break up incoming packets   NOTE: If delimiter is specified, data will not be sent UNTIL delimiter is reached.  If no delimiter specified, data is sent on timeout.</p>

<p><code>&lt;grow&gt;255&lt;/grow&gt;</code>
This is the number of bytes to grow the size of receive buffers by when the original receiver buffer is overflowed.</p>

<p><code>&lt;autobind&gt;True&lt;autobind&gt; </code>
The optional flag above marks this class as needed to be autobound. If an idautobind is provided then this class will be connected on that binding, otherwise it will be connected on the first connection in the project providing this class.</p>

<p><code>&lt;/connections&gt;</code>
The above closes this connections section.</p>

<h2 id='connections-contact-and-relay-bindings'>Contact and Relay Bindings</h2>

<p>Contact and Relay bindings are also control bindings. To the right are two examples:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code> <span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>11<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>Security Zone 1<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
        <span class="nt">&lt;class&gt;</span>
          <span class="nt">&lt;classname&gt;</span>CONTACT_SENSOR<span class="nt">&lt;/classname&gt;</span>
        <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>

and

<span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>24<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>Relay Port 1<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>True<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>RELAY<span class="nt">&lt;/classname&gt;</span>
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
 <span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<p>Remember, you can always refer to existing drivers for the device type that you are creating to see how the &lt;connections&gt; XML section should be defined.</p>

<h2 id='connections-control-bindings'>Control Bindings</h2>

<p>The serial port’s communication parameters are defined in the &lt;config&gt; or the &lt;capabilities&gt; section of the driver using as shown to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>Serial RS-232<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>True<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
        <span class="nt">&lt;class&gt;</span>
          <span class="nt">&lt;classname&gt;</span>RS_232<span class="nt">&lt;/classname&gt;</span>
        <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<p>The serial port’s communication parameters are defined in the &lt;config&gt; or the &lt;capabilities&gt; section of the .c4z using:</p>

<p><code>&lt;serialsettings&gt;9600 8 odd 1 none&lt;/serialsettings</code></p>

<p>The statement above defines the following communication parameters:</p>

<ul>
<li>9600 baud</li>
<li>8 data bits</li>
<li>odd parity</li>
<li>1 stop bit</li>
<li>no flow control</li>
</ul>

<p>The serial port binding is also a control binding</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>Serial RS-232<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>True<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
        <span class="nt">&lt;class&gt;</span>
          <span class="nt">&lt;classname&gt;</span>RS_232<span class="nt">&lt;/classname&gt;</span>
        <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<h2 id='connections-non-binding-connection'>Non-Binding Connection</h2>

<p>The traditional connection in Composer represents a cable that is attached from the output of one device to the input of another device. A non-binding connection lacks the physical cable and is used with devices that are not intended to be connected by the dealer in Composer. Likewise, a non-binding connection does not require a dealer to identify the connection. Non-binding connections are beneficial as they remove the burden of Director and Composer to maintain bindings that don&#39;t actually exist. Their use makes the model in Director more accurately reflect the real world. In many cases these are web based connections between devices that are not connected by a cable. </p>

<p>For example, consider an IP Video Matrix which has the following connection path:</p>

<p>BlueRay -&gt; HDMI Server &lt;&gt;--Non-Binding Connection--&lt;&gt; HDMI Client -&gt; TV -&gt; Room Video Endpoint</p>

<p>In this example, the BlueRay will appear as a video source in the project&#39;s TV Room.</p>

<p>Characteristics of a non-binding connections include:</p>

<ul>
<li>Any provider is connected to all consumers. </li>
<li>The non-binding connection has a key of datatype text, which discriminates which connections are connected. </li>
<li>All non-binding providers with a key are connected to all non-binding consumers with the same key. </li>
<li>There is no requirement for the dealer to establish the connections in Composer.</li>
</ul>

<p>A non-binding connection is created in the <code>&lt;connection</code>&gt; section of the the driver. The included is a Provider-side example of a non-binding connection. Note the use of the <code>&lt;nonbindingkey&gt;</code> element. See the example to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
 <span class="nt">&lt;id&gt;</span>4444<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;connectionname&gt;</span>Net Output<span class="nt">&lt;/connectionname&gt;</span>
 <span class="nt">&lt;type&gt;</span>6<span class="nt">&lt;/type&gt;</span>
 <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
 <span class="nt">&lt;audiosource&gt;</span>True<span class="nt">&lt;/audiosource&gt;</span>
 <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
 <span class="nt">&lt;hidden&gt;</span>True<span class="nt">&lt;/hidden&gt;</span>
 <span class="nt">&lt;nobindingkey&gt;</span>Connection Key<span class="nt">&lt;/nobindingkey&gt;</span>
 <span class="nt">&lt;/classes&gt;</span>
  <span class="nt">&lt;class&gt;</span>
   <span class="nt">&lt;classname&gt;</span>SOME_CLASS<span class="nt">&lt;/classname&gt;</span>
  <span class="nt">&lt;/class&gt;</span>
 <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<p>Next is the Consumer-side example for the non-binding connection. Note the use of the <code>&lt;nonbindingkey&gt;</code> element:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
 <span class="nt">&lt;id&gt;</span>3333<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;connectionname&gt;</span>Net Input<span class="nt">&lt;/connectionname&gt;</span>
 <span class="nt">&lt;type&gt;</span>6<span class="nt">&lt;/type&gt;</span>
 <span class="nt">&lt;consumer&gt;</span>True<span class="nt">&lt;/consumer&gt;</span>
 <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
 <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
 <span class="nt">&lt;hidden&gt;</span>True<span class="nt">&lt;/hidden&gt;</span>
 <span class="nt">&lt;nobindingkey&gt;</span>Connection Key<span class="nt">&lt;/nobindingkey&gt;</span>
 <span class="nt">&lt;/classes&gt;</span>
  <span class="nt">&lt;class&gt;</span>
   <span class="nt">&lt;classname&gt;</span>SOME_CLASS<span class="nt">&lt;/classname&gt;</span>
  <span class="nt">&lt;/class&gt;</span>
 <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<p>In both examples to the right, the connection uses the hidden element set to True as typically a non-binding connection should not be displayed.</p>

<h2 id='connections-proxy-binding-multiple-proxies'>Proxy Binding Multiple Proxies</h2>

<p>The example from the right comes from one of the receiver drivers that Control4 publishes. As you can see, a device with multiple proxies will have multiple connection bindings defined: one for each proxy. There will be an instance of the driver loaded for each proxy when these devices are added to the project using Composer.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>5001<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>Receiver<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>RECEIVER<span class="nt">&lt;/classname&gt;</span>
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
<span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>5002<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>TUNER<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>TUNER<span class="nt">&lt;/classname&gt;</span>
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
<span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>5003<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>XMTUNER<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>TUNERXM<span class="nt">&lt;/classname&gt;</span>
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
<span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>5004<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>IPOD<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>DVD<span class="err">&lt;</span>/classname
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
<span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>5005<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>SIRIUSTUNER<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>TUNERXM<span class="nt">&lt;/classname&gt;</span>
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<h2 id='connections-proxy-binding-single-proxy-examples'>Proxy Binding Single Proxy Examples</h2><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>5001<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>TV<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>TV<span class="nt">&lt;/classname&gt;</span>
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
      <span class="nt">&lt;id&gt;</span>5001<span class="nt">&lt;/id&gt;</span>
      <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
      <span class="nt">&lt;connectionname&gt;</span>Light<span class="nt">&lt;/connectionname&gt;</span>
      <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
      <span class="nt">&lt;consumer&gt;</span>True<span class="nt">&lt;/consumer&gt;</span>
      <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
      <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
      <span class="nt">&lt;linelevel&gt;</span>False<span class="nt">&lt;/linelevel&gt;</span>
      <span class="nt">&lt;classes&gt;</span>
         <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>LIGHT<span class="nt">&lt;/classname&gt;</span>
            <span class="nt">&lt;autobind&gt;</span>False<span class="nt">&lt;/autobind&gt;</span>
         <span class="nt">&lt;/class&gt;</span>
      <span class="nt">&lt;/classes&gt;</span>
      <span class="nt">&lt;hidden&gt;</span>False<span class="nt">&lt;/hidden&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>
<h2 id='connections-user-datagram-protocol'>User Datagram Protocol</h2>

<p>Note that there&#39;s no need for the use of <code>C4:NetConnect</code> and <code>C4:NetDisconnect</code> when using UDP as every packet is a UDP datagram and is independent of any connection. Also, the usage of network functions <code>C4:SendToNetwork</code>  and <code>C4:ReceivedFromNetwork</code> are the same as if using TCP. See the example to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
    <span class="nt">&lt;id&gt;</span>6001<span class="nt">&lt;/id&gt;</span>
    <span class="nt">&lt;facing&gt;</span>6<span class="nt">&lt;/facing&gt;</span>
    <span class="nt">&lt;connectionname&gt;</span>ADAM Network Connection<span class="nt">&lt;/connectionname&gt;</span>
    <span class="nt">&lt;type&gt;</span>4<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;consumer&gt;</span>True<span class="nt">&lt;/consumer&gt;</span>
    <span class="nt">&lt;audiosource&gt;</span>False<span class="nt">&lt;/audiosource&gt;</span>
    <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
    <span class="nt">&lt;linelevel&gt;</span>True<span class="nt">&lt;/linelevel&gt;</span>
    <span class="nt">&lt;classes&gt;</span>
        <span class="nt">&lt;class&gt;</span>
            <span class="nt">&lt;classname&gt;</span>UDP<span class="nt">&lt;/classname&gt;</span>
            <span class="nt">&lt;ports&gt;</span>
                <span class="nt">&lt;port&gt;</span>
                    <span class="nt">&lt;number&gt;</span>1025<span class="nt">&lt;/number&gt;</span>
                    <span class="nt">&lt;auto_connect&gt;</span>True<span class="nt">&lt;/auto_connect&gt;</span>
                    <span class="nt">&lt;monitor_connection&gt;</span>True<span class="nt">&lt;/monitor_connection&gt;</span>
                    <span class="nt">&lt;keep_connection&gt;</span>True<span class="nt">&lt;/keep_connection&gt;</span>
                <span class="nt">&lt;/port&gt;</span>
            <span class="nt">&lt;/ports&gt;</span>
        <span class="nt">&lt;/class&gt;</span>
     <span class="nt">&lt;/classes&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<h2 id='connections-favored-and-blocked-av-connection-classes'>Favored and Blocked AV Connection Classes</h2>

<p>Two AV connection class-level driver elements have been delivered in conjunction with O.S 3.2.0: Favored classes and Blocked classes:</p>

<ul>
<li><p><code>&lt;favoredclasses&gt;&lt;/favoredclasses&gt;</code></p></li>
<li><p><code>&lt;blockedclasses&gt;&lt;/blockedclasses&gt;</code></p></li>
</ul>

<p>These properties provide the ability to designate an AV connection class or classes as “favored” or “blocked”. </p>

<p>Favoriting or blocking connections in your connection XML code can be a helpful solution that is most often needed in AV Receiver drivers. Specifically, when handling audio signals distributed across multiple zones where signal conversion is not handled consistently by the device (i.e., receiver). Signal conversion (i.e., HDMI input to analog stereo output) is defined in Control4 drivers via the down-classing and up-classing capabilities.</p>

<h3 id='connections-favored-and-blocked-av-connection-classes-a-use-case-for-favored-connection-classes'>A Use Case for Favored Connection Classes</h3>

<p>To better understand the problem that favoriting connection classes can resolve, let’s consider the following AV Receiver which resides in a Control4 project: </p>

<ul>
<li><p>The ability to down-class digital audio (HDMI) for the receiver’s Zone 1 (STEREO / SPEAKER).</p></li>
<li><p>The inability to down-class digital audio (HDMI) for the receiver’s Zone 2 (STEREO / SPEAKER).</p></li>
<li><p>Media Player 1 bound via HDMI and STEREO</p></li>
<li><p>Media Player 2 bound via HDMI</p></li>
</ul>

<p>The goals of successful pathing architecture is to minimize the switch of audio class within a path while not consuming higher quality components with a lower quality stream. This approach leaves those components available to use a higher quality stream.</p>

<p>So, when audio is selected for Zone 1 through the Control4 UI, Director will select Media Player 1 via the STEREO audio path. The result is audio successfully being played in the receiver’s Zone 1 through the STEREO connection. Once HDMI has been downmixed to STEREO, it will attempt to stay on STEREO.</p>

<p>Next, while Zone 1 is still playing audio, the user selects Media Player 2 in Zone 2 to play another audio signal (since Media Player 1 is already in use in Zone 1). Director’s pathing architecture has no way of knowing that the receiver lacks the ability to down-class HDMI to STEREO on Zone 2 so it presents Media Player 2 as an available source. This results in Media Player 2 being selected in Zone 2 UI but no audio being distributed due to it being an HDMI source signal.</p>

<p>This example was selected for simplicity. A more typical example is when multiple outputs of a Control4 controller are bound to an AV Matrix and then the AV Matrix is bound to a Receiver for a few zones. In this example, the user(s) are selecting audio streams from sources such as Tidal and TuneIn so the user has no idea what output Director may be selecting. </p>

<p>Blocking and favoring AV connection classes give the driver writer the ability to influence the choices Director’s pathing architecture makes to successfully connect inputs to outputs and avoid the scenarios described above in Zone 2.  This is accomplished by applying the favored classes XML elements within the output connections in the driver’s Connection XML code. An example of the XML needed to favor a class is to the right.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>-- Favored Example

<span class="nt">&lt;favoredclasses&gt;</span>
  <span class="nt">&lt;classname&gt;</span>HDMI<span class="nt">&lt;/classname&gt;</span>
  <span class="nt">&lt;classname&gt;</span>STEREO<span class="nt">&lt;/classname&gt;</span>
<span class="nt">&lt;/favoredclasses&gt;</span>
</code></pre></div>

<p>In the use case defined above, we can resolve the lack of audio availability in Zone 2 by using favored classes. But to do so, we need to start with Zone 1. We’re going to favor some of the other connection classes the receiver supports in Zone 1. By favoriting these classes, Director will select from those classes to play the audio. This frees up connection classes we know can be can successfully used for playing audio in Zone 2. In the example to the right you can see the connection XML for the Main Output of the receiver or Zone 1. </p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>-- Main Zone Example

<span class="nt">&lt;connection</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id&gt;</span>4000<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;facing&gt;</span>1<span class="nt">&lt;/facing&gt;</span>
            <span class="nt">&lt;connectionname&gt;</span>Main Output<span class="nt">&lt;/connectionname&gt;</span>
            <span class="nt">&lt;type&gt;</span>6<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
            <span class="nt">&lt;audiosource&gt;</span>True<span class="nt">&lt;/audiosource&gt;</span>
            <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
            <span class="nt">&lt;linelevel&gt;</span>True<span class="nt">&lt;/linelevel&gt;</span>
            <span class="nt">&lt;classes&gt;</span>
                <span class="nt">&lt;class&gt;</span>
                    <span class="nt">&lt;classname&gt;</span>SPEAKER<span class="nt">&lt;/classname&gt;</span>
                <span class="nt">&lt;/class&gt;</span>
                <span class="nt">&lt;class&gt;</span>
                    <span class="nt">&lt;classname&gt;</span>STEREO<span class="nt">&lt;/classname&gt;</span>
                <span class="nt">&lt;/class&gt;</span>
            <span class="nt">&lt;/classes&gt;</span>
            <span class="nt">&lt;favoredclasses&gt;</span>
                 <span class="nt">&lt;classname&gt;</span>HDMI<span class="nt">&lt;/classname&gt;</span>
                 <span class="nt">&lt;classname&gt;</span>DIGITAL_COAX<span class="nt">&lt;/classname&gt;</span>
                 <span class="nt">&lt;classname&gt;</span>DIGITAL_OPTICAL<span class="nt">&lt;/classname&gt;</span>
            <span class="nt">&lt;/favoredclasses&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<p>Note that the following connection classes are favored using the new  <code>&lt;favoredclasses&gt;&lt;/favoredclasses&gt;</code> XML element: </p>

<ul>
<li>HDMI</li>
<li>DIGITAL_COAX</li>
<li>DIGITAL_OPTICAL</li>
</ul>

<p>Beginning with O.S release 3.2.0, Director will select a favored connection class first. In this example, by not favoring SPEAKER and STEREO there is a higher probability that they will be available to the other Zones, such as Zone 2 that require this type of signal. </p>

<p>At this point in the use case, we’ve favored the signal classes in our main zone (Zone 1). In doing so we’ve increased the probability that they will be selected in Zone 1.  This leaves the lower classes (STEREO and SPEAKER) available for Zone 2. However, there are some scenarios where the STEREO signal may be in use and not available to the Zone 2. To prevent the selection of the source being a digital class in Zone 2, we must block those signals in the Zone 2 connection XML to be sure that they cannot be selected. We can see in the Zone 2 connection example to the right that we’ve blocked: </p>

<ul>
<li>HDMI</li>
<li>DIGITAL_COAX</li>
<li>DIGITAL_OPTICAL</li>
</ul>

<div class="highlight"><pre class="highlight xml tab-xml"><code>-- Zone 2 Example

<span class="nt">&lt;connection</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;id&gt;</span>4002<span class="nt">&lt;/id&gt;</span>
            <span class="nt">&lt;facing&gt;</span>1<span class="nt">&lt;/facing&gt;</span>
            <span class="nt">&lt;connectionname&gt;</span>Zone2 Output<span class="nt">&lt;/connectionname&gt;</span>
            <span class="nt">&lt;type&gt;</span>6<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
            <span class="nt">&lt;audiosource&gt;</span>True<span class="nt">&lt;/audiosource&gt;</span>
            <span class="nt">&lt;videosource&gt;</span>False<span class="nt">&lt;/videosource&gt;</span>
            <span class="nt">&lt;linelevel&gt;</span>True<span class="nt">&lt;/linelevel&gt;</span>
            <span class="nt">&lt;classes&gt;</span>
                <span class="nt">&lt;class&gt;</span>
                    <span class="nt">&lt;classname&gt;</span>STEREO<span class="nt">&lt;/classname&gt;</span>
                <span class="nt">&lt;/class&gt;</span>
            <span class="nt">&lt;/classes&gt;</span>
            <span class="nt">&lt;blockedclasses&gt;</span>
                 <span class="nt">&lt;classname&gt;</span>HDMI<span class="nt">&lt;/classname&gt;</span>
            <span class="nt">&lt;classname&gt;</span>DIGITAL_COAX<span class="nt">&lt;/classname&gt;</span>
                 <span class="nt">&lt;classname&gt;</span>DIGITAL_OPTICAL<span class="nt">&lt;/classname&gt;</span>
            <span class="nt">&lt;/blockedclasses&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<p>By using favored connection classes in Zone 1 and blocked connection classes in Zone 2 we’re putting the AV Receiver driver in a position to influence Director to successfully distribute audio signals to both Zones regardless of the Signal Conversion limitations of the device.</p>
<h1 id='custom-select-implementation'>CUSTOM SELECT Implementation</h1>

<p>Note: A sample driver has been delivered to assist with understanding and implementing custom select functionality in LUA drivers. The driver is named sample_custom_select.c4z. It can be found in the DriverWorks Github repository in the Sample Drivers folder: </p>

<p><a href="https://github.com/snap-one/docs-driverworks/tree/master/sample_drivers">https://github.com/snap-one/docs-driverworks/tree/master/sample_drivers</a></p>

<p>The examples used in this documentation come from this driver. The driver can be loaded into a project and all of the supported CUSTOM_SELECT features can be exercised. Use of the sample driver is intended for O.S. 4.0.0 or later. However, it can be used in prior operating systems with the understanding that an earlier O.S. will result in inconsistent performance specifically surrounding the CUSTOM_SELECT Search and Filter types.</p>

<p>To make full use of the documentation, it is recommended that the driver be opened in your preferred development environment as several of the driver’s files will be reviewed and discussed in the examples included here.</p>

<p>The CUSTOM_SELECT type is available for both actions and commands for a driver. You’ll note identical Actions and Commands are defined in the sample XML and LUA code found in the sample_custom_select.c4z driver. While this documentation focuses on Action to demonstrate the CUSTOM_SELECT functionality, implementation of commands is identical. </p>

<p>The driver provides a list of selectable items in Composer Pro. Once an item is selected, it is returned to the driver. For Programming in Composer Pro, the driver provides a list of items to select that are used in a command for the driver. This enables actions and programming to have dynamic lists. </p>

<p>The ability of a Driver to deliver a list of related data-elements is supported through the use of the CUSTOM_SELECT XML property. The delivery of these lists can be very useful for your driver as they could represent radio stations, TV channels, light levels or URLs. It is also possible to create a “browsing experience” in Composer Pro with folders that contain the list data.  Once these data-elements are delivered, they can then be used as a parameter in ComposerPro programming. </p>

<p>For example, consider that a driver supports the ability to play audio from a database. The CUSTOM_SELECT type can be implemented to provide several user experiences in ComposerPro with regard to selecting audio. It can return simple list of audio choices and searching the list is also supported. The audio can also be organized in folders to create a browsable experience. The CUSTOM_SELECT type also supports the use of asynchronous calls in the case where it is used with an online audio service provider. All of these use cases and their respective implementations are detailed in the documentation that follows.</p>

<p>Currently, the following CUSTOM_SELECT features are supported:</p>

<ul>
<li><strong>List</strong>: Returns a simple list with no filtering options using minimal required parameters.</li>
<li><strong>Search</strong>: Adds a search box to the dialog.</li>
<li><strong>Filter</strong>: Adds a filter drop down to the dialog with the list provided by the xml. This is a static filter list.</li>
<li><strong>Folder</strong>: Adds a tree view type control. Note that folder and folder traversal is determined by the driver.</li>
<li><strong>Async</strong>: Supports an Asynchronous call for the list.</li>
</ul>

<p>Throughout this documentation we’ll refer to several Composer Pro UI constructs. These are found within the Actions dialog box. They include:</p>

<ol>
<li>List of returned data.</li>
<li>Folders which can be use to organize data.</li>
<li>Search box that supports string entry for searching data.</li>
<li>Filter drop down box that displays the static filters defined in the driver’s XML.</li>
<li>OK button which executes the ExecuteCommand Lua function.</li>
</ol>

<p><img src="images/csimage100-bd62bafb.png"/></p>

<h3 id='custom-select-implementation-favored-and-blocked-av-connection-classes-how-actions-work-in-your-driver'>How Actions work in Your Driver</h3>

<p>Before implementing CUSTOM_SELECT action functionality in a .lua driver, it is necessary to understand how driver Actions work. Actions are defined in your driver’s &lt;actions&gt; section of the drivers.xml file. They are displayed under the Actions tab in the Properties area of Composer Pro. </p>

<p>When an action is selected and executed in Composer Pro, a <code>LUA_ACTION</code> command is sent to the driver with any parameters the action may have. These commands are handled in the driver&#39;s ExecuteCommand function. You can see this code in the sample driver&#39;s driver.lua file.</p>

<p>The sample driver’s implementation of this is all handled within the ExecuteCommand function. The <code>LUA_ACTION</code> command is where all actions are handled. With programming, each command is handled individually.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">sCommand</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">selectedItem</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">if</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"LUA_ACTION"</span> <span class="k">then</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tParams</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
            <span class="kd">local</span> <span class="n">action</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"ACTION"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_List"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Search"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Filter"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Folder"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async_Country"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_All"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">else</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">"Action not found: "</span> <span class="o">..</span> <span class="n">action</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">elseif</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT List"</span> <span class="k">then</span>
        <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Command List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
    <span class="k">elseif</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT Search"</span> <span class="k">then</span>
        <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Command Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
    <span class="k">elseif</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT Filter"</span> <span class="k">then</span>
        <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Command Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
    <span class="k">elseif</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT Folder"</span> <span class="k">then</span>
        <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Command Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
    <span class="k">elseif</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT Async All"</span> <span class="k">then</span>
        <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Command Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
    <span class="k">elseif</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT Async Country"</span> <span class="k">then</span>
        <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Command Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
    <span class="k">elseif</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT All"</span> <span class="k">then</span>
        <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Command All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
    <span class="k">else</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s2">"Error: unsuppoted command: "</span><span class="o">..</span> <span class="n">sCommand</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p>The ExecuteCommand takes two parameters. The first parameter contains the command name being sent to the driver. The second parameter is a table of all of the parameters for the command. In the case of the sample driver, if the command is not handled an error message is printed and no action is taken.</p>

<h3 id='custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options'>Action Configuration Options</h3>

<p><em>sample driver action example:</em></p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>CUSTOM_SELECT Filter<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>CUSTOM_SELECT_Filter<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>3<span class="nt">&lt;/sort_order&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Select Channel<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:GetFilterList<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;search&gt;</span>
                <span class="nt">&lt;filters&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"all"</span><span class="nt">&gt;</span>All<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"country"</span><span class="nt">&gt;</span>Country<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"jazz"</span><span class="nt">&gt;</span>Jazz<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"oldies"</span><span class="nt">&gt;</span>Oldies<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"pop"</span><span class="nt">&gt;</span>Pop<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"rock"</span><span class="nt">&gt;</span>Rock<span class="nt">&lt;/filter&gt;</span>
                <span class="nt">&lt;/filters&gt;</span>
            <span class="nt">&lt;/search&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p><code>&lt;name&gt;</code></p>

<ul>
<li>Required</li>
<li>The &lt;name&gt; element contains the name of the Action. This name appears in Composer Pro’s list of actions.</li>
<li>In this documentation this is referred to as the <strong>&quot;Action Name&quot;</strong>.</li>
</ul>

<p><code>&lt;command&gt;</code></p>

<ul>
<li>Required</li>
<li>When an action is executed, a key/value pair entry is added to the tParams <em>(the second parameter to the ExecuteCommand function)</em> table with the key equal to <code>ACTION</code> and the value equal to the value of the &lt;command&gt; element. In the following example below, we can see the Action is the key and command CUSTOM_SELECT_filter is the value: <code>{&quot;ACTION&quot;:&quot;CUSTOM_SELECT_Filter&quot;}</code>.</li>
<li>In this documentation, this is referred to as the <strong>“Action Command”</strong></li>
</ul>

<p><code>&lt;sort_order&gt;</code></p>

<ul>
<li>Optional</li>
<li>Numeric value that specifies the order the action appears in the list of Actions in Composer Pro.</li>
</ul>

<p><code>&lt;param&gt;&lt;name&gt;</code></p>

<ul>
<li>Required</li>
<li>Name of the parameter that will be displayed in the parameter list in Composer Pro.</li>
<li>In this documentation, this is referred to as the <strong>&quot;Parameter Name&quot;</strong></li>
</ul>

<p><code>&lt;param&gt;&lt;type&gt;</code></p>

<ul>
<li>Required</li>
<li>The type of the parameter. The type for custom select action parameter is: <code>CUSTOM_SELECT:function_name</code>. The function_name is the name of the function that must be implemented in the driver and will return the desired list and shown in Composer Pro. In the example above, the function name is <code>GetFilterList</code>. The sample driver&#39;s custom select functions are found in the custom_select.lua file.</li>
<li>In this documentation, this is referred to as the <strong>“Custom Select Function”</strong>.</li>
</ul>

<p><code>&lt;param&gt;&lt;search&gt;</code></p>

<ul>
<li>Optional</li>
<li>Provides a search text box for filtering the list items. Use an empty tag to show the text box without the filter combo box control.</li>
</ul>

<p><code>&lt;search&gt;&lt;filters&gt;</code></p>

<ul>
<li>Optional</li>
<li>A filter combo box will be added to the Select dialog. The combo box contains the list of strings defined by the filter elements in the xml. How the filters are used is determined by the driver.</li>
</ul>

<p><code>&lt;filter&gt;</code></p>

<ul>
<li>Requires at least two &lt;filter&gt; elements for filtering.</li>
<li>There needs to be one filter element for each item in the list. The name attribute value is used when selecting the item from the list. The element value is the text that is displayed in the combo box.</li>
</ul>

<h3 id='custom-select-implementation-favored-and-blocked-av-connection-classes-implementation-steps'>Implementation Steps</h3>

<p>The list below represent the three fundamental steps required to implement CUSTOM_SELECT type. The fourth step is only required when supporting Asynchronous type actions. These steps will be referred to throughout the documentation.</p>

<ol>
<li>Define the Action in the drivers.xml file.</li>
<li>Implement the action&#39;s <strong>Custom Select Function</strong> defined in the &lt;param&gt;&lt;type&gt; element. This function implementation in the sample driver is found in the custom_select.lua file.</li>
<li>Handle the <strong>“Action Command”</strong> within the ExecuteCommand function.</li>
<li>If there are any Asynchronous type actions, handle the results in the ReceivedAsync function. This is found in the driver.lua in the sample driver.</li>
</ol>

<h3 id='custom-select-implementation-favored-and-blocked-av-connection-classes-custom-select-function'>Custom Select Function</h3>

<p>The Custom Select Function&#39;s purpose is to provide the data for the <em>Select</em> dialog in Composer Pro. This dialog has numerous capabilities that will be described below.</p>

<p><strong><em>Parameters</em></strong></p>

<p>The function parameters are optional depending on the desired functionality of the <em>Select</em> dialog. There are a maximum of four parameters. These are defined below. In the sample driver used with this documentation, when no parameters are passed, the function returns a list of all the items. </p>

<p><em>Parameter 1 - string</em> (folder)<br>
This parameter is used for the tree view (folder) functionality and will contain the name of a selected folder. If the parameter is empty then that indicates Composer wants the list at the root level. Otherwise, it will contain a folder name and the function will return the list of items within that folder.</p>

<p><em>Parameter 2 - function</em> (callback)<br>
This parameter is typically used in asynchronous actions. However, it can be used in place of using return values. This function will be described below.</p>

<p><em>Parameter 3 - string</em> (search)<br>
This parameter contains the text entered in the search box of the Select dialog. This is handled more like a filter rather than a search. The Custom Select Function should return just those items that contain the text from this parameter.</p>

<p><em>Parameter 4 - string</em> (filter)<br>
This parameter contains the text value of the selected item in the filter combo box in the search control. It is up to the driver developer to determine how to use this parameter. For example, it may contain a list of music genres, in which case the Custom Select Function should return a list of albums or songs that match that genre.</p>

<p><em><strong>Callback Function (parameter 2)</strong></em><br>
A callback function is provided in those cases where the list data is not available when the function is called as will be the case with asynchronous actions. The driver must save this function for use when the driver is ready to return the data.</p>

<p><em><strong>Return Values/Parameters for the Callback Function</strong></em><br>
There are two ways to return the results of the Custom Select Function: function return values or execute the callback function provided by parameter 2. In both cases there are two parameters or return items: the list of items and the name of the folder for use when the back button is selected. Executing the callback function is required for asynchronous actions since the data is not available at the time the Custom Select Function is called.</p>

<p><em>Return/Parameter 1 - table</em> (list of items)<br>
Table of list items. The format is described below.</p>

<p><em>Return/Parameter 2 - string</em> (back)<br>
The name of the folder to open when the back button is pressed. If empty, then it will return back to the root folder level.</p>

<p><em><strong>Return List Format</strong></em></p>

<p>Each entry in the table has three key, value pair items. Two are required and one is optional.
text
- string type
- Required
- Contains the text that is displayed.</p>

<p>value
- string type
    - Required
    - Value returned when the item is selected.</p>

<p>folder
- type boolean
    - Optional
    - default = false
    - Specifies if the item is a folder item. If = true, the item will be displayed as a folder. When a folder is selected, The Custom Select Function is called with the first parameter equal to the value in the table entry.</p>

<p><em>sample list creation</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="c1">-- create table of list items</span>
<span class="n">list</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1">-- add some folders</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Country"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"country"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Jazz"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"jazz"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Oldies"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"oldies"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Pop"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"pop"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Rock"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"rock"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
<span class="c1">-- add some list items</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'50s Rock and Roll'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'rock_50'</span> <span class="p">})</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'60s Oldies'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'oldies_60'</span> <span class="p">})</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'60s Pop'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_60'</span> <span class="p">})</span>
<span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'70s Pop'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_70'</span> <span class="p">})</span>
</code></pre></div><h3 id='custom-select-implementation-favored-and-blocked-av-connection-classes-understanding-action-workflow'>Understanding Action Workflow</h3>
<p>If a driver has any Actions defined, there will be an Actions tab On the driver&#39;s System Design page. After selecting the Action tab, a list of actions will be displayed. This list comes from the list of actions in the drivers.xml file. </p>

<p>Upon selecting an action, the <code>Action Parameter List</code> dialog will appear. Any actions that are CUSTOM_SELECT type actions will have a lookup button to the left of the parameter. Upon selecting this button,  the function declared in the CUSTOM_SELECT type field is called. This function handles the creation of the list that is displayed in the <code>Select</code> dialog.
 <em>Note: How this function interacts with Composer Pro Actions will be described in each of the CUSTOM_SELECT feature documentation sections below.</em> </p>

<p>After selecting an item in the list and clicking Ok, you will be returned back to the <code>Action Parameter List</code> with the selected value in the action value field. </p>

<p>Clicking Ok on the <code>Action Parameter List</code> dialog will call the action command defined in the actions xml. This command will receive a table of results from the action where the driver handles those results.</p>

<p>The following represents a LUA Driver/Composer Pro workflow which begins with the user selecting the Actions tab in Composer Pro and ends with the execution of the ExecuteCommand function where the action is handled:</p>

<ul>
<li>User selects Actions Tab on the Driver&#39;s System Design page.

<ul>
<li>The Action List is Displayed.</li>
<li>User selects the action from the list.

<ul>
<li>The Action Parameter List dialog is displayed with the list of parameter(s).</li>
<li>User selects the Lookup Button for the action.
-The action&#39;s Custom Select Function is called, which returns a list or saves off the callback function for asynchronous type actions.

<ul>
<li>The list is displayed in the Select dialog either from the return values or when the asynchronous process completes and returns the list.</li>
<li>User finds the desired list item and selects the item.</li>
<li>User Clicks the Ok button.</li>
</ul></li>
<li>Back to Action Parameter List where the action parameter is set to the selected item&#39;s value</li>
<li>User Clicks the Ok button.</li>
<li>The Action’s Command is sent to the driver&#39;s ExecuteCommand function where the result of the action is handled.</li>
</ul></li>
</ul></li>
</ul>

<p><strong>Data used for sample_custom_select.c4z driver</strong></p>

<p>The example driver’s driver.lua file has a global table that contains all of the data that is used when exercising the driver and found in this documentation. The table uses music genres and types for example purposes:</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">g_tMusicGenre</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">-- Initialize functions</span>
<span class="k">function</span> <span class="nf">OnDriverInit</span><span class="p">(</span><span class="n">initType</span><span class="p">)</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'50s Rock and Roll'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'rock_50'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"rock"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"50s"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'60s Oldies'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'oldies_60'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"oldies"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"60s"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'60s Pop'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_60'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"pop"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"60s"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'70s Pop'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_70'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"pop"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"70s"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'80s Pop'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_80'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"pop"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"80s"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Classic Country'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'country_classic'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"country"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Classic Rock'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'rock_classic'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"rock"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Contermporary Jazz'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'jazz_contermporary'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"jazz"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Cool Jazz'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'jazz_cool'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"jazz"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Country 2K'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'country_2k'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"country"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"2k"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Country Rock'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'country_rock'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"rock"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Golden Oldies'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'oldies_golden'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"oldies"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Hard Rock'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'rock_hard'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"rock"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Jazz Piano'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'jazz_piano'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"jazz"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Motown'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'oldies_motown'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"oldies"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Pop Love Songs'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_lovesongs'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"pop"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Pop Rock'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_rock'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"pop"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Rock Hits'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'rock_hits'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"rock"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Smooth Jazz'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'jazz_smooth'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"jazz"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Soft Rock'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'rock_soft'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"rock"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'The 80s'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'country_80'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"country"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"80s"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'The 90s'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'country_90'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"country"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">"90s"</span> <span class="p">})</span>
    <span class="nb">table.insert</span><span class="p">(</span><span class="n">g_tMusicGenre</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s1">'Today\'</span><span class="n">s</span> <span class="n">Country</span><span class="s1">', value = '</span><span class="n">country_today</span><span class="s1">', genre = "country", period = "" })
    table.insert(g_tMusicGenre, { text = '</span><span class="n">Today</span><span class="err">\</span><span class="s1">'s Hits'</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s1">'pop_todays_hits'</span><span class="p">,</span> <span class="n">genre</span> <span class="o">=</span> <span class="s2">"pop"</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="s2">""</span> <span class="p">})</span>
<span class="k">end</span>
</code></pre></div>

<p>The documentation that follows contains information on implementing CUSTOM\SELECT features including:</p>

<p><strong><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-custom_select-list">List</a></strong></p>

<p><strong><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-custom_select-search">Search</a></strong></p>

<p><strong><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-custom_select-filter">Filter</a></strong></p>

<p><strong><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-custom_select-folder">Folder</a></strong></p>

<p><strong><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-custom_select-async-all">Asynch</a></strong></p>

<p>All of the supporting code for these features are provided in the sample_custom_select.c4z driver.</p>

<h2 id='custom-select-implementation-custom_select-list'>CUSTOM_SELECT List</h2>

<p>This example provides a simple, flat list with no search or filtering functionality.</p>

<p><strong>1. Define the Action</strong></p>

<p>The following xml defines the action for CUSTOM_SELECT List.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>~<span class="nt">&lt;actions&gt;</span>~
    <span class="nt">&lt;action&gt;</span>
        <span class="nt">&lt;name&gt;</span>CUSTOM_SELECT List<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;command&gt;</span>CUSTOM_SELECT_List<span class="nt">&lt;/command&gt;</span>
        <span class="nt">&lt;sort_order&gt;</span>1<span class="nt">&lt;/sort_order&gt;</span>
        <span class="nt">&lt;params&gt;</span>
            <span class="nt">&lt;param&gt;</span>
                <span class="nt">&lt;name&gt;</span>Select List Item<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:GetList<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
    <span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p>In the example above:</p>

<p>The <a href="https://legendary-disco-58bce7a4.pages.github.io/#custom-select-implementation-common-directories-action-configuration-options">Action Command</a> = CUSTOM_SELECT_List.<br>
The <a href="https://legendary-disco-58bce7a4.pages.github.io/#custom-select-implementation-common-directories-custom-select-function">Custom Select Function</a> = GetList.</p>

<p><strong>2. Implement the Custom Select Function</strong></p>

<p><em>Implementation of GetList()</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetList</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- table of list items to return</span>

    <span class="n">InsertAll</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>

<p>In this example we want to return the full list of data from the <code>g_tMusicGenre</code> table . Since there is no search, filtering or folder functionality, the GetList function needs no parameters and simply returns the full list in the table. In our sample driver, this function is implemented in the drivers’ sample_custom_select.lua file.</p>

<p><strong>3. Handle the Action Command</strong>
All driver commands are handled in the ExecuteCommand function. To illustrate the handling of this <a href="https://legendary-disco-58bce7a4.pages.github.io/#custom-select-implementation-common-directories-action-configuration-options">action command</a>, we can update the &quot;CUSTOM_SELECT Action List Result&quot; property in the driver with the result of the action. Simply replace that code with whatever action is required for your driver’s needs.</p>

<p><em>Handling of <strong>CUSTOM_SELECT_List</strong> action in Execute Command</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">sCommand</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">selectedItem</span> <span class="o">=</span> <span class="s2">""</span>

<span class="k">if</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"LUA_ACTION"</span> <span class="k">then</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tParams</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">action</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"ACTION"</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_List"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Search"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Filter"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Folder"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async_Country"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_All"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Timer"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Timer Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">else</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">"Action not found: "</span> <span class="o">..</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
</code></pre></div>

<p><strong> ExecuteCommand Parameters</strong><br>
sCommand: Command sent to the driver. For actions, this will always be &quot;LUA_ACTION&quot;.<br>
tParams: Table of parameter key/value pairs for the command.</p>

<p><strong>Action Parameters</strong><br>
ACTION: The value of this item is the <em><a href="https://legendary-disco-58bce7a4.pages.github.io/#custom-select-implementation-common-directories-action-configuration-options">Action Command</a></em> of the action executed. In this case it will be CUSTOM_SELECT_List.<br>
&quot;Select List Item&quot;: This parameter is the <em><a href="https://legendary-disco-58bce7a4.pages.github.io/#custom-select-implementation-common-directories-action-configuration-options">Parameter Name</a></em> as defined in the xml. Its value is the value returned from the action.</p>

<h2 id='custom-select-implementation-custom_select-search'>CUSTOM_SELECT Search</h2>

<p>This example provides a search field in the Composer Pro’s CUSTOM_SELECT UI. In our example, the box accepts string based searches and returns matching data from the <code>g_tMusicGenre</code> table.</p>

<p><strong>1. Define the Action</strong></p>

<p>The following xml defines the action for CUSTOM_SELECT Search.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>CUSTOM_SELECT Search<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>CUSTOM_SELECT_Search<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>2<span class="nt">&lt;/sort_order&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Select List Item<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:GetSearchList<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;search</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p>In the example above:</p>

<p>The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a> = CUSTOM_SELECT_Search.<br>
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-custom-select-function">Custom Select Function</a> = GetSearchList.<br>
The &lt;search /&gt; tag enables the search box in the <code>Select</code> diablog.</p>

<p><strong>2. Implement the Custom Select Function</strong></p>

<p><em>Implementation of GetSearchList()</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetSearchList</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- table of list items to return</span>

    <span class="k">if</span> <span class="n">IsEmpty</span><span class="p">(</span><span class="n">searchText</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">InsertAll</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="n">FilterText</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>

<p>The GetSearchList function is provided for the &quot;CUSTOM_SELECT Search&quot; action to call when it needs the list of items available to select. The &quot;CUSTOM_SELECT Search&quot; action example is a flat list with filtering by a string. If searchText is empty, the full list is returned, Otherwise, only items that contain the search text will be returned</p>

<p><strong>3. Handle the Action Command</strong></p>

<p>All driver commands are handled in the ExecuteCommand function. To illustrate the handling of this <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">action command</a>, we update the &quot;CUSTOM_SELECT Action Search Result&quot; property in the driver with the result of the action. Simply replace that code with whatever action is required for your driver’s needs.</p>

<p><em>Handling of <strong>CUSTOM_SELECT_Search</strong> action in Execute Command</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">sCommand</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">selectedItem</span> <span class="o">=</span> <span class="s2">""</span>

<span class="k">if</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"LUA_ACTION"</span> <span class="k">then</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tParams</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
        <span class="kd">local</span> <span class="n">action</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"ACTION"</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_List"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Search"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Filter"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Folder"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async_Country"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_All"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Timer"</span> <span class="k">then</span>
            <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
            <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Timer Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
        <span class="k">else</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">"Action not found: "</span> <span class="o">..</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><strong> ExecuteCommand Parameters</strong><br>
sCommand: Command sent to the driver. For actions, this will always be &quot;LUA_ACTION&quot;.<br>
tParams: Table of parameter key/value pairs for the command.</p>

<p><strong>Action Parameters</strong><br>
ACTION: The value of this item is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a></em> of the action executed. In this case it will be CUSTOM_SELECT_Search.<br>
&quot;Select List Item&quot;: This parameter is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Parameter Name</a></em> as defined in the xml. Its value is the value returned from the action.</p>

<h2 id='custom-select-implementation-custom_select-filter'>CUSTOM_SELECT Filter</h2>

<p>This example adds a filter drop down to the dialog with the filter list provided by the xml. Note that this is a static filter list. Filter list content is defined within the <code>&lt;search&gt;&lt;/search&gt;</code> tags of the action’s XML.</p>

<p><strong>1. Define the Action</strong></p>

<p>The following xml defines the action for CUSTOM_SELECT Filter.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>CUSTOM_SELECT Filter<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>CUSTOM_SELECT_Filter<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>3<span class="nt">&lt;/sort_order&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Select Channel<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:GetFilterList<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;search&gt;</span>
                <span class="nt">&lt;filters&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"all"</span><span class="nt">&gt;</span>All<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"country"</span><span class="nt">&gt;</span>Country<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"jazz"</span><span class="nt">&gt;</span>Jazz<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"oldies"</span><span class="nt">&gt;</span>Oldies<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"pop"</span><span class="nt">&gt;</span>Pop<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"rock"</span><span class="nt">&gt;</span>Rock<span class="nt">&lt;/filter&gt;</span>
                <span class="nt">&lt;/filters&gt;</span>
            <span class="nt">&lt;/search&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p>In the example above:
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a> = CUSTOM_SELECT_Filter.<br>
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-custom-select-function">Custom Select Function</a> = GetFilterList.</p>

<p><strong>2. Implement the Custom Select Function</strong></p>

<p><em>Implementation of GetFilterList()</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetFilterList</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">searchText</span><span class="p">,</span> <span class="n">filter</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">-- table of list items to return</span>
    <span class="kd">local</span> <span class="n">hasSearch</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">IsEmpty</span><span class="p">(</span><span class="n">searchText</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">hasFilter</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">IsEmpty</span><span class="p">(</span><span class="n">filter</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filter</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasFilter</span> <span class="k">then</span>
        <span class="n">InsertAll</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasFilter</span> <span class="k">then</span>
        <span class="n">FilterText</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="ow">not</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="n">hasFilter</span> <span class="k">then</span>
        <span class="n">FilterByGenre</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">filter</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="c1">-- has both searchText and filter</span>
        <span class="n">FilterGenreText</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">filter</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>

<p>The GetFilterList function is provided for the &quot;CUSTOM_SELECT Filter&quot; action to call when it needs the list of items available to select. The &quot;CUSTOM_SELECT Filter&quot; action example is a flat list with both text filtering and/or matches the music genre contained in the filter parameter. The filter parameter will be one of the &lt;filter&gt; items driver.xml file. If both the searchText and filter parameters are empty, the full list is returned, Otherwise, only items that contain the search text and match the genre will be returned.</p>

<p><strong>3. Handle the Action Command</strong></p>

<p>All driver commands are handled in the ExecuteCommand function. To illustrate the handling of this action, we update the &quot;CUSTOM_SELECT Action Search Result&quot; property in the driver with the result of the action. Simply replace that code with whatever action is required for your driver’s needs.</p>

<p><em>Handling of <strong>CUSTOM_SELECT_Filter</strong> action in Execute Command</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">sCommand</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">selectedItem</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">if</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"LUA_ACTION"</span> <span class="k">then</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tParams</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
            <span class="kd">local</span> <span class="n">action</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"ACTION"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_List"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Search"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Filter"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Folder"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async_Country"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_All"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Timer"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Timer Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">else</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">"Action not found: "</span> <span class="o">..</span> <span class="n">action</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><strong> ExecuteCommand Parameters</strong><br>
sCommand: Command sent to the driver. For actions, this will always be &quot;LUA_ACTION&quot;.<br>
tParams: Table of parameter key/value pairs for the command.</p>

<p><strong>Action Parameters</strong><br>
ACTION: The value of this item is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a></em> of the action executed. In this case it will be CUSTOM_SELECT_Filter.<br>
&quot;Select Channel”: This parameter is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Parameter Name</a></em> as defined in the xml. Its value is the value returned from the action.</p>

<h2 id='custom-select-implementation-custom_select-folder'>CUSTOM_SELECT Folder</h2>

<p>This example adds a tree view type control. Note that the folders and folder traversal are determined by the driver. There is nothing extra required in the action xml definition.</p>

<p><strong>1. Define the Action</strong></p>

<p>The following xml defines the action for CUSTOM_SELECT Folder.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>~<span class="nt">&lt;action&gt;</span>~
    <span class="nt">&lt;name&gt;</span>CUSTOM_SELECT Folder<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>CUSTOM_SELECT_Folder<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>4<span class="nt">&lt;/sort_order&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Select List Item<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:GetFolderList<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p>In the example above:
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a> = CUSTOM_SELECT_Folder.<br>
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-custom-select-function">Custom Select Function</a> = GetFolderList.</p>

<p><strong>2. Implement the Custom Select Function</strong></p>

<p><em>Implementation of GetFolderList()</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetFolderList</span><span class="p">(</span><span class="n">folderName</span><span class="p">)</span>
    <span class="c1">-- folderName = Genre</span>

    <span class="kd">local</span> <span class="n">back</span> <span class="o">=</span> <span class="kc">nil</span> <span class="c1">-- used to specify the list to return to when back button is selected.</span>
    <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">-- table of list items to return</span>
    <span class="kd">local</span> <span class="n">isInFolder</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">IsEmpty</span><span class="p">(</span><span class="n">folderName</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">isInFolder</span><span class="p">)</span> <span class="k">then</span>
        <span class="k">if</span> <span class="n">folderName</span> <span class="o">==</span> <span class="s1">'rock'</span> <span class="ow">or</span> <span class="n">folderName</span> <span class="o">==</span> <span class="s1">'oldies'</span> <span class="ow">or</span> <span class="n">folderName</span> <span class="o">==</span> <span class="s1">'pop'</span> <span class="ow">or</span> <span class="n">folderName</span> <span class="o">==</span> <span class="s1">'country'</span> <span class="ow">or</span> <span class="n">folderName</span> <span class="o">==</span> <span class="s1">'jazz'</span> <span class="k">then</span>
            <span class="n">FilterByGenre</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">folderName</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
            <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root folder</span>
        <span class="k">else</span>
            <span class="c1">-- if there is a sub folder</span>
            <span class="kd">local</span> <span class="n">subFolderIndex</span> <span class="o">=</span> <span class="nb">string.find</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="s1">'_'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subFolderIndex</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
                <span class="n">back</span> <span class="o">=</span> <span class="nb">string.match</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="s2">"(.*)_"</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span> <span class="k">do</span>
                    <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="n">folderName</span> <span class="o">..</span> <span class="s2">" song "</span> <span class="o">..</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"song_"</span> <span class="o">..</span> <span class="n">folderName</span> <span class="o">..</span> <span class="s2">"_"</span> <span class="o">..</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">})</span>
                <span class="k">end</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">else</span>
        <span class="c1">-- at the root level</span>
        <span class="n">InsertRootFolders</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">return</span> <span class="n">list</span><span class="p">,</span> <span class="n">back</span>
<span class="k">end</span>
</code></pre></div>

<p>The GetFolderList function is provided for the &quot;CUSTOM_SELECT Folder&quot; action to call when it needs the list of items available to select. The &quot;CUSTOM_SELECT Folder&quot; action example is a tree view control of folders that contain the different list of genres. There are no filtering capabilities with this action. Items will be listed based on the folderName. If empty the root list will be provided.  </p>

<p><strong>Parameters</strong><br>
folderName: The name of the folder you are in. This will be empty the first time. In this example folderName equals a genre.  </p>

<p><strong>Return Values</strong><br>
list: A list of items based on the folderName, if empty the root level is returned.<br>
back: Name of the folder to return to when the back button is selected. If empty returns to the root level.</p>

<p><strong>3. Handle the Action Command</strong></p>

<p>All driver commands are handled in the ExecuteCommand function. To illustrate the handling of this action, we can update the &quot;CUSTOM_SELECT Action Search Result&quot; property in the driver with the result of the action. Simply replace that code with whatever action is required for your driver’s needs.</p>

<p><em>Handling of <strong>CUSTOM_SELECT_Folder</strong> action in Execute Command</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">sCommand</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">selectedItem</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">if</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"LUA_ACTION"</span> <span class="k">then</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tParams</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
            <span class="kd">local</span> <span class="n">action</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"ACTION"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_List"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Search"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Filter"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Folder"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async_Country"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_All"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Timer"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Timer Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">else</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">"Action not found: "</span> <span class="o">..</span> <span class="n">action</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><strong> ExecuteCommand Parameters</strong><br>
sCommand: Command sent to the driver. For actions, this will always be &quot;LUA_ACTION&quot;.<br>
tParams: Table of parameter key/value pairs for the command.</p>

<p><strong>Action Parameters</strong><br>
ACTION: The value of this item is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a></em> of the action executed. In this case it will be CUSTOM_SELECT_Folder.<br>
&quot;Select List Item”: This parameter is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Parameter Name</a></em> as defined in the xml. Its value is the value returned from the action.</p>

<h2 id='custom-select-implementation-custom_select-async-all'>CUSTOM_SELECT Async All</h2>

<p>This example supports an Asynchronous call for the list of data found in the <code>g_tMusicGenre</code>. While our example uses static data, CUSTOM_SELECT Async All is useful for querying data from an online resource such as a music service.</p>

<p><strong>1. Define the Action</strong></p>

<p>The following xml defines the action for CUSTOM_SELECT Async All.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>~<span class="nt">&lt;action&gt;</span>~
    <span class="nt">&lt;name&gt;</span>CUSTOM_SELECT Async All<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>CUSTOM_SELECT_Async<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>5<span class="nt">&lt;/sort_order&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Select List Item<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:GetAsyncListAll<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p>In the example above:
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command </a>= CUSTOM_SELECT_Async.<br>
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-custom-select-function">Custom Select Function</a> = GetAsyncListAll.</p>

<p><strong>2. Implement the Custom Select Function</strong></p>

<p><em>Implementation of GetAsyncListAll()</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetAsyncListAll</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">ticketId</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">urlGet</span><span class="p">(</span><span class="s2">"http://www.example.com"</span><span class="p">)</span>

    <span class="c1">-- Add an entry to g_tickets to store the callback function and a variable myAction</span>
    <span class="c1">-- so that the ReceivedAsync call will know what function issued the C4:urlGet command.</span>
    <span class="n">g_tickets</span><span class="p">[</span><span class="n">ticketId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">callbackFunction</span> <span class="o">=</span> <span class="n">callback</span><span class="p">,</span> <span class="n">myAction</span> <span class="o">=</span> <span class="s2">"GetAsyncListAll"</span> <span class="p">}</span>

    <span class="c1">-- Do not return anything here, the ReceivedAsync callback function will be called</span>
    <span class="c1">-- after the C4:urlGet function completes</span>
<span class="k">end</span>
</code></pre></div>

<p>GetAsyncListAll function is provided for the &quot;CUSTOM_SELECT Async All&quot; action to call when it needs the list of items available to select. The &quot;CUSTOM_SELECT Async All&quot; action example shows how to handle the list data if an asynchronous call is needed to return the list such as a C4:urlGet command. In this example we will be returning the full list. There are no filtering capabilities in this example.</p>

<p><strong>3. Handle the Action Command</strong></p>

<p>All driver commands are handled in the ExecuteCommand function. To illustrate the handling of this action, we can update the &quot;CUSTOM_SELECT Action Search Result&quot; property in the driver with the result of the action. Simply replace that code with whatever action is required for your driver’s needs.</p>

<p><em>Handling of <strong>CUSTOM_SELECT_Async</strong> action in Execute Command</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">sCommand</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">selectedItem</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">if</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"LUA_ACTION"</span> <span class="k">then</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tParams</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
            <span class="kd">local</span> <span class="n">action</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"ACTION"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_List"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Search"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Filter"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Folder"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async_Country"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_All"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Timer"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Timer Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">else</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">"Action not found: "</span> <span class="o">..</span> <span class="n">action</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><strong> ExecuteCommand Parameters</strong><br>
sCommand: Command sent to the driver. For actions, this will always be &quot;LUA_ACTION&quot;.<br>
tParams: Table of parameter key/value pairs for the command.</p>

<p><strong>Action Parameters</strong><br>
ACTION: The value of this item is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a></em> of the action executed. In this case it will be CUSTOM_SELECT_Async.<br>
&quot;Select List Item”: This parameter is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Parameter Name</a></em> as defined in the xml. Its value is the value returned from the action.</p>

<h3 id='custom-select-implementation-custom_select-async-all-additional-async-examples'>Additional Async Examples</h3>

<p>The sample driver includes two additional examples that can be used to demonstrate support for asynchronous data requests:</p>

<p><strong>GetAsyncListCountry</strong></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetAsyncListCountry</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">ticketId</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">urlGet</span><span class="p">(</span><span class="s2">"http://www.example.com"</span><span class="p">)</span>

    <span class="c1">-- Add an entry to g_tickets to store the callback function and a variable myAction</span>
    <span class="c1">-- so that the ReceivedAsync call will know what function issued the C4:urlGet command.</span>
    <span class="n">g_tickets</span><span class="p">[</span><span class="n">ticketId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">callbackFunction</span> <span class="o">=</span> <span class="n">callback</span><span class="p">,</span> <span class="n">myAction</span> <span class="o">=</span> <span class="s2">"GetAsyncListCountry"</span> <span class="p">}</span>

    <span class="c1">-- Do not return anything here, the ReceivedAsync callback function will be called</span>
    <span class="c1">-- after the C4:urlGet function completes</span>
<span class="k">end</span>
</code></pre></div>

<p>GetAsyncListCountry function is provided for the &quot;CUSTOM_SELECT Async Country&quot; action to call when it needs the list of items available to select. The &quot;CUSTOM_SELECT Async Country&quot; action example shows how to handle the list data if an asynchronous call is needed to return the list such as a C4:urlGet command. This example returns only country songs. There are no filtering capabilities with this action.</p>

<p><strong>GetAsyncTimer</strong></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetAsyncListTimer</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">timerId</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">AddTimer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">"SECONDS"</span><span class="p">)</span>

    <span class="c1">-- Add an entry to g_timers to store the callback function.</span>
    <span class="n">g_timers</span><span class="p">[</span><span class="n">timerId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">callbackFunction</span> <span class="o">=</span> <span class="n">callback</span> <span class="p">}</span>

    <span class="c1">-- Do not return anything here, the OnTimerExpired function will be called</span>
    <span class="c1">-- after the timer expires.</span>
<span class="k">end</span>
</code></pre></div>

<p>GetAsyncListTimer function is provided for the &quot;CUSTOM_SELECT Async Timer action to call. The &quot;CUSTOM_SELECT Async Timer action example uses a five second timer to demonstrate an asynchronous call. After five seconds expire, it returns a list of all of the entries in the <code>g_tMusicGenre</code> table.</p>

<h2 id='custom-select-implementation-custom_select-all'>CUSTOM_SELECT All</h2>

<p>This example demonstrates the implementation of several CUSTOM_SELECT features within one Action. It includes List, Search, Filter, Folder.</p>

<p><strong>1. Define the Action</strong></p>

<p>The following xml defines the action for CUSTOM_SELECT All.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>CUSTOM_SELECT All<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>CUSTOM_SELECT_All<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>8<span class="nt">&lt;/sort_order&gt;</span>
    <span class="nt">&lt;params&gt;</span>
        <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Select List Item<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:GetListAll<span class="nt">&lt;/type&gt;</span>
            <span class="nt">&lt;search&gt;</span>
                <span class="nt">&lt;filters&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"all"</span><span class="nt">&gt;</span>All<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"50s"</span><span class="nt">&gt;</span>50s<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"60s"</span><span class="nt">&gt;</span>60s<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"70s"</span><span class="nt">&gt;</span>70s<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"80s"</span><span class="nt">&gt;</span>80s<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"90s"</span><span class="nt">&gt;</span>90s<span class="nt">&lt;/filter&gt;</span>
                    <span class="nt">&lt;filter</span> <span class="na">name=</span><span class="s">"2k"</span><span class="nt">&gt;</span>90s<span class="nt">&lt;/filter&gt;</span>
                <span class="nt">&lt;/filters&gt;</span>
            <span class="nt">&lt;/search&gt;</span>
        <span class="nt">&lt;/param&gt;</span>
    <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p>In the example above:<br>
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command </a>= CUSTOM_SELECT_All.<br>
The <a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-custom-select-function">Custom Select Function</a> = GetListAll.</p>

<p><strong>2. Implement the Custom Select Function</strong></p>

<p><em>Implementation of GetListAll()</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">GetListAll</span><span class="p">(</span><span class="n">folderName</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">searchText</span><span class="p">,</span> <span class="n">filter</span><span class="p">)</span>
    <span class="c1">-- folderName = Genre</span>
    <span class="c1">-- filter = period</span>

    <span class="kd">local</span> <span class="n">back</span> <span class="o">=</span> <span class="kc">nil</span> <span class="c1">-- used to specify the list to return to when back button is selected.</span>
    <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1">-- table of list items to return</span>

    <span class="kd">local</span> <span class="n">isInFolder</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">IsEmpty</span><span class="p">(</span><span class="n">folderName</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">hasSearch</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">IsEmpty</span><span class="p">(</span><span class="n">searchText</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">hasFilter</span> <span class="o">=</span> <span class="ow">not</span> <span class="p">(</span><span class="n">IsEmpty</span><span class="p">(</span><span class="n">filter</span><span class="p">)</span> <span class="ow">or</span> <span class="n">filter</span> <span class="o">==</span> <span class="s2">"all"</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">isInFolder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- at the root level and no filtering, show all folders and items</span>
        <span class="n">InsertRootFolders</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
        <span class="n">InsertAll</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">isInFolder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- filter by Genre</span>
        <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root folder</span>
        <span class="n">FilterByGenre</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">folderName</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">isInFolder</span> <span class="ow">and</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- search text only</span>
        <span class="n">FilterText</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">isInFolder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="c1">-- filter only</span>
        <span class="n">FilterByPeriod</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">filter</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">isInFolder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root folder</span>
        <span class="n">FilterGenrePeriod</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">folderName</span><span class="p">,</span> <span class="n">filter</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">isInFolder</span> <span class="ow">and</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root folder</span>
        <span class="n">FilterGenreText</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">folderName</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">isInFolder</span> <span class="ow">and</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">FilterPeriodText</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">filter</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="p">(</span><span class="n">isInFolder</span> <span class="ow">and</span> <span class="n">hasSearch</span> <span class="ow">and</span> <span class="n">hasFilter</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root folder</span>
        <span class="n">FilterGenrePeriodText</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">folderName</span><span class="p">,</span> <span class="n">filter</span><span class="p">,</span> <span class="n">searchText</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">return</span> <span class="n">list</span><span class="p">,</span> <span class="n">back</span>
<span class="k">end</span>
</code></pre></div>

<p>The GetListAll function is provided for the &quot;CUSTOM_SELECT All&quot; action to call when it needs the list of items available to select. The &quot;CUSTOM_SELECT All&quot; action example combines all the features except the asynchronous examples into a single action.</p>

<p><strong>3. Handle the Action Command</strong></p>

<p>All driver commands are handled in the ExecuteCommand function. To illustrate the handling of this action, we can update the &quot;CUSTOM_SELECT Action Search Result&quot; property in the driver with the result of the action. Simply replace that code with whatever action is required for your driver’s needs.</p>

<p><em>Handling of <strong>CUSTOM_SELECT_All</strong> action in Execute Command</em></p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">sCommand</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">selectedItem</span> <span class="o">=</span> <span class="s2">""</span>

    <span class="k">if</span> <span class="n">sCommand</span> <span class="o">==</span> <span class="s2">"LUA_ACTION"</span> <span class="k">then</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tParams</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
            <span class="kd">local</span> <span class="n">action</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"ACTION"</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_List"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action List Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Search"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Search Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Filter"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select Channel"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Filter Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Folder"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Folder Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Async_Country"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async2 Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_All"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action All Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">elseif</span> <span class="n">action</span> <span class="o">==</span> <span class="s2">"CUSTOM_SELECT_Timer"</span> <span class="k">then</span>
                <span class="n">selectedItem</span> <span class="o">=</span> <span class="n">tParams</span><span class="p">[</span><span class="s2">"Select List Item"</span><span class="p">]</span>
                <span class="n">C4</span><span class="p">:</span><span class="n">UpdateProperty</span><span class="p">(</span><span class="s2">"CUSTOM_SELECT Action Async Timer Result"</span><span class="p">,</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">selectedItem</span><span class="p">))</span>
            <span class="k">else</span>
                <span class="nb">print</span> <span class="p">(</span><span class="s2">"Action not found: "</span> <span class="o">..</span> <span class="n">action</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>

<p><strong> ExecuteCommand Parameters</strong><br>
sCommand: Command sent to the driver. For actions, this will always be &quot;LUA_ACTION&quot;.<br>
tParams: Table of parameter key/value pairs for the command.</p>

<p><strong>Action Parameters</strong><br>
ACTION: The value of this item is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Action Command</a></em> of the action executed. In this case it will be CUSTOM_SELECT_All.<br>
&quot;Select List Item”: This parameter is the <em><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#custom-select-implementation-favored-and-blocked-av-connection-classes-action-configuration-options">Parameter Name</a></em> as defined in the xml. Its value is the value returned from the action.</p>
<h1 id='events'>Events</h1>

<h2 id='events-history-event-notifications'>History Event Notifications</h2>

<p><strong>Overview</strong></p>

<p>Beginning with O.S. 3.4.0, drivers can provide a better experience for users receiving Event push notifications on smartphones or tablets. Users can now view these notifications and, if desired, select the notification and be taken directly to the relevant content within the Control4 app. This removes the previous need to navigate through the app to find the relevant information. </p>

<p>For example, consider an IP Camera sending a push notification from a Motion event type. The notification displayed on the UI can be selected and the user is taken into the camera area of the app and the video that triggered the event. If the event was triggered in the past, the notification link will take the user to the History UI.</p>

<p>Prior to O.S. 3.4.0, driver developers had to use the SendUIRequest API to directly send the RECORD_HISTORICAL_EVENT command to the agent in order to get back the UUID of the event. This functionality has also been enhanced through an updated <a href="https://snap-one.github.io/docs-driverworks-api/#helper-interface-recordhistory">RecordHistory</a> API. </p>

<p><strong>Role of the Navigation Agent</strong>
In order for the deep linking to work, the Navigation agent must be installed. This is where the URI is generated. Without the navigation agent installed, the director.log will look similar to the example to the right.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">13</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">05</span><span class="p">.</span><span class="mi">964</span> <span class="o">-</span><span class="mi">0600</span> <span class="n">core3</span><span class="o">-</span><span class="mi">000</span><span class="n">FFF0C34A4</span> <span class="p">[</span><span class="mi">2330</span><span class="p">]</span> <span class="p">(</span><span class="mi">2244</span><span class="p">)</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">HistoryAgent</span><span class="p">::</span><span class="n">getBuildHistoryURI</span><span class="p">:</span> <span class="n">Started</span> <span class="o">-</span> <span class="n">Action</span><span class="p">:</span> <span class="n">Aquiring</span> <span class="n">Navigation</span> <span class="n">Agent</span> <span class="n">Device</span> <span class="n">Id</span><span class="p">.</span>

<span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">13</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">05</span><span class="p">.</span><span class="mi">964</span> <span class="o">-</span><span class="mi">0600</span> <span class="n">core3</span><span class="o">-</span><span class="mi">000</span><span class="n">FFF0C34A4</span> <span class="p">[</span><span class="mi">2330</span><span class="p">]</span> <span class="p">(</span><span class="mi">2244</span><span class="p">)</span> <span class="n">ERROR</span><span class="p">:</span> <span class="n">HistoryAgent</span><span class="p">::</span><span class="n">getBuildHistoryURI</span><span class="p">:</span> <span class="n">Failed</span> <span class="o">-</span> <span class="n">No</span> <span class="n">Navigation</span> <span class="n">Agent</span> <span class="n">found</span> <span class="n">using</span> <span class="n">control4_agent_navigation</span><span class="p">.</span><span class="n">c4i</span><span class="p">.</span>
</code></pre></div>

<p>Once the Navigation Agent is successfully installed, the director.log will be similar to the example to the right. Note the inclusion of the URI.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">13</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">39</span><span class="p">.</span><span class="mi">479</span> <span class="o">-</span><span class="mi">0600</span> <span class="n">core3</span><span class="o">-</span><span class="mi">000</span><span class="n">FFF0C34A4</span> <span class="p">[</span><span class="mi">2330</span><span class="p">]</span> <span class="p">(</span><span class="mi">2244</span><span class="p">)</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">HistoryAgent</span><span class="p">::</span><span class="n">getBuildHistoryURI</span><span class="p">:</span> <span class="n">Started</span> <span class="o">-</span> <span class="n">Action</span><span class="p">:</span> <span class="n">Aquiring</span> <span class="n">Navigation</span> <span class="n">Agent</span> <span class="n">Device</span> <span class="n">Id</span><span class="p">.</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">13</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">39</span><span class="p">.</span><span class="mi">480</span> <span class="o">-</span><span class="mi">0600</span> <span class="n">core3</span><span class="o">-</span><span class="mi">000</span><span class="n">FFF0C34A4</span> <span class="p">[</span><span class="mi">2330</span><span class="p">]</span> <span class="p">(</span><span class="mi">2244</span><span class="p">)</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">HistoryAgent</span><span class="p">::</span><span class="n">getBuildHistoryURI</span><span class="p">:</span> <span class="n">Response</span> <span class="o">-</span> <span class="n">XML</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">uri</span><span class="o">&gt;/</span><span class="n">v1</span><span class="o">/</span><span class="n">rooms</span><span class="o">/</span><span class="mi">268</span><span class="o">/</span><span class="n">cameras</span><span class="o">/</span><span class="mi">827</span><span class="o">&lt;/</span><span class="n">uri</span><span class="o">&gt;</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">01</span> <span class="mi">13</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">39</span><span class="p">.</span><span class="mi">480</span> <span class="o">-</span><span class="mi">0600</span> <span class="n">core3</span><span class="o">-</span><span class="mi">000</span><span class="n">FFF0C34A4</span> <span class="p">[</span><span class="mi">2330</span><span class="p">]</span> <span class="p">(</span><span class="mi">2244</span><span class="p">)</span> <span class="n">DEBUG</span><span class="p">:</span> <span class="n">HistoryAgent</span><span class="p">::</span><span class="n">getBuildHistoryURI</span><span class="p">:</span> <span class="n">Response</span> <span class="o">-</span> <span class="n">URI</span><span class="p">:</span> <span class="s1">'/v1/rooms/268/cameras/827'</span>
</code></pre></div>

<h2 id='events-sorting-events-in-composerpro'>Sorting Events in ComposerPro</h2>

<p>Prior to the release of O.S. 3.3.0, driver writers did not have the ability to order the way driver Events were displayed in the Programming area of ComposerPro. A sort order driver provides the ability to display Events in any desired order. Sort order can be applied to Events in the driver.xml with the inclusion of the following xml tag: &lt;sort_order&gt;&lt;/sort_order&gt;. See the lighting code Example 1 from a driver.xml file to the right.</p>

<p>The ability to order the way driver Events are displayed in the Properties area of ComposerPro is possible with the use of a sort order driver XML tag:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>New Description<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>0<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 1<span class="nt">&lt;/name&gt;</span>  
                <span class="nt">&lt;description&gt;</span>Event Description 1<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>1<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 2<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 2<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>2<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 3<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 3<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>3<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 4<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 4<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>4<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 5<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 10<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>5<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
</code></pre></div>

<p><code>&lt;sort_order&gt;&lt;/sort_order&gt;</code> </p>

<p>The tag accepts a zero based list and will display the Events in the order of the number included in each of the Events’ <code>&lt;sort_order&gt;&lt;/sort_order&gt;</code>tag.</p>

<p>For example, in the XML code to the right there are five device specific Events. They will display in ComposerPro Programming as:</p>

<ul>
<li>New Event</li>
<li>New Event 1</li>
<li>New Event 2</li>
<li>New Event 3</li>
<li>New Event 4</li>
<li>New Event 5</li>
</ul>
<h1 id='capabilities'>Capabilities</h1>

<h2 id='capabilities-capabilities'>Capabilities</h2>

<p>Capabilities tell the Proxy what your device can do. Not all devices of a particular type have the same capabilities.  In these cases, the .c4z file contains information which enables the proxy driver to determine what capabilities are available.  For example, a Receiver-Tuner might have the included example code to the right in the .c4z file:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;capabilities&gt;</span>
    <span class="nt">&lt;has_discrete_volume_control&gt;</span>True<span class="nt">&lt;/has_discrete_volume_control&gt;</span>
    <span class="nt">&lt;has_up_down_volume_control&gt;</span>True<span class="nt">&lt;/has_up_down_volume_control&gt;</span>
    <span class="nt">&lt;has_discrete_input_select&gt;</span>True<span class="nt">&lt;/has_discrete_input_select&gt;</span>
    <span class="nt">&lt;has_toad_input_select&gt;</span>True<span class="nt">&lt;/has_toad_input_select&gt;</span>
    <span class="nt">&lt;has_discrete_surround_mode_select&gt;</span>True<span class="nt">&lt;/has_discrete_surround_mode_select&gt;</span>
    <span class="nt">&lt;has_toad_surround_mode_select&gt;</span>True<span class="nt">&lt;/has_toad_surround_mode_select&gt;</span>
    <span class="nt">&lt;has_tune_up_down&gt;</span>True<span class="nt">&lt;/has_tune_up_down&gt;</span>
    <span class="nt">&lt;has_search_up_down&gt;</span>False<span class="nt">&lt;/has_search_up_down&gt;</span>
    <span class="nt">&lt;has_discrete_preset&gt;</span>True<span class="nt">&lt;/has_discrete_preset&gt;</span>
    <span class="nt">&lt;has_preset_up_down&gt;</span>True<span class="nt">&lt;/has_preset_up_down&gt;</span>
    <span class="nt">&lt;preset_count&gt;</span>40<span class="nt">&lt;/preset_count&gt;</span>
    <span class="nt">&lt;can_upclass&gt;</span>False<span class="nt">&lt;/can_upclass&gt;</span>
    <span class="nt">&lt;can_downclass&gt;</span>False<span class="nt">&lt;/can_downclass&gt;</span>
    <span class="nt">&lt;video_provider_count&gt;</span>1<span class="nt">&lt;/video_provider_count&gt;</span>
    <span class="nt">&lt;video_consumer_count&gt;</span>4<span class="nt">&lt;/video_consumer_count&gt;</span>
    <span class="nt">&lt;audio_provider_count&gt;</span>2<span class="nt">&lt;/audio_provider_count&gt;</span>
    <span class="nt">&lt;audio_consumer_count&gt;</span>8<span class="nt">&lt;/audio_consumer_count&gt;</span>
    <span class="nt">&lt;has_discrete_mute_control&gt;</span>True<span class="nt">&lt;/has_discrete_mute_control&gt;</span>
    <span class="nt">&lt;has_toggle_mute_control&gt;</span>True<span class="nt">&lt;/has_toggle_mute_control&gt;</span>
    <span class="nt">&lt;has_discrete_channel_select&gt;</span>True<span class="nt">&lt;/has_discrete_channel_select&gt;</span>
    <span class="nt">&lt;has_discrete_input_select&gt;</span>True<span class="nt">&lt;/has_discrete_input_select&gt;</span>
    <span class="nt">&lt;has_channel_up_down&gt;</span>True<span class="nt">&lt;/has_channel_up_down&gt;</span>
    <span class="nt">&lt;has_feedback&gt;</span>True<span class="nt">&lt;/has_feedback&gt;</span>
    <span class="nt">&lt;serialdelay&gt;</span>0<span class="nt">&lt;/serialdelay&gt;</span>
    <span class="nt">&lt;serialsettings&gt;</span>9600 8 none 1 none 232<span class="nt">&lt;/serialsettings&gt;</span>
 <span class="nt">&lt;/capabilities&gt;</span>
</code></pre></div>

<p>Please see the Proxy and Protocol Guide for supported capabilities for each of the device proxies.</p>
<h1 id='creating-or-modifying-driverworks-drivers'>Creating or Modifying DriverWorks Drivers</h1>

<h2 id='creating-or-modifying-driverworks-drivers-introduction'>Introduction</h2>

<p>This section provides an overview of the steps required to create or modify a driver using DriverWorks. It then describes how to load that driver into a Control4 system and how to begin using it. We will follow this essential process-flow in much greater detail in the upcoming sections. Much like the previous Concepts and Terminology section, familiarizing yourself with the process below will greatly assist you in your use of DriverWorks.</p>

<h2 id='creating-or-modifying-driverworks-drivers-development-process-flow'>Development Process Flow</h2><h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-obtain-the-device-and-control-modules-if-needed'>Obtain the device and control modules (if needed).</h3>
<p>If you are creating a driver for a device, you need to have access to the device itself and to the accessory modules (if required) that enable it to communicate via serial or TCP/IP with a control system. </p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-obtain-the-control-protocol-documentation'>Obtain the control protocol documentation.</h3>
<p>The control protocol documentation for the device will contain all of the information needed to implement your DriverWorks driver. This should include control protocol, communication protocol. </p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-physically-connect-the-device-to-your-control4-system'>Physically connect the device to your Control4 system.</h3>
<p>Determine how the device will communicate with the Control4 system. With DriverWorks, you can use either serial or TCP/IP communication protocols. Make the physical connections between your device and the system.</p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-select-the-appropriate-proxy-type-for-your-custom-driver'>Select the appropriate proxy type for your custom driver.</h3>
<p>The proxy selection determines the interface, which will be automatically generated for the user of the system in controlling this device.</p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-decide-whether-to-use-a-template-c4z-or-generate-a-c4z-using-the-driver-wizard'>Decide whether to use a template .c4z or generate a .c4z using the Driver Wizard.</h3>
<p>While you can hand code the entire .c4z file with the appropriate information, you’ll find it easier to start with a pre-formed .c4i. The advantage of using a template .c4z is it is already set up for DriverWorks and allows you to add your custom programming and modifications.  However, particularly with more complex AV devices containing multiple inputs / outputs, you may find it easier to generate a .c4z file using the Control4 Driver Wizard and then modify that .c4i file for use with DriverWorks. If an existing driver is available, you can modify that driver to meet your requirements. This assumes a driver already exists for the device.</p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-select-an-editor'>Select an editor.</h3>
<p>The DriverWorks creation process requires that you use an editor. You can use a text editor, and/or an XML editor, and (if desired) an IDE such as DriverEditor for creating your DriverWorks driver.  The advantage to a text editor is that it allows for the greatest flexibility in text entry. However, you have to be careful to ensure that the XML structure of the .c4z file is correct.The reason to consider an XML editor – at least for checking your .c4z file – is that it will help you identify if you have XML construct errors. The .c4z file needs to be proper XML for it to work within the Control4 system. Depending on the complexity of your Lua programming, you might also find it helpful to utilize an IDE which supports Lua.  This will allow you to validate your programming for errors prior to inclusion in the driver. Alternatively, you can also use the Lua interpreter built into Composer for that purpose.</p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-create-edit-your-driver'>Create/edit your driver.</h3>
<p>Obviously, this is the heart of the process and may require a considerable number of iterations to get correct. Make backups of your driver along the way so that if you need to recover to a known good point, you can easily do so. You will find it beneficial to start simple, get the basic driver working, and then add functionality.  We’ll cover this procedure in detail in a later section.</p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-add-your-driver-to-the-control4-project'>Add your driver to the Control4 project.</h3>
<p>In order to test your driver you will add it to the Control4 system.</p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-update-the-driver-loaded-within-your-project'>Update the driver loaded within your project.</h3>
<p>If you are just making changes to the Lua programming, you can use the Composer Lua window to continually update and refine the functionality of your driver without reloading.  However, changes to other areas of the .c4i file (such as Commands, Properties, Events, Capabilities, etc) will require that the .c4i be reloaded in the project in order to have access to the changes you are making. If you don’t want to redo your programming and bindings, the easiest way to reload your driver is to load a new instance of that driver into your project and then restart Director.  Even if you have just been updating the Lua code, you need to reload the final .c4i file when you are done so that when Director restarts you will have the latest iteration.</p>
<h3 id='creating-or-modifying-driverworks-drivers-development-process-flow-share-your-driver'>Share your driver.</h3>
<p>If you want to share your driver with someone else, simply e-mail (or otherwise transfer) the .c4z file to them.  As long as they are running a 1.6 or later system, all they have to do is use Composer to add the custom driver to their system.</p>

<h2 id='creating-or-modifying-driverworks-drivers-template-development-process-flow'>Template Development Process Flow</h2>

<p>This section provides step by step directions to help you create the .c4i file needed for your DriverWorks driver.  In most cases you will want to either use a template or use an existing driver .c4i file and modify it to meet your needs.  While it is possible to create a .c4z file by hand using the information provided above, Control4 does not recommend that approach due to the complexity and many required elements.</p>

<p>As you can see by the following steps, there is a great deal of similarity between using a template or sample DriverWorks driver and using an existing 1-way driver’s .c4z file.  The differences specifically lie in which fields need to be changed.</p>

<p>Several templates have been included in the SDK.  These templates and sample drivers range from very simple .c4z’s to partially functional DriverWorks drivers.  If a template exists for the device (proxy) type that you are creating your driver for, it is very easy to begin with the pre-existing template.</p>

<p>The steps are as follows:</p>

<ol>
<li>Copy the template .c4z and rename your copy</li>
<li>Change the .c4z elements that you need to change in order to make your driver.</li>
<li>Fields that should be changed include: <code>&lt;manufacturer&gt;, &lt;model&gt;, &lt;creator&gt;, &lt;name&gt;, &lt;created&gt;, &lt;modified&gt;</code></li>
<li>Fields that may need modification include: <code>&lt;documentation&gt;, &lt;properties&gt;, &lt;actions&gt;, &lt;commands&gt;, &lt;connections&gt;</code></li>
<li>After each major change you make ensure that your .c4z file can be seen by and loaded into your project using Composer. It is good practice to verify this throughout the time you work on the .c4i file.</li>
<li>Add/change the Lua code that will be used by your driver.</li>
<li>After all the change iterations have been completed, reload your driver </li>
</ol>

<p>Occasionally, and particularly for AV devices, you might find it easier to take an existing one-way driver’s .c4z file and convert it for use as a DriverWorks driver.  This enables you to leverage all the connections and capabilities information required to model your device.</p>

<p>The steps are as follows:</p>

<ol>
<li>Copy the existing one-way driver’s .c4z file and rename your copy</li>
<li>Change the .c4z elements that you need to change in order to make your driver.</li>
<li>Fields that must be changed include: <code>&lt;driver&gt;, &lt;control&gt;</code></li>
<li>Fields that should be changed include: <code>&lt;creator&gt;, &lt;name&gt;, &lt;created&gt;, &lt;modified&gt;</code></li>
<li>Fields that may need modification include: <code>&lt;manufacturer&gt;, &lt;model&gt;, &lt;documentation&gt;, &lt;properties&gt;, &lt;actions&gt;, &lt;commands&gt;, &lt;connections&gt;</code></li>
<li>After each major change you make ensure that your .c4z file can be seen by and loaded into your project using Composer. It is good practice to verify this throughout the time you work on the .c4i file.</li>
<li>Add/change the Lua code that will be used by your driver</li>
<li>After all the change iterations have been completed, reload your driver.</li>
</ol>
<h1 id='updating-released-drivers'>Updating Released Drivers</h1>

<h2 id='updating-released-drivers-automatically-updating-released-drivers'>Automatically Updating Released Drivers</h2>

<p>The ability for a driver to update to a newer version through a new ComposerPro interface has been added in conjunction with O.S release 2.9.0. The Automatic Driver Update functionality only applies to drivers loaded into Control4’s online driver database. This is similar to the automatic application update capabilities provided by the Apple iTunes store and Google Play store for example. If you are a 3rd-party Developer and would like to utilize the automatic driver update functionality, you may work with Control4 and participate in the driver certification program to get your drivers posted on the Control4 driver database.</p>

<p>For consideration regarding whether or not your driver is a candidate for Driver Update (as opposed to a new driver release) please see Driver Update Considerations</p>

<p>There are two main components involved in supporting this functionality. These include several, new XML tags that need to be included in the driver. These new tags can reside anywhere at the top level of the driver XML under <code>&lt;devicedata&gt;</code>. The second component involves enabling the Driver Update Agent in ComposerPro.</p>

<p>The new driver XML tags include: </p>

<p><code>&lt;auto_update&gt;&lt;/auto_update&gt;</code>
This tag designates if a driver supports automatically updating to newer version when set to true. For example:</p>

<p><code>&lt;auto_update&gt;true&lt;/auto_update&gt;</code></p>

<p>The <code>auto_update</code> functionality is executed by an agent running on the Control4 controller. It checks with the online driver DB once in each 24 hour period to see if there’s a higher version of any of the drivers installed in the project. If there is, that driver is automatically updated.</p>

<p>To utilize this functionality, the driver must be hosted in the online driver DB. It doesn’t matter whether it is certified or not.</p>

<p>As long as the version in the online driver DB has the <code>auto_update</code> tag, the local version will be auto updated provided that the <code>minimum_auto_update_version</code> version matches.</p>

<p><code>&lt;minimum_auto_update_version&gt;&lt;/minimum_auto_update_version&gt;</code>
Assuming <code>&lt;auto_update&gt;</code> is set to true, this tag designated the minimum required driver version before an update can be applied automatically.  For example: </p>

<p><code>&lt;minimum_auto_update_version&gt;4&lt;/minimum_auto_update_version&gt;</code></p>

<p>The above example indicates that the driver found in the project must be version 4 (at a minimum) in order for the driver to be updated automatically.</p>

<p><code>&lt;minimum_os_version&gt;&lt;/minimum_os_version&gt;</code></p>

<p>Assuming <code>&lt;auto_update&gt;</code> is set to true, this tag designates the minimum required Control4 Operating System before an update can be applied automatically.  For example: </p>

<p><code>&lt;minimum_os_version&gt;2.8.0&lt;/minimum_os_version&gt;</code></p>

<p>The above example indicates that the Control4 operating system being used must be version 2.8.0 (at a minimum) in order for the driver to be updated automatically.</p>

<p><code>&lt;force_auto_update&gt;false&lt;/force_auto_update&gt;</code></p>

<p>The force auto update tag, when set to true, ignores the Enable Driver Update flag set by dealers in ComposerPro <em>see below</em>. It will update on the scheduled time regardless of the setting of the flag.</p>

<p>As mentioned above, the other component to managing driver auto updates is found in ComposerPro&#39;s Manage Drivers/Auto Update screen. The screen is accessed through the ComposerPro toolbar by selecting Driver/ Manage Drivers:</p>

<p><img src="images/14_1-01-9f012389.png"/></p>

<p>Note the addition of the new check box called Enable Driver Update Agent:</p>

<p><img src="images/14_1-02-892c89f0.png"/></p>

<p>When the check box populated, every driver that has <code>&lt;auto_update&gt;true&lt;/auto_update&gt;</code> will be listed here. The check boxes next to the driver’s name are used to keep that specific driver from auto updating even if the <code>auto_update</code> XML tag is set to true. Leaving the Enable Driver Update Agent check box unpopulated will prevent any drivers from auto updating – regardless of XML settings.</p>

<h2 id='updating-released-drivers-driver-update-limitations-and-considerations'>Driver Update Limitations and Considerations</h2>

<p>!Driver developers may occasionally need to make a change to an existing driver to provide additional functionality or correct a defect. When considering this, it is important to be aware of what is and what is not permissible.This will assist with making the best decision regarding whether or not a driver can or should be updated versus a new driver being created and released. </p>

<p>The benefit of updating a driver is that existing users of that driver can use the Driver Update functionality within Composer to get access to and take advantage of the changes made. This is much easier than asking them to remove the old driver, add the new driver, and reconfigure it. With a driver update, all configuration remains intact.</p>

<p><strong>Hardware/Protocol Changes</strong> – If the driver is for a device that is being updated with new hardware and/or a new control protocol, the driver developer should almost always create a new driver with a distinct driver name and filename. This will allow the existing users of the previous hardware/protocol to continue to use the previous driver. New users can install the new version of the driver.</p>

<p><strong>Defect Resolution/New Functionality</strong> – When resolving defects or providing new functionality that is limited to  to Lua code: driver.lua or an included lua library file - an update to the the existing driver is the best practice. Please make sure that you increment the &lt;version&gt; and change the modification date so that users can distinguish between the drivers. You may also want to consider including a changelog in your driver documentation that outlines the changes made.</p>

<p><strong>New Functionality and New Proxy Instances</strong> – If the device, or the system you&#39;re connecting to features new functionality that you want to expose by adding a new &lt;proxy&gt; declaration within the driver, you MUST create a new driver. Each proxy instance declared by the driver causes director to load a corresponding proxy driver when your driver is added to the project. The only time these proxy-protocol drivers are added and dependent internal bindings made is when the driver is added to the project. So, if you create an updated driver with a new proxy instance, and an existing driver is updated to your new version, it will be lacking the dependent proxy driver and internal binding to it. This causes project corruption. The same thing applies to removing a proxy instance or changing the type of proxy used by your driver. If you must make any of those changes, you must create a new driver.</p>

<p>Modeling Changes in <code>&lt;connections&gt;</code> - Generally, it&#39;s not a good idea to change the connections declarations with a driver update. However, if you must do so, you may only add. You should not remove connections, or change the type or definition of your connections in driver.xml. This can cause the project configuration to become broken for that driver when it is update.
 </p>

<p>Other Changes to driver.xml – Consider carefully before making changes to any of the following in driver.xml or in the corresponding DriverWorks Lua interfaces:</p>

<ul>
<li><p>Properties – Generally, the changes you make to properties are safe across driver update. You may add and remove; but be careful about retyping properties.</p></li>
<li><p>Events – Dealers may program custom functionality to be executed with an event is triggered. You won’t want to remove any events (or change the Event ID) or it may cause problems with existing programming.</p></li>
<li><p>Variables – Dealers may evaluate variables or set variable values in custom programming. Adding variables will not cause any problems. Removing variables or renaming, re-typing, or changing ID may cause problems in an updated driver.</p></li>
<li><p>Commands – Dealers use commands to create custom functionality to be executed with an event is triggered. You won&#39;t want to remove any commands or it may cause problems with existing programming.</p></li>
</ul>

<p><strong>Driver Debug Messaging Considerations and LuaJIT</strong>
Beginning with OS 3, the ability to send debug Lua messages upon a driver failing to update has changed. Sending Lua debug messages are determined on how the driver&#39;s properties are set. When a driver is updated from using the previous PUC Lua compiler to LuaJIT, the driver&#39;s state and properties are temporarily lost. This is also true if a driver is updated involves going from LuaJIT to PUC Lua. The state and properties are not restored until the driver has loaded successfully. During this time frame, driver debug messages are not sent. The following are use cases to consider regarding this:</p>

<p><strong>Driver updating from PUC to PUC.</strong>
This is a driver that was initially loaded with PUC and the updated driver likewise loads with PUC. There is no &quot;jit&quot; attribute applied to the driver script. In this case, the same driver instance is reused and the driver will function as it did prior to OS 3.</p>

<p><strong>Driver updating from PUC to LuaJIT:</strong>
This is a driver that was initially loaded with PUC and the updated driver expects to load with LuaJIT. The specified &quot;jit&quot; attribute has been applied to the driver script. In this case, the old driver instance is destroyed and then re-loaded with LuaJIT. In doing so, all of the driver properties that set for this driver are temporarily lost. This results in the following two scenarios:
If the driver loads successfully all of the properties &amp; state data is restored.
If the driver fails to load successfully, the LuaJIT instance is abandoned and then reloaded with PUC Lua. The properties &amp; state data is restored after the driver loads. Debug Lua messaging is  impacted.</p>

<p><strong>Driver updating from LuaJIT to LuaJIT:</strong>
This is a driver that was initially loaded with LuaJIT and the updated driver likewise loads with LuaJIT. The specified &quot;jit&quot; attribute has been applied to the driver script. In this case, an attempt is made to re-use the same driver instance. This results in the following two scenarios:
If the driver loads successfully, then this will function as it did prior to OS 3.
If the driver fails to load, the LuaJIT instance is abandoned and reloaded with PUC. When this happens, all of the properties that are set for the driver are temporarily lost. The properties &amp; state data is restored after the driver loads. Debug Lua messaging is impacted.</p>
<h1 id='composerpro-the-interface-into-the-sdk'>ComposerPro: The Interface into the SDK</h1>

<h2 id='composerpro-the-interface-into-the-sdk-properties'>Properties</h2>

<p>DriverWorks Properties are defined in the .c4z file and exposed in the Composer System Design interface on the Properties tab. Below is table of currently supported properties. The code examples for each are to the right. </p>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>List</strong></td>
<td>Provides a list of selectable objects.</td>
</tr>
<tr>
<td><strong>Ranged Float</strong></td>
<td>Provides a range of selectable floating-point or non-integer numbers.</td>
</tr>
<tr>
<td><strong>Ranged Integer</strong></td>
<td>Provides a range of selectable integers.</td>
</tr>
<tr>
<td><strong>String</strong></td>
<td>Provides a read only string.</td>
</tr>
<tr>
<td><strong>String Password</strong></td>
<td>Provides a string which can be used as a password.</td>
</tr>
<tr>
<td><strong>Device Selector</strong></td>
<td>Provides a list of selectable drivers. See the Device Selector topic for more information.</td>
</tr>
<tr>
<td><strong>Color Selector</strong></td>
<td>Provides the ability to select a color. See the Color Selector topic for more information.</td>
</tr>
<tr>
<td><strong>Dynamic List</strong></td>
<td>Provides driver-based, dynamically updated lists. See the Dynamic List topic for more information.</td>
</tr>
<tr>
<td><strong>Link</strong></td>
<td>Provides a link to a resource which can be used to support your driver.</td>
</tr>
</tbody></table>

<div class="highlight"><pre class="highlight xml tab-xml"><code>List Property Example
<span class="nt">&lt;property&gt;</span>
       <span class="nt">&lt;name&gt;</span>Log Level<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>LIST<span class="nt">&lt;/type&gt;</span>
          <span class="nt">&lt;readonly&gt;</span>false<span class="nt">&lt;/readonly&gt;</span>
          <span class="nt">&lt;default&gt;</span>2 - Warning<span class="nt">&lt;/default&gt;</span>
             <span class="nt">&lt;items&gt;</span>
               <span class="nt">&lt;item&gt;</span>0 - Fatal<span class="nt">&lt;/item&gt;</span>
               <span class="nt">&lt;item&gt;</span>1 - Error<span class="nt">&lt;/item&gt;</span>
               <span class="nt">&lt;item&gt;</span>2 - Warning<span class="nt">&lt;/item&gt;</span>
               <span class="nt">&lt;item&gt;</span>3 - Info<span class="nt">&lt;/item&gt;</span>
               <span class="nt">&lt;item&gt;</span>4 - Debug<span class="nt">&lt;/item&gt;</span>
               <span class="nt">&lt;item&gt;</span>5 - Trace<span class="nt">&lt;/item&gt;</span>
            <span class="nt">&lt;/items&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code>Ranged Float Property Example
<span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>My Float<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>RANGED_FLOAT<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;minimum&gt;</span>5.0<span class="nt">&lt;/minimum&gt;</span>
        <span class="nt">&lt;maximum&gt;</span>50.0<span class="nt">&lt;/maximum&gt;</span>
        <span class="nt">&lt;default&gt;</span>10.0<span class="nt">&lt;/default&gt;</span>
        <span class="nt">&lt;readonly&gt;</span>false<span class="nt">&lt;/readonly&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code>Ranged Integer Property Example
<span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>Zone<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;type&gt;</span>RANGED_INTEGER<span class="nt">&lt;/type&gt;</span>
     <span class="nt">&lt;minimum&gt;</span>1<span class="nt">&lt;/minimum&gt;</span>
     <span class="nt">&lt;maximum&gt;</span>8<span class="nt">&lt;/maximum&gt;</span>
     <span class="nt">&lt;default&gt;</span>1<span class="nt">&lt;/default&gt;</span>
     <span class="nt">&lt;readonly&gt;</span>false<span class="nt">&lt;/readonly&gt;</span>
     <span class="nt">&lt;tooltip&gt;</span>Zone number of the thermostat.<span class="nt">&lt;/tooltip&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code>String Property Example
<span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>Test Read Only<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
   <span class="nt">&lt;readonly&gt;</span>true<span class="nt">&lt;/readonly&gt;</span>
   <span class="nt">&lt;tooltip&gt;</span>Property to test Read Only Property Tooltip<span class="nt">&lt;/tooltip&gt;</span>
   <span class="nt">&lt;description&gt;</span>This is a test description.<span class="nt">&lt;/description&gt;</span>
   <span class="nt">&lt;default&gt;</span>ReadOnly<span class="nt">&lt;/default&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code>String Paswword Property Example
<span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>Test STRING password<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;password&gt;</span>true<span class="nt">&lt;/password&gt;</span>
  <span class="nt">&lt;default&gt;</span>password<span class="nt">&lt;/default&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code>Device Selector Property Example
<span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>AssociatedDevice<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;type&gt;</span>DEVICE_SELECTOR<span class="nt">&lt;/type&gt;</span>_
   <span class="nt">&lt;items&gt;</span>
       <span class="nt">&lt;item&gt;</span>control4_network_mediastorage.c4i<span class="nt">&lt;/item&gt;</span>
     <span class="nt">&lt;/items&gt;</span>
     <span class="nt">&lt;multiselect&gt;</span>false<span class="nt">&lt;/multiselect&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code>Color Selector Property
<span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>Test Color Selector<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;type&gt;</span>COLOR_SELECTOR<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;default&gt;</span>255,0,0<span class="nt">&lt;/default&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight xml tab-xml"><code>Dynamic List Property Example
<span class="nt">&lt;property&gt;</span> 
   <span class="nt">&lt;name&gt;</span>Test Dynamic List No Default<span class="nt">&lt;/name&gt;</span> 
    <span class="nt">&lt;type&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/type&gt;</span> 
    <span class="nt">&lt;readonly&gt;</span>false<span class="nt">&lt;/readonly&gt;</span> 
    <span class="nt">&lt;tooltip&gt;</span>DYNAMIC_LIST No Default Property Tooltip<span class="nt">&lt;/tooltip&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><div class="highlight"><pre class="highlight html tab-html"><code>Link Property Example
<span class="nt">&lt;property&gt;</span>
   <span class="nt">&lt;name&gt;</span>Test Link<span class="nt">&lt;/name&gt;</span>
   <span class="nt">&lt;type&gt;</span>LINK<span class="nt">&lt;/type&gt;</span>
   <span class="nt">&lt;tooltip&gt;</span>Property to test Link Property Tooltip<span class="nt">&lt;/tooltip&gt;</span>
   <span class="nt">&lt;default&gt;</span>http://www.control4.com<span class="nt">&lt;/default&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div><h3 id='composerpro-the-interface-into-the-sdk-properties-usage-note-regarding-the-ranged-float-property'>Usage Note Regarding the Ranged Float Property</h3>
<p>Note that the local setting of a Control4 Controller in a project, and the local setting assigned to devices found within that project can potentially have an impact of the way in which a RANGED FLOAT property is handled by a driver. For example, if the controller has a local setting which uses the English language, the RANGED FLOAT property will be defined as in the example to the right (using a decimal).  However, if the local setting is that which supports another language - such as French for example, the minimum, maximum and default values will come in using a comma instead of a decimal point. For example, 50.0 will be received as 50,0. In the event that project controllers and project devices cannot be set to the same local, resulting in the same language, a driver will need to be able to handle the differing value definitions. </p>
<h3 id='composerpro-the-interface-into-the-sdk-properties-usage-note-regarding-the-password-property'>Usage Note Regarding the Password Property</h3>
<p>The Password property type prevents the text of a password from being displayed. It will show asterisks <code>*</code> in place of any text that is part of the property.  It is important to note that the data of the password field is NOT protected in any way. For example, if the properties table from the driver were to be printed, it will show the actual password. If the password field is used by a driver Control4 strongly recommends that the driver be encrypted.</p>
<h3 id='composerpro-the-interface-into-the-sdk-properties-using-tooltips-and-descriptions-in-properties'>Using tooltips and Descriptions in Properties</h3>
<p>All properties can have initial/default values and may be changed by the installer or configured as read-only.</p>

<p>Properties have the ability to have two parameters. These include &lt;tooltip&gt; and &lt;description&gt;.</p>

<p>The &lt;tooltip&gt; parameter provides the means to display a brief description of the parameter when the user hovers over it with their mouse. </p>

<p>For example:</p>

<p><img src="images/15_1-01-3a3226cb.png"/></p>

<p>The <code>&lt;description&gt;</code> parameter contains text that can be displayed in the description field to provide additional information about the property.</p>

<p>For example:</p>

<p><img src="images/15_1-02-3e74bd17.png"/></p>

<p>In the Tooltip/Description Example to the right, the two parameters are passed to the string property named TEST READ ONLY.</p>
<div class="highlight"><pre class="highlight xml tab-xml"><code>Tooltip/Description Example

<span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>Test Read Only<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
     <span class="nt">&lt;readonly&gt;</span>true<span class="nt">&lt;/readonly&gt;</span>
     <span class="nt">&lt;tooltip&gt;</span>Property to test Read Only Property Tooltip<span class="nt">&lt;/tooltip&gt;</span>
     <span class="nt">&lt;description&gt;</span>This is a test description.<span class="nt">&lt;/description&gt;</span>
     <span class="nt">&lt;default&gt;</span>ReadOnly<span class="nt">&lt;/default&gt;</span>
 <span class="nt">&lt;/property&gt;</span>
</code></pre></div>

<p><img src="images/15_1-03-cd1b9383.png"/></p>

<h2 id='composerpro-the-interface-into-the-sdk-dynamic-list-properties'>Dynamic List Properties</h2>

<p>The ability to provide driver-based, dynamically updated lists in ComposerPro’s Advanced Properties screen has been included in DriverWorks. When this feature is included in a driver’s properties section, the Properties tab in ComposerPro will display a list of items and (optionally) a default item for the list can be displayed. </p>

<p>The following sample property code uses the new property called <code>DYNAMIC_LIST</code>.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>Test Dynamic List<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;type&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;default&gt;</span>Item 5<span class="nt">&lt;/default&gt;</span>
  <span class="nt">&lt;tooltip&gt;</span>DYNAMIC\_LIST Property Tooltip\<span class="nt">&lt;/tooltip&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div>

<p>In the example above, a name for the property is included as “Test Dynamic List”. This is the string value that will be displayed as the name for this list in ComposerPro. Next, you can see the property type of <code>DYNAMIC_LIST</code>.  Next we can see that the selected parameter has a value of “Item5”. This will result in Item 5 being displayed as the default value (displayed value) when the list is shown in ComposerPro. Finally, the optional tooltip parameter is populated with text that is displayed when the user hovers over the Test Dynamic List field in Composer Pro. The resulting List can be seen as:</p>

<p><img src="images/15_2-01-688597c6.png"/></p>

<p>In the above screen shot, we can see the Test Dynamic List displayed along with its selected value of Item 5. The selected value for the list can be changed from within ComposerPro by selecting the new default value and clicking on the Set button.</p>

<p>The <code>DYNAMIC_LIST</code> property can also be configured to use no default value. An example of the XML for that type of list would be:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;property&gt;</span>
 <span class="nt">&lt;name&gt;</span>Test Dynamic List No Default<span class="nt">&lt;/name&gt;</span>
 <span class="nt">&lt;type&gt;</span>DYNAMIC_LIST<span class="nt">&lt;/type&gt;</span>
 <span class="nt">&lt;readonly&gt;</span>false<span class="nt">&lt;/readonly&gt;</span>
 <span class="nt">&lt;tooltip&gt;</span>DYNAMIC_LIST No Default Property Tooltip<span class="nt">&lt;/tooltip&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div>

<p>The ComposerPro Properties Page would look like this:</p>

<p><img src="images/15_2-02-81c2b61d.png"/></p>

<p>Note that there is no value displayed by default for the list called “Test Dynamic List No Default”. This is due to the omission of the &lt;default&gt; parameter. </p>

<p>List content is delivered from the driver to ComposerPro by using the new UpdatePropertyList API. The API may be called within OnDriverInit. For example:</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">OnDriverInit</span><span class="p">()</span>
  <span class="n">C4</span><span class="p">:</span><span class="n">UpdatePropertyList</span><span class="p">(</span><span class="s2">"Test Dynamic List"</span><span class="p">,</span><span class="s2">"Item 4,Item 5,Item 6"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>

<p>The example above includes the three items used the “Test Dynamic List” example above.</p>

<p>Here is an example of the API used to populate the items in the second example or the  &quot;Test Dynamic List No Default&quot;:</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">OnDriverInit</span><span class="p">()</span>
  <span class="n">C4</span><span class="p">:</span><span class="n">UpdatePropertyList</span><span class="p">(</span><span class="s2">"Test Dynamic List No Default"</span><span class="p">,</span><span class="s2">"Item 7,Item 8,Item 9"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>

<p>When a user selects an item from the a list’s LOV, OnPropertyChanged is called with the information for the selected item. </p>

<p>It is important to understand that that Dynamic List items are NOT persisted. The protocol driver must handle rebuilding the list during initialization. This is very different behavior than most other properties.</p>

<p>A sample driver that utilizes Dynamic List Properties is included in the SDK. The driver demonstrates the ability to generate Dynamic Lists based on driver code to support a proxy-less device. The Lists that are generated can subsequently be configured and used in the ComposerPro environment and, through Programming, convey useful information throughout devices running Navigator. Specifically, Dynamic Lists are demonstrated in Properties, Actions and Device Specific Commands.</p>

<p>The driver: <code>dynamic_list_widget.c4z</code> can be found in the Samples directory of the SDK in the Dynamic List Properties folder.</p>

<h2 id='composerpro-the-interface-into-the-sdk-advanced-properties'>Advanced Properties</h2>

<p><strong>LABEL</strong>
Prior to OS Release 2.10.0, the only way to create a separator or section between properties in the driver was to use a STRING type property and mark it read only. Now, with the inclusion of the XML example to the right, a much cleaner header can be created:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;config&gt;</span>
  <span class="nt">&lt;properties&gt;</span>
   <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>Header<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;type&gt;</span>LABEL<span class="nt">&lt;/type&gt;</span>
   <span class="nt">&lt;default&gt;</span>New Header<span class="nt">&lt;/default&gt;</span>
  <span class="nt">&lt;/property&gt;</span>
 <span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div>

<p>An example of the new Header are on the Properties screen in ComposerPro:</p>

<p><img src="images/15_3-01-b04197b7.png"/></p>

<p>Note that this PropertyType could also be used to make a blank space by omitting the &lt;default&gt;&lt;/default&gt; element.</p>

<p><strong>Scroll</strong></p>

<p>Prior to OS Release 2.10.0, the only way to set an integer value on a scale was to have a <code>RANGED_INTEGER</code> type property. Now, with the inclusion of the XML to the right, a more graphical view can be provided.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;config&gt;</span>
  <span class="nt">&lt;properties&gt;</span>
   <span class="nt">&lt;property&gt;</span>
    <span class="nt">&lt;name&gt;</span>New Scroll Control<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;type&gt;</span>SCROLL<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;minimum&gt;</span>0<span class="nt">&lt;/minimum&gt;</span>
    <span class="nt">&lt;maximum&gt;</span>60<span class="nt">&lt;/maximum&gt;</span>
    <span class="nt">&lt;default&gt;</span>0<span class="nt">&lt;/default&gt;</span>
   <span class="nt">&lt;/property&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div>

<p>An example of the new Scroll Property Type on the Properties screen is shown above,</p>

<p><strong>TRACK</strong></p>

<p>A second option is available for setting an integer value which is similar to Scroll. Track is more of a discrete slider control. The XML for Track is also to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;config&gt;</span>
   <span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;property&gt;</span>
     <span class="nt">&lt;name&gt;</span>New Scroll Control<span class="nt">&lt;/name&gt;</span>
     <span class="nt">&lt;type&gt;</span>TRACK<span class="nt">&lt;/type&gt;</span>
     <span class="nt">&lt;minimum&gt;</span>0<span class="nt">&lt;/minimum&gt;</span>
     <span class="nt">&lt;maximum&gt;</span>10<span class="nt">&lt;/maximum&gt;</span>
     <span class="nt">&lt;default&gt;</span>0<span class="nt">&lt;/default&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
   <span class="nt">&lt;/properties&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div>

<p>An example of the new Scroll Property Track on the Properties screen is shown above</p>

<h2 id='composerpro-the-interface-into-the-sdk-using-the-device-selector-property'>Using the DEVICE SELECTOR Property</h2>

<p>Device Selector is a property that can be added to a DriverWorks driver. Device Selector allows you (as the driver developer) to display a list of devices that may be associated with the driver you have developed. These devices can then be selected from within composer. The selected devices are then “bound” to the driver.
As stated above, Device Selector is added to the properties section of your driver. The example to the right contains an entry that associated a network storage device to the driver:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>AssociatedDevice<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;type&gt;</span>DEVICE_SELECTOR<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;items&gt;</span>
          <span class="nt">&lt;item&gt;</span>control4_network_mediastorage.c4i<span class="nt">&lt;/item&gt;</span>
        <span class="nt">&lt;/items&gt;</span>
        <span class="nt">&lt;multiselect&gt;</span>false<span class="nt">&lt;/multiselect&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
</code></pre></div>

<p>The device selector property can be named anything you like. In the example above it is named “Associated Device”.</p>

<p>The property type must be: <code>DEVICE_SELECTOR</code></p>

<p>In the items section enter the devices as they display in Composer. Acceptable items are permitted c4i names for either proxy or protocols.</p>

<p>The multi-select element controls whether multiple devices can be selected from within Composer. True supports the selection of all of the devices in the items section. False allows for the selection of one.</p>

<p>Once the driver has been modified and saved into the project, “Associated Device” will now be displayed under the Properties tab in Composer. Clicking on the Select button will display all of the devices listed under the items section of the Device Selector property. If the multi-select element has a value of True, all of the devices in the items section will be displayed in the tree with check boxes next to them. The installer can select as many of the items as desired. If multi-select has a value of false only one of the devices in the items section can be chosen. Clicking on the Set button will bind the driver to the selected devices.</p>

<h3 id='composerpro-the-interface-into-the-sdk-using-the-device-selector-property-device-selector-in-lua'>Device Selector in Lua</h3>

<p>The selected devices are also presented as a comma delimited string of device ids under the Lua tab. For example:</p>

<p><code>devs = Properties[&quot;Test Selector&quot;]</code></p>

<p><code>print(&quot;Selected devices: &quot; .. devs)</code></p>

<p>Returns the following:</p>

<p><code>Selected devices: 13,16,18,20,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,64,66,68,72,74,76,78,80</code></p>

<h2 id='composerpro-the-interface-into-the-sdk-using-the-custom-select-property'>Using the CUSTOM SELECT Property</h2>

<p>The ability of a Proxy driver to deliver a browse-able list of related elements can be supported through the use of the <code>CUSTOM_SELECT</code> property. These lists could represent stations, channels or actual media. The elements delivered in the list can then be used as parameter in a command.</p>

<p>Initially, a command needs to be created in the <code>&lt;devicedata&gt;&lt;config&gt;</code> section of the c4z driver.xml file. For example, here is a command called SelectChannel:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;devicedata&gt;</span>
 <span class="nt">&lt;config&gt;</span>
   <span class="nt">&lt;commands&gt;</span>
    <span class="nt">&lt;command&gt;</span>
      <span class="nt">&lt;name&gt;</span>SelectChannel<span class="nt">&lt;/name&gt;</span>
      <span class="nt">&lt;description&gt;</span>Select channel PARAM1<span class="nt">&lt;/description&gt;</span> 
        <span class="nt">&lt;params&gt;</span> 
          <span class="nt">&lt;param&gt;</span>
            <span class="nt">&lt;name&gt;</span>Channel<span class="nt">&lt;/name&gt;</span> 
            <span class="nt">&lt;type&gt;</span>CUSTOM_SELECT:SelectChannelParamSelect<span class="nt">&lt;/type&gt;</span> 
          <span class="nt">&lt;/param&gt;</span>
        <span class="nt">&lt;/params&gt;</span>
    <span class="nt">&lt;/command&gt;</span>
   <span class="nt">&lt;/commands&gt;</span>
  <span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/devicedata&gt;</span>
</code></pre></div>

<p>In the SelectChannel example above, SelectChannel is the command name that is sent to the ExecuteCommand function in the driver. The param type <code>CUSTOM_SELECT</code> allows for the specification of a global .lua function that will be invoked whenever ComposerPro wants to get data. In the example to the right, it is the function SelectChannelParamSelect.</p>

<p>The command description can also contain variables enclosed in {{ and }}, and the name refers to the param name.
Note, that this variable substitution currently only works with params of type <code>CUSTOM_SELECT.</code></p>

<p>Next, the newly created .lua function needs to be implemented. The simplest implementation just returns a list of strings:</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">SelectChannelParamSelect</span><span class="p">(</span><span class="n">currentValue</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span>
   <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span> <span class="k">do</span>
      <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="s2">"Channel "</span> <span class="o">..</span> <span class="n">i</span><span class="p">)</span>
   <span class="k">end</span>
   <span class="k">return</span> <span class="n">list</span>
<span class="k">end</span>
</code></pre></div>

<p>It is possible to return human-readable text, while keeping internal values hidden (e.g. to display a station’s name rather than its station id). Keep in mind that these values must be of type string:</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">SelectChannelParamSelect</span><span class="p">(</span><span class="n">currentValue</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span>
   <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span> <span class="k">do</span>
      <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Channel "</span> <span class="o">..</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">})</span>
   <span class="k">end</span>
   <span class="k">return</span> <span class="n">list</span>
<span class="k">end</span>
</code></pre></div>

<p>You can also create a browsing experience with folders. Note, that the function can return an arbitrary string value as second return value. If this occurs a “Back” link with that value will be displayed. The first example to the right also allows selecting the “Most Popular” folder. By default folders are not selectable.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="k">function</span> <span class="nf">SelectChannelParamSelect</span><span class="p">(</span><span class="n">currentValue</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">back</span> <span class="o">=</span> <span class="kc">nil</span>
   <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span>
   <span class="k">if</span> <span class="p">(</span><span class="nb">string.sub</span><span class="p">(</span><span class="n">currentValue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"popular"</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root menu</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span> <span class="k">do</span>
         <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Channel #"</span> <span class="o">..</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"popular"</span> <span class="o">..</span> <span class="n">i</span> <span class="p">})</span>
      <span class="k">end</span>
   <span class="k">elseif</span> <span class="p">(</span><span class="nb">string.sub</span><span class="p">(</span><span class="n">currentValue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"playlists"</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root menu</span>
      <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Mine"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"myplaylists"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="k">do</span>
         <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Playlist "</span> <span class="o">..</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"playlists"</span> <span class="o">..</span> <span class="n">i</span> <span class="p">})</span>
      <span class="k">end</span>
   <span class="k">elseif</span> <span class="p">(</span><span class="nb">string.sub</span><span class="p">(</span><span class="n">currentValue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"myplaylists"</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">back</span> <span class="o">=</span> <span class="s2">"playlists"</span> <span class="c1">-- Back to the Playlists</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="k">do</span>
         <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"My playlist "</span> <span class="o">..</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"myplaylists"</span> <span class="o">..</span> <span class="n">i</span> <span class="p">})</span>
      <span class="k">end</span>
   <span class="k">elseif</span> <span class="p">(</span><span class="nb">string.sub</span><span class="p">(</span><span class="n">currentValue</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"favorites"</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">back</span> <span class="o">=</span> <span class="s2">""</span> <span class="c1">-- Back to the root menu</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
         <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Favorite "</span> <span class="o">..</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"favorites"</span> <span class="o">..</span> <span class="n">i</span> <span class="p">})</span>
      <span class="k">end</span>
   <span class="k">else</span>
      <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Playlists"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"playlists"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
      <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Favorites"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"favorites"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
      <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Most popular"</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"popular"</span><span class="p">,</span> <span class="n">folder</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
      <span class="n">selectable</span> <span class="o">=</span> <span class="kc">true</span> <span class="p">})</span>
      <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="k">do</span>
         <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Channel "</span> <span class="o">..</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="s2">"channel"</span> <span class="o">..</span> <span class="n">i</span> <span class="p">})</span>
      <span class="k">end</span>
   <span class="k">end</span>

   <span class="k">return</span> <span class="n">list</span><span class="p">,</span> <span class="n">back</span>
<span class="k">end</span>
</code></pre></div>

<p>You can also defer returning the list. This may be useful if you are waiting for the completion of a web service call or waiting for data from a device to return. The function you’re implementing (SelectChannel) is receiving a function pointer as a second argument, which can be saved off and can be called to return the list at a later time. This function either takes the list and back value, or just a string if ComposerPro should display an error message.</p>

<p>In order to defer returning data, you would not return anything from the function, but then when you have the data, call the provided function. Note that if you fail to call this provided function, and also don’t return anything from your function, then Composer will display an error message. Also, you may only call this function once. See the second example to the right.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">g_tickets</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nf">ReceivedAsync</span><span class="p">(</span><span class="n">ticketId</span><span class="p">,</span> <span class="n">strData</span><span class="p">,</span> <span class="n">responseCode</span><span class="p">,</span> <span class="n">tHeaders</span><span class="p">,</span> <span class="n">strError</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">ticket</span> <span class="o">=</span> <span class="n">g_tickets</span><span class="p">[</span><span class="n">ticketId</span><span class="p">]</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ticket</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">g_tickets</span><span class="p">[</span><span class="n">ticketId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">strError</span> <span class="o">~=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span>
         <span class="c1">-- Display the error</span>
         <span class="n">ticket</span><span class="p">.</span><span class="n">returnData</span><span class="p">(</span><span class="s2">"Web Service Error: "</span> <span class="o">..</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">strError</span><span class="p">))</span>
      <span class="k">else</span>
         <span class="c1">-- Parse the response and return a list</span>
         <span class="kd">local</span> <span class="n">back</span> <span class="o">=</span> <span class="kc">nil</span>
         <span class="kd">local</span> <span class="n">list</span> <span class="o">=</span> <span class="p">{}</span>
         <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span> <span class="k">do</span>
            <span class="nb">table.insert</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="p">{</span> <span class="n">text</span> <span class="o">=</span> <span class="s2">"Data "</span> <span class="o">..</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="nb">tostring</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">})</span>
         <span class="k">end</span>
         <span class="n">ticket</span><span class="p">.</span><span class="n">returnData</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">back</span><span class="p">)</span>
      <span class="k">end</span>
   <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">SelectChannelParamSelect</span><span class="p">(</span><span class="n">currentValue</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span>
<span class="err">  </span><span class="kd">local</span> <span class="n">ticketId</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">urlGet</span><span class="p">(</span><span class="s2">"http://www.example.com"</span><span class="p">)</span>

<span class="n">g_tickets</span><span class="p">[</span><span class="n">ticketId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">returnData</span> <span class="o">=</span> <span class="n">done</span> <span class="p">}</span>

<span class="err">  </span><span class="c1">-- Do not return anything here, we're calling the done function when we have data</span>
<span class="k">end</span>
</code></pre></div>

<h2 id='composerpro-the-interface-into-the-sdk-using-the-color-selector-property'>Using the COLOR SELECTOR Property</h2>

<p>The ability to assign a color to interface elements through a device driver is possible with the use of a DriverWorks Property Type called <code>COLOR_SELECTOR</code>. This property has most often been used for backlight purposes on thermostats or LED lights on Thermostat drivers but it’s applicable to any driver supporting color based interfaces. A prototype of the property looks like this:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;property&gt;</span>
  <span class="nt">&lt;name&gt;</span>Test Color Selector<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;type&gt;</span>COLOR_SELECTOR<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;default&gt;</span>255,0,0<span class="nt">&lt;/default&gt;</span>
<span class="nt">&lt;/property&gt;</span>
</code></pre></div>

<p>The property contains a comma delimited RGB value which the driver receives through the OnPropertyChanged event. OnPropertyChanged is invoked when the user defines a color within the Color Selector and hits the Set button from within Composer Pro.</p>

<p>Note that the property defaults to 255, 0 ,0 which is red. The <code>COLOR_SELECTOR</code> property will accept any comma delimited RGB value as an entry. To change the color used by the property, click on the Test Color Selector block which displays the currently assigned color:</p>

<p><img src="images/15_5-02-441fa427.png"/></p>

<p>Selecting the box will display the color selection palette:</p>

<p><img src="images/15_5-03-fb66e3d6.png"/></p>

<p>The palette provides the ability to select a basic color, assign a color from the spectrum field and save those colors as “Custom Colors” .</p>

<p>After a color has been selected, clicking OK will close the color selection palette screen and populate the<code> COLOR_SELECTOR</code> property in ComposerPro with a Set or Cancel button.</p>

<p>Selecting the Set button will assign the color to the property. A color can also be assigned to the <code>COLOR_SELECTOR </code>property under the Programming/Actions area of ComposerPro. Clicking on Programming will display the following Actions screen.</p>

<p><img src="images/15_5-04-e6ff3283.png"/></p>

<p>The Test <code>COLOR_SELECTOR</code> under Actions works in a similar manner as it does under properties. To assign a color, click on the Test Color Selector block which displays the currently assigned color. Selecting the box will display the color selection palette and a color can be selected as in the previous example. 
This creates an Action with a color assignment that can be used in system programming. For example: “When this button is pressed, set led color to green.”</p>

<h2 id='composerpro-the-interface-into-the-sdk-actions'>ACTIONS</h2>

<p>Use the <code>&lt;actions&gt;</code> section to define programming which is specific to initial installation/configuration of the driver. This is typically functionality which is not required for ongoing driver use.</p>

<p>Actions are defined in the driver&#39;s XML and consist of the following types: STRING, LIST, RANGED INTEGER, RANGED FLOAT and COLOR SELECTOR.</p>

<p>To the right is an example of XML containing Actions with Parameters.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>       <span class="nt">&lt;action&gt;</span>
                <span class="nt">&lt;name&gt;</span>Test Action with Parameters<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;command&gt;</span>TestActionWithParameters<span class="nt">&lt;/command&gt;</span>
                <span class="nt">&lt;params&gt;</span>
                    <span class="nt">&lt;param&gt;</span>
                        <span class="nt">&lt;name&gt;</span>Test STRING password<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
                        <span class="nt">&lt;password&gt;</span>true<span class="nt">&lt;/password&gt;</span>
                    <span class="nt">&lt;/param&gt;</span>
                    <span class="nt">&lt;param&gt;</span>
                        <span class="nt">&lt;name&gt;</span>Test STRING<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;type&gt;</span>STRING<span class="nt">&lt;/type&gt;</span>
                    <span class="nt">&lt;/param&gt;</span>
                    <span class="nt">&lt;param&gt;</span>
                        <span class="nt">&lt;name&gt;</span>Test LIST<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;type&gt;</span>LIST<span class="nt">&lt;/type&gt;</span>
                        <span class="nt">&lt;items&gt;</span>
                            <span class="nt">&lt;item&gt;</span>On<span class="nt">&lt;/item&gt;</span>
                            <span class="nt">&lt;item&gt;</span>Off<span class="nt">&lt;/item&gt;</span>
                        <span class="nt">&lt;/items&gt;</span>
                    <span class="nt">&lt;/param&gt;</span>
                    <span class="nt">&lt;param&gt;</span>
                        <span class="nt">&lt;name&gt;</span>Test RANGED_INTEGER<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;type&gt;</span>RANGED_INTEGER<span class="nt">&lt;/type&gt;</span>
                        <span class="nt">&lt;minimum&gt;</span>79<span class="nt">&lt;/minimum&gt;</span>
                        <span class="nt">&lt;maximum&gt;</span>120<span class="nt">&lt;/maximum&gt;</span>
                    <span class="nt">&lt;/param&gt;</span>
                    <span class="nt">&lt;param&gt;</span>
                        <span class="nt">&lt;name&gt;</span>Test RANGED_FLOAT<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;type&gt;</span>RANGED_FLOAT<span class="nt">&lt;/type&gt;</span>
                        <span class="nt">&lt;minimum&gt;</span>50.5<span class="nt">&lt;/minimum&gt;</span>
                        <span class="nt">&lt;maximum&gt;</span>60.3<span class="nt">&lt;/maximum&gt;</span>
                    <span class="nt">&lt;/param&gt;</span>
                    <span class="nt">&lt;param&gt;</span>
                        <span class="nt">&lt;name&gt;</span>Test COLOR_SELECTOR<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;type&gt;</span>COLOR_SELECTOR<span class="nt">&lt;/type&gt;</span>
                    <span class="nt">&lt;/param&gt;</span>
                <span class="nt">&lt;/params&gt;</span>
       <span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p>When clicking on the Actions tab from within the Properties window in ComposerPro, the option to Test Action with Parameters is presented:</p>

<p><img src="images/15_6-01-66a467c2.png"/></p>

<p>Clicking this button displays all of the driver&#39;s Actions along their parameters. Note that only the default parameter is displayed in this window.</p>

<p><img src="images/15_6-02-270a461f.png"/></p>

<h3 id='composerpro-the-interface-into-the-sdk-actions-sorting-actions-in-composerpro'>Sorting Actions in ComposerPro</h3>

<p>Prior to the release of O.S. 3.3.0, driver writers did not have the ability to order the way driver Actions were displayed in the Programming area of ComposerPro. A new sort order driver element has been delivered that provides the ability to display Actions in any desired order. Sort order can be applied to Actions in the driver.xml with the inclusion of the following xml tag: <code>\&lt;sort\_order\&gt;\&lt;/sort\_order\&gt;</code>. See the lighting code Example 1 from a driver.xml file to the right.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>New_Action<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>New_Action<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>0<span class="nt">&lt;/sort_order&gt;</span>
<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>New_Action_1<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>New_Action1<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>1<span class="nt">&lt;/sort_order&gt;</span>
<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>New_Action_2<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>New_Action2<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>2<span class="nt">&lt;/sort_order&gt;</span>
<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>New_Action_3<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;command&gt;</span>New_Action3<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>3<span class="nt">&lt;/sort_order&gt;</span>
<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>New_Action_4/name&gt;
    <span class="nt">&lt;command&gt;</span>New_Action4<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>4<span class="nt">&lt;/sort_order&gt;</span>
<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;name&gt;</span>New_Action_5/name&gt;
    <span class="nt">&lt;command&gt;</span>New_Action5<span class="nt">&lt;/command&gt;</span>
    <span class="nt">&lt;sort_order&gt;</span>5<span class="nt">&lt;/sort_order&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>

<p><code>&lt;sort_order&gt;&lt;/sort_order&gt;</code></p>

<p>The tag accepts a zero based list and will display the Actions in the order of the number included in each Actions’ <code>&lt;sort_order&gt;&lt;/sort_order&gt;</code>tag.</p>

<p>For example, in the XML code to the right there are five device specific Actions. They will display under the Actions tab in ComposerPro’s Property screen as:</p>

<ul>
<li>New Action</li>
<li>New Action 1</li>
<li>New Action 2</li>
<li>New Action 3</li>
<li>New Action 4</li>
<li>New Action 5</li>
</ul>

<h3 id='composerpro-the-interface-into-the-sdk-actions-considerations-when-sorting-actions'>Considerations when Sorting Actions</h3>

<ul>
<li>Sort Order numbering must be a positive number (including 0). The list is sorted in numerical order.</li>
<li> If a sort order number value is used twice, the second Action using the same value will not be displayed.</li>
<li>When defining Actions that will use the Sort Order element, all of the Actions must include a numeric value. Failing to provide a sort order number for one Action will result in none of the Actions being sorted. For example, if you have ten Actions defined in your driver and one of them is missing the sort order element - none of the Actions will be sorted.</li>
</ul>

<h2 id='composerpro-the-interface-into-the-sdk-lua'>LUA</h2>

<p>All properties can have initial/default values and may be changed by the installer or configured as read-only</p>

<p>The Lua tab contains two windows.  The Lua Command window where Lua commands can be entered and executed.  The results of those commands will be displayed in the Lua Output window.
In the figure below, very simple lines of Lua programming have been entered. The first line is the familiar “Hello World” programming used to introduce all programming languages. The second line combines a text string with a string from the property page (Your Name).</p>

<p><img src="images/15_7-01-0f028aaa.png"/></p>

<p>When this programming is executed, the output of both commands is presented in the Lua Output window.  If there are any programming errors, the error messages will also be displayed in that window.</p>

<p>Because the Lua Command window gives you access to an active interpreter running on the Controller, you can modify any of your Lua programming on the fly. You can re-define functions, correct and improve your programming, and add functionality – all without leaving Composer. </p>

<p>You can navigate through the tabs: Properties, Documentation, Actions etc. without losing information displayed in the Lua Output window.</p>

<p>However,  it is important to understand that the data displayed in the Lua Output window is not saved. <strong>If you navigate away from the device without saving any needed information, you will lose your Lua output.</strong></p>

<h2 id='composerpro-the-interface-into-the-sdk-programming'>PROGRAMMING</h2>

<p><strong>Commands</strong>
The DriverWorks driver’s commands are used in Control4 programming as device specific commands (device actions are combined with proxy actions) in the Actions dialog for the device. They are “do” statements. Examples of commands include:</p>

<ul>
<li>Light: on, off</li>
<li>Security Device: arm, disarm</li>
<li>TV device: turn on, turn off, change channel</li>
</ul>

<p><strong>Variables</strong>
A variable is a representation of information about the controlled device, such as the device’s current power state. Use the variables section to define the system variables that will be available within the Control4 project that your driver is installed into.  These will be available as system variables to use in programming in the same way that variables from any other device are used. </p>

<p><strong>Conditionals</strong>
The use of conditionals in the custom driver is linked with the device variables. It is an ”if” statement. An “if” statement asks a true/false question to the device. Examples of conditionals include:</p>

<ul>
<li>If door is open</li>
<li>If after 5:00 PM</li>
<li>If light is greater than 50%</li>
</ul>

<p>See Driver Based Conditionals for additional information.</p>

<p><strong>Events</strong>
Your driver can trigger events within the Control4 system. Events are used to cause other things to happen within the system using custom programming. They can be considered “when” statements. One of the duties of your driver is to expose all events. Examples of Events include:</p>

<ul>
<li>When the door opens.</li>
<li>When it is 7:00 AM.</li>
<li>When it is sunrise.</li>
</ul>

<p><strong>Note that a limit of 1000 Events per driver exists within the Control4 Operating System. Exceeding this limit results in undesirable handling of Events.</strong></p>

<h3 id='composerpro-the-interface-into-the-sdk-programming-sorting-events-in-composerpro'>Sorting Events in ComposerPro</h3>

<p>Prior to the release of O.S. 3.3.0, driver writers did not have the ability to order the way driver Events were displayed in the Programming area of ComposerPro. A sort order driver provides the ability to display Events in any desired order. Sort order can be applied to Events in the driver.xml with the inclusion of the following xml tag: &lt;sort_order&gt;&lt;/sort_order&gt;. See the lighting code Example 1 from a driver.xml file to the right.</p>

<p>The ability to order the way driver Events are displayed in the Properties area of ComposerPro is possible with the use of a sort order driver XML tag:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>New Description<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>0<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 1<span class="nt">&lt;/name&gt;</span>  
                <span class="nt">&lt;description&gt;</span>Event Description 1<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>1<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 2<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 2<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>2<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 3<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 3<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>3<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 4<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 4<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>4<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
            <span class="nt">&lt;event&gt;</span>
                <span class="nt">&lt;name&gt;</span>New Event 5<span class="nt">&lt;/name&gt;</span>
                <span class="nt">&lt;description&gt;</span>Event Description 10<span class="nt">&lt;/description&gt;</span>
                <span class="nt">&lt;sort_order&gt;</span>5<span class="nt">&lt;/sort_order&gt;</span>
            <span class="nt">&lt;/event&gt;</span>
</code></pre></div>

<p><code>&lt;sort_order&gt;&lt;/sort_order&gt;</code> </p>

<p>The tag accepts a zero based list and will display the Events in the order of the number included in each of the Events’ <code>&lt;sort_order&gt;&lt;/sort_order&gt;</code>tag.</p>

<p>For example, in the XML code to the right there are five device specific Events. They will display in ComposerPro Programming as:</p>

<ul>
<li>New Event</li>
<li>New Event 1</li>
<li>New Event 2</li>
<li>New Event 3</li>
<li>New Event 4</li>
<li>New Event 5</li>
</ul>
<h1 id='director'>Director</h1>

<h2 id='director-director-and-geo-location-services'>Director and Geo Location Services</h2>

<p>Director maintains two different values for location. The first is the project location which is set by the dealer. This value is maintained by the project and is stored in the project database. </p>

<p>The second is the geo location. This value is retrieved from web services. </p>

<p>Why does Director now need to manage two different values for location? Historically, Director has always stored the project location. The project location value is used for such things as computing sunrise/sunset times and determining the radio power level for ZigBee devices. However, inadequacies arise when trying to use the project location value to determine radio power levels, particularly for WiFi levels. These inadequacies are largely due to new regulations. These regulations require that the location be determined with a high degree of certainty. As such, Director can no longer rely on the project location value because a dealer may inadvertently set the wrong location or purposefully enter inaccurate location information. </p>

<p>In order to comply with regulations, Control4 has implemented a new service that returns the geo location in conjunction with O.S. 3.2.0. This location is retrieved from a webservice and is based on the IP address. This webservice returns the country code and name, and does so with a high degree of certainty. Please see the <a href="https://snap-one.github.io/docs-driverworks-api/#geolocation-interface">GetGeoSettings API</a> for more information.</p>

<p>After Director has loaded the project and finished initializing drivers, it schedules an initial call to the geo location webservice. It does this by setting a timer. The interval for this timer is maintained by the following Director configuration setting: <code>geo-initial-interval-seconds</code></p>

<p>This configuration setting specifies the number of seconds that Director should wait before making the initial call to the geo location webservice. The default value is 5 seconds.</p>

<p>When the timer fires Director invokes the geo location webservice. The endpoint for this webservice is retrieved from the registry using the following key: <code>geolocation.service_url</code></p>

<p>The default URL for the geo location webservice (stored in the registry) is as follows:</p>

<p><code>https://apiz.control4.com/cs/geolocation/v1/location</code></p>

<p>On success, Director retrieves the country code and name from the response and stores them. Regardless of success or failure, Director then schedules another call to the geo location webservice. It does this by setting a timer. The interval for this timer is maintained by the following Director configuration setting: <code>geo-interval-minutes</code></p>

<p>This configuration setting specifies the number of minutes until the next call to the geo location webservice. The default value is 60 minutes resulting in Director invoking the geo location webservice every hour, by default.</p>
<h1 id='system-manager-logging'>System Manager Logging</h1>

<h2 id='system-manager-logging-introduction'>Introduction</h2>

<p>Beginning with OS system 2.6.0, the System Manager (sysman) utility has been enhanced with a logging interface. This interface has been delivered as a replacement for the previously supported c4log utility. The sysman log interface represents an enhancement to the previous supported system logging process. Some improvements include:</p>

<ul>
<li><p>Deprecation of the c4log script. This has been replaced with enhanced logging control commands executed from within System Manager.</p></li>
<li><p>Unified the existing logging levels and their messaging to provide consistency across logging output.</p></li>
<li><p>Increased the number of logging utilities to deliver a more granular view of log content.</p></li>
<li><p>Increased the number of logging utilities including independent, targeted logs and increased log level control to reduce the amount of times Director logs roll over.</p></li>
<li><p>Added advanced logging features such as named loggers and appenders. This provides the ability to direct logs to other directory and network locations. This will prevent the loss of information which previously occurred due to system re-boots.</p></li>
<li><p>Added a new log level: TRACE. This level logs an even greater level of detail than DEBUG. This should be used sparingly during the active investigation of an issue.</p></li>
<li><p>Default functionality now sets Log levels to INFO rather than DEBUG unless tracking down an issue. This is only applicable in  versions. Release version logging defaults to DEBUG.</p></li>
<li><p>Default functionality now sets logging to be enabled in a release version capturing FATAL and ERROR conditions.</p></li>
<li><p>The ComposerPro System Manager UI has been enhanced to support the logging interface. Logs can be viewed and filtered and log levels assigned through System Manager.</p></li>
</ul>

<p>The purpose of this section is to provide instruction on how to use the sysman logging platform to:</p>

<ul>
<li><p>Connect to a controller from the System Manager Logging UI</p></li>
<li><p>Review active Loggers within the UI</p></li>
<li><p>Filter the results displayed in the UI</p></li>
<li><p>Assign a logging level to an active Logger from within the UI</p></li>
<li><p>View Log File content and Log File locations</p></li>
</ul>

<p>The Advanced Logging Capabilities section provides command line instructions on how to accomplish all of the above as well as information on how to assign Log Appenders.</p>

<h2 id='system-manager-logging-system-manager-logging-ui'>System Manager Logging UI</h2>

<p><strong>Accessing the UI</strong></p>

<p>The System Manager Program can also be run independently from Composer Pro by double clicking the sysman.exe included with the operating system installation.</p>

<p><img src="images/16_2-01-23bfd869.png"/></p>

<p>Once Sysman is open, locate the controller from the Device list and connect to it. Next, click on the Logging tab to display the Sysman Logging UI:</p>

<p><img src="images/16_2-02-b739339d.png"/></p>

<p>The view shown below is the default view for Logging. The view includes all of the program level loggers running, the logging level they are currently using to capture log data and the destination where the log file resides.</p>

<p><img src="images/16_2-03-716b447f.png"/></p>

<h2 id='system-manager-logging-sorting-and-filtering-the-log-view'>Sorting and Filtering the Log View</h2>

<p><strong>Sorting the Log View</strong>
The Log view can be sorted alphabetically by clicking within the column header area. Doing so will arrange the log information for that column (along with its associated data found in the other columns) alphabetically. The arrow displayed in the header indicates if the display is sorted alphabetically from top to bottom or bottom to top.</p>

<p><img src="images/16_3-01-6f1336e5.png"/></p>

<p>The Log view can be sorted alphabetically by clicking within the column header area. Doing so will arrange the log information for that column (along with its associated data found in the other columns) alphabetically. The arrow displayed in the header indicates if the display is sorted alphabetically from top to bottom or bottom to top.</p>

<p><strong>Filtering Log Information</strong>
Filters are provided for all of columns displayed in the Log View except for the Name and Destination columns. Filters are useful as they allow you to display only the logging information you desire.</p>

<p>By default, the Type column has a filter associated with it when the logging view is first accessed. You can tell that a column is filtered by the display of the filter icon:</p>

<p><img src="images/16_3-02-bdb85643.png"/></p>

<p>Using the Filter icon in the Type column can display all of the active loggers. This includes the Named loggers and the Syslog loggers. </p>

<p><img src="images/16_3-03-db23077b.png"/></p>

<p>Right clicking within the Type column header will display the Filtering menu item. Clicking on it will display all of the available items found under the Log Type category. In our example above, we have selected all of the log types to show in our Logging display. Clicking on the Apply button will change our Logging UI to show all log types:</p>

<p><img src="images/16_3-04-c2bad323.png"/></p>

<p>To add a filter to a column, simply right click on the column header and select the Filtering menu option:</p>

<p><img src="images/16_3-05-faeeaac8.png"/></p>

<p>In the example above, we’re creating a filter for the status column. After the Filtering menu item is selected, all of the available statuses are displayed. Populating a checkbox, or checkboxes will dictate what information is shown in the UI. Clicking the Apply button will change our Logging view to this:</p>

<p><img src="images/16_3-06-20215082.png"/></p>

<p>Because we chose the “set” item to filter our view on, the Logging screen only displays loggers with a status of set. Note the Filter icon is also now displayed in the Status column header.</p>

<h2 id='system-manager-logging-supported-log-types'>Supported Log Types</h2>

<p>Program – These are the logs of primary interest. Each of the named logs is associated with a major area of the Control4 system architecture.</p>

<p>Named – These logs are used by specific functional areas of the Control4 system. Each named logger rolls up to the root level of one of the program loggers and, if not specifically configured to behave differently, the logs for the named logger are always shown in the Program log of the root logger.</p>

<p>Syslog – The default Linux system logging is used by a couple of the Control4 systems processes. </p>

<h2 id='system-manager-logging-changing-log-levels'>Changing Log Levels</h2>

<p>Log levels can be changed from within the Sysman Logging UI. Doubling click within the cell that contains the logging level you wish to change. This will display a list of all available logging levels, simply select the desired level and the log setting is now changed.</p>

<p><img src="images/16_5-01-38974b64.png"/></p>

<h2 id='system-manager-logging-viewing-log-file-data'>Viewing Log File Data</h2>

<p>Log file content can be viewed by highlighting a logger from the view and clicking on the Open Log button in the upper right hand corner of the Logging screen:</p>

<p><img src="images/16_7-01-e9e894eb.png"/></p>

<p>By default, the log file content will be displayed in Notepad.</p>

<p>Viewing Log File Destinations
The location of a log file can be viewed by highlighting a logger from the view and clicking on the View Destination button in the upper right hand corner of the Logging screen:</p>

<p><img src="images/16_7-02-aaf64e2d.png"/></p>

<p>The location of the log file is displayed in Windows Explorer.</p>

<h2 id='system-manager-logging-adding-a-log-appender-column'>Adding a Log Appender Column</h2>

<p>By default, the Log Appender column is not displayed on the Sysman Logging UI. This column can be added by right clicking on any of the column headers. Populate the Appender checkbox from the list of columns at the bottom of the menu:</p>

<p><img src="images/16_8-01-840f2a3d.png"/></p>

<p>The Appender column will be added to the view:</p>

<p><img src="images/16_8-02-174f79a2.png"/></p>

<p>For more information on using Log Appenders, please see the “Targeting Log Directories” section in the Advanced Logging Capabilities portion of this document.</p>

<h2 id='system-manager-logging-advanced-logging-capabilities'>Advanced Logging Capabilities</h2>

<p><strong>Determining the Status of a Log File</strong>
Using the sysman logging interface you can ascertain the status of a log file using the first example to the right:</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="o">/</span><span class="err">#</span> <span class="nx">sysman</span> <span class="nx">log</span> <span class="nx">director</span>
<span class="nx">lighttpd</span> <span class="nx">syslog</span> <span class="nx">err</span> <span class="nx">enabled</span> <span class="nx">file</span> <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">director</span><span class="p">.</span><span class="nx">log</span>
<span class="nx">OK</span>
</code></pre></div>

<p>In this example, we can see that the director logging utility is set to a level of ERROR and it is using a file appender with a directory destination of: /var/log.</p>

<p><strong>Assigning Log Levels</strong>
Prior to 2.6.0, the only way to change a logging utility&#39;s level was to edit its .config file and then restart the controller. </p>

<p>The Sysman Logging utility allows you to assign log levels to a specific log through its interface.  For example, if we wanted to set the logging level for our director log to DEBUG, we would enter the code from the second example:  </p>

<div class="highlight"><pre class="highlight javascript"><code><span class="o">/</span><span class="err">#</span> <span class="nx">sysman</span> <span class="nx">log</span> <span class="nx">director</span> <span class="nx">debug</span>
<span class="err"> </span><span class="nx">Logging</span> <span class="k">for</span> <span class="nx">director</span> <span class="kd">set</span> <span class="nx">to</span> <span class="nx">debug</span>
<span class="err"> </span><span class="nx">OK</span>
</code></pre></div>

<p>In the third example, we can also return the log to value its default value of ERROR.</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="o">/</span><span class="err">#</span> <span class="nx">sysman</span> <span class="nx">log</span> <span class="nx">director</span> <span class="k">default</span>
<span class="err">  </span><span class="nx">Logging</span> <span class="k">for</span> <span class="nx">director</span> <span class="kd">set</span> <span class="nx">to</span> <span class="k">default</span>
<span class="err">  </span><span class="nx">OK</span>
</code></pre></div>

<p>Note that Logs for programs are always enabled. It is not possible to disable logging for a program. You can only reset it to its default value. Supported Log Levels include:</p>

<table><thead>
<tr>
<th>Log Level</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Fatal</td>
<td>The FATAL level designates very severe error events that will presumably lead the application to abort.</td>
</tr>
<tr>
<td>Error</td>
<td>The ERROR level designates error events that might still allow the application to continue running.</td>
</tr>
<tr>
<td>Warning</td>
<td>WARN level designates potentially harmful situations.</td>
</tr>
<tr>
<td>Info</td>
<td>INFO level designates informational messages that highlight the progress of the application at coarse-grained level.</td>
</tr>
<tr>
<td>Debug</td>
<td>The DEBUG Level designates fine-grained informational events that are most useful to debug an application.</td>
</tr>
<tr>
<td>Trace</td>
<td>The TRACE Level designates finer-grained informational events than the DEBUG.</td>
</tr>
</tbody></table>

<p>By default, logging is enabled for all Control4 processes. The default log level is Error, meaning Fatal and Error level messages are logged. Warning, Info, Debug, and Trace messages are not.</p>

<p><strong>Targeting Log Directories</strong></p>

<p>Prior to 2.6.0, the only way to change a logging utility’s destination directory was to edit its .config file and then restart the controller. </p>

<p>Beginning with OS 2.6.0, the use “Log Appenders” is supported. Log Appenders deliver a log file to a specific destination. The assignment of a Log Appender cannot be done through the sysman interface. It must be done through an SSL connection. There are three kinds of Log Appenders supported by the sysman logging interface:</p>

<ul>
<li>syslog appenders - These send log messages to syslog.</li>
<li>file appenders - These write log messages to a file. </li>
<li>socket appenders - These send log messages to a specific host and port number.</li>
</ul>

<p>Most Control4 programs use a simple file appender at the root logger. The sysman log interface allows users to add additional appenders, as well as remove appenders. The following examples to the right show these actions using the director log.</p>

<p>First, we’ll set the log level of debug using the same syntax used previously.</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="o">/</span><span class="err">#</span> <span class="nx">sysman</span> <span class="nx">log</span> <span class="nx">director</span> <span class="nx">debug</span>
<span class="nx">Logging</span> <span class="k">for</span> <span class="nx">director</span> <span class="kd">set</span> <span class="nx">to</span> <span class="nx">debug</span>
<span class="nx">OK</span>
</code></pre></div>

<p>Next, we’ll add a new destination directory for the director’s log file (my-director.log). To do this we need to add a file appender.</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="o">/</span><span class="err">#</span> <span class="nx">sysman</span> <span class="nx">log</span> <span class="nx">director</span> <span class="nx">add</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">my</span><span class="o">-</span><span class="nx">director</span><span class="p">.</span><span class="nx">log</span>
<span class="nx">Added</span> <span class="nx">file</span> <span class="nx">appender</span> <span class="nx">director_0</span> <span class="nx">to</span> <span class="nx">director</span> <span class="k">for</span> <span class="sr">/tmp/my</span><span class="o">-</span><span class="nx">director</span><span class="p">.</span><span class="nx">log</span>
<span class="nx">OK</span>
</code></pre></div>

<p>This code sample adds a new file appender which will write the log file to: /tmp/my-director.log. </p>

<p>Note that the confirmation message displayed by sysman also includes the appender name or <code>director_0</code> in the example.</p>

<p>The <code>director_0</code> name is also used when we need to remove the appender.</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="o">/</span><span class="err">#</span> <span class="nx">sysman</span> <span class="nx">log</span> <span class="nx">director</span> <span class="nx">remove</span> <span class="nx">director_0</span>
<span class="nx">Removed</span> <span class="nx">appender</span> <span class="nx">director_0</span> <span class="k">from</span> <span class="nx">director</span>
<span class="nx">OK</span>
</code></pre></div>

<p>Any log file destination must begin with a slash &quot;/&quot; character as this creates the log4cplus file appender.</p>

<p>If the destination is a host:port number, for example &quot;192.168.0.100:5400&quot;, sysman will create a socket appender and configure it for the given host and port.</p>

<p>If the destination is a host name, for example, &quot;director&quot; (this is the host name of the controller running the director process), sysman will create a syslog appender and send log messages there. Note that the target syslog process must be configured to receive these messages and route them appropriately. See the fourth example to the right.</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="o">/</span><span class="err">#</span> <span class="nx">sysman</span> <span class="nx">log</span> <span class="nx">director</span> <span class="nx">add</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">tmp_director</span><span class="p">.</span><span class="nx">log</span>
<span class="nx">Log</span> <span class="nx">file</span> <span class="k">for</span> <span class="nx">director</span> <span class="kd">set</span> <span class="nx">to</span> <span class="o">/</span><span class="nx">tmp</span><span class="o">/</span><span class="nx">tmp_light</span><span class="p">.</span><span class="nx">log</span>
<span class="nx">OK</span>
</code></pre></div>

<p><strong>Log File Size and Rotation Settings</strong>
Configuration of log file size and rotation setting has not changed with new sysman logging utility. These can be configured in the logrotate.conf file on the controller. The file can be edited using a text editor.</p>

<p><strong>Reviewing the Status of All Active Loggers</strong>
An overview of the status of all loggers can be displayed through the sysman command line by entering: sysman.log
The resulting output is to the right:</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="err"> </span><span class="nx">Logger</span>            <span class="nx">Type</span>      <span class="nx">Level</span>    <span class="nx">Status</span>      <span class="nx">Appender</span>         <span class="nx">Destination</span><span class="err"> </span>
<span class="err"> </span><span class="nx">audio3client</span>      <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">audio</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">audio3client_nl</span>   <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">audio3server</span>      <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">audio</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">audio3server_nl</span>   <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">audio_asp_nl</span>      <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">audio_buffer_nl</span>   <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">audio_utils_nl</span>    <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">audioclient</span>       <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">audio</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">audioclient_nl</span>    <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">audioserver</span>       <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">audio</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">audioserver_nl</span>    <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">c4lookup</span>          <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">c4lookup</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">c4lookup_nl</span>       <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">c4net_nl</span>          <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">c4perfd</span>           <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">c4perfd</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">c4perfd_nl</span>        <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">c4rmengined</span>       <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">c4rmengined</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">c4rmengined_nl</span>    <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">c4server</span>          <span class="nx">program</span>   <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">c4server</span><span class="p">.</span><span class="nx">log</span>
<span class="err"> </span><span class="nx">c4server_nl</span>       <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>
<span class="err"> </span><span class="nx">cli_event</span>         <span class="nx">named</span>     <span class="nx">error</span>    <span class="nx">defaulted</span>   <span class="nx">cli_event</span>        <span class="nx">unknown</span>
<span class="err"> </span><span class="nx">daemon</span>            <span class="nx">syslog</span>    <span class="nx">debug</span>    <span class="kd">set</span>         <span class="nx">syslog</span>           <span class="nx">director</span>
<span class="err"> </span><span class="k">default</span>           <span class="nx">program</span>   <span class="nx">error</span>    <span class="kd">set</span>         <span class="nx">rootAppender</span><span class="err">    </span>
<span class="err"> </span><span class="nx">director</span>          <span class="nx">program</span>   <span class="nx">error</span>    <span class="kd">set</span>         <span class="nx">rootAppender</span>     <span class="o">/</span><span class="kd">var</span><span class="sr">/log/</span><span class="nx">director</span><span class="p">.</span><span class="nx">log</span>
</code></pre></div>

<ul>
<li><p>The first column titled “Logger” shows the program or named logger.</p></li>
<li><p>The “Type” column shows the type of logger. There are three types of loggers: syslog loggers, program log4cplus root loggers and named log4cplus loggers. Note that the sysman interface doesn’t expose the differences between these types of loggers. However, it is exposed here as Log Type as it may be useful when reviewing groups of loggers.</p></li>
<li><p>The “Level” column, Level, indicates the current logging level.</p></li>
<li><p>The “Status” column Status indicates if the level is set explicitly or derived from the logging defaults.</p></li>
<li><p>The “Appender” column indicates the type of destination. This will be a file, syslog host, named appender or root appender.</p></li>
<li><p>The Destination column shows where log lines are sent. This will be either a file name, host name, syslog ident, or console.</p></li>
</ul>
<h1 id='handling-binary-data'>Handling Binary Data</h1>

<h2 id='handling-binary-data-operating-system-3-and-binary-data'>Operating System 3 and Binary Data</h2>

<p>With the release of OS 3, support for Lua&#39;s Just In Time compiler (LuaJIT) has been added. For more information regarding LuaJIT, please see Lua JIT Compatibility and DriverWorks Drivers content.</p>

<p>With regard to handling Binary Data in OS 3, Lua JIT uses a bit Library called bittop. Prior to OS 3, the PUC LUA compiler used a bit library called bitlib. To ensure that code executes identically between both compilers, the bittop Library is now being used by both LuaJIT and PUC LUA. </p>

<p>While this change does not impact computations, printing to ComposerPro&#39;s Lua Output Window can be impacted if using PUC LUA&#39;s bitlib and bitwise operators for data that exceeds more than single byte operations. </p>

<p>For example, to the right two outputs using bitlib:</p>

<p>2.10.X use of bitlib:</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="nx">a</span> <span class="o">=</span> <span class="nx">bit</span><span class="p">.</span><span class="nx">lshift</span><span class="p">(</span><span class="mh">0xc0</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="mi">3221225472</span>
</code></pre></div>

<p>OS 3 use of bitlib:﻿</p>

<div class="highlight"><pre class="highlight javascript"><code><span class="nx">OS3</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">bit</span><span class="p">.</span><span class="nx">lshift</span><span class="p">(</span><span class="mh">0xc0</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>
<span class="o">-</span><span class="mi">1073741824</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">bit</span><span class="p">.</span><span class="nx">band</span><span class="p">(</span><span class="nx">bit</span><span class="p">.</span><span class="nx">lshift</span><span class="p">(</span><span class="mh">0xc0</span><span class="p">,</span><span class="mi">24</span><span class="p">),</span><span class="mh">0xffffffff</span><span class="p">))</span>
<span class="o">-</span><span class="mi">1073741824</span>
<span class="nx">a</span> <span class="o">=</span> <span class="nx">bit</span><span class="p">.</span><span class="nx">lshift</span><span class="p">(</span><span class="mh">0xc0</span><span class="p">,</span><span class="mi">24</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">a</span><span class="o">&lt;</span><span class="mi">0</span> <span class="nx">then</span>
<span class="nx">a</span><span class="o">=</span><span class="nx">bit</span><span class="p">.</span><span class="nx">band</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="mh">0x7fffffff</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x80000000</span>
<span class="nx">end</span>
<span class="nx">print</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="mi">3221225472</span>
</code></pre></div>

<p>If PUC LUA&#39;s bitlib is used, Control4 does not recommend its use for anything more than single byte operations.</p>

<h2 id='handling-binary-data-using-the-bit-library'>Using the Bit Library</h2>

<p>The bit library is a C library for Lua that is included in DriverWorks to perform bitwise operations on bit strings. Library operations include:</p>

<ul>
<li><code>bit.bnot(a)</code> - Returns the one&#39;s complement of a. </li>
<li><code>bit.band(w1,...)</code> - Returns the bitwise and of the w variables. </li>
<li><code>bit.bor(w1,...)</code> - Returns the bitwise or of the w variables. </li>
<li><code>bit.bxor(w1,...)</code> - Returns the bitwise xor of the w variables. </li>
<li><code>bit.lshift(a,b)</code> - Returns a shifted left b places—padded with zeros. </li>
<li><code>bit.rshift(a,b)</code> - Returns a shifted logically right b places. </li>
<li><code>bit.arshift(a,b)</code> - Returns a shifted arithmetically right b places. </li>
<li><code>bit.mod(a,b)</code> - Returns the integer remainder of a divided by b. </li>
</ul>

<p>A simple example of using the bit.bor operation follows. It assumes the following binary data set:</p>

<p>8    4    2    1     (byte positions)
1    1    0    0          (12)
1    0    1    1           (11)</p>

<p>Input:</p>

<p><code>foo = 12</code></p>

<p><code>bar = 11</code></p>

<p><code>print(bit.bor(foo, bar))</code></p>

<p>Output:</p>

<p><code>15</code></p>

<p>Here is another example using the bit.rshift operator based on the same binary data set:</p>

<p>Input:</p>

<p><code>foo = 12</code></p>

<p><code>print(bit.rshift(foo, 2))</code></p>

<p>Output:</p>

<p><code>3</code></p>

<h2 id='handling-binary-data-using-string-pack'>Using string.pack</h2>

<p>STRING.UNPACK can be found in the string library. It returns values read from the binary data string. The first result is the position at which the unpack stopped. This can be used as init value for subsequent calls. The first result is followed by values defined by the format string. Numerical values in the format string are interpreted as repetitions like in pack, except if used with the A operator, in which cases the number tells unpack how many bytes to read. Unpack stops if either the format string or the binary data string are exhausted. </p>

<p>The following example uses string.unpack to take a hexadecimal value and create a hexadecimal output:</p>

<p>Input:</p>

<p><code>foo =   &quot;\022\001\002\003\004&quot;</code></p>

<p><code>pos, mybyte, mylong = string.unpack(foo, &quot;b&gt;l&quot;)</code></p>

<p><code>print(&quot;mybyte = &quot; .. mybyte .. &quot; mydword = &quot; .. mylong)</code></p>

<p>Output:</p>

<p><code>mybyte = 22 mydword = 16909060</code></p>

<h2 id='handling-binary-data-using-string-unpack'>Using string.unpack</h2>

<p>STRING.UNPACK can be found in the string library. It packs given arguments into binary string according to format. The format string describes how the parameters (p1, ...) will be interpreted. Numerical values following the operators are standard for operator repetitions and need an according amount of parameters. Operators also expect appropriate parameter types. </p>

<p>The following example uses string.pack to take a decimal input and create a hexadecimal output:</p>

<p>Input:</p>

<p><code>mybyte = 22</code></p>

<p><code>mylong = 16909060</code></p>

<p><code>msg = string.pack(&quot;b&gt;l&quot;, mybyte, mylong)</code></p>

<p><code>hexdump(msg)</code></p>

<p>Output:</p>

<p><code>00000000 16 01 02 03 04</code></p>

<p>Note the use of the big endian modifier in the example above.</p>

<h2 id='handling-binary-data-using-pack-and-unpack-format-operators'>Using Pack and Unpack Format Operators</h2>

<p>Pack/unpack supports the encoding and decoding of values from binary data. The pack/unpack functions take a format string to encode and decode binary data. The operators of the format string follow.</p>

<p>bin.lib Format String Operators</p>

<table><thead>
<tr>
<th>Operator</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>z</td>
<td>zero-terminated string</td>
</tr>
<tr>
<td>h</td>
<td>short</td>
</tr>
<tr>
<td>H</td>
<td>unsigned short</td>
</tr>
<tr>
<td>b</td>
<td>byte = unsigned char</td>
</tr>
<tr>
<td>p</td>
<td>string preceded by length byte</td>
</tr>
<tr>
<td>P</td>
<td>string preceded by length word</td>
</tr>
<tr>
<td>a</td>
<td>string preceded by length size t</td>
</tr>
<tr>
<td>A</td>
<td>string</td>
</tr>
<tr>
<td>f</td>
<td>float</td>
</tr>
<tr>
<td>d</td>
<td>double</td>
</tr>
<tr>
<td>n</td>
<td>Lua number</td>
</tr>
<tr>
<td>c</td>
<td>char</td>
</tr>
<tr>
<td>i</td>
<td>int</td>
</tr>
<tr>
<td>I</td>
<td>unsigned int</td>
</tr>
<tr>
<td>l</td>
<td>long</td>
</tr>
<tr>
<td>L</td>
<td>unsigned long</td>
</tr>
<tr>
<td>&lt;</td>
<td>little endian</td>
</tr>
<tr>
<td>&gt;</td>
<td>big endian</td>
</tr>
<tr>
<td>=</td>
<td>native endian</td>
</tr>
</tbody></table>

<p>Note that the endian operators work as modifiers to all the characters following them in the format string.</p>
<h1 id='handling-xml-code'>Handling XML Code</h1>

<p>The included Lua method will escape XML code to the Lua driver. Any time string data is put into XML this method must be called.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">int</span> <span class="n">LuaC4Object</span><span class="p">::</span><span class="n">XmlEscapeString</span><span class="p">(</span><span class="n">lua_State</span> <span class="o">*</span><span class="n">L</span><span class="p">)</span>
 <span class="p">{</span>
<span class="err">      </span> <span class="n">LuaParamType</span> <span class="n">params</span><span class="p">[]</span> <span class="err">``</span><span class="o">=</span>
<span class="err">      </span> <span class="err">``</span><span class="p">{</span>
<span class="err">             </span> <span class="p">{</span><span class="s2">"string"</span><span class="p">,</span> <span class="s2">"stringToEscape"</span> <span class="p">}</span><span class="err">``</span><span class="p">,</span>
<span class="err">      </span> <span class="p">}</span><span class="err">``</span><span class="p">;</span><span class="err">``</span>

        <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">CheckParams</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">params</span><span class="err">``</span><span class="p">)</span>
<span class="err">             </span> <span class="k">return</span> <span class="mi">0</span><span class="err">``</span><span class="p">;</span><span class="err">``</span>

<span class="err">      </span> <span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="n">stringToEscape</span> <span class="o">=</span> <span class="n">lua_tostring</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="err">``</span><span class="p">;</span><span class="err">``</span>

<span class="err">      </span> <span class="n">std</span><span class="p">::</span><span class="n">string</span> <span class="n">strVariable</span> <span class="o">=</span> <span class="n">XmlEscapeMyString</span><span class="p">(</span><span class="n">stringToEscape</span><span class="p">.</span><span class="n">c_str</span><span class="p">())</span><span class="err">``</span><span class="p">;</span>
<span class="err">      </span> <span class="n">lua_pushlstring</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">strVariable</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">strVariable</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="err">``</span><span class="p">;</span>
<span class="err">      </span> <span class="k">return</span> <span class="mi">1</span><span class="err">``</span><span class="p">;</span><span class="err">`</span>
<span class="p">}</span>
</code></pre></div>

<p>For example:</p>

<p><code>strXmlListItem = “&lt;text&gt;&quot; .. EscapeXML(strListItem) .. &quot;&lt;/text&gt;”</code></p>

<h2 id='handling-xml-code-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers'>Using XML Dependencies to Automatically Load and Bind Dependent Drivers</h2>

<p>Using a driver&#39;s dependencies XML, it is possible to designate other drivers as &quot;dependent&quot; and force those drivers to load into a project simultaneously. In addition to this, the dependencies XML can also be used to have these driver automatically bind when they enter the project.</p>

<h3 id='handling-xml-code-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-use-case'>Use Case:</h3>

<p>Consider an example where we&#39;d like to add a Keypad driver to a project and then have two instances of a Light driver automatically added as well. In addition to this, we also want the connections between the Keypad driver and the two instances if the light driver created automatically as well. This can be accomplished for any set of drivers in the dependencies and connections XML area of the drivers.</p>

<p>First we&#39;ll look at the dependencies XML for the Keypad driver:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>1.<span class="nt">&lt;dependencies&gt;</span>
2. <span class="nt">&lt;dependency</span> <span class="na">alwaysAdd=</span><span class="s">"true"</span> <span class="na">addMultiple=</span><span class="s">"true"</span><span class="nt">&gt;</span>
3.   <span class="nt">&lt;name&gt;</span>light_for_keypad.c4z<span class="nt">&lt;/name&gt;</span>
4.   <span class="nt">&lt;auto_bindings&gt;</span>
5.   <span class="nt">&lt;auto_binding&gt;</span>
6.    <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
7.    <span class="nt">&lt;isconsumer&gt;</span>false<span class="nt">&lt;/isconsumer&gt;</span>
8.    <span class="nt">&lt;classes&gt;</span>
9.     <span class="nt">&lt;class&gt;</span>
10.     <span class="nt">&lt;classname&gt;</span>KEYPAD_LIGHT<span class="nt">&lt;/classname&gt;</span>
11.    <span class="nt">&lt;/class&gt;</span>
12.   <span class="nt">&lt;/classes&gt;</span>
13.   <span class="nt">&lt;dep_binding_id&gt;</span>14<span class="nt">&lt;/dep_binding_id&gt;</span>
14.   <span class="nt">&lt;/auto_binding&gt;</span>
15.   <span class="nt">&lt;/auto_bindings&gt;</span>
16.   <span class="nt">&lt;/dependency&gt;</span>
17. <span class="nt">&lt;dependency</span> <span class="na">alwaysAdd=</span><span class="s">"true"</span> <span class="na">addMultiple=</span><span class="s">"true"</span><span class="nt">&gt;</span>
18.    <span class="nt">&lt;name&gt;</span>light_for_keypad.c4z<span class="nt">&lt;/name&gt;</span>
19.    <span class="nt">&lt;auto_bindings&gt;</span>
20.    <span class="nt">&lt;auto_binding&gt;</span>
21.     <span class="nt">&lt;id&gt;</span>2<span class="nt">&lt;/id&gt;</span>
22.    <span class="nt">&lt;isconsumer&gt;</span>false<span class="nt">&lt;/isconsumer&gt;</span>
23.    <span class="nt">&lt;classes&gt;</span>
24.     <span class="nt">&lt;class&gt;</span>
25.       <span class="nt">&lt;classname&gt;</span>KEYPAD_LIGHT<span class="nt">&lt;/classname&gt;</span>
26.     <span class="nt">&lt;/class&gt;</span>
27.    <span class="nt">&lt;/classes&gt;</span>
28.    <span class="nt">&lt;dep_binding_id&gt;</span>14<span class="nt">&lt;/dep_binding_id&gt;</span>
29.    <span class="nt">&lt;/auto_binding&gt;</span>
30.    <span class="nt">&lt;/auto_bindings&gt;</span>
31.    <span class="nt">&lt;/dependency&gt;</span>
32.<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>

<p>Looking at lines of code 1 through 16, we can see in line 2 that the alwaysAdd tag is set to true. This means that the defined dependent driver (in this example: <code>light_for_keypad.c4z</code>) will always be added to the project when the Keypad driver is loaded. We can also see that addMultiple is also set to true. This means that more than one instance of the <code>light_for_keypad</code> driver can be added when the Keypad driver is loaded. This will allow us the two instances if the <code>light_for_keypad</code> driver when the Keypad driver loads. Line 3 clearly identifies the driver that will load with the Keypad driver.</p>

<p>Line 4 through 16 is the XML that will automatically create a binding between the Keypad driver and the light_for_keypad driver when they load into a project. The <code>auto_bindings</code> XML contains all of the Keypad driver&#39;s binding information to connect the two drivers. In Line 6 we can see the <code>auto_binding Id</code> of 1. This represents the first binding ID for the Keypad driver. That is where we want our first connection to the <code>light_for_keypad</code> driver to take place. </p>

<p>Note that the Keypad driver is a Provider (isconsumer=false), this allows for multiple, dependency drivers to loaded and bound to it. We can also see in Line 10 that this binds with a classname of <code>KEYPAD_LIGHT</code>.  If we look at the <code>light_for_keypad</code> driver&#39;s connection xml, we  see that it also shares the same connection classname:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>light_for_keypad driver Connections XML
<span class="nt">&lt;connections&gt;</span>
<span class="nt">&lt;connection&gt;</span>
 <span class="nt">&lt;id&gt;</span>14<span class="nt">&lt;/id&gt;</span>
 <span class="nt">&lt;connectionname&gt;</span>Keypad Light<span class="nt">&lt;/connectionname&gt;</span>
 <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
 <span class="nt">&lt;consumer&gt;</span>True<span class="nt">&lt;/consumer&gt;</span>
 <span class="nt">&lt;classes&gt;</span>
   <span class="nt">&lt;class&gt;</span>
     <span class="nt">&lt;classname&gt;</span>KEYPAD_LIGHT<span class="nt">&lt;/classname&gt;</span>
   <span class="nt">&lt;/class&gt;</span>
 <span class="nt">&lt;/classes&gt;</span>
 <span class="nt">&lt;/connection&gt;</span>
<span class="nt">&lt;/connections&gt;</span>
</code></pre></div>

<p>Note that the <code>light_for_keypad</code> driver&#39;s connection XML shares the same classname as the Keypad driver:  <code>Keypad_Light</code>. We can also see in Line 6 that it is a consumer, which will make up the other half of our Provider-Consumer connection with the Keypad driver. </p>

<p>Note in Line 3 that this specific connection in the <code>light_for_keypad</code> driver has an ID of 14. If you look up in the dependency XML for the Keypad driver you&#39;ll see in line 28 the <code>dep_binding__id </code>value of 14 which matches this connection in the <code>light_for_keypad</code> driver. </p>

<p>Following this , is the connection XML for the Keypad driver.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>
1. <span class="nt">&lt;connections&gt;</span>
2.     <span class="nt">&lt;connection&gt;</span>
3.     <span class="nt">&lt;id&gt;</span>1<span class="nt">&lt;/id&gt;</span>
4.     <span class="nt">&lt;connectionname&gt;</span>Keypad Light<span class="nt">&lt;/connectionname&gt;</span>
5.     <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
6.     <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
7.     <span class="nt">&lt;classes&gt;</span>
8.       <span class="nt">&lt;class&gt;</span>
9.        <span class="nt">&lt;classname&gt;</span>KEYPAD_LIGHT<span class="nt">&lt;/classname&gt;</span>
10.       <span class="nt">&lt;/class&gt;</span>
11.     <span class="nt">&lt;/classes&gt;</span>
12.   <span class="nt">&lt;/connection&gt;</span>
13.   <span class="nt">&lt;connection&gt;</span>
14.     <span class="nt">&lt;id&gt;</span>2<span class="nt">&lt;/id&gt;</span>
15.      <span class="nt">&lt;connectionname&gt;</span>Keypad Light<span class="nt">&lt;/connectionname&gt;</span>
16.      <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
17.      <span class="nt">&lt;consumer&gt;</span>False<span class="nt">&lt;/consumer&gt;</span>
18.      <span class="nt">&lt;classes&gt;</span>
19.        <span class="nt">&lt;class&gt;</span>
20.       <span class="nt">&lt;classname&gt;</span>KEYPAD_LIGHT<span class="nt">&lt;/classname&gt;</span>
21.       <span class="nt">&lt;/class&gt;</span>
22.     <span class="nt">&lt;/classes&gt;</span>
23.   <span class="nt">&lt;/connection&gt;</span>
24. <span class="nt">&lt;/connections&gt;</span>
</code></pre></div>

<p>Note in Line 9 that it has the same connection name as found in the <code>light_for_keypad</code> driver: Keypad Light.</p>

<p>The dependency XML found in the Keypad Driver and the coordinated connection XML between the Keypad driver and the <code>light_for_keypad</code> driver results in the driver being loaded when the Keypad driver loads. Also, the first binding for the Keypad driver is connected to the <code>light_for_keypad</code> driver at binding ID 14.</p>

<p>In the beginning of this section, we indicated that the use case calls for two instances of the <code>light_for_keypad</code> driver to load. This happens due to the second dependency binding XML found in the Keypad driver. Specifically, lines 17 through 32 represent another dependent binding that will be automatically created between the keypad driver and the <code>light_for_keypad</code> driver when they load.  </p>

<p>Keypad Driver Dependencies XML</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>17. <span class="nt">&lt;dependency</span> <span class="na">alwaysAdd=</span><span class="s">"true"</span> <span class="na">addMultiple=</span><span class="s">"true"</span><span class="nt">&gt;</span>
18. <span class="nt">&lt;name&gt;</span>light_for_keypad.c4z<span class="nt">&lt;/name&gt;</span>
19.  <span class="nt">&lt;auto_bindings&gt;</span>
20.  <span class="nt">&lt;auto_binding&gt;</span>
21.   <span class="nt">&lt;id&gt;</span>2<span class="nt">&lt;/id&gt;</span>
22.   <span class="nt">&lt;isconsumer&gt;</span>false<span class="nt">&lt;/isconsumer&gt;</span>
23.   <span class="nt">&lt;classes&gt;</span>
24.    <span class="nt">&lt;class&gt;</span>
25.     <span class="nt">&lt;classname&gt;</span>KEYPAD_LIGHT<span class="nt">&lt;/classname&gt;</span>
26.     <span class="nt">&lt;/class&gt;</span>
27.   <span class="nt">&lt;/classes&gt;</span>
28.  <span class="nt">&lt;dep_binding_id&gt;</span>14<span class="nt">&lt;/dep_binding_id&gt;</span>
29.  <span class="nt">&lt;/auto_binding&gt;</span>
30.   <span class="nt">&lt;/auto_bindings&gt;</span>
31.   <span class="nt">&lt;/dependency&gt;</span>
32. <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>

<p>Remember, this is possible because of the Keypad driver&#39;s addMultiple XML being set to true. Note that this <code>auto_binding ID</code> has a value of 2. It is the second binding point for the Keypad driver as our previous example connection used the first one. </p>

<p>Note that this also has a <code>dep_binding_id</code> value of 14. This means that two connections will be made from the Keypad driver to two instances of the <code>light_for_key</code> driver. The connections will be made in each of the <code>light_for_keypad</code> drivers at binding 14. </p>
<h1 id='driver-icon-management'>Driver Icon Management</h1>

<p><strong>Note: Detailed information regarding the creation of Device and Service Icons as well as useful Icon Templates can be found in the DriverWorks SDK at: DriverWorks SDK/Icon Templates.</strong></p>

<h3 id='driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-managing-driver-icons'>Managing Driver Icons</h3>

<p>Drivers are graphically represented within the ComposerPro environment using icons. These icons are displayed in several places: </p>

<p>The System design view found on the left hand side of Composer Pro:</p>

<p><img src="images/19_1-01-99e67a84.png"/></p>

<p>The List View area in the center of the ComposerPro window:</p>

<p><img src="images/19_1-02-e02f926f.png"/></p>

<p>Under the My Drivers tab found in the Items area on the right hand side of the ComposerPro window:</p>

<p><img src="images/19_1-03-b90937c6.png"/></p>

<p>Before discussing how these icons are included in drivers, it&#39;s important to note the differences in icon sizes in the images above. The System Design and Items areas accept an icon that is 16 X 16 pixels in size. This is referred in driver development terminology as the &quot;small image&quot; or <code>small_icon</code> in XML. The List View area uses a larger image at a size of 32 X 32 pixels. This image is referred to as the &quot;large image&quot; or <code>large_icon</code> in the driver&#39;s XML:</p>

<p><img src="images/19_1-04-63058b04.png"/></p>

<p>Note that both the <code>small_icon_</code> and <code>large_icon_</code><strong>require the use of 96 DPI.</strong> Using a DPI value other than 96 will result in icons appearing stretched or shrunk. Additionally, these icons will not work correctly in ComposerPro.</p>

<p>Driver icons are defined in the driver&#39;s XML. The remainder of this document will identify several types of drivers and, depending on where the driver&#39;s icons are located, outline the driver attributes required to display the icons in ComposerPro.</p>

<h3 id='driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-combo-drivers'>Combo Drivers</h3>

<p>Combo Drivers are drivers that represent both the proxy and protocol information in a single driver file. They are also the simplest with regard to implementing driver icons. The example to the right shows a combo driver&#39;s XML and identifies the attributes that define the driver&#39;s icons: the small and large XML tags:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;created&gt;</span><span class="err">&lt;</span>/created
<span class="nt">&lt;modified&gt;&lt;/modified&gt;</span>
<span class="nt">&lt;version&gt;&lt;/version&gt;</span>
<span class="nt">&lt;small&gt;&lt;/small&gt;</span>
<span class="nt">&lt;large&gt;&lt;/large&gt;</span>
<span class="nt">&lt;control&gt;&lt;/control&gt;</span>
<span class="nt">&lt;controlmethod&gt;&lt;/controlmethod&gt;</span>
<span class="nt">&lt;combo&gt;&lt;/combo&gt;</span>
</code></pre></div>

<p>The contents of these tags are used to identify the small and large versions of the driver&#39;s icons. Control4 delivers numerous icons, which are available when ComposerPro is installed. For example, in a typical installation these icons can be found at: C:/Program Files/Control4/ComposerPro280/Images</p>

<p>Here you will find folders for both large and small icons. If you would like to use one of the included icons for your driver, the icon name will need to be included in the combo driver&#39;s XML tags. For example, the large icon name for the Portable V2 Touchscreen is <code>control4_touchpad_32</code> and the small icon name is <code>control4_touchpad_16</code>. To use these icons the combo driver&#39;s XML will need to be updated to:</p>

<p><code>&lt;small&gt;devices_sm/control4_touchpad_16.gif&lt;/small&gt;</code></p>

<p><code>&lt;large&gt;devices_lg/control4_touchpad_32.gif&lt;/large&gt;</code></p>

<p>Next, let&#39;s consider an example of a combo driver that requires icons not provided by Control4. This driver obtains its small and large icons from a URL. The same XML tags can be used but instead of an icon name, a URL to the image is inserted. For example:</p>

<p><code>&lt;small&gt;http://root/images/small/small_icon.gif&lt;/small&gt;</code></p>

<p><code>&lt;large&gt;http://root/images/large/large_icon.gif&lt;/large&gt;</code></p>

<p>Note the use of &quot;http://&quot; in both of the XML strings above. This is a pathing requirement in using icons from a URL.</p>

<p>If the combo driver is a .c4z driver file, and wants to provide its own image, there are two additional components to implementing icons. </p>

<p>The first is an XML attribute that must be included in the small and large XML strings. The attribute is: <code>image_source</code> and it must be equal to &quot;c4z&quot;. For example:</p>

<p><code>&lt;small image_source=&quot;c4z&quot;&gt;images/devices_sm/small_icon.gif&lt;/small&gt;</code></p>

<p><code>&lt;large image_source=&quot;c4z&quot;&gt;images/devices_lg/large_icon.gif&lt;/large&gt;</code></p>

<p>The second component required in .c4z files is the creation of a directory at the root level of the .c4z file itself. This directory will contain a path to the small and large icons you wish to use for your driver. Defining the directories levels below the root level www directory are up to the driver developer. For our example, we&#39;ll use a path of:</p>

<p><code>www/images/devices_sm</code></p>

<p>and</p>

<p><code>www/images/devices_lg</code></p>

<p>The <code>devices_sm</code> directory will contain the small images and the <code>devices_lg</code> will hold the large format.  Using the example above we can see the directory path (following the www level) to the images:</p>

<p><code>&lt;small image_source=&quot;c4z&quot;&gt;images/devices_sm/small_icon.gif&lt;/small&gt;</code></p>

<p><code>&lt;large image_source=&quot;c4z&quot;&gt;images/devices_lg/large_icon.gif&lt;/large&gt;</code></p>

<h3 id='driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-single-proxy-drivers'>Single Proxy Drivers</h3>

<p>Single Proxy drivers define their icons using the same XML strings as a combo driver. However, they also have the ability to define additional icons in the &lt;proxies&gt; area of the XML.</p>

<p>If the &lt;small&gt;&lt;/small&gt; XML tag is populated with an image or UL to an image, that file will always be used in the My Drivers list of the Items area in ComposerPro. The &lt;large&gt;&lt;/large&gt; XML tag is used to populate the List View area of ComposerPro unless a different icon is defined in the &lt;proxies&gt;&lt;/proxies&gt; XML section of the driver. If a different icon is defined, the contents of the &lt;large&gt;&lt;/large&gt; XML tag will be disregarded.</p>

<p>Additional icons and other useful attributes are defined under the &lt;proxies&gt; XML tag. For example, let&#39;s consider a Keypad driver that obtains its icon from the delivered images with ComposerPro. Its proxy XML definition is shown to the right.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies</span> <span class="na">qty=</span><span class="s">"1"</span><span class="nt">&gt;</span>~
<span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5003"</span> <span class="na">name=</span><span class="s">"KEYPAD"</span> <span class="na">small_image=</span><span class="s">"devices_sm/keypad_16.gif"</span> <span class="na">large_image=</span><span class="s">"devices_lg/keypad_32.gif"</span><span class="nt">&gt;</span>light_v2<span class="nt">&lt;/proxy&gt;</span>
</code></pre></div>

<p>If we look at the XML attributes for the proxy section we can see the proxy binding ID is defined first. This is required for the correct icon to be displayed. Next we see a name attribute. This attribute is useful as it defines the driver&#39;s name that will be displayed in ComposerPro and on devices running Navigator. This is especially useful when dealing with multi-proxy drivers and its use is further explained below. When left blank, the name of the proxy used by the driver will be displayed. Following the name attribute we can see the small and large image icon attributes. Note the format the XML follows:</p>

<p><code>small_image=&quot;devices_sm/keypad_16.gif&quot;</code></p>

<p><code>large_image=&quot;devices_lg/keypad_32.gif&quot;</code></p>

<p>In the example above, we can see the <code>small_image</code> and <code>large_image</code> directories that are installed with ComposerPro as well as the small and large icon names within each<code>.</code></p>

<p>If our single proxy driver requires the use of icons through a URL, the proxy XML would look like code to the right.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies</span> <span class="na">qty=</span><span class="s">"1"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span> <span class="na">name=</span><span class="s">"KEYPAD"</span> <span class="na">image_source=</span><span class="s">"url"</span> 
  <span class="na">small_image=</span><span class="s">"http://192.168.1.111/driver/`driver_singleproxy/image/devices_sm/keypad_16.gif"</span> 
  <span class="na">large_image=</span><span class="s">"http://192.168.1.111/driver/`driver_singleproxy/image/devices_lg keypad_32.gif"</span><span class="nt">&gt;</span>keypad_proxy<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div>

<p>Again we see the proxy binding ID and name attributes defined followed by the <code>image_source</code> value. This is followed by the small and large image attributes but note the URL to the images in quotations. As mentioned earlier, the only requirement for the URL definition is that it begins with &quot;http://<code>&quot;</code></p>

<p>Finally, if our single proxy driver uses an image provided through the .c4z file, our &lt;proxy&gt; XML would look like the last example.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;proxies</span> <span class="na">qty =</span> <span class="s">"1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5002"</span> <span class="na">name=</span><span class="s">"KEYPAD"</span> <span class="err">image\</span><span class="na">_source=</span><span class="s">"c4z"</span> <span class="err">small\</span><span class="na">_image=</span><span class="s">"images/devices\_sm/keypad\_16.gif"</span><span class="err">\`</span>   <span class="na">large_image=</span><span class="s">"Images/Devices_Lg/keypad_32.gif"</span><span class="nt">&gt;</span>light_v2<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div>

<p>In the example above, we see an attribute that is required for .c4z use: <code>image_source</code>. As mentioned earlier, this attribute must be included and it must be equal to &quot;c4z&quot;. For the small and large image attribute we see a directory path. This path is found below the required www directory at the root level of the .c4z file. </p>

<p>The www directory contains a path to the small and large icons you wish to use for your driver. Defining the directories levels below the root level www directory are left up to the driver developer. For our example, we&#39;ll use a path of:</p>

<p><code>www/images/devices_sm</code></p>

<p>and</p>

<p><code>www/images/devices_lg</code></p>

<p>In this driver, the <code>devices_sm</code> directory will hold the small icons and the <code>devices_lg</code> will hold the large format.  Using the example above we can see the directory path (following the www level) to the images.</p>

<p>Note that if no custom images are defined in the driver&#39;s XML, the default icon for the Control4 Proxy used by the driver will be displayed.</p>

<h3 id='driver-icon-management-using-xml-dependencies-to-automatically-load-and-bind-dependent-drivers-multi-proxy-drivers'>Multi Proxy Drivers</h3>

<p>Icons are handled in multi-proxy drivers in much the same way as single proxy drivers. The XML differs only slightly in that additional proxy tags are included for each proxy used by the driver. For this example, we&#39;ll use XML for a receiver driver that uses the Receiver Proxy as its primary proxy. The driver also has two DVD sub-proxies, which are used to control a media player and a media streaming device. </p>

<p>This driver implements icons from two different locations: the receiver portion of the driver gets its icons from Control4&#39;s Receiver Proxy, the media player and the streaming device get their icons from a .c4z file. The XML for the driver is shown to the right</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;small</span> <span class="na">image_source=</span><span class="s">"c4z"</span><span class="nt">&gt;</span>images/devices_sm/receiver_16.gif<span class="nt">&lt;/small&gt;</span>
<span class="nt">&lt;large</span> <span class="na">image_source=</span><span class="s">"c4z"</span><span class="nt">&gt;</span>images/devices_lg/receiver_32.gif<span class="nt">&lt;/large&gt;</span>
<span class="nt">&lt;control&gt;</span>lua_gen<span class="nt">&lt;/control&gt;</span>
<span class="nt">&lt;controlmethod&gt;</span>~serial~<span class="nt">&lt;/controlmethod&gt;</span>
<span class="nt">&lt;driver&gt;</span>~DriverWorks~<span class="nt">&lt;/driver&gt;</span>
<span class="nt">&lt;proxies</span> <span class="na">qty=</span><span class="s">"3"</span><span class="nt">&gt;</span>
<span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5001"</span> <span class="na">name=</span><span class="s">"My Receiver"</span><span class="nt">&gt;</span>~receiver~<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5002"</span> <span class="na">name=</span><span class="s">"Media Player"</span> <span class="na">image_source=</span><span class="s">"c4z"</span> <span class="na">small_image=</span><span class="s">"images/devices_sm/media_player_16.gif” 
large_image="</span><span class="err">images/devices_lg/media_player_32.gif"</span><span class="nt">&gt;</span>dvd<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;proxy</span> <span class="na">proxybindingid=</span><span class="s">"5003"</span> <span class="na">name=</span><span class="s">"Streaming"</span> <span class="na">image_source=</span><span class="s">"c4z"</span> <span class="na">small_image=</span><span class="s">"images/devices_sm/stream_16.gif"</span><span class="err">large\</span><span class="na">_image=</span><span class="s">"i`mages/devices\_lg/stream\_32.gif"</span><span class="nt">&gt;</span>dvd~<span class="nt">&lt;/proxy&gt;</span>
<span class="nt">&lt;/proxies&gt;</span>
</code></pre></div>

<p>It&#39;s worth noting several attributes in the XML example to the right. First, the &lt;proxies qty&gt; tag has a value equal to 3, the amount of proxies this driver uses: one Receiver and two DVD proxies. Note that each of the individual proxies uses their own proxy binding IDs: 5001, 5002 and 5003. Proxy Binding IDs are required each so the correct icons are displayed. Also, this example shows the usefulness of the name= attribute. Each of the proxies have a unique name. This is especially useful with the multiple instances of DVD sub-proxies. In addition to unique driver icons, the use of &quot;Media Player&quot; and &quot;Streaming&quot; for the name attributes will make it easier to distinguish between the two in ComposerPro and Navigators:</p>

<p><img src="images/19_1-05-ce273388.png"/></p>
<h1 id='qr-codes-and-drivers'>QR Codes and Drivers</h1>

<h2 id='qr-codes-and-drivers-using-qr-codes-to-identify-and-download-drivers'>Using QR Codes to Identify and Download Drivers</h2>

<p><strong>Note: Detailed information regarding the creation and use of QR Codes Device and Service Icons as well as useful image templates can be found in the DriverWorks SDK at: DriverWorks SDK/QR Branding.</strong></p>

<p>Composer Express version 2.9.0 and later support the ability for a device driver to be downloaded by way of scanning a Quick Response code (QR code). QR codes are useful as they can be placed on a product, product packaging, within documentation or embedded on a product webpage.  When scanned within the Composer Express (CE) environment, they not only provide a way to download the correct driver, but also offer a convenient way to build a project at an offsite location.</p>

<p>For example, when an installer using Composer Express scans a Control4 QR code, CE reads the code and provides the ability for a driver to connect to the code. Composer Express will then download the driver and also provide the ability to place that driver in a desired room within the project.</p>

<p>The use of QR codes to download drivers is recommended for any device except those that are controller with an IP or ZigBee driver. For IP controlled devices, Control4 strongly encourages manufacturers to implement Control4&#39;s Simple Device Discovery Protocol (SDDP) to offer an easy driver download identification experience. For a ZigBee device, when its identification process is initiated, then Composer Express will automatically discover it and the associated driver will be downloaded into the project.</p>

<p>Creating QR Codes
Numerous QR Code generation utilities are available and acceptable for creating a QR code to support driver downloads.  Most support the ability to create a code for numerous items such as URLs, images or any number of file types. </p>

<p>For the purposes of a creating a QR code for driver download, the utility needs to support text to QR creation. The text that comprises the QR code includes three parameters: the manufacturer name, the device model number and the driver name.</p>

<p>For example, when the following text is entered into a QR code generator the code to the right is created:</p>

<p><img src="images/20_1-01-cbeff644.png"/></p>

<p>It is important to note that the name of the driver defined in the text of the QR code must exactly match the text defined in the driver&#39;s name XML element. Using the example above, <code>control4_device</code> would need to match the driver&#39;s XML of:</p>

<p><code>&lt;name&gt;control4_device.c4z&lt;/name&gt;</code></p>

<p>Driver names with either .c4z or .c4i extensions can be included in the QR code.</p>

<p>Once the QR code is created, it needs to be scaled and branded. The guidelines for scaling and branding the QR code, as well as sample branding icons can be found within the DriverWorks SDK in the following directory: DriverWorks SDK \Documentation\QR Branding\Connects with Control4  </p>

<p>For example, the code created for the example in this document would look like this:</p>

<p><img src="images/20_1-02-c7c4e2bf.png"/></p>

<p>QR Codes and ComposerExpress
The dealer or installer experience when using QR codes to add device drivers is very straightforward. With the project loaded and the Design page open, the &quot;+&quot; button is selected to Add a Device.</p>

<p><img src="images/20_1-03-34e0ba1b.png"/></p>

<p>From the Add Device page, the Scan QR Code button is selected:</p>

<p><img src="images/20_1-04-2b00d331.png"/></p>

<p>The mobile device is held approximately 8&quot; from the QR code to initiate the scan process:</p>

<p><img src="images/20_1-05-6a9dcc5f.png"/></p>

<p>When the code is scanned, the Add Device page is displayed. At this point, the installer can select the room where the device will reside and rename the driver if desired:</p>

<p><img src="images/20_1-06-9938c7d8.png"/></p>

<p>When the Add Device button is selected, the driver is downloaded to the controller and installed into the project. It is then ready for identification and configuration.</p>
<h1 id='universal-minidrivers'>Universal Minidrivers</h1>

<h2 id='universal-minidrivers-overview'>Overview</h2>

<p>Universal Minidrivers are small, self-contained Media Player proxy drivers designed to provide a UI-selectable driver for an individual media service, such as Netflix.  Minidrivers are designed to be lightweight with minimal control capability of their own.  Any UI interaction with a minidrivers will, by design, forward the interaction on to whichever device driver is providing the service audio and video, such as a Roku player.</p>

<p>Core Concepts
Each minidriver is device-ambivalent.  A single minidriver can be connected to as many or as few device drivers in the project as required of any supported type.  This eliminates any need for polluting the project and UI with “Roku Living Room Netflix”, “Roku Master Bedroom Netflix”, “Amazon Fire Netflix” drivers.  It also means that the Composer online database will only need to contain a single Netflix driver, rather than one for every device that supports Netflix.</p>

<p>The minidriver concept only provides for controlling a device providing a UI.  It does not provide for any ability to browse the selected service or provide feedback on what is currently playing on any one device.</p>

<p>The associated switcher logic (to be added to the device driver implementing universal minidriver support) has optional components to “take over” as the room selected device once the minidriver is selected.  This is more useful when the device itself implements the media player proxy than when the device is a receiver or TV, simply because the UI presented in Navigator for a media player provides more useful buttons for control of a media service than the TV or Receiver proxies do.  This is toggled in the device driver (not the minidriver) using the “Passthrough Mode” property, where setting “Passthrough Mode” to “On” will leave the minidriver selected in the room, and the minidriver will pass through any proxy commands to the switcher driver.</p>

<h3 id='universal-minidrivers-overview-minidriver-specifics'>Minidriver Specifics</h3>

<p>A Minidriver.c4z file contains a common core in <code>common/universal_app.lua</code> with a very small amount of service specific code (in driver.lua).  The common core code should not be changed under any circumstances by non-Control4 developers.</p>

<p>The driver.lua code defines two variables:</p>

<p><code>APP_NAME</code> This is the full name of the service.</p>

<p><code>SERVICE_IDS</code> This is a table which contains keys of the unique device type code used by a device driver (or class of device drivers) mapped to a code that defines how to launch this service on that device.  An example from the Amazon Video minidriver is to the right.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="n">SERVICE_IDS</span> <span class="o">=</span> <span class="p">{</span>
<span class="err">    </span><span class="n">UM_ROKU</span> <span class="o">=</span> <span class="s1">'13'</span><span class="p">,</span>
<span class="err">    </span><span class="n">UM_SAMSUNG2017</span> <span class="o">=</span> <span class="s1">'amazon'</span><span class="p">,</span>
<span class="err">    </span><span class="n">UM_AMAZON</span> <span class="o">=</span> <span class="s1">'com.amazon.avod'</span><span class="p">,</span>
<span class="err">    </span><span class="n">UM_SONY_TV</span> <span class="o">=</span> <span class="s1">'Amazon Video'</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<p>The channel ID for Amazon Video on Roku is 13.  The application name used to start the Amazon Video service on the Amazon Fire products is com.amazon.avod.  These are the values that will be discovered and used by the device specific drivers for their application launch code – so the Roku driver will discover the channel ID of 13 and plug that into the channel launch function unique to Roku, ignoring the other values from this table.</p>

<p>These variables are used in the <code>common/universal_app.lua</code> code to generate variables. The switcher component of the schema talks to these variables. They are also used in the internal build process to generate the documentation and driver.XML for each Minidriver must conform to this format.</p>

<h3 id='universal-minidrivers-overview-making-a-new-service-driver'>Making a New Service Driver</h3>

<p>A new service, “Play Net Movies”, has been launched and is available on Roku devices only at launch.  Three items are required to create a Minidriver for this new service:</p>

<ul>
<li>The name of the service to populate the value of <code>APP_NAME</code></li>
<li>The channel ID on Roku to populate the value of the <code>UM_ROKU</code> key in the <code>SERVICE_IDS</code> table. If this is available on other devices, the unique id for those devices as well</li>
<li>Logo artwork for the service, in 16x16, 32x32, 70x70, 90x90 and 300x300 pixel images.</li>
</ul>

<p>The artwork should be placed into the www/icons folder with these names:</p>

<ul>
<li>16x16 – <code>device_sm.png</code></li>
<li>32x32 – <code>device_lg.png</code></li>
<li>70x70 - <code>/device/experience_70.png</code></li>
<li>90x90 - <code>/device/experience_90.png</code></li>
<li>300x300 - <code>/device/experience_300.png</code></li>
</ul>

<p>The driver should then be run through the build process at Control4 by submitting this information to &lt;universal_minidriver_dev@control4.com&gt; for inclusion in the online driver database.</p>

<p>Alternatively, it&#39;s possible to take an existing driver and edit the driver.lua and driver.xml to have the correct values.  If you do this, please also still submit the information to &lt;universal_minidriver_dev@control4.com&gt; so we can update the online driver database.</p>

<p>Making a New Device Driver Compatible with Universal Minidrivers
New media playback devices are coming online all the time and existing ones continuously receive additional functionality.  Therefore, it may become necessary to add the capability to select Universal Minidrivers to a driver that is either under development or already released.</p>

<p>To that end, we have included in this package components of code that should be included in the driver Lua and XML.  They are found in the switcher directory. These files are marked up with comments that should help when implementing Universal Minidriver support. Below are some additional instructions for clarity.</p>

<h3 id='universal-minidrivers-overview-xml'>XML</h3>

<p>The driver.XML defines several sections of XML that should be copied into your driver.XML.</p>

<p>The &lt;properties&gt; section defines one property.  If your driver already has a &lt;properties&gt; section, copy the single property into your properties section. Do not create a new &lt;properties&gt; section.</p>

<p>The &lt;proxies&gt; section defines one additional avswitch proxy that may need to be added to your driver.</p>

<p>If your driver is implemented using the TV, Receiver, AV Switch or other proxy that handles input selection using <code>SET_INPUT</code> you do NOT need to include this proxy. You MUST change all the proxybindingid values of the <code>RF_MINI_APP</code> connections to this proxy ID.</p>

<p>If your driver is implemented using the media player or other proxy that does not handle <code>SET_INPUT</code>; you MUST include this proxy and MAY change the proxy ID here.  Note that updating an existing driver in a project with a driver that has an additional proxy will cause project corruption. Developers updating an existing driver must be careful to not cause this project corruption by changes within their driver.</p>

<p>The <code>&lt;connections&gt;</code> section defines AVSWITCH, App Switch Video Out and App Switch Audio Out connections. These are only needed if you included the avswitch additional proxy.</p>

<p>The remaining connections are of class <code>RF_MINI_APP</code>.  This is a special class created for Universal Minidrivers and should not be changed unless you did not need to include the additional proxy or you changed the proxy ID of that additional proxy. If this is the case, you must change the proxybindingid value to match the correct proxy.</p>

<p>By default, the <code>RF_MINI_APP</code> connections start at 3101 and go through 3125.  This can be changed if needed or desired. However, they must be sequential. Please make sure to adjust the <code>MINIAPP_BINDING_START</code> and <code>MINIAPP_BINDING_EN</code>D values in the OnDriverInit section of the Lua to match these changes.</p>

<h3 id='universal-minidrivers-overview-lua'>Lua</h3>

<p>In the Lua driver, there are several functions marked as &quot;MERGE&quot; and several marked as &quot;COPY&quot;.
The functions marked as MERGE are all entry points to your driver defined in DriverWorks and these may already exist as functions in your driver.  Please carefully merge the contents of these functions into your existing code without changing any of the statements themselves.</p>

<p>The functions marked as COPY are new functions not defined in DriverWorks. Verify that you do not already have functions with these names. If not, these are safe to simply copy as-is into your code. </p>

<p>There are some initialization values in the OnDriverInit section that should be confirmed:</p>

<p><code>PASSTHROUGH_PROXY</code>
This is the Proxy ID of the proxy in the switcher driver that will receive any proxy commands from the Minidriver such as transport controls, cursor controls , etc.</p>

<p><code>SWITCHER_PROXY</code>
This is the Proxy ID of the proxy in the switcher driver that has the <code>RF_MINI_APP</code> connections bound to it</p>

<p><code>USES_DEDICATED_SWITCHER </code>
Used to hide the <code>SWITCHER_PROXY</code> proxy from all UIs</p>

<p><code>MINIAPP_BINDING_START</code>
First connection ID of the <code>RF_MINI_APP</code> connections.</p>

<p><code>MINIAPP_BINDING_END</code> 
Last connection ID of the <code>RF_MINI_APP</code> connections</p>

<p><code>MINIAPP_TYPE</code>
This is the Unique ID used to key into the <code>SERVICE_IDS</code> table in the Minidriver.  It is how this driver retrieves the unique code required to launch the selected service. </p>

<h3 id='universal-minidrivers-overview-finishing-up'>Finishing Up</h3>

<p>In order to test that your driver supports Universal Minidrivers you will likely need to modify an existing Minidriver to support your new device as described above.  Once you are confident that the driver is working, but BEFORE releasing your driver, please contact ,universal_minidriver_dev@control4.com. to confirm the <code>SERVICE_IDS</code> table entry you have chosen is unique and descriptive. You will also need to provide a list of values for all services that your device supports so they can be included in the online database in time for your release.</p>

<p><strong>For sample drivers please see the Samples/Universal Minidrivers area of the DriverWorks SDK.</strong></p>
<h1 id='driverworks-agents'>DriverWorks Agents</h1>

<p>Beginning with O.S. Release 3.1.3, the DriverWorks SDK provides a stable enough platform for developing Control4 Agents in addition to device drivers. DriverWorks Agents provide third-party Driver Developers the ability to create agents which can be loaded into projects and used in customer homes.</p>

<h3 id='driverworks-agents-overview-agents-vs-drivers'>Agents vs. Drivers</h3>

<p>An agent is essentially a driver.  Agents are best used for drivers that meet the following criteria:</p>

<ul>
<li><p>An Agent is by definition a singleton driver. If more than one is needed, it should not be implemented as an agent.</p></li>
<li><p>An Agent can interact with a hardware device or service, but it would need to be a singleton implementation as mentioned above. </p></li>
<li><p>An Agent is a self-proxy driver. If a proxy-based UI is needed, it should not be implemented as an agent.</p></li>
<li><p>An Agent does not need to be located within the project room structure.</p></li>
</ul>

<h3 id='driverworks-agents-overview-creating-an-agent-from-an-existing-driver'>Creating an Agent from an Existing Driver</h3>

<ol>
<li>Select the DriverWorks driver. Preferably a self-proxy or combo driver.</li>
<li>Ensure that your favorite driver is actually a .c4z type driver.</li>
<li>Open your driver and select the “driver.xml” for editing.</li>
<li>Add the following child xml element to the <code>&lt;devicedata&gt;</code> element:  <code>&lt;agent&gt;true&lt;/agent&gt;</code> For example, see the code to the right:</li>
</ol>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;devicedata&gt;</span>
   <span class="nt">&lt;agent&gt;</span>true<span class="nt">&lt;/agent&gt;</span>
<span class="nt">&lt;/devicedata&gt;</span>
</code></pre></div>

<p>Next, save the driver.xml back into your favorite selected driver and load the updated driver into a Control4 project.</p>

<h3 id='driverworks-agents-overview-managing-driverworks-agents'>Managing DriverWorks Agents</h3>

<p>Also beginning with O.S. Release 3.1.3, Composer creates a new “Agents” directory in the “My Documents\Control4” directory structure. It is recommended that DriverWorks Agents be placed into this directory. Maintaining new Agents in this directory makes them easy to locate and avoids possible confusion for dealers who may try to load the agent as a driver. DriverWorks Drivers which have been modified to an agent will not load properly if treated as a driver.</p>

<h3 id='driverworks-agents-overview-loading-a-driverworks-agent'>Loading a DriverWorks Agent</h3>

<p>To load a new DriverWorks Agent, select Agents from below the Project Tree in Composer Pro. From within the Agents panel, click on Add. The new Agents screen is displayed. </p>

<p><img src="images/22_1-01-be28d2eb.png"/></p>

<p>This screen has a very similar look and function as that of the Drivers Search tab under System Design. All of the project’s legacy agents as well as newly created DriverWorks Agents are displayed in the results window. The search window at the top of the screen allows for text-based searches. Furthermore, searching for Agents can be refined by Category and Manufacturer. Search results can be sorted by the Control Method defined in the Agent as well the relevance which includes sorting by name or modified date. </p>

<p>Note that DriverWorks Agents will be available for distribution through the Online Driver Database in a future release.</p>
<h1 id='command-handling-and-dropped-connections'>Command Handling and Dropped Connections</h1>

<h2 id='command-handling-and-dropped-connections-command-handling-and-dropped-network-connections'>Command Handling and Dropped Network Connections</h2>

<p>Depending on the device your IP driver supports, it may be desirable that is reacts correctly in the event that a network connection fails. The driver should not only be able to recognize that the connection is down but also be able to handle the commands that are sent during the period of time when the network is not connected. </p>

<p>One strategy to detect network connectivity is to enable your driver to send a “heartbeat” is across the network. This could returns a very small amount of data to detect the status of the network.  When several of these returning data packages do not arrive, a disconnect/reconnect is forced. </p>

<p>If a command is sent while the receiving device is unavailable – the command will fail.  If a command is sent during this timeframe, the command may need to be sent again. While it is possible for your driver to monitor and indicate the status of the network using the OnConnectionStatusChanged function, the command will need to be manually sent yet again if your driver is not written to handle this scenario.</p>

<p>The example in this section is taken from an IP receiver driver. It uses several functions to monitor network connectivity and handle commands accordingly.  It is recommended that OnTimerExpired check to see if the network is connected before commands are sent. In the example below, the driver queries the network three times before it disconnects and then reconnects.</p>

<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="c1">--global init</span>
<span class="n">gPollTimer</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">function</span> <span class="nf">OnTimerExpired</span><span class="p">(</span><span class="n">idTimer</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">idTimer</span> <span class="o">==</span> <span class="n">gPollTimer</span><span class="p">)</span> <span class="k">then</span>
    <span class="c1">-- Send a status query on the main port...</span>
    <span class="c1">-- If we haven't gotten a response, increment the 'not checked in'... if it hits 3, disconnect all ports...</span>
    <span class="n">gLastCheckin</span> <span class="o">=</span> <span class="n">gLastCheckin</span> <span class="ow">or</span> <span class="mi">0</span>
    <span class="n">gLastCheckin</span> <span class="o">=</span> <span class="n">gLastCheckin</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gLastCheckin</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">mNetConnected</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="k">then</span> 
        <span class="n">C4</span><span class="p">:</span><span class="n">NetDisconnect</span><span class="p">(</span><span class="mi">6001</span><span class="p">,</span> <span class="n">mPort</span><span class="p">)</span> 
        <span class="n">dbgStatus</span><span class="p">(</span><span class="s2">"Failed to receive poll responses... Disconnecting..."</span><span class="p">)</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">ErrorLog</span><span class="p">(</span><span class="s2">"Denon AVR device is not responding... Disconnecting..."</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="c1">-- Send Poll Packet if we're ONLINE...</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mNetConnected</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">emit</span><span class="p">(</span><span class="s1">'RM ?'</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="k">return</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">idTimer</span> <span class="o">==</span> <span class="n">gReconnectTimer</span><span class="p">)</span> <span class="k">then</span>
    <span class="n">dbgStatus</span><span class="p">(</span><span class="s2">"Attempting to reconnect to Denon AVR..."</span><span class="p">)</span>
    <span class="n">C4</span><span class="p">:</span><span class="n">ErrorLog</span><span class="p">(</span><span class="s2">"Attempting to reconnect to Denon AVR..."</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">bTrying</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="n">gReconnectTimer</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">KillTimer</span><span class="p">(</span><span class="n">gReconnectTimer</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gNetworkStatus</span> <span class="o">==</span> <span class="s2">"OFFLINE"</span><span class="p">)</span> <span class="k">then</span>
      <span class="c1">-- Try to reconnect to the Denon Control port...</span>
      <span class="n">C4</span><span class="p">:</span><span class="n">NetDisconnect</span><span class="p">(</span><span class="mi">6001</span><span class="p">,</span> <span class="n">mPort</span><span class="p">)</span>
      <span class="n">C4</span><span class="p">:</span><span class="n">NetConnect</span><span class="p">(</span><span class="mi">6001</span><span class="p">,</span> <span class="n">mPort</span><span class="p">)</span>
      <span class="n">bTrying</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bTrying</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">gReconnectTimer</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">AddTimer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">"SECONDS"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>

<span class="k">function</span> <span class="nf">OnConnectionStatusChanged</span><span class="p">(</span><span class="n">idBinding</span><span class="p">,</span> <span class="n">nPort</span><span class="p">,</span> <span class="n">strStatus</span><span class="p">)</span>
  <span class="n">dbg</span><span class="p">(</span><span class="s2">"OnConnectionStatusChanged["</span> <span class="o">..</span> <span class="n">idBinding</span> <span class="o">..</span> <span class="s2">" ("</span> <span class="o">..</span> <span class="n">nPort</span> <span class="o">..</span> <span class="s2">")]: "</span> <span class="o">..</span> <span class="n">strStatus</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">idBinding</span> <span class="o">==</span> <span class="mi">6001</span><span class="p">)</span> <span class="k">then</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">strStatus</span> <span class="o">==</span> <span class="s2">"ONLINE"</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">mNetConnected</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="n">C4</span><span class="p">:</span><span class="n">ErrorLog</span><span class="p">(</span><span class="s2">"Connected to Denon AVR..."</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">gPollTimer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="n">C4</span><span class="p">:</span><span class="n">KillTimer</span><span class="p">(</span><span class="n">gPollTimer</span><span class="p">)</span> <span class="k">end</span>
      <span class="n">gPollTimer</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">AddTimer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">"SECONDS"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">-- 5 second repeating timer...</span>
    <span class="k">else</span>
      <span class="n">mNetConnected</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="c1">-- Try a re-connect of the device gGCControlPort...</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">gReconnectTimer</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">gReconnectTimer</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
        <span class="n">gReconnectTimer</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">AddTimer</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s2">"SECONDS"</span><span class="p">)</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">NetDisconnect</span><span class="p">(</span><span class="mi">6001</span><span class="p">,</span> <span class="n">mPort</span><span class="p">)</span>
        <span class="n">C4</span><span class="p">:</span><span class="n">NetConnect</span><span class="p">(</span><span class="mi">6001</span><span class="p">,</span> <span class="n">mPort</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="k">function</span> <span class="nf">processSerial</span><span class="p">(</span><span class="n">retMessage</span><span class="p">)</span>
  <span class="n">gLastCheckin</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nf">OnDriverDestroyed</span><span class="p">()</span>
  <span class="c1">-- Kill all timers in the system...</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gReconnectTimer</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span> <span class="n">gReconnectTimer</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">KillTimer</span><span class="p">(</span><span class="n">gReconnectTimer</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">gPollTimer</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span> <span class="k">then</span> <span class="n">gPollTimer</span> <span class="o">=</span> <span class="n">C4</span><span class="p">:</span><span class="n">KillTimer</span><span class="p">(</span><span class="n">gPollTimer</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<h1 id='persisting-driver-data'>Persisting Driver Data</h1>

<h2 id='persisting-driver-data-persisting-driver-data-and-the-persistdata-table'>Persisting Driver Data and the PersistData Table</h2>

<p>The PersistData table was created with the initial release of the DriverWorks SDK. It still works in the current OS releases and it is anticipated that it will continue to work in subsequent releases. Prior to OS 2.10.0 InvalidateState caused the PersistData table to be stored. However, InvalidateState was overused and caused significant performance issues on larger projects. </p>

<p>Beginning with OS 2.10.0, InvalidateState no longer functions. Now, the PersistData table is systematically saved out. This is done by a Director Timer that fires twice per second. Each time the timer fires, Director round-robins through the drivers in the project and saves off any state information for that specific driver. Due to this model, the larger the project - the longer it will take to persist the data.</p>

<p>Several factors should be considered when deciding if data should be persisted. If the data is significant enough that it should be persisted in the project file (.c4p); then it likely is a good candidate for being stored in the PersistData table or being handled through the creation of a Property. One example to consider is a project reload. When a project is loaded, the data residing in the PersistData table should be populated with data that will be used to bring the system back to the stable, usable state. An example of this type of data would be the ramp rate levels configured for lights or LED colors configured on keypads. Those are data values that should be available as soon as the project is loaded. </p>

<p>Additionally, PersistData should be properly retained when any of the following occur:</p>

<ul>
<li>The Composer user saves (backs up) the project </li>
<li>Director restarts in an expected manner </li>
<li>The driver is updated using Composer or Auto-update methods</li>
</ul>

<p>Other types of runtime data that offer no benefit to being persisted should not be stored in the PersistData Table. The last known power state of a light (On/Off) or the last media instance being streamed are examples of data that should not be stored in the project file.
Note that functions cannot be members of a table that contain data that is intended to be persisted.</p>

<h3 id='persisting-driver-data-persisting-driver-data-and-the-persistdata-table-persisting-data-post-o-s-2-10-0'>Persisting Data Post O.S. 2.10.0</h3>

<p>Drivers that were created for OS 2.10.0 and later will benefit from using the persist functions delivered in the 2.10.0 release. They include:</p>

<ul>
<li>PersistSetValue </li>
<li>PersistGetValue </li>
<li>PersistDeleteAll</li>
</ul>

<p>These APIs are defined in the DriverWorks SDK API Reference Guide. They do not depend on the same round-robin handling for saving data that is described above. These are handled by a Director thread and are very quick.</p>

<p>It is important to understand that persisting extraneous data through a driver can have performance implications. Device drivers should avoid calling these functions spuriously as this will result in the data never being saved. Director will only flush data to the disk after a sufficient period of no changes by any driver. Currently, a save of all persist data for all drivers is very CPU intensive. To view persisted data, see the PersistData Table in the driver XML and the Properties interface in ComposerPro for values that are being persisted through your driver.</p>
<h1 id='tls-and-ssl-driver-configuration'>TLS and SSL Driver Configuration</h1>

<h2 id='tls-and-ssl-driver-configuration-tls-ssl-driver-configuration'>TLS/SSL Driver Configuration</h2>

<p>Control4 drivers can connect securely with devices using SSL/TLS. These connections are outgoing TCP client connections, using either the C4:url calls or the standard network connections (either static in XML or dynamic in Lua).</p>

<p>If you use the DriverWorks SDK URL interface, you can implement basic or digest authentication support within your driver and construct the url properly to include those credentials in communication with the device. For more information, please see:</p>

<p><a href="https://snap-one.github.io/docs-driverworks-api/#url-interface">https://snap-one.github.io/docs-driverworks-api/#url-interface</a></p>

<p><a href="https://snap-one.github.io/docs-driverworks-api/#serial-and-network-interface-netportoptions">https://snap-one.github.io/docs-driverworks-api/#netportoptions</a></p>

<p><a href="https://github.com/control4/docs-driverworks/tree/master/sample_drivers">https://github.com/control4/docs-driverworks/tree/master/sample_drivers</a></p>

<p>A “class” of connections that enable declaring secure (SSL) connections in a driver file (.c4z) is defined to the right. As part of this, the “port” section supports some additional properties that enable various features of SSL. To the right is an example taken from the HC-800 driver file.
 </p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;classname&gt;</span>SSL<span class="nt">&lt;/classname&gt;</span>
    <span class="nt">&lt;ports&gt;</span>
       <span class="nt">&lt;port&gt;</span>
          <span class="nt">&lt;name&gt;</span>Sysman<span class="nt">&lt;/name&gt;</span>
           <span class="nt">&lt;number&gt;</span>5810<span class="nt">&lt;/number&gt;</span>
           <span class="nt">&lt;auto_connect&gt;</span>True<span class="nt">&lt;/auto_connect&gt;</span>
           <span class="nt">&lt;monitor_connection&gt;</span>True<span class="nt">&lt;/monitor_connection&gt;</span>
           <span class="nt">&lt;keep_connection&gt;</span>True<span class="nt">&lt;/keep_connection&gt;</span>
           <span class="nt">&lt;keep_alive&gt;</span>True<span class="nt">&lt;/keep_alive&gt;</span>
           <span class="nt">&lt;delimiter&gt;</span>4f4b0a<span class="nt">&lt;/delimiter&gt;</span>
       <span class="nt">&lt;/port&gt;</span>
    <span class="nt">&lt;/ports&gt;</span>
</code></pre></div>

<p> </p>

<p>This snipped declares an SSL connection bound to port 5810 (Sysman). This particular connection doesn&#39;t require the use of any special properties. To the right is another example that illustrates the five new properties that were added for SSL.
 </p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;port&gt;</span>
  <span class="nt">&lt;name&gt;</span>CertTest<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;number&gt;</span>6666<span class="nt">&lt;/number&gt;</span>
  <span class="nt">&lt;auto_connect&gt;</span>True<span class="nt">&lt;/auto_connect&gt;</span>
  <span class="nt">&lt;monitor_connection&gt;</span>True<span class="nt">&lt;/monitor_connection&gt;</span>
  <span class="nt">&lt;keep_connection&gt;</span>True<span class="nt">&lt;/keep_connection&gt;</span>
  <span class="nt">&lt;keep_alive&gt;</span>True<span class="nt">&lt;/keep_alive&gt;</span>
  <span class="nt">&lt;delimiter&gt;</span>4f4b0a<span class="nt">&lt;/delimiter&gt;</span>
  <span class="nt">&lt;certificate&gt;</span>./protected.pem<span class="nt">&lt;/certificate&gt;</span>
  <span class="nt">&lt;private_key</span> <span class="na">protected=</span><span class="s">"True"</span><span class="nt">&gt;</span>./protected.pem<span class="nt">&lt;/private_key&gt;</span>
  <span class="nt">&lt;cacert&gt;</span>./cacert.pem<span class="nt">&lt;/cacert&gt;</span>
  <span class="nt">&lt;verify_mode&gt;</span>peer<span class="nt">&lt;/verify_mode&gt;</span>
  <span class="nt">&lt;method&gt;</span>sslv3<span class="nt">&lt;/method&gt;</span>
<span class="nt">&lt;/port&gt;</span>
</code></pre></div>

<p> </p>

<p>The properties are defined as:</p>

<p><code>certificate</code> - Path to the certificate to use for the connection. The path is relative to driver’s C4Z location.</p>

<p><code>private**_key</code>- Path to the private key to use for the connection. The path is relative to the driver’s C4Z location. If the “protected” attribute is “True”, then Director will invoke the callback shown to the right to retrieve the password from the driver:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>function GetPrivateKeyPssword(Binding, Port)
  return “TheKey”
end
</code></pre></div>

<p>See below for GetPrivateKeyPassword definition.</p>

<p><code>cacert</code> - Path to the CA (certificate authority) certificate to use for the connection. The path is relative to the driver’s C4Z location.</p>

<p><code>verify_mode</code> - Specifies the verification mode to use for the connection. The verify mode corresponds to those supported by OpenSSL. A detailed description of the verification modes can be found here:</p>

<p><code>https://www.openssl.org/docs/ssl/SSL_CTX_set_verify.html. </code>_ 
Note that Control4 currently supports only the peer verification mode (<code>SSL_VERIFY_PEER</code>). Value values include:</p>

<ul>
<li><code>none</code></li>
<li><code>peer</code></li>
</ul>

<p>If this property is omitted, then Director defaults to use no verification (“none”).</p>

<p><code>method</code> - Specifies the method to use for establishing the connection. A detailed description of the various methods can be found here: <code>https://www.openssl.org/docs/ssl/SSL_CTX_new.html</code>. Valid values include:</p>

<ul>
<li><code>sslv2</code></li>
<li><code>sslv23</code></li>
<li><code>sslv3</code></li>
<li><code>tlsv1</code></li>
<li><code>tlsv1_1</code></li>
</ul>

<p>If this property is omitted, then Director defaults to using sslv23 (which is the OpenSSL default).</p>

<p>Please note that the <code>&lt;certificate&gt;</code>, <code>&lt;private_key&gt;</code>, and <code>&lt;cacert&gt;</code> expected in those XML tags for certificates and key information may all be contained in the same file.  It&#39;s not required to split the various certificates and keys out into separate files to work properly.  In the case that they are all contained in a single file, put that file&#39;s filename value in each of the XML tags.</p>

<p>If a private key / key exchange is desired, you need to include your client_private.key within the c4z file that contains your driver code. It should be pre-encrypted to protect the private key. You can then use the <a href="https://snap-one.github.io/docs-driverworks-api/#miscellaneous-interface-getprivatekeypassword" title="GetPrivatekeyPassword API">https://snap-one.github.io/docs-driverworks-api/#getprivatekeypassword</a> in your lua code to return the password that is needed for the Control4 system to access and use the private key in the key exchange. Obviously you will want to encrypt your driver code before distributing it in order to protect the client private key.</p>

<p>Once the connection is established, then you simply utilize the standard networking functions (e.g. <a href="https://snap-one.github.io/docs-driverworks-api/#serial-and-network-interface-netconnect">NetConnect</a> ) to communicate with the device. The returned information will come back on <a href="https://snap-one.github.io/docs-driverworks-api/#serial-and-network-interface-receivedfromnetwork">ReceivedFromNetwork</a></p>

<p>Your driver then will be responsible for parsing the JSON data structure and handling it as you deem necessary.</p>

<p>If you want to use a web socket for your device communication, we have a sample web socket driver in our SDK library at:
<a href="https://github.com/control4/docs-driverworks/tree/master/sample_drivers/websocket">https://github.com/control4/docs-driverworks/tree/master/sample_drivers/websocket</a></p>
<h1 id='markdown-driver-documentation'>Markdown Driver Documentation</h1>

<p>Documentation can play an important role in ensuring the proper configuration and use of a driver. Driver documentation is created by the driver writer and delivered within the driver file. After the driver is added to a project, the content is displayed in ComposerPro under the driver’s Advanced Properties/Documentation tab.</p>

<p>Several approaches to delivering driver documentation are currently supported. They differ mainly due to the documentation needs required by the driver.</p>

<p><strong>driver.c4i</strong></p>

<p>If the driver you’re writing uses the .c4i extension, the documentation content is delivered in the XML section of the driver. The content is included within the <code>&lt;documentation&gt;&lt;/documentation&gt;</code>tags. This is the only option to include driver documentation when using the .c4i extension.</p>

<p><strong>driver.c4z</strong></p>

<p>If the driver you’re writing uses the .c4z extension, the documentation content can be delivered in two ways. The first involves the inclusion of a documentation.rtf file within the www directory at the root level of driver. While .RTF files are somewhat limited in nature they can be appropriate for supporting drivers that don’t require the need for a robust documentation experience. Detailed information on the inclusion of a documentation.rtf file can found here:</p>

<p><a href="https://snap-one.github.io/docs-driverworks-fundamentals/#understanding-c4z-drivers">https://snap-one.github.io/docs-driverworks-fundamentals/#understanding-c4z-drivers</a></p>

<p>The second way to include driver documentation within a .c4z driver file is to first created the content in Markdown and then render the Markdown into HTML using React. This approach offers the simplicity of creating content with Markdown while benefitting from the features provided through HTML.</p>

<p>The DriverWorks SDK includes all of the React assets needed to render Markdown driver documentation into HTML. The assets are included in the release.zip file found in the on the DriverWorks Landing page here:</p>

<p><a href="https://github.com/snap-one/docs-driverworks">https://github.com/snap-one/docs-driverworks</a></p>

<p>To include Markdown documentation in your driver.c4z file, first locate the markdown_driver_doc folder at the top of the DriverWorks landing page. Note that the folder contains a release.zip file.</p>

<ol>
<li>Unzip the release.zip file into the www/documentation folder in your driver .c4z file. The updated documentation directory structure should look like this:</li>
</ol>

<p><img src="images/2_01-de4d0f70.jpg"/></p>

<p>Note that the &#39;x&#39; characters seen above will be replaced with random letters or digits.</p>

<ol>
<li>Save the new driver documentation in Markdown as a file named “documentation.md” at the root of the www directory.</li>
<li>Any images used within the documentation need to reside in a subfolder named img at the root of the www directory. An example of a www directory with assets, a driver documentation.md file and associated images would look like this:</li>
</ol>

<p><img src="images/2_02-e49343ce.jpg"/></p>

<p>Note that the documentation.md file <strong>is not</strong> inside the documentation folder.</p>

<ol>
<li><p>Finally, it will be necessary to point to the index.html file in the documentation XML element of the driver.xml:</p>

<p><code>&lt;documentation file=&quot;www/documentation/index.html&quot;/&gt;</code></p></li>
</ol>

<p>After the driver.c4z file is compiled, the assets included from the release.zip will generate driver documentation using the same formatting as can be seen in drivers delivered by Control4.</p>
<h1 id='proxy-specific-information'>Proxy Specific Information</h1>

<p>The following section is intended to supplement the existing Proxy information found on the DriverWorks homepage. It contains information that falls outside of the scope of the Reference Guide which includes, Proxy Commands, Protocol Notifications, Events, Capabilities, etc. </p>

<h2 id='proxy-specific-information-amplifier-proxy-and-navigator-eq-controls'>Amplifier Proxy and Navigator EQ Controls</h2>

<p>The ability to display audio equalization controls on devices running Navigator was added in conjunction with Operating System 3.2.3. Currently, the only Proxies that support Navigator EQ controls are the Amplifier and AV Switch Proxies.</p>

<p>The majority of the of the commands, notifications and capabilities defined here must be implemented in your driver to display EQ controls. Several commands are optional including SET_AUDIOMODE_BYPASS, SET_AUDIOMODE_EQ and SET_AUDIOMODE_TONECONTROL as these have been included to suspect legacy Audio Matrix Switches.</p>

<p>Note that this functionality is disabled by default. The HIDE EQ FROM NAVS CHANGED notification must be sent with a value of False to enable the EQ functionality in Navigator.</p>

<p>For additional Information, please see:</p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-proxy-commands">Navigator EQ Amplifier Proxy Commands</a></p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-protocol-notifications">Navigator EQ Amplifier Protocol Notifications </a></p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-capabilities">Navigator EQ Amplifier Capabilities</a></p>

<h2 id='proxy-specific-information-av-switch-proxy-and-navigator-eq-controls'>AV Switch Proxy and Navigator EQ Controls</h2>

<p>The ability to display audio equalization controls on devices running Navigator was added in conjunction with Operating System 3.2.3. Currently, the only Proxies that support Navigator EQ controls are the Amplifier and AV Switch Proxies.</p>

<p>The majority of the of the commands, notifications and capabilities defined here must be implemented in your driver to display EQ controls. Several commands are optional including SET_AUDIOMODE_BYPASS, SET_AUDIOMODE_EQ and SET_AUDIOMODE_TONECONTROL as these have been included to suspect legacy Audio Matrix Switches.</p>

<p>Note that this functionality is disabled by default. The HIDE EQ FROM NAVS CHANGED notification must be sent with a value of False to enable the EQ functionality in Navigator.</p>

<p>For additional Information, please see the DriverWorks Proxy and Protocol Guide regarding:</p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-proxy-commands">Navigator EQ AV Switch Proxy Commands</a></p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-protocol-notifications">Navigator EQ AV Switch Protocol Notifications </a></p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-capabilities">Navigator EQ AV Switch Capabilities</a></p>

<h2 id='proxy-specific-information-av-switch-proxy-and-display-adjustable-bindings'>AV Switch Proxy and Display Adjustable Bindings</h2>

<p>O.S. releases 3.3.0 and later provides the ability to hide AV Switch Bindings that are not in use. This feature has been provided to better manage the UI display in ComposerPro. This is especially useful for AV Switch devices that have a large number of bindings. Displaying all of the bindings for these devices can make the use of UI cumbersome.</p>

<p><strong>Assumptions:</strong></p>

<ul>
<li>All applicable bindings are correctly defined in the driver’s XML.</li>
<li>Driver developers already have the ability to create control bindings using <a href="https://snap-one.github.io/docs-driverworks-api/#miscellaneous-interface-adddynamicbinding">C4:AddDynamicBinding()</a></li>
<li>The driver file specifies bindings to be hidden by the proxy through the use of a new XML element delivered in O.S. 3.3.0:  <code>&lt;ExtraInfo&gt;D2&lt;/ExtraInfo&gt;</code> <em>See below for more information.</em></li>
<li>Resizing of the bindings list is possible only if a new capability delivered in O.S. 3.3.0 is set to true: <code>&lt;allow_dynamic_resize&gt;</code>  <em>See below for more information.</em></li>
</ul>

<p><strong>AV Switch Proxy Functionality Using Display Adjustable Bindings</strong></p>

<ul>
<li>Bindings that are bound and then unbound in ComposerPro will only be hidden after a Director restart.</li>
<li>The Proxy will increase the amount of displayed bindings based on the last unhidden, bound binding. For example,  bindings 1 through 10 are all bound and unhidden. ComposerPro will display all of those bindings and in addition, binding 11 through 13 assuming they are also unhidden.</li>
<li>The largest Binding amount will be shown ACROSS ALL SECTIONS at the same time.  For example, RX, TX, Audio, Video will all be expanded to the largest bound set of any of the section. If RX has 10 bound connections that means Audio will also display 10, regardless of binding status.</li>
<li>The driver developer is responsible for handling the configuration use case of virtual director or when the device is not available and ensuring that the solution is documented and appropriate for these scenarios.</li>
</ul>

<p><strong>Driver XML to Support Hidden Bindings</strong></p>

<p>To allow the AV Switch Proxy to auto hide/unhide a binding, the driver needs to have a new XML tag included in the each connection in the driver’s XML: <code>&lt;ExtraInfo&gt;D2&lt;/ExtraInfo&gt;</code>.</p>

<p>The ExtraInfo tag must include the value of <code>D2</code> as the parameter for each connection. For example, see the XML for connection 3096 to the right.</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;connection&gt;</span>
     <span class="nt">&lt;id&gt;</span>3096<span class="nt">&lt;/id&gt;</span>
     <span class="nt">&lt;type&gt;</span>6<span class="nt">&lt;/type&gt;</span>
     <span class="nt">&lt;ExtraInfo&gt;</span>D2<span class="nt">&lt;/ExtraInfo&gt;</span>
     <span class="nt">&lt;connectionname&gt;</span>TX 96<span class="nt">&lt;/connectionname&gt;</span>
     <span class="nt">&lt;consumer&gt;</span>True<span class="nt">&lt;/consumer&gt;</span>
<span class="nt">&lt;/connection&gt;</span>
</code></pre></div>

<p><strong> Capability to Support Hidden Bindings</strong></p>

<p><strong>allow_dynamic_resize</strong></p>

<p>Capability that allows for AV Switch bindings to be hidden in ComposerPro. Defaults to false.</p>

<p><strong> Signature</strong></p>

<p><code>&lt;allow_dynamic_resize&gt;false&lt;/allow_dynamic_resize&gt;</code></p>

<p><strong>Additional Information and Expected Limitations</strong></p>

<ul>
<li>The driver developer is responsible for persisting and recreating any non-binding connections when director starts up.</li>
<li>The driver developer must recreate the bindings in the proper order before director loads and creates the connection. This is done by the driver developer by persisting the binding information and creating the bindings on execution of the main driver code.</li>
<li>The driver must handle the &quot;virtual&quot; or device not available case appropriately based on the expected use case for configuring the device. If the connections aren&#39;t defined in xml, and the device isn&#39;t available, the installer may have a limited experience. The driver developer needs to take this into consideration.</li>
</ul>

<p>For additional Information, please see the DriverWorks Proxy and Protocol Guide regarding:</p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-proxy-commands">Navigator EQ AV Switch Proxy Commands</a></p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-protocol-notifications">Navigator EQ AV Switch Protocol Notifications </a></p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#amplifier-navigator-eq-navigator-eq-capabilities">Navigator EQ AV Switch Capabilities</a></p>

<h2 id='proxy-specific-information-camera-proxy-audio-distribution'>Camera Proxy Audio Distribution</h2>

<p>Beginning with O.S. 3.4.0, camera drivers have the ability to distribute audio to devices running Navigator.</p>

<p>If a camera supports the proper CODEC and the camera microphone has been enabled in the appropriate interface a new audio button will appear at the bottom of the single-camera view. This will allow the user to hear live audio with the live video. </p>

<p>Note that if the camera does not support the proper codec, or the camera microphone has been disabled in the camera interface, no button will appear in the single-camera view.</p>

<p><strong>Requirements</strong></p>

<ul>
<li><p>Camera has a microphone and it&#39;s enabled. Note that most most are disabled by default. Depending on the camera/camera driver, the camera microphone can be enabled/disabled within the driver or in OvrC.</p></li>
<li><p>Ensure the configuration for the camera stream is video &amp; audio, not just video.</p></li>
<li><p>The camera supports codec G.711 u-law (G.711μ).</p></li>
<li><p>The driver for the camera shows the Audio Property is present.</p></li>
</ul>

<p>For additional Information, please see the DriverWorks Proxy and Protocol Guide regarding:</p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-proxy-commands">Camera Proxy Commands</a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-protocol-notifications">Camera Proxy Protocol Notifications </a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-properties">Camera Proxy Properties</a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-proxy-extras-interface-library">Camera Extras Interface Library</a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-capabilities">Camera Proxy Capabilities</a></p>

<h2 id='proxy-specific-information-camera-proxy-and-dynamic-streams'>Camera Proxy and Dynamic Streams</h2>

<p>The Camera Proxy has been enhanced with regard to what types of streams it provides. This is a result of the release of Control4’s next generation T4 touchscreens, new controllers and support for H.265 streaming. Camera drivers now have the ability to provide more stream options and can support a larger set of mixed hardware environments.</p>

<p>Also, Navigators now support streaming tiles which results in the need to stream many cameras in parallel. To provide this functionality over a remote connection, it is desirable to offer the option to pick a lower bandwidth stream.</p>

<p>For the best experience, cameras should be minimally configured with the following streams by default:</p>

<table><thead>
<tr>
<th>Next Gen C4 OSD</th>
<th>T4 Touch Screens</th>
<th>Mobile</th>
</tr>
</thead><tbody>
<tr>
<td>High Resolution H.265</td>
<td>1080p H.265</td>
<td>High Resolution H.265</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Legacy C4 OSD</th>
<th>T3 Touch Screens</th>
</tr>
</thead><tbody>
<tr>
<td>720p H.264</td>
<td>720p H.264</td>
</tr>
</tbody></table>

<table><thead>
<tr>
<th>Small Streaming Tiles</th>
</tr>
</thead><tbody>
<tr>
<td>Low Resolution H.265</td>
</tr>
</tbody></table>

<h4 id='proxy-specific-information-camera-proxy-and-dynamic-streams-persisting-data-post-o-s-2-10-0-driver-support-for-dynamic-streams'>Driver Support for Dynamic Streams</h4>

<p><em>See the <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#dynamic-camera-streams-related-apis">Related APIs</a> section below for detailed information regarding the functions discussed in this section.</em></p>

<p>New camera drivers should implement the dynamic streams API to provide a list of streams that the Navigators can pick from. In order to support dynamic streams the driver should:</p>

<ol>
<li><p>Set the requires_dynamic_stream_urls dynamic capability to “true”.</p></li>
<li><p>Implement the GET_STREAM_URLS UI request command. This can be either implemented synchronously, by returning the list of cameras directly or it can also be implemented asynchronously. For example, if the driver needs to query a web service to get the current streams.</p></li>
</ol>

<p>If implemented asynchronously, when the stream list is available it will be necessary to send the Proxy the STREAM_URLS_READY Notify with the results. </p>

<p>Drivers that do not have static URLs for streams will need to respond to the GET_STREAM_URLS call with an XML object that indicates the URL(s) is/are being generated and include a key with the response.  Once the driver has been able to obtain a URL for the stream, the driver should send a STREAM_URLS_READY Notify with the same key that is provided with this Synchronous call response.  An example of the response is:</p>

<p><code>&lt;streams generating_key=&quot;1234&quot;/&gt;</code></p>

<p>The key should be a unique 32 bit integer value.  We recommend starting at 1 and incrementing by 1 for each request that comes in.</p>

<p>Also, if the driver does have a valid temporary URL that is still valid when it gets the call, no further Notify is needed and the driver should respond to this call with the XML of streams information.</p>

<p>To indicate to a client that the driver supports this API call, a driver needs to set the requires_dynamic_stream_urls capability to true in the driver c4i or via DYNAMIC_CAPABILITIES_CHANGED Notify.</p>

<p>If no Port is provided with a URL, the following ports are used by all clients as the default for the transport:</p>

<ul>
<li>http - 80</li>
<li>https - 443</li>
<li>rtsp - 554</li>
<li>rtsps - 443</li>
</ul>

<h4 id='proxy-specific-information-camera-proxy-and-dynamic-streams-persisting-data-post-o-s-2-10-0-support-for-caching-urls'>Support for Caching  URLs</h4>

<p>The ability to cache the stream URL list is also supported. This removes the need to have to execute the GET_STREAM_URLS request every time a camera stream is loaded. This is supported with the capability: dynamic_urls_use_type. </p>

<p>The driver also needs to send a DYNAMIC_URLS_CHANGED notification to the proxy when the configured URLs have been changed. The proxy would then send a &quot;DYNAMIC_URLS_CHANGED&quot; DataToUI in response to this that the Navigators would key off of to refresh any cached URLs. This is useful for driver&#39;s with MULTIPLE use type URLs.</p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-related-apis'>Related APIs</h3><h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-requires_dynamic_stream_urls'>requires_dynamic_stream_urls</h3>

<p>Capability determining whether the camera should be asked for stream URLs through the more advanced API call.</p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-signature'>Signature</h3>

<p><code>&lt;requires_dynamic_stream_urls&gt;&lt;/requires_dynamic_stream_urls&gt;</code></p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-type'>Type</h3>

<p>Boolean: Defaults to false.</p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-dynamic-capability'>Dynamic Capability</h3>

<p>Yes</p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-example'>Example</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;capabilities&gt;</span>
    <span class="nt">&lt;requires_dynamic_stream_urls&gt;</span>true<span class="nt">&lt;/requires_dynamic_stream_urls&gt;</span>
<span class="nt">&lt;/capabilities&gt;</span>
</code></pre></div><h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-requires_dynamic_snapshot_urls'>requires_dynamic_snapshot_urls</h3>

<p>Capability determining whether the camera should be asked for snapshot URLs through the more advanced API call.</p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-signature'>Signature</h3>

<p><code>&lt;requires_dynamic_snapshot_urls&gt;&lt;/requires_dynamic_snapshot_urls&gt;</code></p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-type'>Type</h3>

<p>Boolean: Defaults to false.</p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-dynamic-capability'>Dynamic Capability</h3>

<p>Yes</p>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-example'>Example</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;capabilities&gt;</span>
    <span class="nt">&lt;requires_dynamic_snapshot_urls&gt;</span>true<span class="nt">&lt;/requires_dynamic_snapshot_urls&gt;</span>
<span class="nt">&lt;/capabilities&gt;</span>
</code></pre></div><h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-get_stream_urls'>GET_STREAM_URLS</h3>

<p>This command is used to obtain URLs for a camera that does not have a constant URL like a Cloud based camera or for cameras that have a wider range of features and configurable options that can produce better customer experiences using various clients. </p>

<p>A Client will make this request to a driver and provide information about how the client will be using the stream.  The driver optionally can adjust the URL(s) returned based on this information.  Driver developers are encouraged to test their driver on various devices to ensure good customer experiences when viewing collages, high resolution or high frame rate streams.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>CODEC</td>
<td>Optional. Comma separated list of codecs that the client can support with the most preferred first.  A driver is not required to handle this but some drivers may want to if they support multiple codecs. (mjpeg, h264, h264i, h265)</td>
</tr>
<tr>
<td>RESOLUTION</td>
<td>Optional. Resolution that the client will be using to display the stream.  A driver is not required to support this but this can be helpful for clients that may need a lower resolution stream for collages of multiple cameras and a 4MP or higher stream would tax the client hardware.</td>
</tr>
<tr>
<td>FPS</td>
<td>Optional. Frames Per Second that the client would prefer.  A driver is not required to support this but if it does it may result in better customer experience when dealing with collages on Navigators.</td>
</tr>
</tbody></table>

<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-examples'>Examples</h3>

<p>An example of the simplest XML returned by a driver is shown to the right:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>--- simple

<span class="nt">&lt;streams&gt;</span>
   <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://192.168.1.150/view_camera.cgi"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/streams&gt;</span>

or

<span class="nt">&lt;streams&gt;</span>
   <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/view_camera.cgi"</span> <span class="na">codec=</span><span class="s">"h264"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://192.168.1.150:80/view_camera_h265.cgi"</span> <span class="na">codec=</span><span class="s">"h265"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/streams&gt;</span>
</code></pre></div>

<p>This is followed by a more complex example from a camera with more features and can provide more options to allow clients to pick a better stream:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code>--- complex

<span class="nt">&lt;streams&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsps://server.company.com:554/rtsp.cgi"</span> <span class="na">codec=</span><span class="s">"h265"</span> <span class="na">resolution=</span><span class="s">"1920x1080"</span> <span class="na">fps=</span><span class="s">"60"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsps://server.company.com:554/cloudapi.cgi?fh2f5hw2"</span> <span class="na">codec=</span><span class="s">"h265"</span> <span class="na">resolution=</span><span class="s">"640x480"</span> <span class="na">fps=</span><span class="s">"5"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsp://server.company.com:554/cloudapi.cgi?fh2f4hw1"</span> <span class="na">codec=</span><span class="s">"h264"</span> <span class="na">resolution=</span><span class="s">"1920x1080"</span> <span class="na">fps=</span><span class="s">"60"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsp://server.company.com:554/cloudapi.cgi?fh2f4hw2"</span> <span class="na">codec=</span><span class="s">"h264"</span> <span class="na">resolution=</span><span class="s">"640x480"</span> <span class="na">fps=</span><span class="s">"5"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"https://server.company.com:443/cloudapi.cgi?fh2fhsw3"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span> <span class="na">resolution=</span><span class="s">"1920x1080"</span> <span class="na">fps=</span><span class="s">"20"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"https://server.company.com:443/cloudapi.cgi?fh2fhsw5"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://server.company.com:80/cloudapi.cgi?fh2fhw3"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span> <span class="na">resolution=</span><span class="s">"1920x1080"</span> <span class="na">fps=</span><span class="s">"20"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://server.company.com:80/cloudapi.cgi?fh2fhw5"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/streams&gt;</span>
</code></pre></div><h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-get_snapshot_urls'>GET_SNAPSHOT_URLS</h3>
<p>This command is used to obtain URLs for a camera that does not have a constant URL like a Cloud based camera or for cameras that have a wider range of features and configurable options that can produce better customer experiences using various clients. </p>

<p>A Client will make this request to a driver and provide information about how the client will be using the snapshot.  The driver optionally can adjust the URL(s) returned based on this information.</p>
<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-examples'>Examples</h3>
<p>An example of the simplest XML returned by a driver is shown to the right:</p>
<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;snapshots&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"http://192.168.1.150/view_camera.cgi"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/snapshots&gt;</span>

or

<span class="nt">&lt;snapshots&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"http://192.168.1.150:80/custom_resolution_as_requested_by_client.cgi"</span> <span class="na">resolution=</span><span class="s">"644x481"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/view_snapshot.cgi"</span> <span class="na">resolution=</span><span class="s">"3840x2160"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/view_snapshot.cgi"</span> <span class="na">resolution=</span><span class="s">"1920x1080"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:80/view_snapshot.cgi"</span> <span class="na">resolution=</span><span class="s">"640x480"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/snapshots&gt;</span>
</code></pre></div><h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-usage-note'>Usage Note</h3>
<p><strong>Cloud Based Cameras </strong></p>

<p>Drivers that do not have static URLs for snapshots will need to respond to this call with an XML object that indicates the URL(s) is/are being generated and include a key with the response.  Once the driver has been able to obtain a URL for the stream, the driver should send a SNAPSHOT_URLS_READY Notify with the same key that is provided with this Synchronous call response.  An example of the response is:</p>

<p><code>&lt;streams generating_key=&quot;1234&quot;/&gt;</code></p>

<p>The driver would then follow up with the SNAPSHOT_URLS_READY Notify and specify KEY=1234 in that notify along with the URL.  The key should be a unique 32 bit integer value.  We recommend starting at 1 and incrementing by 1 for each request that comes in.</p>

<p>Also, if the driver does have a valid temporary that is still valid when it gets the call, no further Notify is needed and the driver should respond to this call with the XML of snapshots information.</p>

<p>To indicate to a client that the driver supports this API call, a driver needs to set the requires_dynamic_stream_urls capability to true in the driver or via the DYNAMIC_CAPABILITIES_CHANGED Notify.</p>

<p>If no Port is provided with a URL, the following ports are used by all clients as the default for the transport:</p>

<p>http - 80
https - 443</p>
<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-stream_urls_ready'>STREAM_URLS_READY</h3>
<p>Protocol Notification used for following up to a GET_STREAM_URLS Synchronous call.  This Notify will let a UI know that the URL information they requested is ready.  The driver must use the same key parameter value that was returned to the UI as the key parameter in this notify.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>KEY</td>
<td>Key of the originating call for the snapshot to be created.</td>
</tr>
<tr>
<td>URLS</td>
<td>String of XML object as described in the description of this call.</td>
</tr>
</tbody></table>
<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-examples'>Examples</h3>
<p>An example of the simplest XML used by a driver is shown to the right:</p>
<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;streams</span> <span class="na">key=</span><span class="s">"1234"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://192.168.1.150/view_camera.cgi"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/streams&gt;</span>

or

<span class="nt">&lt;streams</span> <span class="na">key=</span><span class="s">"1234"</span> <span class="na">camera_address=</span><span class="s">"192.168.1.150"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/view_camera.cgi"</span> <span class="na">codec=</span><span class="s">"h264"</span><span class="nt">&gt;</span>
   <span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://192.168.1.150:80/view_camera_h265.cgi"</span> <span class="na">codec=</span><span class="s">"h265"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/streams&gt;</span>
</code></pre></div>

<p>This is followed by an example from a camera with more features and can provide more options to allow clients to pick a better stream:</p>

<div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;streams</span> <span class="na">key=</span><span class="s">"1234"</span> <span class="na">camera_address=</span><span class="s">"server.company.com"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsps://192.168.1.150:554/rtsp.cgi"</span> <span class="na">codec=</span><span class="s">"h265"</span> <span class="err">resolution"1920x1080"</span> <span class="na">fps=</span><span class="s">"60"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsps://192.168.1.150:554/cloudapi.cgi?fh2f5hw2"</span> <span class="na">codec=</span><span class="s">"h265"</span> <span class="err">resolution"640x480"</span> <span class="na">fps=</span><span class="s">"5"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsp://192.168.1.150:554/cloudapi.cgi?fh2f4hw1"</span> <span class="na">codec=</span><span class="s">"h264"</span> <span class="err">resolution"1920x1080"</span> <span class="na">fps=</span><span class="s">"60"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"rtsp://192.168.1.150:554/cloudapi.cgi?fh2f4hw2"</span> <span class="na">codec=</span><span class="s">"h264"</span> <span class="err">resolution"640x480"</span> <span class="na">fps=</span><span class="s">"5"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/cloudapi.cgi?fh2fhsw3"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span> <span class="err">resolution"1920x1080"</span> <span class="na">fps=</span><span class="s">"20"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/cloudapi.cgi?fh2fhsw5"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://192.168.1.150:80/cloudapi.cgi?fh2fhw3"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span> <span class="err">resolution"1920x1080"</span> <span class="na">fps=</span><span class="s">"20"</span><span class="nt">&gt;</span>
<span class="nt">&lt;stream</span> <span class="na">url=</span><span class="s">"http://192.168.1.150:80/cloudapi.cgi?fh2fhw5"</span> <span class="na">codec=</span><span class="s">"mjpeg"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/streams&gt;</span>

</code></pre></div><h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-snapshot_urls_ready'>SNAPSHOT_URLS_READY</h3>
<p>Notify used for following up to a GET_SNAPSHOT_URLS Synchronous call.  This Notify will let a UI know that the URL information they requested is ready.  The driver must use the same key parameter value that was returned to the UI as the key parameter in this notify.</p>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>KEY</td>
<td>Key of the originating call for the snapshot to be created.</td>
</tr>
<tr>
<td>URLS</td>
<td>String of XML object as described in the description of this call.</td>
</tr>
</tbody></table>
<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-example'>Example</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;snapshots</span> <span class="na">key=</span><span class="s">"1234"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"http://192.168.1.150/view_camera.cgi"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/snapshots&gt;</span>

or

<span class="nt">&lt;snapshots</span> <span class="na">key=</span><span class="s">"1234"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"http://192.168.1.150:80/custom_resolution_as_requested_by_client.cgi"</span> <span class="na">resolution=</span><span class="s">"644x481"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/view_snapshot.cgi"</span> <span class="na">resolution=</span><span class="s">"3840x2160"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:443/view_snapshot.cgi"</span> <span class="na">resolution=</span><span class="s">"1920x1080"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;snapshot</span> <span class="na">url=</span><span class="s">"https://192.168.1.150:80/view_snapshot.cgi"</span> <span class="na">resolution=</span><span class="s">"640x480"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/snapshots&gt;</span>
</code></pre></div><h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-dynamic_urls_use_type'>dynamic_urls_use_type</h3>
<p>Supports the following use types:</p>

<p>MULTIPLE - Default if the capability is not specified. URLs can be used repeatedly. If URLs change, the driver should send DYNAMIC_URLS_CHANGED notification to the proxy.</p>

<p>SINGLE - URLs can only be used once. Driver must be asked each time for a new set of URLs.</p>

<p>EXPIRING (Do not include in 3.3.1) - URLs can be used more than once, but expire after some time period.</p>
<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-signature'>Signature</h3>
<p><code>&lt;dynamic_urls_use_type&gt;&lt;/dynamic_urls_use_type&gt;</code></p>
<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-dynamic-capability'>Dynamic Capability</h3>
<p>Yes</p>
<h3 id='proxy-specific-information-camera-proxy-and-dynamic-streams-example'>Example</h3><div class="highlight"><pre class="highlight xml tab-xml"><code><span class="nt">&lt;capabilities&gt;</span>
    <span class="nt">&lt;dynamic_urls_use_type&gt;</span>SINGLE<span class="nt">&lt;/dynamic_urls_use_type&gt;</span>
<span class="nt">&lt;/capabilities&gt;</span>
</code></pre></div>

<p>For additional Information, please see the DriverWorks Proxy and Protocol Guide regarding:</p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-proxy-commands">Camera Proxy Commands</a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-protocol-notifications">Camera Proxy Protocol Notifications </a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-properties">Camera Proxy Properties</a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-proxy-extras-interface-library">Camera Extras Interface Library</a></p>

<p><a href="https://jubilant-barnacle-73gylvg.pages.github.io/#camera-capabilities">Camera Proxy Capabilities</a></p>

<h2 id='proxy-specific-information-intercom-proxy-best-practices'>Intercom Proxy Best Practices</h2><h3 id='proxy-specific-information-intercom-proxy-best-practices-overview'>Overview</h3>
<p>The Intercom Proxy interface is defined in terms of Commands, Requests and Notifications, each of which are described in this section of the proxy and Protocol Guide.</p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-commands">Intercom Proxy Commands</a> are issued by a proxy consumer and may or may not result in an asynchronous notification in response.  Commands typically change state of the Intercom Proxy, or other components of the intercom architecture.</p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-requests">Intercom Proxy Requests</a> are issued from a proxy consumer with the expectation of getting a response from the protocol.  Requests do not change state of the intercom proxy or any other component of the architecture.  </p>

<p><a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-notifications">Intercom Proxy Notifications</a> are sent from the intercom proxy to the intercom consumer asynchronously, and indicate a state change in the intercom proxy or one of its related architecture components.</p>

<p>All communication through the proxy interface is asynchronous.  Even request responses, such as getting a list of known intercom devices, are returned asynchronously with respect to the request for that data.</p>
<h3 id='proxy-specific-information-intercom-proxy-best-practices-storing-session-ids'>Storing Session IDs</h3>
<p>Many intercom API commands and requests require the sessionId as an input parameter. The value for this parameter is provided by the SIP Client on the device in response to issuing a <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-commands-start-_call"><code>START_CALL</code></a> command or a physical button press event. </p>

<p>This sessionId value is included in the resulting <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-notifications-outgoing_call"><code>OUTGOING_CALL</code></a> or <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-notifications-incoming_call"><code>INCOMING_CALL</code></a> notifications. The intercom proxy consumer is responsible for storing the sessionId returned with these notifications for use in subsequent commands and requests.</p>
<h3 id='proxy-specific-information-intercom-proxy-best-practices-using-the-remoteaor-property'>Using the RemoteAor Property</h3>
<p>When the “remoteAor” parameter is used in a notification or command, the value is always the address of record of the other intercom device participating in an intercom call. </p>

<p>For example, consider that intercom device A has address of record of “sip-user-A@192.168.1.123” and intercom device B has an address of record of “sip-user-B@192.168.1.123”. </p>

<p>Intercom device A initiates a call with intercom device B, which results in an <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-notifications-incoming_call"><code>INCOMING_CALL</code></a> notification on intercom device B. When intercom device B issues the <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-commands-accept_call"><code>ACCEPT_CALL</code></a> command, which takes remoteAor as a parameter, intercom device B should use “sip-user-A@192.168.1.123” (the address of record of intercom device A, or the initiator) as the value of this parameter. </p>

<p>Likewise, when intercom device A sends the <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-notifications-call_accepted"><code>CALL_ACCEPTED</code></a> notification, it will contain a remoteAor property that has the value of the address of record of intercom device B, or “sip-user-B@192.168.1.123”.</p>

<p>For additional Information, please see the <a href="https://literate-tribble-gq5lk61.pages.github.io/#introduction">DriverWorks Proxy and Protocol Guide</a> regarding all of the functions supported by the Intercom Proxy.</p>

<h2 id='proxy-specific-information-intercom-proxy-terminology'>Intercom Proxy Terminology</h2>

<p>The following terms are specific to the Control4 Intercom Proxy and their use in developing a door station or door station like driver. Note that this content does not include the scope of developing a touch panel to support intercom use.</p>

<p><strong>Intercom Call Commands</strong> –  Includes a set of commands that are sent from the Intercom Proxy to the door station device that is supported by your driver. An example of an Intercom Proxy Command is <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-commands-start-_call">START_CALL</a>. When your driver receives the START_CALL command, it must handle the command in a manner that enables your device to begin a call.</p>

<p><strong>Intercom Call Notifications</strong> -  Includes a set  of notifications  that are sent from the device you are supporting, via your driver, to the Intercom Proxy. For example, when your driver receives a <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-commands-start-_call">START_CALL</a> command, it will send a <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-notifications-call_accepted">CALL_ACCEPTED</a> notification to the Intercom Proxy.</p>

<p><strong>Intercom Call Requests</strong> - These functions represent requests that are sent from your device driver to the Intercom Proxy to obtain various sets of call data. For example, when needed your driver may send the Intercom Call Request of <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-requests-get_device_list">GET_DEVICE_LIST</a>. The GET_DEVICE_LIST request is a function for gathering information about other devices on the network that  might communicate with your device. Information returned includes data such as whether another device has a camera, does it include a display, etc.</p>

<p><strong>Intercom State Commands</strong> - These functions consist of commands that impact the state of the device you are writing a driver for. For example, your driver may receive a State Command of <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-state-commands-set_ringer_volume">SET_RINGER_VOLUME</a> from the Intercom Proxy. SET_RINGER_VOLUME will be sent with a numerical value indicating the new ringer volume level. Your driver will need to receive this state command and adjust the ringer volume on your device accordingly.</p>

<p><strong>Intercom State Notifications</strong> - These functions consist of notifications    that are sent from the device you are supporting, via your driver, to the Intercom Proxy. For example, when your driver receives the State Command of <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-state-commands-set_ringer_volume">SET_RINGER_VOLUME</a>, it needs to send a State Notification of <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-state-notifications-ringer_volume_changed">RINGER_VOLUME_CHANGED</a> that includes the new ringer volume value.</p>

<p><strong>Intercom State Requests</strong> - These functions  represent requests that are sent from your device driver to the Intercom Proxy for various sets of device state data. For example, when needed your driver may send the Intercom Call Request of <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-state-requests-get_state_list">GET_STATE_LIST</a>. This request returns the device states for all of the intercom endpoints in the project.</p>

<p><strong>Intercom Call Group Requests</strong> - Currently, this consists of one function: <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-call-group-requests-get_group_list">GET_GROUP_LIST</a> which can be used by your driver to obtain the group list of all of intercom call groups in the project.</p>

<p><strong>Intercom Capabilities</strong> -  These <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-capabilities">functions </a> consist of Boolean XML elements that need to be defined in your driver. They represent functionality supported by your device such as do not disturb support, camera inclusion or its ability to play a door chime.</p>

<p><strong>Intercom Events</strong> - <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-events">Events</a> are useful to define in your driver as they provide an opportunity for ComposerPro programming to occur based on them being fired. For example, if the speaker_volume_changed Event is defined in your driver and that Event fires when the speaker volume of your device changes, it would be possible (through programming in ComposerPro) to modify the speaker volume of other intercom devices in the project.</p>

<p><strong>Intercom Conditionals</strong> - <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#intercom-conditionals">Conditionals</a> are useful to define in your driver as they also provide an opportunity for ComposerPro programming to occur based on their state. For example, if the In a Call conditional is set to true, the device that reported this conditional could be displayed as busy on Navigators. </p>

<p><strong>Intercom Variables</strong> – The Intercom Proxy supports three Variables which can also be used in ComposerPro programming when defined in your driver. For example, the CALL_DURATION Variable can be assigned a time limit for a call, If that limit is exceeded, the call can be terminated.</p>

<p>For additional Information, please see the <a href="https://literate-tribble-gq5lk61.pages.github.io/#introduction">DriverWorks Proxy and Protocol Guide</a> regarding all of the functions supported by the Intercom Proxy.</p>

<h2 id='proxy-specific-information-light-proxy-driver-development-best-practices'>Light Proxy Driver Development Best Practices</h2>

<p>The purpose of this section is to provide best practice advice for driver developers developing lighting drivers using the Light V2 Proxy. By following these recommendations, developers will ensure consistent behavior from their driver and other lighting drivers. Additionally, implementing these guidelines will greatly improve driver interaction with other components in the Control4 OS such as Agents, Customer Interfaces, Programming, etc.</p>

<p>For documentation that details the functions that make up the Light V2 Proxy, please see the <a href="https://expert-adventure-1w2nllv.pages.github.io/#introduction">Light Proxy and Protocol Guide</a>.</p>

<h4 id='proxy-specific-information-light-proxy-driver-development-best-practices-using-the-remoteaor-property-brightness-target-api'>Brightness Target API</h4>

<p>A Brightness Target API has been released in conjunction with O.S. 3.3.0. The API is disabled by default for non-color capable drivers and can be enabled with the <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#light-v2-capabilities-supports_target">supports_target</a> capability. The API includes the <a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-commands-set_brightness_target">SET_BRIGHTNESS_TARGET</a> proxy command and <a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-protocol-notifications-light_brightness_changed">LIGHT_BRIGHTNESS_CHANGED</a> and <a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-protocol-notifications-light_brightness_changing">LIGHT_BRIGHTNESS_CHANGING</a> proxy notifies.</p>

<p>Brightness target API should be used by all new driver written against the Light V2 Proxy and existing drivers should be updated if possible. The API is required for driver certification in 3.3.0.  Dimmer drivers should now only use LIGHT_BRIGHTNESS_CHANGING and LIGHT_BRIGHTNESS_CHANGED notifies. Switch drivers only need to use the BRIGHTNESS_CHANGED notify. Note that the LEVEL_CHANGED notify should not be used.</p>

<p>Using the LIGHT_BRIGHTNESS_CHANGING notify command allows drivers to inform the proxy of brightness transitions. Customer Interfaces monitor LIGHT_BRIGHTNESS_CHANGING events and will display a brightness changing animation depending on the provided current brightness, target brightness and rate. This can be useful for devices that do not send intermediate status notifications when transitioning between brightness levels. It is also recommended to send brightness changing notify command in cases where the final level is unknown, such as holding a button to ramp a light, scene or group up or down. For example, if a customer holds a button to slow-ramp a light on, the driver should notify the proxy that the brightness is changing to 100%. This will in turn show a brightness changing animation on Customer Interfaces. Once the customer releases the button (e.g. at 30%), the driver should send a LIGHT_BRIGHTNESS_CHANGED notify to indicate where the light ramping stopped.</p>

<p>Previously, drivers had to &#39;emulate&#39; slider movements on Customer Interfaces by sending periodic, incremental light level notifies during brightness transitions (e.g. every 20ms). These updates cause performance issues including:</p>

<ul>
<li>Slow performance in proxies, director, customer interfaces and Advanced Lighting Scene agent.</li>
<li>Potentially inaccurate states for Advanced Lighting Scene tracking.</li>
<li>Excessive zigbee traffic and often incorrect keypad button LED status.</li>
<li>Inconsistent slider movement in Customer Interfaces.</li>
<li>Excessive triggering and potentially incorrect Composer Programming being fired.</li>
</ul>

<h4 id='proxy-specific-information-light-proxy-driver-development-best-practices-using-the-remoteaor-property-brightness-and-color-changing-api'>Brightness and Color Changing API</h4>

<p>OS 3.3.0 also introduced a new Light V2 Proxy API that allows protocol drivers to notify the proxy that a light&#39;s color (<a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-protocol-notifications-light_color_changing">LIGHT_COLOR_CHANGING</a>) or brightness (<a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-protocol-notifications-light_brightness_changing">LIGHT_BRIGHTNESS_CHANGING</a>) is changing. The use of these notify commands are optional. However, it is recommended to notify the proxy of color or brightness transitions whenever possible. Using these notify commands allows other drivers or agents in the system to monitor the state of the light.</p>

<p>Using these notifies also allows additional Programming:</p>

<ul>
<li>Events: Brightness Begins to ramp and Color begins to ramp.</li>
<li>Conditionals and Loops: Is Brightness Target and Is Color Target.</li>
</ul>

<h4 id='proxy-specific-information-light-proxy-driver-development-best-practices-using-the-remoteaor-property-enforcing-min-max-capabilities'>Enforcing min/max Capabilities</h4>

<p>Beginning with OS 3.3.0, Advanced Lighting Scenes Agent, Customer Interfaces, Programming and other system components strictly enforce min/max and other capability settings in LightV2 Proxy drivers. It is recommended to verify if these capabilities are correct in your drivers.  Existing out-of-range settings (e.g. in <a href="https://snap-one.github.io/docs-driverworks-proxyprotocol/#advanced-lighting-scene-agent">Advanced Lighting Scenes agent</a>, Programming, etc.) will not be forcibly changed on upgrades but any new settings will enforce min/max capabilities.</p>

<p>For example, in pre-OS 3.3.0, Composer and the proxy only enforced <a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-capabilities-click_rate_min">click_rate_min/max capabilities</a> in a driver&#39;s Properties. In the Advanced Lighting Scene Agent and Programming, it was possible to set a rate that was out of the click_rate_min/max range. In OS 3.3.0 and later, it will not be possible to set a rate out of this range. If these capabilities are not correct, partners and customers will not be able to use correct range when specifying ramp rates.</p>

<h4 id='proxy-specific-information-light-proxy-driver-development-best-practices-using-the-remoteaor-property-handling-consecutive-brightness-and-color-commands'>Handling Consecutive Brightness and Color commands</h4>

<p>The Light V2 Proxy has independent commands to set color (chromaticity) (<a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-commands-set_color_target">SET_COLOR_TARGET</a>) and brightness (<a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-commands-set_brightness_target">SET_BRIGHTNESS_TARGET</a>). It is possible to send these commands to the protocol driver one immediately after the other (e.g, Programming, Customer Interfaces, Agents or other drivers). When these commands come in succession, a desired outcome is that the light transitions to the specified color and brightness, i.e., consecutive commands should not interfere or override each other.</p>

<p>Driver developers must make sure that consecutive color and brightness commands are handled correctly. If the device does not support consecutive commands, a best practice is to have a debouncing (and/or queuing) mechanism in the driver so that commands can be combined.</p>

<h4 id='proxy-specific-information-light-proxy-driver-development-best-practices-using-the-remoteaor-property-default-on-and-dim-colors'>Default On and Dim Colors</h4>

<p>All colored lights have a mandatory Default On Color and Default Dim Color presets. These provide a consistent behavior when turning the light on or off. Furthermore, these presets can also be used as &#39;hooks&#39; for other agents/drivers in the system that might want to change color that the light should turn on to or transition to while turning off.</p>

<p>Default On Color should be set whenever the devices turns on through <a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-commands-set_brightness_target">SET_BRIGHTNESS_TARGET</a> command, Button Click and Hold actions, etc.</p>

<p>Default Dim color should be used while the light is turning off, except in cases when the final level is unknown. For example, color should not be changed while dimming down using button hold since it is not known when the dimming will be stopped. For example, it is not known if the customer is dimming to turn off the light or to only lower the brightness.</p>

<h4 id='proxy-specific-information-light-proxy-driver-development-best-practices-using-the-remoteaor-property-setting-color-while-the-light-is-off'>Setting Color while the Light is Off</h4>

<p>The Light V2 proxy allows sending <a href="https://expert-adventure-1w2nllv.pages.github.io/#light-v2-commands-set_color_target">SET_COLOR_TARGET</a> commands to the protocol driver while the light is off. In Control4 OS. color chromaticity and brightness are independent. Because of this, the protocol driver should not turn on the light when a command to set the color is received while the light is off. Instead, drivers should save the last color that was sent while the light is off and set that color when the light subsequently turns on from the Control4 system.</p>

<h4 id='proxy-specific-information-light-proxy-driver-development-best-practices-using-the-remoteaor-property-warm-dim'>Warm Dim</h4>

<p>Warm Dim technology allows LED lights to dim down to a warmer color temperature. This replicates the effect of incandescent and halogen light bulbs. With color and color temperature support in OS 3.3.0, driver developers can &#39;emulate&#39; Warm Dim behavior in their drivers. The following section explains how Warm Dimming is implemented for a Philips Hue driver. However, this approach is recommended for other drivers that support this behavior.</p>

<p><strong>Principle of Operation for Philips Hue</strong>
This feature is only available for lights that support color correlated temperature (CCT) control. Warm Dimming can be enabled or disabled on the Lighting Extras view on the Customer Interfaces or on the driver&#39;s Advanced Properties page in Composer. When enabled, a change to the light&#39;s brightness level will automatically change the color temperature of the light so that lower brightness results in warmer colors and vise versa.</p>

<p>When Warm Dimming is active, color correlated temperature of the light will follow a linear function of brightness, between the &#39;Warm Dimming CCT At Min Brightness&#39; and &#39;Warm Dimming CCT At Max Brightness&#39; Advanced Properties. &#39;Warm Dimming CCT At Min Brightness&#39; and &#39;Warm Dimming CCT At Max Brightness&#39; are color correlated temperatures of the light at 1% and 100% brightness, respectively:</p>

<p><code>cct = WarmDimmingCCTatMinBrightness + (targetBrightness - 1) * (WarmDimmingCCTatMaxBrightness - WarmDimmingCCTatMinBrightness) / 99</code></p>

<p>Enabling Warm Dimming does not change Default On Color and Default Dim Color settings. The light will turn on at the Default On Brightness and CCT will be the value for Default On Brightness on the warm dimming function.</p>

<p>The Following graph displays a Warm Dimming CCT change as function of brightness for the following settings:</p>

<ul>
<li>Warm Dimming CCT At Min Brightness = 2000K</li>
<li>Warm Dimming CCT At Max Brightness = 6000K</li>
<li>Default On Brightness = 50%</li>
<li>With brightness change to 1%, CCT will also be set by the driver to 2000K. At full brightness (100%), CCT will be 6000K. When the light is turned on, CCT will be 3980K (at Default On Brightness of 50%).</li>
</ul>

<p>Warm Dimming will be active only while changing brightness of the light. Changing the CCT does not affect brightness. Furthermore, if any color is selected (including CCT,  e.g. via Customer Interfaces, Advanced Lighting Scenes, Programming) the light will transition to the specified color and will exit the &#39;emulated warm dimming&#39; mode. To return a light to the emulated warm dimming mode, it must be turned off and then turned back on.</p>

<p>For additional Information, please see the <a href="https://expert-adventure-1w2nllv.pages.github.io/#introduction">DriverWorks Proxy and Protocol Guide</a> regarding all of the functions supported by the Light Proxy.</p>

<h2 id='proxy-specific-information-light-proxy-extras-interface-library'>Light Proxy Extras Interface Library</h2><h3 id='proxy-specific-information-light-proxy-extras-interface-library-overview'>Overview</h3>
<p>Extras are a way for driver developers to expose unique hardware functionality that users can interact with on a UI/Navigator.  This functionality bypasses the need for a proxy to know about the unique features and how to handle them.  A protocol driver notify is used to pass the Extras XML information from the protocol driver to the proxy, where the proxy caches the xml strings for current setup and state information. The UI  uses a UI_REQUEST as needed to get the information if the UI has just rebooted/started/loaded and then the UI will get updates of these xml strings if it is listening for dataToUI&#39;s from the device.  Extras objects are accessible through the &quot;Extras Tab&quot; located on the main Navigator screen for the Proxy.</p>
<h3 id='proxy-specific-information-light-proxy-extras-interface-library-capabilities'>Capabilities</h3>
<p>The has_extras capability must be set to true to support the use of Extras. The library will automatically (via dynamic capability) set the has_extras capability when a first Section is created. Also, when the last section is removed, the has_extras capability will be disabled. The Extras class does not implement class destructor as it is not supported in Lua 5.1 and Lua JIT. In the case of setting the Extras class instance to nil, the Extras:cleanCapability() method should be called previously.</p>
<h3 id='proxy-specific-information-light-proxy-extras-interface-library-protocol-notify-and-proxy-messages'>Protocol Notify and Proxy Messages</h3>
<p>There are two notifies a driver must make to the proxy where this information is forwarded immediately to any UI&#39;s listening for dataToUI on the proxy and the information is also cached for future UI&#39;s to request: EXTRAS_SETUP_CHANGED and EXTRAS_STATE_CHANGED.  </p>

<p>Whenever a driver changes values that are reflected in either the setup or state xml, it must make the notify to the proxy with the updated information.  This includes if hardware or a feature is added or removed, a value for one of the objects was updated, and so on.  </p>

<p>It is also advisable for protocol drivers to send this data either on initialization of the driver if the values are not likely to change when hardware comes online, or perhaps when the hardware comes online and the extras commands will be able to succeed.  </p>

<p>In addition, it could be advisable that the state of objects is changed to hidden when hardware and/or disabled features are not available rather than sending new extras_setup notifies as this may cause a UI to redraw the extras page and reset defaults while a user is interacting with the Extras page on a UI.</p>
<h3 id='proxy-specific-information-light-proxy-extras-interface-library-how-ui-39-s-handle-extras-objects'>How UI&#39;s handle Extras objects</h3>
<p>UI&#39;s will display objects in the order they are read in the EXTRAS_SETUP xml.  If an object needs to have a default selection, number or string, the UI looks at the value attribute for the default.  If no value is specified in the EXTRAS_SETUP the UI will default to a behavior listed below for each object type.</p>

<p>When a user changes a value on a UI, the UI will immediately send the command associated with that object down to a protocol driver as a command.  The UI waits for a response that the protocol driver has handled the command and the protocol driver must send an updated EXTRAS_STATE notify for the object.  </p>

<p>The EXTRAS_STATE does not need to include all states of all objects, only the states of the objects it wants to update (or acknowledged) it has received but it could contain more than just one objects updated state.  A driver could also respond back with just the <code>&lt;extras_state&gt;&lt;extra&gt;&lt;object id=&quot;1&quot;&gt;&lt;/extra&gt;&lt;/extras_state&gt;</code> if it wanted to acknowledge the command succeeded but not update the value.  If a UI that sent the command does not get a response in 10 seconds, it will change the value of the object back to what it was prior to what the user had changed it from.</p>
<h3 id='proxy-specific-information-light-proxy-extras-interface-library-extras-library-use-case-examples'>Extras Library Use Case Examples</h3><h4 id='proxy-specific-information-light-proxy-extras-interface-library-extras-library-use-case-examples-importing-the-library'>Importing the library</h4>
<p>To use this library, please move all <code>*.lua</code> files to the source directory of your driver, then import <code>Extras.lua</code> file in your <code>driver.lua</code> file. The <code>Extras.lua</code> file includes all other library files needed.</p>

<p>This library depends on a driver template. Please, make sure that the driver template files are included in the path.
<strong>NOTE</strong> Make sure paths are setup correctly</p>
<h4 id='proxy-specific-information-light-proxy-extras-interface-library-extras-library-use-case-examples-how-to-use-the-library'>How to use the library</h4>
<p><strong>Set Up</strong></p>

<p>The code to the right is an example how to setup the extras library:</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="nb">require</span> <span class="s2">"Extas"</span>

<span class="k">function</span> <span class="nc">ON_DRIVER_INIT</span><span class="p">.</span><span class="nf">SetupExtras</span><span class="p">()</span>
    <span class="n">extras</span> <span class="o">=</span> <span class="n">Extras</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">DEFAULT_PROXY_BINDINGID</span><span class="p">)</span>
    <span class="n">extras</span><span class="p">:</span><span class="n">addSection</span><span class="p">(</span><span class="s2">"ButtonLabel"</span><span class="p">)</span>
    <span class="n">extras</span><span class="p">:</span><span class="n">addSection</span><span class="p">(</span><span class="s2">"CheckboxLabel"</span><span class="p">)</span>
    <span class="kd">local</span> <span class="n">bt1Table</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">=</span> <span class="s2">"Button1ID"</span><span class="p">,</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s2">"Button 1 Label"</span><span class="p">,</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">"Button1Command"</span><span class="p">,</span>
        <span class="n">extraparams</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">Checkbox4ID</span> <span class="o">=</span> <span class="s2">"Extr1"</span><span class="p">,</span>
            <span class="n">Checkbox3ID</span> <span class="o">=</span> <span class="s2">"Extr2"</span><span class="p">,</span>
            <span class="n">Button2ID</span> <span class="o">=</span> <span class="s2">"Extr3"</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="n">extras</span><span class="p">:</span><span class="n">addObjects</span><span class="p">({</span><span class="n">ExtrasButton</span><span class="p">:</span><span class="n">new</span><span class="p">(</span><span class="n">bt1Table</span><span class="p">,</span> <span class="s2">"ButtonText1"</span><span class="p">),</span>
           <span class="n">ExtrasButton</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="n">id</span> <span class="o">=</span> <span class="s2">"Button3ID"</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">"Button 3 Label"</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">"Button1Command"</span><span class="p">},</span> <span class="s2">"ButtonText3"</span><span class="p">),</span>
           <span class="n">ExtrasButton</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="n">id</span> <span class="o">=</span> <span class="s2">"Button2ID"</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">"Button 2 Label"</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">"Button1Command"</span><span class="p">},</span> <span class="s2">"ButtonText2"</span><span class="p">),</span>
           <span class="n">ExtrasButton</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="n">id</span> <span class="o">=</span> <span class="s2">"Button4ID"</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">"Button 4 Label"</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">"Button1Command"</span><span class="p">},</span> <span class="s2">"ButtonText4"</span><span class="p">)},</span>
           <span class="s2">"ButtonLabel"</span><span class="p">)</span>
    <span class="n">extras</span><span class="p">:</span><span class="n">addObjects</span><span class="p">({</span><span class="n">ExtrasCheckbox</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="n">id</span> <span class="o">=</span> <span class="s2">"Checkbox1ID"</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">"Checkbox 1 Label"</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">"Checkbox1Command"</span><span class="p">},</span> <span class="s2">"true"</span><span class="p">),</span>
           <span class="n">ExtrasCheckbox</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="n">id</span> <span class="o">=</span> <span class="s2">"Checkbox2ID"</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">"Checkbox 2 Label"</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">"Checkbox1Command"</span><span class="p">},</span> <span class="s2">"true"</span><span class="p">),</span>
           <span class="n">ExtrasCheckbox</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="n">id</span> <span class="o">=</span> <span class="s2">"Checkbox3ID"</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">"Checkbox 3 Label"</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">"Checkbox1Command"</span><span class="p">},</span> <span class="s2">"true"</span><span class="p">),</span>
           <span class="n">ExtrasCheckbox</span><span class="p">:</span><span class="n">new</span><span class="p">({</span><span class="n">id</span> <span class="o">=</span> <span class="s2">"Checkbox4ID"</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">"Checkbox 4 Label"</span><span class="p">,</span> <span class="n">command</span> <span class="o">=</span> <span class="s2">"Checkbox1Command"</span><span class="p">},</span> <span class="s2">"true"</span><span class="p">)},</span>
           <span class="s2">"CheckboxLabel"</span><span class="p">)</span>
    <span class="n">extras</span><span class="p">:</span><span class="n">sendSetup</span><span class="p">(</span><span class="n">DEFAULT_PROXY_BINDINGID</span><span class="p">)</span>
<span class="k">end</span>

</code></pre></div>
<ul>
<li>Section order in the CI will be in the same order section were added in the container class instance.</li>
<li>Object order in the CI will be in the same order objects were added in the section.</li>
<li>Remember that object could be added as separated elements or as an array of objects.</li>
<li>This setup can be called in <code>DriverLateInit()</code>. Setting extras in the <code>DriverInit()</code> callback is possible but not recommended.</li>
</ul>
<h4 id='proxy-specific-information-light-proxy-extras-interface-library-extras-library-use-case-examples-handling-proxy-commands'>Handling Proxy Commands</h4>
<p>The next code example shows how to write handlers for proxy commands received when extras change:</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="c1">-- Proxy Command Handlers</span>

<span class="n">PRX_CMD</span><span class="p">.</span><span class="n">Button1Command</span><span class="p">(</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="n">C4</span><span class="p">:</span><span class="n">SetVariable</span><span class="p">(</span><span class="s2">"Extras_Button1"</span><span class="p">,</span> <span class="nb">os.date</span><span class="p">())</span>
    <span class="n">LogDebug</span><span class="p">(</span><span class="nb">os.date</span><span class="p">()</span> <span class="o">..</span> <span class="s2">" "</span> <span class="o">..</span> <span class="n">extras</span><span class="p">:</span><span class="n">getObject</span><span class="p">(</span><span class="n">tParams</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">label</span> <span class="o">..</span> <span class="s2">" - Extras Button pressed"</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">PRX_CMD</span><span class="p">.</span><span class="nf">Checkbox1Command</span><span class="p">(</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">tParams</span><span class="p">)</span>
    <span class="n">C4</span><span class="p">:</span><span class="n">SetVariable</span><span class="p">(</span><span class="s2">"Extras_Checkbox1"</span><span class="p">,</span> <span class="n">tParams</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="n">LogDebug</span><span class="p">(</span><span class="nb">os.date</span><span class="p">()</span> <span class="o">..</span> <span class="s2">" "</span> <span class="o">..</span> <span class="n">extras</span><span class="p">:</span><span class="n">getObject</span><span class="p">(</span><span class="n">tParams</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="n">label</span> <span class="o">..</span> <span class="s2">" - Extras Checkbox switched"</span><span class="p">)</span>
    <span class="n">extras</span><span class="p">:</span><span class="n">updateObject</span><span class="p">(</span><span class="n">proxyId</span><span class="p">,</span> <span class="n">tParams</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">tParams</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>To handle changes in extras parameters coming from the device side, the  <code>updateObject</code> method can be used. This method updates extras object instance and sends proxy notification that extras status has been changed. Also, each <code>ExtrasObjectBasedClass</code> class supports the  <code>ExtrasObjectBasedClass:update(value, hidden)</code> method that enables extras update from the class instance directly.</p>

<p>It is nice to create a variable for each extras object, to give the partner opportunity to monitor and take action based on extras states. Sample variable definitions are to the right.</p>
<div class="highlight"><pre class="highlight lua tab-lua"><code><span class="c1">--Variable Examples</span>

<span class="n">C4</span><span class="p">:</span><span class="n">AddVariable</span><span class="p">(</span><span class="s2">"Extras_Button1"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"STRING"</span><span class="p">)</span>
<span class="n">C4</span><span class="p">:</span><span class="n">AddVariable</span><span class="p">(</span><span class="s2">"Extras_Checkbox1"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="s2">"BOOL"</span><span class="p">)</span>
</code></pre></div><h4 id='proxy-specific-information-light-proxy-extras-interface-library-extras-library-use-case-examples-sqishy'>Sqishy</h4>
<p>If the Lua Squish is used, the Module code snippet below should be included in the squishy file:</p>
<div class="highlight"><pre class="highlight xml tab-xml"><code>-- Lua Squish Sample

Module "Extras" "extras/Extras.lua"
Module "ExtrasObject" "extras/ExtrasObject.lua"
Module "ExtrasButton" "extras/ExtrasButton.lua"
Module "ExtrasCheckbox" "extras/ExtrasCheckbox.lua"
Module "ExtrasIcon" "extras/ExtrasIcon.lua"
Module "ExtrasList" "extras/ExtrasList.lua"
Module "ExtrasSwitch" "extras/ExtrasSwitch.lua"
Module "ExtrasNumber" "extras/ExtrasNumber.lua"
Module "ExtrasSlider" "extras/ExtrasSlider.lua"
Module "ExtrasText" "extras/ExtrasText.lua"
Module "ExtrasTextField" "extras/ExtrasTextField.lua"
</code></pre></div>
<p>In this case, the library can be used as git submodule.</p>
<h4 id='proxy-specific-information-light-proxy-extras-interface-library-extras-library-use-case-examples-removing'>Removing</h4>
<p>To remove the object or the section please use following methods:</p>

<ul>
<li><code>Extras:removeObject(id)</code></li>
<li><code>Extras:removeSection(sectionLabel)</code></li>
</ul>

<p>This way, you will avoid lost objects (objects that are in section array but will not be displayed because empty index before).
It is strongly recommended to hide rather than remove objects that will be temporary removed form the CI.</p>

<p>Before destroying an Extras class instance, please use the <code>Extras:cleanCapability()</code> method. Also, please pay attention to the Capability section of the documentation.</p>

<p>For additional Information, please see the <a href="https://expert-adventure-1w2nllv.pages.github.io/#introduction">DriverWorks Proxy and Protocol Guide</a> regarding all of the functions supported by the Light Proxy.</p>

<h2 id='proxy-specific-information-security-sensor-types'>Security Sensor Types</h2>

<p>The following sensor types and their respective ID values are listed below:</p>

<ul>
<li>UNKNOWN = 0</li>
<li>CONTACT_SENSOR = 1</li>
<li>EXTERIOR_DOOR = 2</li>
<li>EXTERIOR_WINDOW = 3</li>
<li>INTERIOR_DOOR = 4</li>
<li>MOTION_SENSOR = 5</li>
<li>FIRE = 6</li>
<li>GAS = 7</li>
<li>CARBON_MONOXIDE = 8</li>
<li>HEAT = 9</li>
<li>WATER = 10</li>
<li>SMOKE = 11</li>
<li>PRESSURE = 12</li>
<li>GLASS_BREAK = 13</li>
<li>GATE = 14</li>
<li>GARAGE_DOOR = 15</li>
</ul>

<p>There are no restrictions imposed regarding sensor types when zone information is sent to the security proxy and functionality is not impacted based on the sensor type defined. The sensor type value only dictates which icons are displayed on Navigators and within ComposerPro.</p>

<p>For additional Information, please see the <a href="https://super-bassoon-22j7m8r.pages.github.io/#introduction">DriverWorks Proxy and Protocol Guide</a> regarding all of the functions supported by the Security Proxy.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="lua">lua</a>
          </div>
      </div>
    </div>
  </body>
</html>
